{"version":3,"sources":["types/index.tsx","redux/actions/index.ts","redux/reducers/addOrg.ts","redux/reducers/editOrg.ts","redux/reducers/viewOrg.ts","redux/reducers/browseOrgs.ts","redux/reducers/auth.ts","redux/reducers/app.ts","redux/reducers/manageOrganizationRequests.ts","redux/reducers/viewMembers.ts","data/apis/groups.ts","data/models/requests.ts","data/models/organization/model.ts","data/models/organization/validation.ts","redux/reducers/inviteUser.ts","redux/reducers/manageMembership.ts","redux/reducers/requestAddNarrative.ts","redux/reducers/dashboard.ts","redux/reducers/entities.ts","redux/reducers/organizationCentric.ts","redux/reducers/global.ts","redux/reducers/index.tsx","components/entities/Member.tsx","components/entities/Avatar.tsx","data/apis/userProfile.ts","data/models/user.ts","data/apis/genericClient.ts","data/apis/serviceWizard.ts","data/apis/serviceClient.ts","data/apis/dynamicServiceClient.ts","data/models/narrative.ts","data/apis/narrativeService.ts","data/apis/workspaceUtils.ts","redux/actions/entities.ts","components/entities/MemberContainer.tsx","components/organizations/component.tsx","components/organizations/container.tsx","components/Header.tsx","components/views/browseOrgs/component.tsx","redux/actions/browseOrgs.ts","components/views/browseOrgs/container.tsx","components/views/browseOrgs/loader.tsx","redux/actions/addOrg.ts","components/views/newOrganization/component.tsx","components/views/newOrganization/container.tsx","components/views/newOrganization/loader.tsx","data/models/uber.ts","redux/actions/viewOrg.ts","components/views/organizationHeader/component.tsx","components/views/organizationHeader/container.tsx","redux/actions/organizationCentric.ts","components/views/organizationHeader/loader.tsx","components/views/viewOrganization/component.tsx","components/OrganizationNarrative.tsx","components/views/viewOrganization/container.tsx","components/views/viewOrganization/loader.tsx","redux/actions/editOrg.ts","components/views/editOrganization/component.tsx","components/views/editOrganization/container.tsx","components/views/editOrganization/loader.tsx","components/Auth.tsx","data/auth.ts","redux/actions/auth.ts","containers/Auth.tsx","lib/windowChannel.ts","lib/IFrameSimulator.ts","lib/IFrameIntegration.ts","redux/actions/app.ts","components/KBaseIntegration.tsx","containers/KBaseIntegration.tsx","redux/actions/manageOrganizationRequests.ts","components/entities/User.tsx","components/entities/UserContainer.tsx","components/entities/Narrative.tsx","components/entities/NarrativeContainer.tsx","components/views/manageOrganizationRequests/component.tsx","components/views/manageOrganizationRequests/container.tsx","components/views/manageOrganizationRequests/loader.tsx","redux/actions/viewMembers.ts","components/views/viewMembers/MemberRow.tsx","components/views/viewMembers/component.tsx","components/views/viewMembers/container.ts","components/views/viewMembers/loader.tsx","redux/actions/inviteUser.ts","components/User.tsx","components/views/inviteUser/component.tsx","components/views/inviteUser/container.tsx","components/views/inviteUser/loader.tsx","components/views/manageMembership/component.tsx","components/views/manageMembership/container.tsx","components/views/manageMembership/loader.tsx","components/views/requestAddNarrative/component.tsx","redux/actions/manageMembership.ts","redux/actions/requestAddNarrative.ts","components/views/requestAddNarrative/container.tsx","components/views/requestAddNarrative/loader.tsx","components/views/dashboard/OrganizationCompact.tsx","components/views/dashboard/Organization.tsx","components/views/dashboard/OrganizationCompactContainer.tsx","data/formatters.ts","components/notifications/component.tsx","components/notifications/storeAdapter.tsx","components/views/dashboard/component.tsx","components/views/dashboard/container.tsx","data/models/feeds.ts","data/apis/feeds.ts","components/views/dashboard/loader.tsx","redux/actions/dashboard.ts","redux/state.tsx","App.tsx","index.tsx"],"names":["UIErrorType","MemberType","RequestType","RequestResourceType","RequestStatus","AuthState","EditOrgState","SyncState","EditState","SaveState","ValidationState","FieldState","ViewOrgState","AppState","SortDirection","ComponentLoadingState","BrowseOrgsState","InviteUserViewState","NarrativeState","ProcessingState","RequestNarrativeState","ActionFlag","AppException","_Error","_ref","_this","code","message","detail","info","Object","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","name","Error","captureStackTrace","assertThisInitialized","stack","indexOf","trace","split","inherits","wrapNativeSuper","reducer","state","action","type","ADD_ORG_SAVE","views","addOrgView","viewModel","objectSpread","saveState","SAVING","console","warn","saveStart","ADD_ORG_SAVE_SUCCESS","editState","UNEDITED","SAVED","saveSuccess","ADD_ORG_SAVE_ERROR","SAVE_ERROR","error","saveError","ADD_ORG_LOAD_START","loadingState","LOADING","loadStart","ADD_ORG_LOAD_SUCCESS","SUCCESS","validationState","NONE","NEW","newOrganization","loadSuccess","ADD_ORG_LOAD_ERROR","loadError","ADD_ORG_UNLOAD","unload","ADD_ORG_UPDATE_NAME_SUCCESS","EDITED","value","VALID","validatedAt","Date","updateNameSuccess","ADD_ORG_UPDATE_NAME_ERROR","INVALID","updateNameError","ADD_ORG_UPDATE_GRAVATAR_HASH_SUCCESS","gravatarHash","updateGravatarHashSuccess","ADD_ORG_UPDATE_GRAVATAR_HASH_ERROR","updateGravatarHashError","ADD_ORG_UPDATE_ID_SUCCESS","id","updateIdSuccess","ADD_ORG_UPDATE_ID_ERROR","updateIdError","ADD_ORG_UPDATE_ID_PASS","updateIdPass","ADD_ORG_UPDATE_DESCRIPTION_SUCCESS","description","updateDescriptionSuccess","ADD_ORG_UPDATE_DESCRIPTION_ERROR","updateDescriptionError","ADD_ORG_UPDATE_IS_PRIVATE_SUCCESS","isPrivate","updateIsPrivateSuccess","ADD_ORG_EVALUATE_OK","addOrgEvaluateOk","ADD_ORG_EVALUATE_ERRORS","addOrgEvaluateErrors","EDIT_ORG_LOAD_START","editOrgView","EDIT_ORG_LOAD_SUCCESS","organization","editedOrganization","EDIT_ORG_LOAD_ERROR","ERROR","EDIT_ORG_SAVE_START","editOrgSaveStart","EDIT_ORG_SAVE_SUCCESS","editOrgSaveSuccess","EDIT_ORG_SAVE_ERROR","editOrgSaveError","EDIT_ORG_UPDATE_NAME_SUCCESS","editOrgUpdateNameSuccess","EDIT_ORG_UPDATE_NAME_ERROR","editOrgUpdateNameError","EDIT_ORG_UPDATE_GRAVATAR_HASH_SUCCESS","editOrgUpdateGravatarHashSuccess","EDIT_ORG_UPDATE_GRAVATAR_HASH_ERROR","editOrgUpdateGravatarHashError","EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS","editOrgUpdateDescriptionSuccess","EDIT_ORG_UPDATE_DESCRIPTION_ERROR","editOrgUpdateDescriptionError","EDIT_ORG_EVALUATE_OK","editOrgEvaluateOk","EDIT_ORG_EVALUATE_ERRORS","editOrgEvaluateErrors","VIEW_ORG_LOAD_START","viewOrgView","types","VIEW_ORG_LOAD_SUCCESS","relation","groupRequests","groupInvitations","VIEW_ORG_LOAD_ERROR","VIEW_ORG_UNLOAD","VIEW_ORG_REMOVE_NARRATIVE_SUCCESS","newNarratives","narratives","filter","narrative","workspaceId","removeNarrativeSuccess","VIEW_ORG_ACCESS_NARRATIVE_SUCCESS","accessNarrativeSuccess","BROWSE_ORGS_LOAD_SUCCESS","_action$defaultViewMo","defaultViewModel","rawOrganizations","organizations","searchTerms","sortBy","sortDirection","totalCount","filteredCount","selectedOrganizationId","searching","browseOrgsView","BROWSE_ORGS_SEARCH","_state$views$browseOr","searchOrgs","BROWSE_ORGS_SEARCH_START","searchOrgsStart","BROWSE_ORGS_SEARCH_SUCCESS","length","searchOrgsSuccess","BROWSE_ORGS_SEARCH_ERROR","searchOrgsError","BROWSE_ORGS_SORT_START","_state$views$browseOr2","auth","authorization","username","sortOrgsStart","BROWSE_ORGS_FILTER_START","filterOrgsStart","AUTH_CHECK_START","status","CHECKING","token","realname","roles","authCheckStart","AUTH_AUTHORIZED","AUTHORIZED","authAuthorized","AUTH_UNAUTHORIZED","UNAUTHORIZED","authUnauthorized","AUTH_CHECK_ERROR","authCheckError","APP_SUCCESS","app","READY","config","appSuccess","ADMIN_MANAGE_REQUESTS_LOAD_START","ADMIN_MANAGE_REQUESTS_LOAD_SUCCESS","manageOrganizationRequestsView","requests","invitations","ADMIN_MANAGE_REQUESTS_LOAD_ERROR","ADMIN_MANAGE_REQUESTS_UNLOAD","ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_SUCCESS","newRequests","map","request","getViewAccessSuccess","VIEW_MEMBERS_LOAD_START","viewMembersView","VIEW_MEMBERS_LOAD_SUCCESS","VIEW_MEMBERS_LOAD_ERROR","VIEW_MEMBERS_UNLOAD","VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS","members","member","memberUsername","ADMIN","promoteToAdminSuccess","VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS","MEMBER","demoteToMemberSuccess","GroupException","_AppException","apperror","Map","httpcode","httpstatus","appcode","callid","time","originalError","ServerException","_AppException2","_this2","GroupsClient","url","createClass","key","fetch","headers","Authorization","Accept","mode","then","response","json","result","exists","_this3","getTime","Promise","all","group","getGroupById","path","body","concat","join","Content-Type","method","JSON","stringify","statusText","get","text","_post","asyncToGenerator","regenerator_default","a","mark","_callee","errorText","wrap","_context","prev","next","sent","t0","abrupt","stop","_x","_x2","apply","arguments","_get","_callee2","_context2","_x3","newGroup","payload","private","custom","gravatarhash","put","groupUpdate","_getRequest","_callee3","requestId","_context3","_x4","groupId","params","query","URLSearchParams","includeClosed","append","DESCENDING","startAt","String","toString","complete","_grantResourceAccess","_callee4","resourceType","resourceId","_context4","post","_x5","_x6","_x7","_ref2","_ref3","_ref4","_ref5","_ref6","_ref7","_ref8","_ref9","groupRequestToOrgRequest","requestType","INVITATION","REQUEST","stringToRequestType","USER","WORKSPACE","APP","stringToResourceType","resourcetype","requestStatus","OPEN","organizationId","groupid","requester","user","resource","createdAt","createdate","expireAt","expiredate","modifiedAt","moddate","narrativeId","appId","UserRelationToOrganization","UserWorkspacePermission","RequestsModel","groupsClient","groupsApi","groupsServiceURL","cache","grequest","has","getRequest","set","_getUserRequests","grequests","getCreatedRequests","forEach","_getUserRequestForOrg","find","r","_getPendingRequestsForOrg","_getOrganizationInvitations","_callee5","_context5","_getOrganizationInvitationsForOrg","_callee6","_context6","getOrganizationInvitations","invitation","_getUserInvitations","_callee7","_context7","getTargetedRequests","_getUserInvitationForOrg","_callee8","_context8","_getPendingOrganizationRequestsForOrg","_callee9","_context9","getGroupRequests","_getPendingOrganizationRequests","_callee10","groupIds","allRequests","_context10","reduce","_cancelRequest","_callee11","_context11","cancelRequest","_x8","_acceptRequest","_callee12","_context12","acceptRequest","_x9","_denyRequest","_callee13","_context13","denyRequest","_x10","_acceptJoinInvitation","_callee14","_context14","_x11","_rejectJoinInvitation","_callee15","_context15","_x12","_inviteUserToJoinOrg","_callee16","_context16","inviteUserToGroup","_x13","_x14","Validation","s","firstNonPrintable","search","nonPrintableRe","beforeStart","before","slice","after","match","determineRelation","org","owner","OWNER","MEMBER_REQUEST_PENDING","MEMBER_INVITATION_PENDING","groupToOrganization","currentUser","joinedAt","joined","admins","admin","resources","workspace","parseInt","rid","title","narrname","isPublic","public","permission","groupsPermission","VIEW","EDIT","groupPermissionToWorkspacePermission","perm","isMember","ismember","apps","applyOrgSearch","orgs","searchTermsRe","term","RegExp","every","termRe","test","applySort","direction","ASCENDING","sort","b","localeCompare","applyFilter","findIndex","OrganizationModel","_getOrg","_getOrgs","ids","getOrg","_getAllOrgs","groups","getGroups","getOrgs","_getOwnOrgs","getAllOrgs","_queryOrgs","filtered","searched","sorted","total","_ownOrgs","ownGroups","ownOrganizations","_grantViewAccess","req","grantReadAccessToRequestedResource","requestModel","_addOrg","newOrg","reject","createGroup","_orgExists","groupExists","_updateOrg","orgUpdate","updateGroup","validateOrgId","validateOrgName","validateOrgDescription","_removeNarrativeFromOrg","deleteResource","_grantNarrativeAccess","grantResourceAccess","_requestMembershipToGroup","requestMembership","_x15","_addOrRequestNarrativeToGroup","addOrRequestNarrative","_x16","_x17","memberToAdmin","adminToMember","removeMember","userPermissionToWorkspacePermission","userPermission","isOwner","INVITE_USER_LOAD_START","inviteUserView","INVITE_USER_LOAD_SUCCESS","EDITING","users","selectedUser","INVITE_USER_LOAD_ERROR","INVITE_USER_UNLOAD","INVITE_USER_SEARCH_USERS_SUCCESS","searchUsersSuccess","INVITE_USER_SELECT_USER_SUCCESS","selectUserSuccess","INVITE_USER_SEND_INVITATION_START","SENDING","sendInvitationStart","INVITE_USER_SEND_INVITATION_SUCCESS","_state$views$inviteUs","orgModel","newUsers","sendInvitationSuccess","INVITE_USER_SEND_INVITATION_ERROR","sendInvitationError","MANAGE_MEMBERSHIP_LOAD_START","manageMembershipView","MANAGE_MEMBERSHIP_LOAD_SUCCESS","MANAGE_MEMBERSHIP_LOAD_ERROR","MANAGE_MEMBERSHIP_UNLOAD","sendRequestStart","requestNarrativeView","REQUEST_ADD_NARRATIVE_LOAD_START","REQUEST_ADD_NARRATIVE_LOAD_SUCCESS","selectedNarrative","REQUEST_ADD_NARRATIVE_LOAD_ERROR","REQUEST_ADD_NARRATIVE_SEND_START","REQUEST_ADD_NARRATIVE_SEND_SUCCESS","newState","ASSOCIATED","REQUESTED","sendRequestSuccess","REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_SUCCESS","selectNarrativeSuccess","REQUEST_ADD_NARRATIVE_UNLOAD","DASHBOARD_LOAD_START","dashboardView","DASHBOARD_LOAD_SUCCESS","notifications","pendingRequests","pendingInvitations","pendingAdminRequests","pendingGroupRequests","DASHBOARD_LOAD_ERROR","DASHBOARD_UNLOAD","ENTITY_USER_LOADER_SUCCESS","entities","byId","userLoaderSuccess","ENTITY_ORGANIZATION_LOADER_SUCCESS","orgsMap","organizationLoaderSuccess","ENTITY_NARRATIVE_LOAD_SUCCESS","loadNarrativeSuccess","ORGANIZATION_CENTRIC_VIEW_LOAD_START","organizationCentricView","ORGANIZATION_CENTRIC_VIEW_LOAD_SUCCESS","pendingJoinRequest","pendingJoinInvitation","ORGANIZATION_CENTRIC_VIEW_LOAD_ERROR","ORGANIZATION_CENTRIC_VIEW_UNLOAD","GLOBAL_ACCESS_NARRATIVE_SUCCESS","narrativesById","View","addOrgReducer","editOrgReducer","browseOrgsReducer","viewOrgReducer","authReducer","appReducer","manageOrganizatiopRequests","viewMembers","inviteUser","manageMembership","requestAddNarrative","dashboard","organizationCentric","global","Avatar","_React$Component","props","avatarOption","gravatarDefault","avatarUrl","getAvatarUrl","react","src","style","width","size","React","Member","view","COMPACT","setState","v","NORMAL","reverseView","icon","className","components_entities_Avatar","avatarSize","href","target","renderRole","Intl","DateTimeFormat","month","day","year","format","onClick","onToggleView","bind","city","country","x","renderCompact","renderNormal","UserProfileClient","param","version","Math","random","makeEmptyPayload","_getUserProfile","profileCache","resolve","makePayload","usernames","profileToUser","profile","jobTitle","userdata","jobTitleOther","synced","UserModel","userProfileClient","userProfileServiceURL","_getUser","userProfile","getUserProfile","_getUsers","toFetch","userProfiles","push","getUserProfiles","_searchUsers","searchUsers","excludedUsers","AuthorizedGenericClient","_GenericClient","_callFunc2","func","processResponse","GenericClient","module","_processResponse","_error","_error2","_callFunc","ServiceWizardClient","_AuthorizedServiceCli","callFunc","theResult","_ServiceClient","AuthorizedServiceClient","ServiceClient","constructor","NarrativeAccess","moduleCache","Cache","itemLifetime","monitoringFrequency","waiterTimeout","waiterFrequency","cacheLifetime","isMonitoring","window","setTimeout","newCache","cacheRenewed","keys","item","isExpired","runMonitor","cacheItem","reserved","undefined","cached","delete","Bluebird","started","waiter","reserveAndFetch","fetcher","catch","err","elapsed","reserveItem","fetchPromise","setItem","finally","isCancelled","isReserved","reserveWaiter","NarrativeServiceClient","_DynamicServiceClient","_listNarratives","slicedToArray","DynamicServiceClient","timeout","rpcContext","moduleId","getModule","getItemWithWait","_this4","getCached","client","getServiceStatus","module_name","funcName","_this5","lookupModule","serviceStatus","iso8601ToDate","dateString","dateParts","exec","TypeError","offset","newDateString","workspaceInfoToObject","wsInfo","objectCount","globalReadPermission","lockStatus","metadata","objectInfoToObject","data","majorVersion","minorVersion","savedAt","savedBy","workspaceName","checksum","ref","NarrativeModel","_getOwnNarratives","narrativeServiceClient","requestClient","narrativesResult","workspacesInOrg","serviceWizardURL","listNarratives","getPendingRequestsForOrg","nar","workspaceInfo","workspaceApi","ws","objectInfo","is_temporary","objectId","narrative_nice_name","_workspaceToNarrative","workspaceClient","_ref4$","_ref4$$","rawObjectInfoError","_ref4$2","_ref4$2$","rawWorkspaceInfo","rawWorkspaceInfoError","workspaceServiceURL","objects","wsid","objid","includeMetadata","ignoreErrors","_getNarrative","_ref6$","rawObjectInfo","_ref6$2","_access","access","infos","lastSavedAt","lastSavedBy","t1","userLoader","userId","dispatch","getState","_getState","_getState$auth$author","model","_user","ENTITY_USER_LOADER_START","userModel","services","UserProfile","getUser","ENTITY_USER_LOADER_ERROR","Loader","components_entities_Member","onLoad","connect","actions","Organizations","height","count","singular","plural","pluralize","index","NavLink","to","renderAvatar","MemberContainer","renderOrg","es_alert","maxWidth","margin","overflowY","display","flexDirection","renderOrgs","Header","breadcrumbs","verticalAlign","marginLeft","marginRight","data-test","buildSeparator","buttons","OrganizationsBrowser","searchInput","searchButton","showInfo","onSearchOrgs","Modal","content","current","currentSearchInputValue","e","preventDefault","doSearch","onSortOrgs","onFilterOrgs","onSearchInputChange","onSubmit","placeholder","onChange","autoFocus","es_button","disabled","haveSearchInput","form","htmlType","renderSearchIcon","onClearSearch","fontWeight","fontStyle","renderSearchFeedback","shape","onShowInfo","src_components_Header","es_select","onSortByChange2","defaultValue","dropdownMatchSelectWidth","Option","onSortDirectionChange2","onFilterChange2","container","renderHeader","renderSearchBar","renderSearchFilter","renderOrganizations","load","BROWSE_ORGS_LOAD_START","_browseOrgsView$viewM","Groups","queryOrgs","sortOrgs","_getState2","_getState2$auth$autho","orgClient","_browseOrgsView$viewM2","filterOrgs","_getState3","_getState3$auth$autho","_browseOrgsView$viewM3","storeState","_storeState$views$bro","renderLoading","renderError","browseOrgs_container","onUnload","BROWSE_ORGS_UNLOAD","AddOrgEvaluateErrors","addOrgEvaluate","addOrg","ADD_ORG_SAVE_START","_state$auth$authoriza","exception","_state$views$addOrgVi","orgModelFromState","_state$auth$authoriza2","updateName","_Validation$validateO","_Validation$validateO2","validatedName","updateGravatarHash","_Validation$validateO3","validateOrgGravatarHash","_Validation$validateO4","validateGravatarHash","Debouncer","delay","fun","canceled","timer","startWaiting","clearTimeout","activeDebouncer","updateId","_Validation$validateO5","_Validation$validateO6","validatedId","lastValidatedAt","now","_Validation$validateO7","_Validation$validateO8","orgExists","cancel","updateDescription","_model$validateOrgDes","_model$validateOrgDes2","validatedDescription","NewOrganization","cancelToBrowser","showError","gravatarEmail","origin","document","location","email","hashed","md5","onUpdateGravatarHash","isModified","confirm","onOk","onCancel","okText","cancelText","onSave","persist","onUpdateName","onUpdateDescription","onUpdateId","onUpdateIsPrivate","checked","input","onNameChange","color","es_checkbox","onIsPrivateChange","marginBottom","flex","onGravatarEmailSync","onGravatarHashChange","onIdChange","minHeight","maxHeight","onDescriptionChange","getOrgAvatarUrl","renderOrgAvatar","dangerouslySetInnerHTML","__html","marked","_this$props","label","errorButton","orgName","toggleError","canSave","line","modal","visible","okType","Redirect","renderForm","renderPreview","renderLoadingHeader","updateIsPrivate","Component","newOrganization_container","UberModel","_getOrganizationForUser","getUserRequestForOrg","getUserInvitationForOrg","getPendingOrganizationRequestsForOrg","_getOrganizationsForUser","getOwnOrgs","getUserRequests","getUserInvitations","removeNarrativeError","VIEW_ORG_REMOVE_NARRATIVE_ERROR","accessNarrativeError","VIEW_ORG_ACCESS_NARRATIVE_ERROR","viewOrgJoinRequestError","VIEW_ORG_JOIN_REQUEST_ERROR","acceptJoinInvitationStart","VIEW_ORG_ACCEPT_JOIN_INVITATION_START","uberClient","_organization","_relation","uberModel","ServiceWizard","Workspace","getOrganizationForUser","getOrganizationInvitationsForOrg","viewOrgJoinRequest","_state$auth$authoriza3","requestMembershipToGroup","VIEW_ORG_JOIN_REQUEST_SUCCESS","viewOrgCancelJoinRequest","_state$auth$authoriza4","newRequest","VIEW_ORG_JOIN_REQUEST_START","VIEW_ORG_CANCEL_JOIN_REQUEST_SUCCESS","VIEW_ORG_CANCEL_JOIN_REQUEST_ERROR","acceptJoinInvitation","_state$auth$authoriza5","VIEW_ORG_ACCEPT_JOIN_INVITATION_SUCCESS","VIEW_ORG_ACCEPT_JOIN_INVITATION_ERROR","rejectJoinInvitation","_state$auth$authoriza6","VIEW_ORG_REJECT_JOIN_INVITATION_SUCCESS","VIEW_ORG_REJECT_JOIN_INVITATION_ERROR","NavigateTo","OrganizationHeader","navigateTo","getUserRelation","currentUsername","onJoinOrg","success","onCancelJoinRequest","onAcceptInvitation","onRejectInvitation","MANAGE_MEMBERSHIP","VIEW_MEMBERS","MANAGE_REQUESTS","EDIT_ORGANIZATION","INVITE_USER","VIEW_ORGANIZATION","onNavigateToViewOrganization","tooltip","placement","mouseEnterDelay","textAlign","onJoinClick","spin","menu","es_menu","onMenuClick","Item","dropdown","overlay","trigger","theme","fontSize","adminMenu","ownerMenu","renderOrgInfo","getRelationClass","renderRelation","organizationHeader_container","OrganizationNarrative","requestAccess","onGetViewAccess","shareButton","permissionTooltip","buttonTooltip","onRequestAccess","cursor","renderPublicPermission","renderNarrativePermission","accessModal","drawer","closable","onClose","onCloseRequestAccess","renderNarrative","ViewOrganization","REQUEST_ADD_NARRATIVE","onRemoveNarrative","renderEditRow","organizationHeader_loader","marginTop","card","headStyle","backgroundColor","inner","twoToneColor","renderGroupRequestsRow","renderGroupRequests","renderEditButton","renderJoinButton","memberCount","extras","onViewMembers","extra","renderMembers","onNarrativeMenu","onRequestAddNarrative","narrativesTable","OrganizationNarrative_OrganizationNarrative","renderNarrativeMenu","narrativeCount","renderOrgHeader","renderNarratives","renderAdminTasks","renderInfo","renderMembersCard","ownProps","_state$views$viewOrgV","onViewOrg","VIEW_ORG_REMOVE_NARRATIVE_START","removeNarrativeFromOrg","VIEW_ORG_ACCESS_NARRATIVE_START","grantNarrativeAccess","viewOrganization_container","editableOrg","editOrgSave","_state$views$editOrgV","update","updateOrg","editOrgEvaluate","editOrgUpdateName","editOrgUpdateGravatarHash","editOrgUpdateDescription","_orgClient$validateOr","_orgClient$validateOr2","EditOrganization","cancelToViewer","onEditOrgSave","renderOrgName","onClickCancelToViewer","editOrganization_container","EDIT_ORG_UNLOAD","Auth","tokenRef","checkAuth","onRemoveAuthorization","onAddAuthorization","onLoginClick","onLogoutClick","buildAuthToolbar","children","buildAuthForm","hosted","buildAuthProd","buildAuthDev","endpoints","AuthClient","makePath","Cookies","getTokenInfo","getMe","account","desc","Listener","onSuccess","onError","WaitingListener","Message","channel","uuidv4","created","envelope","Channel","host","channelId","awaitingResponse","waitingListeners","listeners","lastId","sentCount","receivedCount","unwelcomeReceivedCount","unwelcomeReceivedCountThreshhold","unwelcomeReceiptWarning","unwelcomeReceiptWarningCount","currentListener","messageEvent","handler","ex","awaiting","listener","messageId","listen","postMessage","getMessage","sendMessage","sendRequest","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_loop","_iterator","entries","Symbol","iterator","done","return","startMonitor","listenOnce","received","receiveMessage","addEventListener","removeEventListener","IFrameSimulator","frameId","uuid","feedsServiceURL","parentHost","IFrameIntegration","frameElement","hasAttribute","getAttribute","parse","decodeURIComponent","KBaseIntegration","onAppStart","iframeParams","getParamsFromIFrame","baseUrl","Feeds","fakeIframeParams","_requests","_invitations","User","components_entities_User","Narrative","narrativeModel","renderUserPermission","Narrative_Narrative","narrativeClient","_narrative","ENTITY_NARRATIVE_LOAD_START","getNarrative","ENTITY_NARRATIVE_LOAD_ERROR","ManageGroupRequests","onAcceptJoinRequest","onDenyJoinRequest","onCancelJoinInvitation","open","someDate","measure","measureAbs","unit","nowDate","round","elapsedAbs","abs","prefix","suffix","getFullYear","hoverable","UserContainer","niceElapsed","narrativeAccess","NarrativeContainer","renderRequestJoinRequest","renderRequestNarrativeRequest","renderRequestAppRequest","renderRequestJoinInvitation","_this6","showIcon","minWidth","renderRequest","_this7","es_Redirect","invitationCount","requestCount","renderRequests","renderInvitations","_request2","ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_SUCCESS","ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_ERROR","_getState4","_getState4$auth$autho","_request3","ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_SUCCESS","ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_ERROR","_getState5","_getState5$auth$autho","ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_ERROR","_request","ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_START","grantViewAccess","ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_ERROR","manageOrganizationRequests_container","promoteToAdmin","VIEW_MEMBERS_PROMOTE_TO_ADMIN_START","VIEW_MEMBERS_PROMOTE_TO_ADMIN_ERROR","demoteToMember","VIEW_MEMBERS_DEMOTE_TO_MEMBER_START","VIEW_MEMBERS_DEMOTE_TO_MEMBER_ERROR","VIEW_MEMBERS_REMOVE_MEMBER_START","VIEW_MEMBERS_REMOVE_MEMBER_SUCCESS","VIEW_MEMBERS_REMOVE_MEMBER_ERROR","MemberRow","over","onPromoteMemberToAdmin","onDemoteAdminToMember","onRemoveMember","renderPromoteButton","onMemberMenu","onAdminMenu","renderOwnerMenu","renderAdminMenu","renderMemberMenu","onMouseEnter","onMouseOver","onMouseLeave","onMouseOut","renderMemberOptions","ViewMembers","adminUsername","viewMembers_MemberRow","onViewMembersUnload","renderOrganizationHeader","renderMembersToolbar","renderAdminsToolbar","_state$views$viewMemb","ViewMembersLoader","onViewMembersLoad","viewMembers_container","selectUserError","INVITE_USER_SELECT_USER_ERROR","selectUser","selectedUsername","INVITE_USER_SELECT_USER_START","sendInvitation","_getState4$views$invi","inviteUserToJoinOrg","InviteUser","lastSearchAt","cancelToViewMembers","autocompleteMessage","onSendInvitation","doSearchUsers","searchDebounce","onSearchUsers","onSelectUser","onClickCancelToViewMembers","button","SENDABLE","src_components_User","renderSearchButton","renderUsers","renderSelectedUser","renderInvitationForm","renderFooter","userClient","adminUsers","invited","requested","_users","orgUsers","INVITE_USER_SEARCH_USERS_START","INVITE_USER_SEARCH_USERS_ERROR","InviteUserLoader","onInviteUserLoad","inviteUser_container","ManageMembership","doCancelToViewer","doShowInfo","manageMembership_container","RequestAddNarrative","BROWSER","VIEWER","doSelectNarrative","doSendRequest","classNames","log","onSearchSubmit","onSortByChange","onSortDirectionChange","renderFilterSortBar","buttonLabel","canSendRequest","renderNarrativeSelector","renderSelectedNarrative","renderSelectedNarrativeButton","selectNarrative","REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_START","_state$views$requestN","addOrRequestNarrativeToGroup","REQUEST_ADD_NARRATIVE_SEND_ERROR","requestAddNarrative_container","_narratives","getOwnNarratives","OrganizationBlock","organizationModel","renderMemberCount","requestsPending","renderRelationInfo","renderAdminInfo","OrganizationCompact","OrganizationCompact_OrganizationCompact","ENTITY_ORGANIZATION_LOADER_START","ENTITY_ORGANIZATION_LOADER_ERROR","Notifications","notification","actor","verb","source","renderNotification","renderNotifications","values","db","Array","from","Dashboard","NEW_ORG","onNavigateToNewOrg","onNavigateToBrowser","Organization_OrganizationBlock","renderPendingNotifications","renderPendingRequestsSent","renderPendingRequestsReceived","some","isAdmin","renderPendingAdminRequests","storeAdapter","formatters","renderRequestSentType","renderRequestSentSubject","OrganizationCompactContainer","renderRequestReceivedType","renderRequestReceivedSubject","renderRequestRequester","renderOrganizationsCard","renderNotificationsCard","renderPendingRequestsSentCard","renderPendingRequestsReceivedCard","renderPendingAdminTasksCard","Level","FeedsClient","textResult","_getNotifications","convertLevel","level","ALERT","WARNING","feedsClient","feedsApi","getNotifications","feed","object","seen","expires","external_key","context","expiresAt","externalKey","dashboard_container","requestModelClient","adminOrgIds","_pendingGroupRequests","getOrganizationsForUser","getPendingOrganizationRequests","StateInstances","collections","byGroup","pending","library","add","faSpinner","faSearch","faGlobe","faUserLock","initialState","makeInitialState","store","createStore","theReducer","compose","applyMiddleware","thunk","App","react_default","createElement","es","containers_Auth","containers_KBaseIntegration","HashRouter","basename","Switch","Route","exact","component","DashboardView","viewOrganization_loader","editOrganization_loader","manageOrganizationRequests_loader","viewMembers_loader","inviteUser_loader","manageMembership_loader","requestAddNarrative_loader","ReactDOM","render","src_App_0","getElementById"],"mappings":"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","file":"static/js/main.c0b2304f.chunk.js","sourcesContent":["import * as userProfile from \"../data/apis/userProfile\"\nimport * as groups from \"../data/apis/groups\"\nimport * as orgModel from '../data/models/organization/model'\nimport * as userModel from \"../data/models/user\"\nimport * as requestModel from '../data/models/requests'\nimport * as narrativeModel from '../data/models/narrative'\nimport * as uberModel from '../data/models/uber'\nimport * as feedsModel from '../data/models/feeds'\n\n/* Types from the organization service (approximately) */\n\n/*\n    Organization\n*/\n\nexport interface OrganizationUpdate {\n    name: string\n    gravatarHash: string | null\n    description: string\n}\n\nexport enum UIErrorType {\n    NONE = 0,\n    INFO,\n    WARNING,\n    ERROR\n}\n\nexport interface UIError {\n    type: UIErrorType,\n    message?: string\n}\n\nexport interface EditableOrganization {\n    id: {\n        value: string\n        editState: EditState\n        validationState: ValidationState\n        validatedAt: Date | null\n        error: UIError\n    }\n    name: {\n        value: string\n        editState: EditState\n        validationState: ValidationState\n        validatedAt: Date | null\n        error: UIError\n    }\n    gravatarHash: {\n        value: string | null\n        editState: EditState\n        validationState: ValidationState\n        validatedAt: Date | null\n        error: UIError\n    }\n    description: {\n        value: string\n        editState: EditState\n        validationState: ValidationState\n        validatedAt: Date | null\n        error: UIError\n    }\n    isPrivate: {\n        value: boolean\n        editState: EditState\n        validationState: ValidationState\n        validatedAt: Date | null\n        error: UIError\n    }\n}\n\nexport interface User {\n    username: string\n    realname: string\n    title: string | null\n    organization: string | null\n    city: string | null\n    state: string | null\n    country: string | null\n    avatarOption: string | null\n    gravatarHash: string | null\n    gravatarDefault: string | null\n}\n\nexport enum MemberType {\n    MEMBER = 0,\n    ADMIN,\n    OWNER\n}\nexport interface Member {\n    user: User,\n    type: MemberType\n}\n\n\n\n// export interface User extends UserBase {\n\n// }\n\n// export interface Owner extends UserBase {\n\n// }\n\n// export interface Member extends UserBase {\n\n// }\n\n// export interface Admin extends UserBase {\n\n// }\n\n// export enum UserRelationToOrganization {\n//     NONE = 0,\n//     VIEW,\n//     MEMBER_REQUEST_PENDING,\n//     MEMBER_INVITATION_PENDING,\n//     MEMBER,\n//     ADMIN,\n//     OWNER\n// }\n\n// export interface UserOrgRelation {\n//     type: UserRelationToOrganization\n// }\n\n// export interface NoRelation extends UserOrgRelation {\n//     type: UserRelationToOrganization.NONE\n// }\n\n// export interface ViewRelation extends UserOrgRelation {\n//     type: UserRelationToOrganization.VIEW\n// }\n\n// export interface MembershipRequestPendingRelation extends UserOrgRelation {\n//     type: UserRelationToOrganization.MEMBER_REQUEST_PENDING,\n//     requestId: string\n// }\n\n// export interface MembershipInvitationPendingRelation extends UserOrgRelation {\n//     type: UserRelationToOrganization.MEMBER_INVITATION_PENDING,\n//     requestId: string\n// }\n\n// export interface MemberRelation extends UserOrgRelation {\n//     type: UserRelationToOrganization.MEMBER\n// }\n\n// export interface AdminRelation extends UserOrgRelation {\n//     type: UserRelationToOrganization.ADMIN\n// }\n\n// export interface OwnerRelation extends UserOrgRelation {\n//     type: UserRelationToOrganization.OWNER\n// }\n\nexport interface BriefOrganization {\n    id: string\n    name: string\n    gravatarHash: string | null\n    owner: {\n        username: string\n        realname: string\n    },\n    relation: orgModel.UserRelationToOrganization,\n    createdAt: Date\n    modifiedAt: Date\n}\n\nexport enum RequestType {\n    REQUEST = 0,\n    INVITATION\n}\n\nexport enum RequestResourceType {\n    USER = 0,\n    WORKSPACE,\n    APP\n}\n\nexport enum RequestStatus {\n    OPEN = 0,\n    CANCELED,\n    EXPIRED,\n    ACCEPTED,\n    DENIED\n}\n\nexport type Username = string\n\n\n// export type Request = UserRequest | UserInvitation | WorkspaceRequest | WorkspaceInvitation | AppRequest | AppInvitation\n\nexport interface App {\n    id: string,\n    module: string,\n    func: string,\n    version: string,\n    title: string,\n    category: string\n}\n\nexport interface AppResource {\n    id: string\n}\n\n// REVIVE in a different form? Or not? This is the old Organization\n// export interface Organization {\n//     id: string\n//     name: string\n//     gravatarHash: string | null\n//     description: string\n//     owner: Member\n//     relation: UserOrgRelation\n//     createdAt: Date\n//     modifiedAt: Date,\n//     members: Array<Member>,\n//     // admins: Array<Admin>,\n//     adminRequests: Array<requestModel.Request>,\n//     narratives: Array<NarrativeResource>,\n//     apps: Array<AppResource>\n// }\n\nexport interface EditedOrganization {\n    id: {\n        value: string,\n        error?: UIError\n    }\n    name: {\n        value: string,\n        error?: UIError\n    }\n    description: {\n        value: string,\n        error?: UIError\n    }\n}\n\n/*\n    Collection of organizations\n*/\n\n/* REDUX */\n\nexport enum AuthState {\n    NONE = 0,\n    CHECKING,\n    AUTHORIZED,\n    UNAUTHORIZED,\n    ERROR\n}\n\nexport interface UserAuthorization {\n    token: string,\n    username: string,\n    realname: string,\n    roles: Array<string>\n}\n\n\nexport interface Authorization {\n    status: AuthState,\n    message: string,\n    authorization: UserAuthorization\n}\n\nexport enum EditOrgState {\n    NONE = 0,\n    FETCHING,\n    READY,\n    EDITING_CAN_SAVE,\n    EDITING_ERRORS,\n    SAVING,\n    SAVED,\n    ERROR\n}\n\nexport enum SyncState {\n    NONE = 'NONE',\n    NEW = 'NEW',\n    DIRTY = 'DIRTY',\n    CLEAN = 'CLEAN'\n}\n\nexport enum EditState {\n    NONE = 'NONE',\n    UNEDITED = 'UNEDITED',\n    EDITED = 'EDITED'\n}\n\n// TODO: or CLEAN to replace new and saved\nexport enum SaveState {\n    NONE = 'NONE',\n    NEW = 'NEW',\n    READY = 'READY',\n    SAVING = 'SAVING',\n    SAVED = 'SAVED',\n    SAVE_ERROR = 'SAVE_ERROR'\n}\n\nexport enum ValidationState {\n    NONE = 'NONE',\n    VALID = 'VALID',\n    INVALID = 'INVALID',\n    DIRTY = 'DIRTY'\n}\n\nexport enum FieldState {\n    NONE = 0,\n    UNEDITED_OK,\n    UNEDITED_ERROR,\n    EDITED_OK,\n    EDITED_ERROR,\n    EDITED_WARNING\n}\n\nexport enum ViewOrgState {\n    NONE = 0,\n    INITIAL,\n    FETCHING,\n    READY,\n    ERROR\n}\n\nexport enum AppState {\n    NONE = 0,\n    LOADING,\n    READY,\n    ERROR\n}\n\nexport enum SortDirection {\n    ASCENDING = 'asc',\n    DESCENDING = 'desc'\n}\n\nexport enum ComponentLoadingState {\n    NONE = 0,\n    LOADING,\n    SUCCESS,\n    ERROR\n}\n\nexport interface ManageOrganizationRequestsViewModel {\n    organization: orgModel.Organization\n    requests: Array<requestModel.Request>\n    invitations: Array<requestModel.Request>\n}\n\nexport interface ManageOrganizationRequestsView {\n    loadingState: ComponentLoadingState\n    error: AppError | null\n    viewModel: ManageOrganizationRequestsViewModel | null\n}\n\nexport interface ViewMembersViewModel {\n    organization: orgModel.Organization\n    relation: orgModel.Relation\n}\n\nexport interface ViewMembersView {\n    loadingState: ComponentLoadingState,\n    error: AppError | null,\n    viewModel: ViewMembersViewModel | null\n}\n\nexport enum BrowseOrgsState {\n    NONE = 0,\n    SEARCHING,\n    SUCCESS,\n    ERROR\n}\n\nexport interface BrowseOrgsViewModel {\n    rawOrganizations: Array<orgModel.Organization>\n    organizations: Array<orgModel.Organization>\n    totalCount: number\n    filteredCount: number\n    sortBy: string\n    sortDirection: SortDirection\n    filter: string\n    searchTerms: Array<string>\n    selectedOrganizationId: string | null,\n    // TODO: let's make a new interface for running operations...\n    searching: boolean\n    error: AppError | null\n}\n\nexport interface BrowseOrgsView {\n    loadingState: ComponentLoadingState,\n    error: AppError | null,\n    viewModel: BrowseOrgsViewModel | null\n}\n\nexport enum InviteUserViewState {\n    NONE = 0,\n    EDITING,\n    SENDABLE,\n    SENDING,\n    SUCCESS,\n    ERROR\n}\n\n// user info we get out of user profile search\n\n\n// a user who may or may not be in an org, with org relation info\n// todo: fetch more profile info.\nexport interface OrganizationUser {\n    username: string\n    realname: string\n    relation: orgModel.UserRelationToOrganization\n}\n\nexport interface InviteUserViewModel {\n    organization: orgModel.Organization\n    users: Array<OrganizationUser> | null\n    selectedUser: {\n        user: User,\n        relation: orgModel.UserRelationToOrganization\n    } | null\n    editState: InviteUserViewState\n}\n\nexport interface InviteUserView {\n    loadingState: ComponentLoadingState\n    viewModel: InviteUserViewModel | null\n    error: AppError | null\n    // viewState: AppError | InviteUserValue | null\n}\n\nexport interface ManageMembershipViewModel {\n    organization: orgModel.Organization\n}\n\nexport interface ManageMembershipView {\n    loadingState: ComponentLoadingState\n    error: AppError | null\n    viewModel: ManageMembershipViewModel | null\n}\n\nexport enum NarrativeState {\n    NONE = 0,\n    ASSOCIATED,\n    REQUESTED\n}\n\nexport interface Narrative {\n    workspaceId: number,\n    objectId: number,\n    title: string,\n    status: NarrativeState,\n    // inOrganization: boolean,\n    // createdAt: Date,\n    modifiedAt: Date\n}\n\n// export enum UserWorkspacePermission {\n//     NONE = 0,\n//     READ,\n//     WRITE,\n//     ADMIN,\n//     OWN\n// }\n\n\nexport enum ProcessingState {\n    NONE = 0,\n    PROCESSING,\n    SUCCESS,\n    ERROR\n}\n\n\nexport enum RequestNarrativeState {\n    NONE = 0,\n    LOADING,\n    ERROR,\n    LOADED,\n    SENDING,\n    SENT\n}\n\n\nexport interface RequestNarrativeViewModel {\n    organization: orgModel.Organization\n    narratives: Array<Narrative>\n    selectedNarrative: Narrative | null\n    relation: orgModel.Relation\n    error: AppError | null\n    saveState: SaveState\n}\n\nexport interface RequestNarrativeView {\n    loadingState: ComponentLoadingState\n    error: AppError | null\n    viewModel: RequestNarrativeViewModel | null\n}\n\nexport interface AddOrgViewModel {\n    editState: EditState\n    saveState: SaveState\n    error: AppError | null\n    validationState: ValidationState\n    newOrganization: EditableOrganization\n}\n\nexport interface AddOrgView {\n    loadingState: ComponentLoadingState\n    error: AppError | null\n    viewModel: AddOrgViewModel | null\n}\n\nexport interface Notification {\n\n}\n\nexport interface DashboardViewModel {\n    organizations: Array<uberModel.UberOrganization>\n    // users: Map<userModel.Username, userModel.User>\n    pendingRequests: Array<requestModel.Request>\n    pendingInvitations: Array<requestModel.Request>\n    pendingAdminRequests: Array<requestModel.Request>\n    notifications: Array<Notification>\n}\n\nexport interface DashboardView {\n    loadingState: ComponentLoadingState\n    error: AppError | null\n    viewModel: DashboardViewModel | null\n}\n\nexport interface UserEntity {\n    userId: string\n    profile: userProfile.UserProfile\n}\n\nexport interface OrganizationEntity {\n    groupId: string\n    group: groups.Group\n}\n\nexport interface RequestEntity {\n    requestId: string\n    request: groups.Request\n}\n\nexport interface OrganizationCentricView {\n    loadingState: ComponentLoadingState\n    error: AppError | null\n    viewModel: OrganizationCentricViewModel | null\n}\nexport interface OrganizationCentricViewModel {\n    organization: orgModel.Organization\n    pendingJoinRequest: requestModel.UserRequest | null\n    pendingJoinInvitation: requestModel.UserInvitation | null\n    relation: orgModel.Relation\n}\n\nexport interface ViewOrgViewModel {\n    organization: orgModel.Organization\n    relation: orgModel.Relation\n    groupRequests: Array<requestModel.Request> | null\n    groupInvitations: Array<requestModel.Request> | null\n}\n\nexport interface ViewOrgView {\n    loadingState: ComponentLoadingState\n    error: AppError | null\n    viewModel: ViewOrgViewModel | null\n}\n\nexport interface EditOrgViewModel {\n    editState: EditState\n    saveState: SaveState\n    validationState: ValidationState\n    editedOrganization: EditableOrganization\n    organization: orgModel.Organization\n    saveError: AppError | null\n}\n\nexport interface EditOrgView {\n    loadingState: ComponentLoadingState,\n    error: AppError | null,\n    viewModel: EditOrgViewModel | null\n}\n\nexport interface StoreState {\n    // new!!\n    entities: {\n        users: {\n            byId: Map<userModel.Username, userModel.User>\n            all: Array<string>\n        }\n        orgs: {\n            byId: Map<orgModel.OrganizationID, orgModel.Organization>\n            all: Array<string>\n        }\n        requests: {\n            byId: Map<requestModel.RequestID, requestModel.Request>\n            all: Array<string>\n        }\n        narratives: {\n            byId: Map<narrativeModel.WorkspaceID, narrativeModel.Narrative>\n        }\n        // notifications: {\n        //     byId: <Map<\n        // }\n    }\n\n    db: {\n        notifications: {\n            byId: Map<feedsModel.NotificationID, feedsModel.Notification>\n            collections: {\n                byGroup: Map<orgModel.OrganizationID, Array<feedsModel.NotificationID>>\n            }\n        }\n    }\n\n\n\n    auth: Authorization\n    error: AppError | null\n\n    app: {\n        status: AppState\n        config: AppConfig\n        error?: AppError\n    }\n\n    views: {\n        browseOrgsView: BrowseOrgsView\n        addOrgView: AddOrgView\n        viewOrgView: ViewOrgView\n        editOrgView: EditOrgView\n        manageOrganizationRequestsView: ManageOrganizationRequestsView\n        viewMembersView: ViewMembersView\n        inviteUserView: InviteUserView\n        manageMembershipView: ManageMembershipView\n        requestNarrativeView: RequestNarrativeView\n        dashboardView: DashboardView\n        organizationCentricView: OrganizationCentricView\n    }\n    updateOrg: {\n        pending: boolean\n    }\n}\n\n/* COMPONENT PROPS */\n\nexport interface AppError {\n    code: string\n    message: string\n    trace?: Array<string>\n    errors?: Array<AppError>\n    exception?: AppException\n}\n\nexport class AppException extends Error {\n    code: string\n    message: string\n    detail?: string\n    trace?: Array<string>\n    errors?: Array<AppException>\n    info?: Map<string, any>\n    constructor({ code, message, detail, info }: { code: string, message: string, detail?: string, info?: Map<string, any> }) {\n        super(message)\n        this.name = 'AppException'\n        this.code = code\n        this.message = message\n        this.detail = detail\n        this.info = info\n\n        if (Error.captureStackTrace) {\n            Error.captureStackTrace(this, AppException)\n        }\n\n        if (this.stack) {\n            if (this.stack.indexOf('\\n') >= 0) {\n                this.trace = this.stack.split('\\n')\n            } else {\n                this.trace = [this.stack]\n            }\n        }\n    }\n}\n\nexport interface AppConfig {\n    baseUrl: string\n    services: {\n        Groups: {\n            url: string\n        }\n        UserProfile: {\n            url: string\n        }\n        Workspace: {\n            url: string\n        }\n        ServiceWizard: {\n            url: string\n        }\n        Feeds: {\n            url: string\n        }\n    }\n}\n\nexport interface AuthProps {\n    authorization: Authorization,\n    // authStatus: AuthState,\n    // token: string | null,\n    // username: string | null,\n    // realname: string | null,\n    hosted: boolean,\n    checkAuth: () => void,\n    onRemoveAuthorization: () => void,\n    onAddAuthorization: (token: string) => void\n}\n\n","export enum ActionFlag {\n    APP = 1,\n    APP_START,\n    APP_SUCCESS,\n    // APP_SUCCESS_IFRAME,\n    // APP_SUCCESS_SOLO,\n    APP_ERROR,\n\n    BROWSE_ORGS_LOAD,\n    BROWSE_ORGS_LOAD_START,\n    BROWSE_ORGS_LOAD_SUCCESS,\n    BROWSE_ORGS_LOAD_ERROR,\n    BROWSE_ORGS_UNLOAD,\n\n    BROWSE_ORGS_SORT,\n    BROWSE_ORGS_SORT_START,\n    BROWSE_ORGS_SORT_SUCCESS,\n    BROWSE_ORGS_SORT_ERROR,\n\n    BROWSE_ORGS_FILTER,\n    BROWSE_ORGS_FILTER_START,\n    BROWSE_ORGS_FILTER_SUCCESS,\n    BROWSE_ORGS_FILTER_ERROR,\n\n    BROWSE_ORGS_SEARCH,\n    BROWSE_ORGS_SEARCH_START,\n    BROWSE_ORGS_SEARCH_SUCCESS,\n    BROWSE_ORGS_SEARCH_ERROR,\n\n    UPDATE_ORG,\n    UPDATE_ORG_START,\n    UPDATE_ORG_SUCCESS,\n    UPDATE_ORG_ERROR,\n\n    // viewing org\n    VIEW_ORG_LOAD,\n    VIEW_ORG_LOAD_START,\n    VIEW_ORG_LOAD_SUCCESS,\n    VIEW_ORG_LOAD_ERROR,\n    VIEW_ORG_UNLOAD,\n\n    // Joining and Such\n    VIEW_ORG_JOIN_REQUEST,\n    VIEW_ORG_JOIN_REQUEST_START,\n    VIEW_ORG_JOIN_REQUEST_SUCCESS,\n    VIEW_ORG_JOIN_REQUEST_ERROR,\n\n    VIEW_ORG_CANCEL_JOIN_REQUEST,\n    VIEW_ORG_CANCEL_JOIN_REQUEST_START,\n    VIEW_ORG_CANCEL_JOIN_REQUEST_SUCCESS,\n    VIEW_ORG_CANCEL_JOIN_REQUEST_ERROR,\n\n    VIEW_ORG_ACCEPT_JOIN_INVITATION,\n    VIEW_ORG_ACCEPT_JOIN_INVITATION_START,\n    VIEW_ORG_ACCEPT_JOIN_INVITATION_SUCCESS,\n    VIEW_ORG_ACCEPT_JOIN_INVITATION_ERROR,\n\n\n    VIEW_ORG_REJECT_JOIN_INVITATION,\n    VIEW_ORG_REJECT_JOIN_INVITATION_START,\n    VIEW_ORG_REJECT_JOIN_INVITATION_SUCCESS,\n    VIEW_ORG_REJECT_JOIN_INVITATION_ERROR,\n\n    VIEW_ORG_REMOVE_NARRATIVE,\n    VIEW_ORG_REMOVE_NARRATIVE_START,\n    VIEW_ORG_REMOVE_NARRATIVE_SUCCESS,\n    VIEW_ORG_REMOVE_NARRATIVE_ERROR,\n\n    VIEW_ORG_ACCESS_NARRATIVE,\n    VIEW_ORG_ACCESS_NARRATIVE_START,\n    VIEW_ORG_ACCESS_NARRATIVE_SUCCESS,\n    VIEW_ORG_ACCESS_NARRATIVE_ERROR,\n\n    // add org fields\n\n    ADD_ORG_LOAD,\n    ADD_ORG_LOAD_START,\n    ADD_ORG_LOAD_SUCCESS,\n    ADD_ORG_LOAD_ERROR,\n    ADD_ORG_UNLOAD,\n\n    ADD_ORG_UPDATE_NAME,\n    ADD_ORG_UPDATE_NAME_SUCCESS,\n    ADD_ORG_UPDATE_NAME_ERROR,\n\n    ADD_ORG_UPDATE_GRAVATAR_HASH,\n    ADD_ORG_UPDATE_GRAVATAR_HASH_SUCCESS,\n    ADD_ORG_UPDATE_GRAVATAR_HASH_ERROR,\n\n    ADD_ORG_UPDATE_ID,\n    ADD_ORG_UPDATE_ID_SUCCESS,\n    ADD_ORG_UPDATE_ID_ERROR,\n    ADD_ORG_UPDATE_ID_PASS,\n    ADD_ORG_EVALUATE_ID,\n\n    ADD_ORG_UPDATE_DESCRIPTION,\n    ADD_ORG_UPDATE_DESCRIPTION_SUCCESS,\n    ADD_ORG_UPDATE_DESCRIPTION_ERROR,\n\n    ADD_ORG_UPDATE_IS_PRIVATE,\n    ADD_ORG_UPDATE_IS_PRIVATE_SUCCESS,\n    ADD_ORG_UPDATE_IS_PRIVATE_ERROR,\n\n    ADD_ORG_EVALUATE,\n    ADD_ORG_EVALUATE_OK,\n    ADD_ORG_EVALUATE_ERRORS,\n\n    ADD_ORG_SAVE,\n    ADD_ORG_SAVE_START,\n    ADD_ORG_SAVE_SUCCESS,\n    ADD_ORG_SAVE_ERROR,\n\n\n    // editing org\n    EDIT_ORG_LOAD,\n    EDIT_ORG_LOAD_START,\n    EDIT_ORG_LOAD_SUCCESS,\n    EDIT_ORG_LOAD_ERROR,\n    EDIT_ORG_UNLOAD,\n\n    EDIT_ORG_SAVE,\n    EDIT_ORG_SAVE_START,\n    EDIT_ORG_SAVE_SUCCESS,\n    EDIT_ORG_SAVE_ERROR,\n\n    // edit org, field level updates\n    EDIT_ORG_UPDATE_NAME,\n    EDIT_ORG_UPDATE_NAME_SUCCESS,\n    EDIT_ORG_UPDATE_NAME_ERROR,\n\n    EDIT_ORG_UPDATE_GRAVATAR_HASH,\n    EDIT_ORG_UPDATE_GRAVATAR_HASH_SUCCESS,\n    EDIT_ORG_UPDATE_GRAVATAR_HASH_ERROR,\n\n    EDIT_ORG_UPDATE_DESCRIPTION,\n    EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS,\n    EDIT_ORG_UPDATE_DESCRIPTION_ERROR,\n\n    EDIT_ORG_EVALUATE,\n    EDIT_ORG_EVALUATE_OK,\n    EDIT_ORG_EVALUATE_ERRORS,\n\n    // Auth\n    AUTH_CHECK,\n    AUTH_CHECK_START,\n    AUTH_CHECK_ERROR,\n    AUTH_AUTHORIZED,\n    AUTH_UNAUTHORIZED,\n    AUTH_REMOVE_AUTHORIZATION,\n    AUTH_ADD_AUTHORIZATION,\n    AUTH_ADD_AUTHORIZATION_ERROR,\n\n    ADMIN_MANAGE_REQUESTS_LOAD,\n    ADMIN_MANAGE_REQUESTS_LOAD_START,\n    ADMIN_MANAGE_REQUESTS_LOAD_SUCCESS,\n    ADMIN_MANAGE_REQUESTS_LOAD_ERROR,\n    ADMIN_MANAGE_REQUESTS_UNLOAD,\n\n    ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST,\n    ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_START,\n    ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_SUCCESS,\n    ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_ERROR,\n\n    ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST,\n    ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_START,\n    ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_SUCCESS,\n    ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_ERROR,\n\n    ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION,\n    ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_START,\n    ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_SUCCESS,\n    ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_ERROR,\n\n    ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS,\n    ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_START,\n    ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_SUCCESS,\n    ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_ERROR,\n\n    // MEMBERS\n    VIEW_MEMBERS_LOAD,\n    VIEW_MEMBERS_LOAD_START,\n    VIEW_MEMBERS_LOAD_SUCCESS,\n    VIEW_MEMBERS_LOAD_ERROR,\n    VIEW_MEMBERS_UNLOAD,\n\n    VIEW_MEMBERS_REMOVE_MEMBER,\n    VIEW_MEMBERS_REMOVE_MEMBER_START,\n    VIEW_MEMBERS_REMOVE_MEMBER_SUCCESS,\n    VIEW_MEMBERS_REMOVE_MEMBER_ERROR,\n\n    VIEW_MEMBERS_PROMOTE_TO_ADMIN,\n    VIEW_MEMBERS_PROMOTE_TO_ADMIN_START,\n    VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS,\n    VIEW_MEMBERS_PROMOTE_TO_ADMIN_ERROR,\n\n    VIEW_MEMBERS_DEMOTE_TO_MEMBER,\n    VIEW_MEMBERS_DEMOTE_TO_MEMBER_START,\n    VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS,\n    VIEW_MEMBERS_DEMOTE_TO_MEMBER_ERROR,\n\n    // INVITE USER\n    INVITE_USER_LOAD,\n    INVITE_USER_LOAD_START,\n    INVITE_USER_LOAD_SUCCESS,\n    INVITE_USER_LOAD_ERROR,\n    INVITE_USER_UNLOAD,\n\n    INVITE_USER_SEARCH_USERS,\n    INVITE_USER_SEARCH_USERS_START,\n    INVITE_USER_SEARCH_USERS_SUCCESS,\n    INVITE_USER_SEARCH_USERS_ERROR,\n\n    INVITE_USER_SELECT_USER,\n    INVITE_USER_SELECT_USER_START,\n    INVITE_USER_SELECT_USER_SUCCESS,\n    INVITE_USER_SELECT_USER_ERROR,\n\n    INVITE_USER_SEND_INVITATION,\n    INVITE_USER_SEND_INVITATION_START,\n    INVITE_USER_SEND_INVITATION_SUCCESS,\n    INVITE_USER_SEND_INVITATION_ERROR,\n\n    // Manage Membership\n    MANAGE_MEMBERSHIP_LOAD,\n    MANAGE_MEMBERSHIP_LOAD_START,\n    MANAGE_MEMBERSHIP_LOAD_SUCCESS,\n    MANAGE_MEMBERSHIP_LOAD_ERROR,\n    MANAGE_MEMBERSHIP_UNLOAD,\n\n    // Narrative add requests\n    REQUEST_ADD_NARRATIVE_LOAD,\n    REQUEST_ADD_NARRATIVE_LOAD_START,\n    REQUEST_ADD_NARRATIVE_LOAD_SUCCESS,\n    REQUEST_ADD_NARRATIVE_LOAD_ERROR,\n    REQUEST_ADD_NARRATIVE_UNLOAD,\n\n    REQUEST_ADD_NARRATIVE_SEND,\n    REQUEST_ADD_NARRATIVE_SEND_START,\n    REQUEST_ADD_NARRATIVE_SEND_SUCCESS,\n    REQUEST_ADD_NARRATIVE_SEND_ERROR,\n\n    REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE,\n    REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_START,\n    REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_SUCCESS,\n    REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_ERROR,\n\n    DASHBOARD_LOAD,\n    DASHBOARD_LOAD_START,\n    DASHBOARD_LOAD_SUCCESS,\n    DASHBOARD_LOAD_ERROR,\n    DASHBOARD_UNLOAD,\n\n    // VIEWS\n\n    ORGANIZATION_CENTRIC_VIEW_LOAD,\n    ORGANIZATION_CENTRIC_VIEW_LOAD_START,\n    ORGANIZATION_CENTRIC_VIEW_LOAD_SUCCESS,\n    ORGANIZATION_CENTRIC_VIEW_LOAD_ERROR,\n    ORGANIZATION_CENTRIC_VIEW_UNLOAD,\n\n    // ENTITIES\n\n    ENTITY_USER_LOADER,\n    ENTITY_USER_LOADER_START,\n    ENTITY_USER_LOADER_SUCCESS,\n    ENTITY_USER_LOADER_ERROR,\n\n    ENTITY_ORGANIZATION_LOADER,\n    ENTITY_ORGANIZATION_LOADER_START,\n    ENTITY_ORGANIZATION_LOADER_SUCCESS,\n    ENTITY_ORGANIZATION_LOADER_ERROR,\n\n    ENTITY_NARRATIVE_LOAD,\n    ENTITY_NARRATIVE_LOAD_START,\n    ENTITY_NARRATIVE_LOAD_SUCCESS,\n    ENTITY_NARRATIVE_LOAD_ERROR,\n\n    // GLOBAL ACTIONS\n    GLOBAL_ACCESS_NARRATIVE,\n    GLOBAL_ACCESS_NARRATIVE_START,\n    GLOBAL_ACCESS_NARRATIVE_SUCCESS,\n    GLOBAL_ACCESS_NARRATIVE_ERROR\n}\n","import { Action } from 'redux'\nimport { StoreState, EditState, SaveState, UIErrorType, FieldState, ValidationState, ComponentLoadingState } from '../../types';\nimport { ActionFlag } from '../actions';\nimport {\n    LoadStart, Unload,\n    SaveError, SaveStart, SaveSuccess, AddOrgEvaluateOK, AddOrgEvaluateErrors,\n    LoadSuccess, UpdateNameSuccess, UpdateNameError, UpdateGravatarHashSuccess,\n    UpdateGravatarHashError, UpdateIdSuccess, UpdateIdError, UpdateDescriptionSuccess,\n    UpdateDescriptionError,\n    LoadError,\n    UpdateIdPass,\n    UpdateIsPrivateSuccess\n} from '../actions/addOrg'\n\n// ADD ORG\n\nexport function saveStart(state: StoreState, action: SaveStart): StoreState {\n    if (!state.views.addOrgView.viewModel) {\n        console.warn('attempting saveStart without view model')\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                ...state.views.addOrgView,\n                viewModel: {\n                    ...state.views.addOrgView.viewModel,\n                    saveState: SaveState.SAVING\n                }\n            }\n        }\n    }\n}\n\nexport function saveSuccess(state: StoreState, action: SaveSuccess): StoreState {\n    if (!state.views.addOrgView.viewModel) {\n        console.warn('attempting saveSuccess without view model')\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                ...state.views.addOrgView,\n                viewModel: {\n                    ...state.views.addOrgView.viewModel,\n                    editState: EditState.UNEDITED,\n                    saveState: SaveState.SAVED\n                }\n            }\n        }\n    }\n}\n\nexport function saveError(state: StoreState, action: SaveError): StoreState {\n    if (!state.views.addOrgView.viewModel) {\n        console.warn('attempting saveSuccess without view model')\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n\n            addOrgView: {\n                ...state.views.addOrgView,\n                viewModel: {\n                    ...state.views.addOrgView.viewModel,\n                    saveState: SaveState.SAVE_ERROR,\n                    error: action.error\n                }\n            }\n        }\n    }\n}\n\nexport function addOrgEvaluateOk(state: StoreState, action: AddOrgEvaluateOK): StoreState {\n    if (!state.views.addOrgView.viewModel) {\n        console.warn('attempting saveSuccess without view model')\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                ...state.views.addOrgView,\n                viewModel: {\n                    ...state.views.addOrgView.viewModel,\n                    validationState: ValidationState.VALID\n                }\n            }\n        }\n    }\n}\n\nexport function addOrgEvaluateErrors(state: StoreState, action: AddOrgEvaluateErrors): StoreState {\n    if (!state.views.addOrgView.viewModel) {\n        console.warn('attempting saveSuccess without view model')\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                ...state.views.addOrgView,\n                viewModel: {\n                    ...state.views.addOrgView.viewModel,\n                    validationState: ValidationState.INVALID\n                }\n            }\n        }\n    }\n}\n\nexport function loadStart(state: StoreState, action: LoadStart): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                loadingState: ComponentLoadingState.LOADING,\n                error: null,\n                viewModel: null\n            }\n        }\n    }\n}\n\nexport function loadSuccess(state: StoreState, action: LoadSuccess): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                loadingState: ComponentLoadingState.SUCCESS,\n                error: null,\n                viewModel: {\n                    editState: EditState.UNEDITED,\n                    validationState: ValidationState.NONE,\n                    saveState: SaveState.NEW,\n                    error: null,\n                    newOrganization: action.newOrganization\n                }\n            }\n        }\n    }\n}\nexport function loadError(state: StoreState, action: LoadError): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                loadingState: ComponentLoadingState.SUCCESS,\n                error: action.error,\n                viewModel: null\n            }\n        }\n    }\n}\n\nexport function unload(state: StoreState, action: Unload): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                loadingState: ComponentLoadingState.NONE,\n                error: null,\n                viewModel: null\n            }\n        }\n    }\n}\n\n// Name\nexport function updateNameSuccess(state: StoreState, action: UpdateNameSuccess): StoreState {\n    if (!state.views.addOrgView.viewModel) {\n        console.warn('attempting updateNameSuccess without view model')\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                ...state.views.addOrgView,\n                viewModel: {\n                    ...state.views.addOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    newOrganization: {\n                        ...state.views.addOrgView.viewModel.newOrganization,\n                        name: {\n                            value: action.name,\n                            validationState: ValidationState.VALID,\n                            editState: EditState.EDITED,\n                            validatedAt: new Date(),\n                            // status: FieldState.EDITED_OK,\n                            error: {\n                                type: UIErrorType.NONE\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function updateNameError(state: StoreState, action: UpdateNameError): StoreState {\n    if (!state.views.addOrgView.viewModel) {\n        console.warn('attempting updateNameError without view model')\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                ...state.views.addOrgView,\n                viewModel: {\n                    ...state.views.addOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    newOrganization: {\n                        ...state.views.addOrgView.viewModel.newOrganization,\n                        name: {\n                            value: action.name,\n                            validationState: ValidationState.INVALID,\n                            editState: EditState.EDITED,\n                            validatedAt: new Date(),\n                            error: action.error\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\n// Gravatar hash\nexport function updateGravatarHashSuccess(state: StoreState, action: UpdateGravatarHashSuccess): StoreState {\n    if (!state.views.addOrgView.viewModel) {\n        console.warn('attempting updateGravatarHashSuccess without view model')\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                ...state.views.addOrgView,\n                viewModel: {\n                    ...state.views.addOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    newOrganization: {\n                        ...state.views.addOrgView.viewModel.newOrganization,\n                        gravatarHash: {\n                            value: action.gravatarHash,\n                            validationState: ValidationState.VALID,\n                            editState: EditState.EDITED,\n                            validatedAt: new Date(),\n                            error: {\n                                type: UIErrorType.NONE\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function updateGravatarHashError(state: StoreState, action: UpdateGravatarHashError): StoreState {\n    if (!state.views.addOrgView.viewModel) {\n        console.warn('attempting updateGravatarHashError without view model')\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                ...state.views.addOrgView,\n                viewModel: {\n                    ...state.views.addOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    newOrganization: {\n                        ...state.views.addOrgView.viewModel.newOrganization,\n                        gravatarHash: {\n                            value: action.gravatarHash,\n                            validationState: ValidationState.INVALID,\n                            editState: EditState.EDITED,\n                            validatedAt: new Date(),\n                            error: action.error\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\n// Id\n\nexport function updateIdSuccess(state: StoreState, action: UpdateIdSuccess): StoreState {\n    if (!state.views.addOrgView.viewModel) {\n        console.warn('attempting updateIdSuccess without view model')\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                ...state.views.addOrgView,\n                viewModel: {\n                    ...state.views.addOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    newOrganization: {\n                        ...state.views.addOrgView.viewModel.newOrganization,\n                        id: {\n                            value: action.id,\n                            validationState: ValidationState.VALID,\n                            editState: EditState.EDITED,\n                            validatedAt: new Date(),\n                            error: {\n                                type: UIErrorType.NONE\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function updateIdError(state: StoreState, action: UpdateIdError): StoreState {\n    if (!state.views.addOrgView.viewModel) {\n        console.warn('attempting updateIdError without view model')\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                ...state.views.addOrgView,\n                viewModel: {\n                    ...state.views.addOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    newOrganization: {\n                        ...state.views.addOrgView.viewModel.newOrganization,\n                        id: {\n                            value: action.id,\n                            validationState: ValidationState.INVALID,\n                            editState: EditState.EDITED,\n                            validatedAt: new Date(),\n                            error: action.error\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function updateIdPass(state: StoreState, action: UpdateIdPass): StoreState {\n    if (!state.views.addOrgView.viewModel) {\n        console.warn('attempting updateIdSuccess without view model')\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                ...state.views.addOrgView,\n                viewModel: {\n                    ...state.views.addOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    newOrganization: {\n                        ...state.views.addOrgView.viewModel.newOrganization,\n                        id: {\n                            ...state.views.addOrgView.viewModel.newOrganization.id,\n                            value: action.id,\n                            editState: EditState.EDITED\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function updateDescriptionSuccess(state: StoreState, action: UpdateDescriptionSuccess): StoreState {\n    if (!state.views.addOrgView.viewModel) {\n        console.warn('attempting updateDescriptionSuccess without view model')\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                ...state.views.addOrgView,\n                viewModel: {\n                    ...state.views.addOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    newOrganization: {\n                        ...state.views.addOrgView.viewModel.newOrganization,\n                        description: {\n                            value: action.description,\n                            validationState: ValidationState.VALID,\n                            editState: EditState.EDITED,\n                            validatedAt: new Date(),\n                            error: {\n                                type: UIErrorType.NONE\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function updateDescriptionError(state: StoreState, action: UpdateDescriptionError): StoreState {\n    if (!state.views.addOrgView.viewModel) {\n        console.warn('attempting updateDescriptionError without view model')\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                ...state.views.addOrgView,\n                viewModel: {\n                    ...state.views.addOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    newOrganization: {\n                        ...state.views.addOrgView.viewModel.newOrganization,\n                        description: {\n                            value: action.description,\n                            validationState: ValidationState.INVALID,\n                            editState: EditState.EDITED,\n                            validatedAt: new Date(),\n                            error: action.error\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function updateIsPrivateSuccess(state: StoreState, action: UpdateIsPrivateSuccess): StoreState {\n    if (!state.views.addOrgView.viewModel) {\n        console.warn('attempting updateIdSuccess without view model')\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                ...state.views.addOrgView,\n                viewModel: {\n                    ...state.views.addOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    newOrganization: {\n                        ...state.views.addOrgView.viewModel.newOrganization,\n                        isPrivate: {\n                            value: action.isPrivate,\n                            validationState: ValidationState.VALID,\n                            editState: EditState.EDITED,\n                            validatedAt: new Date(),\n                            error: {\n                                type: UIErrorType.NONE\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function reducer(state: StoreState, action: Action): StoreState | null {\n    // NB using discriminant union nature of the ActionX types to narrow\n    // the type.\n\n    switch (action.type) {\n        case ActionFlag.ADD_ORG_SAVE:\n            return saveStart(state, action as SaveStart)\n        case ActionFlag.ADD_ORG_SAVE_SUCCESS:\n            return saveSuccess(state, action as SaveSuccess)\n        case ActionFlag.ADD_ORG_SAVE_ERROR:\n            return saveError(state, action as SaveError)\n\n        case ActionFlag.ADD_ORG_LOAD_START:\n            return loadStart(state, action as LoadStart)\n        case ActionFlag.ADD_ORG_LOAD_SUCCESS:\n            return loadSuccess(state, action as LoadSuccess)\n        case ActionFlag.ADD_ORG_LOAD_ERROR:\n            return loadError(state, action as LoadError)\n        case ActionFlag.ADD_ORG_UNLOAD:\n            return unload(state, action as Unload)\n\n        case ActionFlag.ADD_ORG_UPDATE_NAME_SUCCESS:\n            return updateNameSuccess(state, action as UpdateNameSuccess)\n        case ActionFlag.ADD_ORG_UPDATE_NAME_ERROR:\n            return updateNameError(state, action as UpdateNameError)\n\n        case ActionFlag.ADD_ORG_UPDATE_GRAVATAR_HASH_SUCCESS:\n            return updateGravatarHashSuccess(state, action as UpdateGravatarHashSuccess)\n        case ActionFlag.ADD_ORG_UPDATE_GRAVATAR_HASH_ERROR:\n            return updateGravatarHashError(state, action as UpdateGravatarHashError)\n\n        case ActionFlag.ADD_ORG_UPDATE_ID_SUCCESS:\n            return updateIdSuccess(state, action as UpdateIdSuccess)\n        case ActionFlag.ADD_ORG_UPDATE_ID_ERROR:\n            return updateIdError(state, action as UpdateIdError)\n        case ActionFlag.ADD_ORG_UPDATE_ID_PASS:\n            return updateIdPass(state, action as UpdateIdPass)\n\n        case ActionFlag.ADD_ORG_UPDATE_DESCRIPTION_SUCCESS:\n            return updateDescriptionSuccess(state, action as UpdateDescriptionSuccess)\n        case ActionFlag.ADD_ORG_UPDATE_DESCRIPTION_ERROR:\n            return updateDescriptionError(state, action as UpdateDescriptionError)\n\n        case ActionFlag.ADD_ORG_UPDATE_IS_PRIVATE_SUCCESS:\n            return updateIsPrivateSuccess(state, action as UpdateIsPrivateSuccess)\n\n        case ActionFlag.ADD_ORG_EVALUATE_OK:\n            return addOrgEvaluateOk(state, action as AddOrgEvaluateOK)\n        case ActionFlag.ADD_ORG_EVALUATE_ERRORS:\n            return addOrgEvaluateErrors(state, action as AddOrgEvaluateErrors)\n        default:\n            return null\n    }\n}\n\nexport default reducer","import { Action } from 'redux'\nimport { StoreState, EditState, SaveState, UIErrorType, ValidationState, ComponentLoadingState } from '../../types';\nimport { ActionFlag } from '../actions';\nimport {\n    LoadStart, LoadSuccess, LoadError,\n    EditOrgEvaluateOK, EditOrgEvaluateErrors,\n    EditOrgSave, EditOrgSaveStart, EditOrgSaveError, EditOrgSaveSuccess,\n    EditOrgUpdateNameSuccess, EditOrgUpdateNameError,\n    // EditOrgUpdateIdSuccess, EditOrgUpdateIdError,\n    EditOrgUpdateDescriptionSuccess, EditOrgUpdateDescriptionError,\n    EditOrgUpdateGravatarHashError, EditOrgUpdateGravatarHashSuccess\n} from '../actions/editOrg'\nimport { StateInstances } from '../state';\n\n\n\n// EDIT ORG\n\n// Edit session loading\n\nexport function loadStart(state: StoreState, action: LoadStart) {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            editOrgView: {\n                loadingState: ComponentLoadingState.LOADING,\n                error: null,\n                viewModel: null\n\n            }\n        }\n    }\n}\n\nexport function loadSuccess(state: StoreState, action: LoadSuccess) {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            editOrgView: {\n                loadingState: ComponentLoadingState.SUCCESS,\n                error: null,\n                viewModel: {\n                    editState: EditState.UNEDITED,\n                    validationState: ValidationState.NONE,\n                    saveState: SaveState.NEW,\n                    // TODO: get rid of this...\n                    // organizationId: action.id,\n                    organization: action.organization,\n                    saveError: null,\n                    editedOrganization: action.editedOrganization\n                }\n            }\n        }\n    }\n}\n\nexport function loadError(state: StoreState, action: LoadError) {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            editOrgView: {\n                loadingState: ComponentLoadingState.ERROR,\n                error: action.error,\n                viewModel: null\n\n            }\n        }\n    }\n}\n\n// save\n\nexport function editOrgSaveStart(state: StoreState, action: EditOrgSaveStart): StoreState {\n    if (!state.views.editOrgView.viewModel) {\n        return state\n    }\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            editOrgView: {\n                ...state.views.editOrgView,\n                viewModel: {\n                    ...state.views.editOrgView.viewModel,\n                    saveState: SaveState.SAVING\n                }\n            }\n        }\n    }\n}\n\nexport function editOrgSaveSuccess(state: StoreState, action: EditOrgSaveSuccess): StoreState {\n    if (!state.views.editOrgView.viewModel) {\n        return state\n    }\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            editOrgView: {\n                ...state.views.editOrgView,\n                viewModel: {\n                    ...state.views.editOrgView.viewModel,\n                    editState: EditState.UNEDITED,\n                    saveState: SaveState.SAVED\n                }\n            }\n        }\n    }\n}\n\nexport function editOrgSaveError(state: StoreState, action: EditOrgSaveError): StoreState {\n    if (!state.views.editOrgView.viewModel) {\n        return state\n    }\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            editOrgView: {\n                ...state.views.editOrgView,\n                viewModel: {\n                    ...state.views.editOrgView.viewModel,\n                    saveState: SaveState.SAVE_ERROR,\n                    saveError: action.error\n                }\n            }\n        }\n    }\n}\n\n// Evaluate edit session\n\nexport function editOrgEvaluateOk(state: StoreState, action: EditOrgEvaluateOK): StoreState {\n    if (!state.views.editOrgView.viewModel) {\n        return state\n    }\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            editOrgView: {\n                ...state.views.editOrgView,\n                viewModel: {\n                    ...state.views.editOrgView.viewModel,\n                    validationState: ValidationState.VALID\n                }\n            }\n        }\n    }\n}\n\nexport function editOrgEvaluateErrors(state: StoreState, action: EditOrgEvaluateErrors): StoreState {\n    if (!state.views.editOrgView.viewModel) {\n        return state\n    }\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            editOrgView: {\n                ...state.views.editOrgView,\n                viewModel: {\n                    ...state.views.editOrgView.viewModel,\n                    validationState: ValidationState.INVALID\n                }\n            }\n        }\n    }\n}\n\n\n\n// Name\nexport function editOrgUpdateNameSuccess(state: StoreState, action: EditOrgUpdateNameSuccess) {\n    if (!state.views.editOrgView.viewModel) {\n        return state\n    }\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            editOrgView: {\n                ...state.views.editOrgView,\n                viewModel: {\n                    ...state.views.editOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    editedOrganization: {\n                        ...state.views.editOrgView.viewModel.editedOrganization,\n                        name: {\n                            value: action.name,\n                            validationState: ValidationState.VALID,\n                            editState: EditState.EDITED,\n                            validatedAt: new Date(),\n                            error: {\n                                type: UIErrorType.NONE\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function editOrgUpdateNameError(state: StoreState, action: EditOrgUpdateNameError) {\n    if (!state.views.editOrgView.viewModel) {\n        return state\n    }\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            editOrgView: {\n                ...state.views.editOrgView,\n                viewModel: {\n                    ...state.views.editOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    editedOrganization: {\n                        ...state.views.editOrgView.viewModel.editedOrganization,\n                        name: {\n                            value: action.name,\n                            validationState: ValidationState.INVALID,\n                            editState: EditState.EDITED,\n                            validatedAt: new Date(),\n                            error: action.error\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\n// Gravatar hash\nexport function editOrgUpdateGravatarHashSuccess(state: StoreState, action: EditOrgUpdateGravatarHashSuccess) {\n    if (!state.views.editOrgView.viewModel) {\n        return state\n    }\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            editOrgView: {\n                ...state.views.editOrgView,\n                viewModel: {\n                    ...state.views.editOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    editedOrganization: {\n                        ...state.views.editOrgView.viewModel.editedOrganization,\n                        gravatarHash: {\n                            value: action.gravatarHash,\n                            validationState: ValidationState.VALID,\n                            editState: EditState.EDITED,\n                            validatedAt: new Date(),\n                            error: {\n                                type: UIErrorType.NONE\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function editOrgUpdateGravatarHashError(state: StoreState, action: EditOrgUpdateGravatarHashError) {\n    if (!state.views.editOrgView.viewModel) {\n        return state\n    }\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            editOrgView: {\n                ...state.views.editOrgView,\n                viewModel: {\n                    ...state.views.editOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    editedOrganization: {\n                        ...state.views.editOrgView.viewModel.editedOrganization,\n                        gravatarHash: {\n                            value: action.gravatarHash,\n                            validationState: ValidationState.INVALID,\n                            editState: EditState.EDITED,\n                            validatedAt: new Date(),\n                            error: action.error\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\n// Id\n\n// export function editOrgUpdateIdSuccess(state: StoreState, action: EditOrgUpdateIdSuccess) {\n//     return {\n//         ...state, editOrg: {\n//             ...state.editOrg,\n//             editState: EditState.EDITED,\n//             editedOrganization: {\n//                 ...state.editOrg.editedOrganization!,\n//                 id: {\n//                     value: action.id,\n//                     status: FieldState.EDITED_OK,\n//                     error: {\n//                         type: UIErrorType.NONE\n//                     }\n//                 }\n//             }\n//         }\n//     }\n// }\n\n// export function editOrgUpdateIdError(state: StoreState, action: EditOrgUpdateIdError) {\n//     return {\n//         ...state, editOrg: {\n//             ...state.editOrg,\n//             editState: EditState.EDITED,\n//             editedOrganization: {\n//                 ...state.editOrg.editedOrganization!,\n//                 id: {\n//                     value: action.id,\n//                     status: FieldState.EDITED_ERROR,\n//                     error: action.error\n//                 }\n//             }\n//         }\n//     }\n// }\n\nexport function editOrgUpdateDescriptionSuccess(state: StoreState, action: EditOrgUpdateDescriptionSuccess) {\n    if (!state.views.editOrgView.viewModel) {\n        return state\n    }\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            editOrgView: {\n                ...state.views.editOrgView,\n                viewModel: {\n                    ...state.views.editOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    editedOrganization: {\n                        ...state.views.editOrgView.viewModel.editedOrganization,\n                        description: {\n                            value: action.description,\n                            validationState: ValidationState.VALID,\n                            editState: EditState.EDITED,\n                            validatedAt: new Date(),\n                            error: {\n                                type: UIErrorType.NONE\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function editOrgUpdateDescriptionError(state: StoreState, action: EditOrgUpdateDescriptionError) {\n    if (!state.views.editOrgView.viewModel) {\n        return state\n    }\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            editOrgView: {\n                ...state.views.editOrgView,\n                viewModel: {\n                    ...state.views.editOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    editedOrganization: {\n                        ...state.views.editOrgView.viewModel.editedOrganization,\n                        description: {\n                            value: action.description,\n                            validationState: ValidationState.INVALID,\n                            editState: EditState.EDITED,\n                            validatedAt: new Date(),\n                            error: action.error\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function reducer(state: StoreState, action: Action): StoreState | null {\n    // NB using discriminant union nature of the ActionX types to narrow\n    // the type.\n\n    switch (action.type) {\n        case ActionFlag.EDIT_ORG_LOAD_START:\n            return loadStart(state, action as LoadStart)\n        case ActionFlag.EDIT_ORG_LOAD_SUCCESS:\n            return loadSuccess(state, action as LoadSuccess)\n        case ActionFlag.EDIT_ORG_LOAD_ERROR:\n            return loadError(state, action as LoadError)\n        case ActionFlag.EDIT_ORG_SAVE_START:\n            return editOrgSaveStart(state, action as EditOrgSaveStart)\n        case ActionFlag.EDIT_ORG_SAVE_SUCCESS:\n            return editOrgSaveSuccess(state, action as EditOrgSaveSuccess)\n        case ActionFlag.EDIT_ORG_SAVE_ERROR:\n            return editOrgSaveError(state, action as EditOrgSaveError)\n\n        case ActionFlag.EDIT_ORG_UPDATE_NAME_SUCCESS:\n            return editOrgUpdateNameSuccess(state, action as EditOrgUpdateNameSuccess)\n        case ActionFlag.EDIT_ORG_UPDATE_NAME_ERROR:\n            return editOrgUpdateNameError(state, action as EditOrgUpdateNameError)\n\n        case ActionFlag.EDIT_ORG_UPDATE_GRAVATAR_HASH_SUCCESS:\n            return editOrgUpdateGravatarHashSuccess(state, action as EditOrgUpdateGravatarHashSuccess)\n        case ActionFlag.EDIT_ORG_UPDATE_GRAVATAR_HASH_ERROR:\n            return editOrgUpdateGravatarHashError(state, action as EditOrgUpdateGravatarHashError)\n\n        // case ActionFlag.EDIT_ORG_UPDATE_ID_SUCCESS:\n        //     return editOrgUpdateIdSuccess(state, action as EditOrgUpdateIdSuccess)\n        // case ActionFlag.EDIT_ORG_UPDATE_ID_ERROR:\n        //     return editOrgUpdateIdError(state, action as EditOrgUpdateIdError)\n        case ActionFlag.EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS:\n            return editOrgUpdateDescriptionSuccess(state, action as EditOrgUpdateDescriptionSuccess)\n        case ActionFlag.EDIT_ORG_UPDATE_DESCRIPTION_ERROR:\n            return editOrgUpdateDescriptionError(state, action as EditOrgUpdateDescriptionError)\n        case ActionFlag.EDIT_ORG_EVALUATE_OK:\n            return editOrgEvaluateOk(state, action as EditOrgEvaluateOK)\n        case ActionFlag.EDIT_ORG_EVALUATE_ERRORS:\n            return editOrgEvaluateErrors(state, action as EditOrgEvaluateErrors)\n        default:\n            return null\n    }\n}\n\nexport default reducer","import { Action } from 'redux'\nimport * as actions from '../actions/viewOrg'\nimport * as types from '../../types'\nimport { ActionFlag } from '../actions'\n\nexport function loadStart(state: types.StoreState, action: actions.LoadStart): types.StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewOrgView: {\n                loadingState: types.ComponentLoadingState.LOADING,\n                error: null,\n                viewModel: null\n            }\n        }\n    }\n}\n\nexport function loadSuccess(state: types.StoreState, action: actions.LoadSuccess): types.StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewOrgView: {\n                loadingState: types.ComponentLoadingState.SUCCESS,\n                error: null,\n                viewModel: {\n                    organization: action.organization,\n                    relation: action.relation,\n                    groupRequests: action.groupRequests,\n                    groupInvitations: action.groupInvitations\n                }\n            }\n        }\n    }\n}\n\nexport function loadError(state: types.StoreState, action: actions.LoadError): types.StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewOrgView: {\n                loadingState: types.ComponentLoadingState.ERROR,\n                error: action.error,\n                viewModel: null\n            }\n        }\n    }\n}\n\nexport function unload(state: types.StoreState, action: actions.Unload): types.StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewOrgView: {\n                loadingState: types.ComponentLoadingState.NONE,\n                error: null,\n                viewModel: null\n            }\n        }\n    }\n}\n\nexport function removeNarrativeSuccess(state: types.StoreState, action: actions.RemoveNarrativeSuccess): types.StoreState {\n    if (!state.views.viewOrgView.viewModel) {\n        return state\n    }\n    const newNarratives = state.views.viewOrgView.viewModel.organization.narratives.filter((narrative) => {\n        return (narrative.workspaceId !== action.narrative.workspaceId)\n    })\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewOrgView: {\n                ...state.views.viewOrgView,\n                viewModel: {\n                    ...state.views.viewOrgView.viewModel,\n                    organization: {\n                        ...state.views.viewOrgView.viewModel.organization,\n                        narratives: newNarratives\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function accessNarrativeSuccess(state: types.StoreState, action: actions.AccessNarrativeSuccess): types.StoreState {\n    if (!state.views.viewOrgView.viewModel) {\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewOrgView: {\n                ...state.views.viewOrgView,\n                viewModel: {\n                    ...state.views.viewOrgView.viewModel,\n                    organization: action.organization\n                }\n            }\n        }\n    }\n}\n\nfunction reducer(state: types.StoreState, action: Action): types.StoreState | null {\n    // NB using discriminant union nature of the ActionX types to narrow\n    // the type.\n\n    switch (action.type) {\n        case ActionFlag.VIEW_ORG_LOAD_START:\n            return loadStart(state, action as actions.LoadStart)\n        case ActionFlag.VIEW_ORG_LOAD_SUCCESS:\n            return loadSuccess(state, action as actions.LoadSuccess)\n        case ActionFlag.VIEW_ORG_LOAD_ERROR:\n            return loadError(state, action as actions.LoadError)\n        case ActionFlag.VIEW_ORG_UNLOAD:\n            return unload(state, action as actions.Unload)\n        case ActionFlag.VIEW_ORG_REMOVE_NARRATIVE_SUCCESS:\n            return removeNarrativeSuccess(state, action as actions.RemoveNarrativeSuccess)\n        case ActionFlag.VIEW_ORG_ACCESS_NARRATIVE_SUCCESS:\n            return accessNarrativeSuccess(state, action as actions.AccessNarrativeSuccess)\n        default:\n            return null\n    }\n}\n\nexport default reducer","import { Action } from 'redux'\nimport * as actions from '../actions/browseOrgs'\nimport * as types from '../../types'\nimport { ActionFlag } from '../actions'\nimport * as orgModel from '../../data/models/organization/model'\n\nexport function applyOrgSearch(orgs: Array<orgModel.Organization>, searchTerms: Array<string>) {\n    const filteredOrgs = orgs.filter((org) => {\n        if (searchTerms.length === 0) {\n            return true;\n        }\n        return searchTerms.every((term) => {\n            // todo : make more efficient!!!\n            return (new RegExp(term, 'i').test(org.name));\n        })\n    })\n\n    return {\n        organizations: filteredOrgs,\n        totalCount: orgs.length,\n        filteredCount: filteredOrgs.length\n    }\n}\n\n// TODO:\n// dispatch the start of the request\n// do the request\n// dispatch the success (will be same for all queries?)\n// dispatch the error\n// FOR NOW:\n// do it here...\nexport function searchOrgs(state: types.StoreState, action: actions.SearchOrgs): types.StoreState {\n    if (state.views.browseOrgsView === null || state.views.browseOrgsView.viewModel === null) {\n        console.warn('Cannot start browseOrgs view')\n        return state\n    }\n\n    const { views: { browseOrgsView: { viewModel: { filter, sortBy, sortDirection } } } } = state\n\n    // const query: Query = {\n    //     searchTerms: action.searchTerms,\n    //     filter: filter,\n    //     sortBy: sortBy,\n    //     sortDirection: sortDirection,\n    //     username: state.auth.authorization.username\n    // }\n    // const result = queryOrgs(state.rawOrganizations, query)\n    // rawOrganizations: Array<Organization>\n    // organizations: Array<Organization>\n    // totalCount: number\n    // filteredCount: number\n    // sortBy: string\n    // sortDirection: SortDirection\n    // filter: string\n    // searchTerms: Array<string>\n    // selectedOrganizationId: string | null\n    return {\n        ...state,\n        // organizations: result.organizations, \n        // totalCount: result.total, \n        // filteredCount: result.organizations.length,\n        views: {\n            ...state.views,\n            browseOrgsView: {\n                ...state.views.browseOrgsView,\n                error: null,\n                viewModel: {\n                    ...state.views.browseOrgsView.viewModel,\n                    selectedOrganizationId: null,\n                    searchTerms: action.searchTerms,\n                    searching: true\n                }\n            }\n        }\n    }\n}\n\nexport function searchOrgsStart(state: types.StoreState, action: actions.SearchOrgsStart): types.StoreState {\n    if (state.views.browseOrgsView === null || state.views.browseOrgsView.viewModel === null) {\n        console.warn('Cannot start browseOrgs view')\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            browseOrgsView: {\n                ...state.views.browseOrgsView,\n                viewModel: {\n                    ...state.views.browseOrgsView.viewModel,\n                    searching: true\n                }\n            }\n        }\n    }\n}\n\nexport function searchOrgsSuccess(state: types.StoreState, action: actions.SearchOrgsSuccess): types.StoreState {\n    if (state.views.browseOrgsView === null || state.views.browseOrgsView.viewModel === null) {\n        console.warn('Cannot start browseOrgs view')\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            browseOrgsView: {\n                ...state.views.browseOrgsView,\n                viewModel: {\n                    ...state.views.browseOrgsView.viewModel,\n                    organizations: action.organizations,\n                    totalCount: action.totalCount,\n                    filteredCount: action.organizations.length,\n                    searching: false\n                }\n            }\n        }\n    }\n}\n\n// TODO: hmm, uses the global error -- this was early in the development of this (a whole two weeks ago!)\n// and this should now go in the \"browseOrgs\" (or better named \"searchOrgs\") branch.\nexport function searchOrgsError(state: types.StoreState, action: actions.SearchOrgsError): types.StoreState {\n    if (state.views.browseOrgsView === null || state.views.browseOrgsView.viewModel === null) {\n        console.warn('Cannot start browseOrgs view')\n        return state\n    }\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            browseOrgsView: {\n                ...state.views.browseOrgsView,\n                viewModel: {\n                    ...state.views.browseOrgsView.viewModel,\n                    searching: false,\n                    error: action.error\n                }\n            }\n        }\n    }\n\n    // if (state.browseOrgs.view) {\n    //     return {\n    //         ...state,\n    //         browseOrgs: {\n    //             ...state.browseOrgs,\n    //             error: action.error,\n    //             state: types.BrowseOrgsState.ERROR,\n    //             view: {\n    //                 ...state.browseOrgs.view,\n    //                 searching: false\n    //             }\n    //         }\n    //     }\n    // } else {\n    //     return {\n    //         ...state,\n    //         browseOrgs: {\n    //             ...state.browseOrgs,\n    //             error: action.error\n    //         }\n    //     }\n    // }\n}\n\n\nexport function sortOrgsStart(state: types.StoreState, action: actions.SortOrgsStart): types.StoreState {\n    if (state.views.browseOrgsView === null || state.views.browseOrgsView.viewModel === null) {\n        console.warn('Cannot start browseOrgs view')\n        return state\n    }\n    const {\n        views: { browseOrgsView: { viewModel: { searchTerms, filter } } },\n        auth: { authorization: { username } }\n    } = state\n\n    // const query: Query = {\n    //     searchTerms: searchTerms,\n    //     filter: filter,\n    //     sortBy: action.sortBy,\n    //     sortDirection: action.sortDirection,\n    //     username: username\n    // }\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            browseOrgsView: {\n                ...state.views.browseOrgsView,\n                viewModel: {\n                    ...state.views.browseOrgsView.viewModel,\n                    sortBy: action.sortBy,\n                    sortDirection: action.sortDirection,\n                    searching: true\n                }\n            }\n        }\n    }\n}\n\n\ninterface Query {\n    searchTerms: Array<string>,\n    username: string,\n    sortBy: string,\n    sortDirection: types.SortDirection,\n    filter: string\n}\n\ninterface QueryResults {\n    organizations: Array<orgModel.Organization>,\n    total: number\n}\n\nfunction filterOrgsStart(state: types.StoreState, action: actions.FilterOrgsStart): types.StoreState {\n    if (state.views.browseOrgsView === null || state.views.browseOrgsView.viewModel === null) {\n        console.warn('Cannot start browseOrgs view')\n        return state\n    }\n\n    const { filter } = action\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            browseOrgsView: {\n                ...state.views.browseOrgsView,\n                viewModel: {\n                    ...state.views.browseOrgsView.viewModel,\n                    filter,\n                    searching: true\n                }\n            }\n        }\n    }\n}\n\nfunction loadSuccess(state: types.StoreState, action: actions.LoadSuccess): types.StoreState {\n    const { defaultViewModel: {\n        rawOrganizations, organizations, searchTerms, sortBy, sortDirection, filter,\n        totalCount, filteredCount, selectedOrganizationId, error, searching\n    } } = action\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            browseOrgsView: {\n                loadingState: types.ComponentLoadingState.SUCCESS,\n                error: null,\n                viewModel: {\n                    rawOrganizations, organizations, searchTerms, sortBy, sortDirection, filter,\n                    totalCount, filteredCount, selectedOrganizationId, error, searching\n                }\n            }\n        }\n    }\n}\n\nfunction reducer(state: types.StoreState, action: Action): types.StoreState | null {\n    // NB using discriminant union nature of the ActionX types to narrow\n    // the type.\n\n    switch (action.type) {\n        case ActionFlag.BROWSE_ORGS_LOAD_SUCCESS:\n            return loadSuccess(state, action as actions.LoadSuccess)\n        case ActionFlag.BROWSE_ORGS_SEARCH:\n            return searchOrgs(state, action as actions.SearchOrgs)\n        case ActionFlag.BROWSE_ORGS_SEARCH_START:\n            return searchOrgsStart(state, action as actions.SearchOrgsStart)\n        case ActionFlag.BROWSE_ORGS_SEARCH_SUCCESS:\n            return searchOrgsSuccess(state, action as actions.SearchOrgsSuccess)\n        case ActionFlag.BROWSE_ORGS_SEARCH_ERROR:\n            return searchOrgsError(state, action as actions.SearchOrgsError)\n        // case ActionFlag.SORT_ORGS_STAR:\n        //     return sortOrgs(state, action as actions.SortOrgs)\n        case ActionFlag.BROWSE_ORGS_SORT_START:\n            return sortOrgsStart(state, action as actions.SortOrgsStart)\n        case ActionFlag.BROWSE_ORGS_FILTER_START:\n            return filterOrgsStart(state, action as actions.FilterOrgsStart)\n        default:\n            return null\n    }\n}\n\nexport default reducer","import { Action } from 'redux'\n\nimport { ActionFlag } from '../actions'\nimport { StoreState, AuthState } from '../../types'\nimport { AuthCheckStart, AuthAuthorized, AuthUnauthorized, AuthCheckError } from '../actions/auth';\n\nexport function authCheckStart(state: StoreState, action: AuthCheckStart): StoreState {\n    return {\n        ...state,\n        auth: {\n            status: AuthState.CHECKING,\n            message: '',\n            authorization: {\n                token: '',\n                username: '',\n                realname: '',\n                roles: []\n            }\n        }\n    }\n}\n\nexport function authCheckError(state: StoreState, action: AuthCheckError): StoreState {\n    return {\n        ...state,\n        auth: {\n            status: AuthState.ERROR,\n            message: action.error.message,\n            authorization: {\n                token: '',\n                username: '',\n                realname: '',\n                roles: []\n            }\n        }\n    }\n}\n\nexport function authAuthorized(state: StoreState, action: AuthAuthorized): StoreState {\n    return {\n        ...state,\n        auth: {\n            status: AuthState.AUTHORIZED,\n            message: '',\n            authorization: {\n                token: action.token,\n                username: action.username,\n                realname: action.realname,\n                roles: action.roles\n            }\n        }\n    }\n}\n\nexport function authUnauthorized(state: StoreState, action: AuthUnauthorized): StoreState {\n    return {\n        ...state,\n        auth: {\n            status: AuthState.UNAUTHORIZED,\n            message: '',\n            authorization: {\n                token: '',\n                username: '',\n                realname: '',\n                roles: []\n            }\n        }\n    }\n}\n\nfunction reducer(state: StoreState, action: Action): StoreState | null {\n    switch (action.type) {\n        case ActionFlag.AUTH_CHECK_START:\n            return authCheckStart(state, action as AuthCheckStart)\n        case ActionFlag.AUTH_AUTHORIZED:\n            return authAuthorized(state, action as AuthAuthorized)\n        case ActionFlag.AUTH_UNAUTHORIZED:\n            return authUnauthorized(state, action as AuthUnauthorized)\n        case ActionFlag.AUTH_CHECK_ERROR:\n            return authCheckError(state, action as AuthCheckError)\n        default:\n            return null\n    }\n}\n\nexport default reducer","import { Action } from 'redux'\nimport { ActionFlag } from '../actions'\nimport { AppSuccess } from '../actions/app';\nimport { StoreState, AppState } from '../../types';\n\nexport function appSuccess(state: StoreState, action: AppSuccess): StoreState {\n    return {\n        ...state,\n        app: {\n            status: AppState.READY,\n            config: action.config\n        }\n    }\n}\n\nfunction reducer(state: StoreState, action: Action): StoreState | null {\n    switch (action.type) {\n        case ActionFlag.APP_SUCCESS:\n            return appSuccess(state, action as AppSuccess)\n        default:\n            return null\n    }\n}\n\nexport default reducer","import { Action } from 'redux'\nimport * as actions from '../actions/manageOrganizationRequests'\nimport { StoreState, ComponentLoadingState } from '../../types'\nimport { ActionFlag } from '../actions'\n\nexport function loadStart(\n    state: StoreState,\n    action: actions.LoadStart): StoreState {\n    return state\n}\n\nexport function loadSuccess(\n    state: StoreState,\n    action: actions.LoadSuccess): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            manageOrganizationRequestsView: {\n                loadingState: ComponentLoadingState.SUCCESS,\n                error: null,\n                viewModel: {\n                    organization: action.organization,\n                    requests: action.requests,\n                    invitations: action.invitations\n                },\n            }\n        }\n    }\n}\n\nexport function loadError(\n    state: StoreState,\n    action: actions.LoadError): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            manageOrganizationRequestsView: {\n                loadingState: ComponentLoadingState.ERROR,\n                error: action.error,\n                viewModel: null\n            }\n        }\n\n    }\n}\n\nexport function unload(state: StoreState, action: actions.Unload): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            manageOrganizationRequestsView: {\n                loadingState: ComponentLoadingState.NONE,\n                error: null,\n                viewModel: null\n            }\n        }\n    }\n}\n\nexport function getViewAccessSuccess(state: StoreState, action: actions.GetViewAccessSuccess): StoreState {\n    // Note: we use the state object rather than peeling off the viewModel because\n    // TS can't trace the assertion (not falsy) of the variable back to the object \n    // property it was taken from.\n    if (!state.views.manageOrganizationRequestsView.viewModel) {\n        return state\n    }\n    const requests = state.views.manageOrganizationRequestsView.viewModel.requests\n    const newRequests = requests.map((request) => {\n        if (request.id = action.request.id) {\n            return action.request\n        }\n        return request\n    })\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            manageOrganizationRequestsView: {\n                ...state.views.manageOrganizationRequestsView,\n                viewModel: {\n                    // TODO: below, \n                    ...state.views.manageOrganizationRequestsView.viewModel,\n                    requests: newRequests\n                }\n            }\n        }\n    }\n}\n\n\nfunction reducer(state: StoreState, action: Action): StoreState | null {\n    switch (action.type) {\n        case ActionFlag.ADMIN_MANAGE_REQUESTS_LOAD_START:\n            return loadStart(state, action as actions.LoadStart)\n        case ActionFlag.ADMIN_MANAGE_REQUESTS_LOAD_SUCCESS:\n            return loadSuccess(state, action as actions.LoadSuccess)\n        case ActionFlag.ADMIN_MANAGE_REQUESTS_LOAD_ERROR:\n            return loadError(state, action as actions.LoadError)\n        case ActionFlag.ADMIN_MANAGE_REQUESTS_UNLOAD:\n            return unload(state, action as actions.Unload)\n        case ActionFlag.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_SUCCESS:\n            return getViewAccessSuccess(state, action as actions.GetViewAccessSuccess)\n        default:\n            return null\n    }\n}\n\nexport default reducer","import { Action } from 'redux'\nimport * as actions from '../actions/viewMembers'\nimport { StoreState, ComponentLoadingState, MemberType } from '../../types'\nimport { ActionFlag } from '../actions'\n\nexport function loadStart(state: StoreState, action: actions.LoadStart) {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewMembersView: {\n                ...state.views.viewMembersView,\n                loadingState: ComponentLoadingState.LOADING,\n                viewModel: null,\n                error: null\n            }\n        }\n    }\n}\n\nexport function unload(state: StoreState, action: actions.Unload): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewMembersView: {\n                ...state.views.viewMembersView,\n                loadingState: ComponentLoadingState.NONE,\n                viewModel: null,\n                error: null\n            }\n        }\n    }\n}\n\nexport function loadSuccess(state: StoreState, action: actions.LoadSuccess): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewMembersView: {\n                ...state.views.viewMembersView,\n                loadingState: ComponentLoadingState.SUCCESS,\n                viewModel: {\n                    organization: action.organization,\n                    relation: action.relation\n                },\n                error: null\n            }\n        }\n    }\n}\n\nexport function loadError(state: StoreState, action: actions.LoadError): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewMembersView: {\n                ...state.views.viewMembersView,\n                loadingState: ComponentLoadingState.ERROR,\n                viewModel: null,\n                error: action.error\n            }\n        }\n    }\n}\n\nexport function promoteToAdminSuccess(state: StoreState, action: actions.PromoteToAdminSuccess): StoreState {\n    if (state.views.viewMembersView.viewModel === null) {\n        return state\n    }\n\n    const {\n        views: { viewMembersView: { viewModel } }\n    } = state\n\n    // TODO: probably better is to have to have the action handler do a call to get the members\n    // and to populate the orgs membership struct from that...\n    const members = viewModel.organization.members.map((member) => {\n        if (member.username === action.memberUsername) {\n            member.type = MemberType.ADMIN\n            return member\n        } else {\n            return member\n        }\n    })\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewMembersView: {\n                ...state.views.viewMembersView,\n                viewModel: {\n                    ...state.views.viewMembersView.viewModel,\n                    organization: {\n                        ...state.views.viewMembersView.viewModel!.organization,\n                        members: members\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function demoteToMemberSuccess(state: StoreState, action: actions.DemoteToMemberSuccess): StoreState {\n    if (state.views.viewMembersView.viewModel === null) {\n        return state\n    }\n\n    const {\n        views: { viewMembersView: { viewModel } }\n    } = state\n\n    // TODO: probably better is to have to have the action handler do a call to get the members\n    // and to populate the orgs membership struct from that...\n    const members = viewModel.organization.members.map((member) => {\n        if (member.username === action.memberUsername) {\n            member.type = MemberType.MEMBER\n            return member\n        } else {\n            return member\n        }\n    })\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewMembersView: {\n                ...state.views.viewMembersView,\n                viewModel: {\n                    ...state.views.viewMembersView.viewModel,\n                    organization: {\n                        ...state.views.viewMembersView.viewModel!.organization,\n                        members: members\n                    }\n                }\n            }\n        }\n    }\n}\n\nfunction reducer(state: StoreState, action: Action): StoreState | null {\n    // NB using discriminant union nature of the ActionX types to narrow\n    // the type.\n\n    switch (action.type) {\n        case ActionFlag.VIEW_MEMBERS_LOAD_START:\n            return loadStart(state, action as actions.LoadStart)\n        case ActionFlag.VIEW_MEMBERS_LOAD_SUCCESS:\n            return loadSuccess(state, action as actions.LoadSuccess)\n        case ActionFlag.VIEW_MEMBERS_LOAD_ERROR:\n            return loadError(state, action as actions.LoadError)\n        case ActionFlag.VIEW_MEMBERS_UNLOAD:\n            return unload(state, action as actions.Unload)\n        case ActionFlag.VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS:\n            return promoteToAdminSuccess(state, action as actions.PromoteToAdminSuccess)\n        case ActionFlag.VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS:\n            return demoteToMemberSuccess(state, action as actions.DemoteToMemberSuccess)\n        default:\n            return null\n    }\n}\n\nexport default reducer","import { AppError, AppException } from \"../../types\";\n\nexport interface GroupsServiceInfo {\n    servname: string;\n    version: string;\n    servertime: number;\n    gitcommithash: string\n}\n\nexport interface BriefGroup {\n    id: string;\n    name: string;\n    custom: {\n        gravatarhash?: string\n    }\n    owner: Member;\n    // createdAt: number;\n    // modifiedAt: number\n}\n\nexport type GroupList = Array<BriefGroup>\n\nexport type Username = string;\n\nexport interface Member {\n    name: Username,\n    joined: number,\n    // TODO: this needs to match the config of the groups service.\n    // ARGH: why do we need custom fields????????\n    custom: {}\n}\n\nexport interface WorkspaceInfo {\n    rid: string\n    name: string\n    narrname: string\n    public: boolean\n    perm: string\n}\n\nexport interface AppInfo {\n    rid: string\n}\n\nexport interface Group {\n    id: string\n    private: boolean\n    ismember: boolean\n    name: string\n    owner: Member\n    admins: Array<Member>\n    members: Array<Member>\n    createdate: number\n    moddate: number\n    resources: {\n        workspace: Array<WorkspaceInfo>,\n        catalogmethod: Array<AppInfo>\n    }\n    custom: {\n        gravatarhash?: string\n        description: string\n    }\n}\n\nexport interface NewGroup {\n    id: string\n    name: string\n    gravatarhash: string | null\n    description: string\n    isPrivate: boolean\n}\n\nexport interface GroupUpdate {\n    name: string\n    gravatarhash: string | null\n    description: string\n}\n\nexport interface Request {\n    id: string\n    groupid: string\n    requester: Username\n    type: string\n    status: string\n    resource: string\n    resourcetype: string\n    createdate: number\n    expiredate: number\n    moddate: number\n}\n\nexport interface RequestWithCompletion extends Request {\n    complete: false\n}\n\nexport interface Completion {\n    complete: true\n}\n\nexport interface ErrorInfo {\n    appcode: number\n    apperror: string\n    callid: string\n    httpcode: number\n    httpstatus: string\n    message: string\n    time: number\n}\n\nexport interface ErrorResult {\n    error: ErrorInfo\n}\n\n// Error types: (appcode)\n// 10000\tAuthentication failed\n// 10010\tNo authentication token\n// 10020\tInvalid token\n// 20000\tUnauthorized\n// 30000\tMissing input parameter\n// 30001\tIllegal input parameter\n// 30010\tIllegal user name\n// 40000\tGroup already exists\n// 40010\tRequest already exists\n// 40020\tUser already group member\n// 40030\tWorkspace already in group\n// 50000\tNo such group\n// 50010\tNo such request\n// 50020\tNo such user\n// 50030\tNo such workspace\n// 60000\tUnsupported operation\n\nexport interface GroupExists {\n    exists: boolean\n}\n\n// export interface GroupRequest {\n//     id: string,\n//     groupid: string,\n//     requester: Username,\n//     type: string,\n//     status: string,\n//     resource: string\n//     resourcetype: string\n//     createdate: number,\n//     expiredate: number,\n//     moddate: number\n// }\n\nexport enum SortDirection {\n    ASCENDING = 0,\n    DESCENDING\n}\n\nexport interface GetRequestsParams {\n    includeClosed?: boolean,\n    sortDirection?: SortDirection,\n    startAt?: Date\n}\n\nexport interface RequestMemebershipParams {\n    groupId: string\n}\n\nexport interface RequestNarrativeParams {\n    workspaceId: number\n    groupId: string\n}\n\nfunction promiseTry<T>(fun: () => Promise<T>): Promise<T> {\n    return new Promise<T>((resolve, reject) => {\n        try {\n            return resolve(fun())\n        } catch (ex) {\n            reject(ex)\n        }\n    })\n}\n\nexport interface GroupError {\n    httpcode: number\n    httpstatus: string\n    appcode: number\n    apperror: string\n    message: string\n    callid: string\n    time: number\n}\n\nexport class Exception extends Error {\n\n}\n\nexport class GroupException extends AppException {\n    originalError: GroupError\n    constructor(error: GroupError) {\n        super({\n            code: 'group-exception',\n            message: error.apperror,\n            detail: error.message,\n            info: new Map<string, any>([\n                ['httpcode', error.httpcode],\n                ['httpstatus', error.httpstatus],\n                ['appcode', error.appcode],\n                ['apperror', error.apperror],\n                ['message', error.message],\n                ['callid', error.callid],\n                ['time', error.time]\n            ])\n        })\n        this.name = 'GroupException'\n        this.originalError = error\n    }\n}\n\nexport class ServerException extends AppException {\n    constructor(detail: string) {\n        super({ code: 'server-exception', message: 'Server Exception', detail: detail })\n        this.name = 'ServerException'\n    }\n}\n\nexport class GroupsClient {\n    token: string;\n    url: string;\n\n    constructor({ token, url }: { token: string, url: string }) {\n        this.token = token\n        this.url = url\n    }\n\n    getInfo(): Promise<GroupsServiceInfo> {\n        return fetch(this.url + '/', {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json'\n            },\n            mode: 'cors'\n        })\n            .then((response) => {\n                return response.json();\n            })\n            .then((result) => {\n                return result as GroupsServiceInfo;\n            });\n    }\n\n    groupExists(id: string): Promise<GroupExists> {\n        return fetch(this.url + '/group/' + id + '/exists')\n            .then((response) => {\n                return response.json()\n            })\n            .then((exists) => {\n                return exists as GroupExists\n            })\n    }\n\n    // getGroups(): Promise<GroupList> {\n    //     return fetch(this.url + '/group', {\n    //         headers: {\n    //             Authorization: this.token,\n    //             Accept: 'application/json'\n    //         },\n    //         mode: 'cors'\n    //     })\n    //         .then((response) => {\n    //             return response.json()\n    //         })\n    //         .then((result: GroupList) => {\n    //             return result.filter(({ type }) => type === 'Organization')\n    //         })\n    // }\n\n\n    getGroups(): Promise<Array<Group>> {\n        let start = new Date().getTime()\n        return fetch(this.url + '/group', {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json'\n            },\n            mode: 'cors'\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    console.error('error fetching groups', response)\n                    throw new Error('Error fetching groups')\n                }\n                return response.json()\n            })\n            .then((result: GroupList) => {\n                return Promise.all(result.map((group) => (this.getGroupById(group.id))))\n            })\n            .then((result) => {\n                return result;\n            })\n    }\n\n    getGroupById(id: string): Promise<Group> {\n        return fetch(this.url + '/group/' + id, {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json'\n            },\n            mode: 'cors'\n        })\n            .then((response) => {\n                if (response.status === 404) {\n                    return null\n                }\n                return response.json()\n            })\n            .then((result) => {\n                return result as Group\n            })\n    }\n\n    put<T>(path: Array<string>, body: any): Promise<T> {\n        const url = ([this.url].concat(path)).join('/')\n        return fetch(url, {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            },\n            mode: 'cors',\n            method: 'PUT',\n            body: JSON.stringify(body)\n        })\n            .then((response) => {\n                if (response.status === 500) {\n                    switch (response.headers.get('Content-Type')) {\n                        case 'application/json':\n                            return response.json()\n                                .then((result) => {\n                                    throw new GroupException(result)\n                                })\n                        case 'text/plain':\n                            return response.text()\n                                .then((result) => {\n                                    throw new ServerException(result)\n                                })\n                        default:\n                            throw new Error('Unexpected content type: ' + response.headers.get('Content-Type'))\n                    }\n                } else if (response.status !== 200) {\n                    throw new Error('Unexpected response: ' + response.status + ' : ' + response.statusText)\n                } else {\n                    return response.json()\n                        .then((result) => {\n                            return result as T\n                        })\n                }\n            })\n    }\n\n    async post<T>(path: Array<string>, body: any): Promise<T | null> {\n        const url = ([this.url].concat(path)).join('/')\n        const response = await fetch(url, {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            },\n            mode: 'cors',\n            method: 'POST',\n            body: body ? JSON.stringify(body) : ''\n        })\n\n        if (response.status === 500) {\n            switch (response.headers.get('Content-Type')) {\n                case 'application/json':\n                    const result = await response.json()\n                    throw new GroupException(result)\n                case 'text/plain':\n                    const errorText = await response.text()\n                    throw new ServerException(errorText)\n                default:\n                    throw new Error('Unexpected content type: ' + response.headers.get('Content-Type'))\n            }\n        } else if (response.status === 200) {\n            return await response.json() as T\n        } else if (response.status === 204) {\n            return null\n        } else {\n            throw new Error('Unexpected response: ' + response.status + ' : ' + response.statusText)\n        }\n    }\n\n    async get<T>(path: Array<string>): Promise<T> {\n        const url = ([this.url].concat(path)).join('/')\n        const response = await fetch(url, {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            },\n            mode: 'cors',\n            method: 'GET'\n        })\n\n        if (response.status === 500) {\n            switch (response.headers.get('Content-Type')) {\n                case 'application/json':\n                    const result = await response.json()\n                    throw new GroupException(result)\n                case 'text/plain':\n                    const errorText = await response.text()\n                    throw new ServerException(errorText)\n                default:\n                    throw new Error('Unexpected content type: ' + response.headers.get('Content-Type'))\n            }\n        } else if (response.status === 200) {\n            return await response.json() as T\n        } else {\n            throw new Error('Unexpected response: ' + response.status + ' : ' + response.statusText)\n        }\n    }\n\n    createGroup(newGroup: NewGroup): Promise<Group> {\n        // argh!! description should be mandatory, but now it is a custom \n        // field and it is not yet defined in the service.\n        // TODO: we need the groups service to have default custom fields.\n        // At that point, what IS the point of custom fields ... oh, I know that\n        // there are internal reasons for this due to re-using \"group\" for \n        // organization, project, etc., but that should not leak through the \n        // api.\n\n        // mandatory fields.\n        const payload: any = {\n            name: newGroup.name,\n            private: newGroup.isPrivate,\n            custom: {\n                gravatarhash: newGroup.gravatarhash\n            }\n        }\n\n        // optional fields\n        if (newGroup.description.length > 0) {\n            payload.custom.description = newGroup.description\n        }\n\n        return this.put<Group>(['group', newGroup.id], payload)\n    }\n\n    updateGroup(id: string, groupUpdate: GroupUpdate): Promise<void> {\n        const payload: any = {\n            name: groupUpdate.name,\n            custom: {\n                gravatarhash: groupUpdate.gravatarhash\n            }\n        }\n        // TODO: remove this when we have descriptions restored to the\n        // groups service.\n        if (groupUpdate.description) {\n            payload.custom.description = groupUpdate.description\n        }\n        return fetch(this.url + '/group/' + id + '/update', {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            },\n            mode: 'cors',\n            method: 'PUT',\n\n            // TODO: build more intelligently\n            body: JSON.stringify(payload)\n        })\n            .then((response) => {\n                // response is an empty body.\n                if (response.status === 204) {\n                    return\n                }\n                throw new Error('Unexpected response: ' + response.status + ' : ' + response.statusText)\n            })\n    }\n\n    async getRequest(requestId: string): Promise<Request> {\n        const path = ['request', 'id', requestId]\n        return await this.get<Request>(path)\n    }\n\n    getGroupRequests(groupId: string, params: GetRequestsParams): Promise<Array<Request>> {\n        const query = new URLSearchParams()\n        if (params.includeClosed) {\n            query.append('closed', 'closed')\n        }\n        if (params.sortDirection) {\n            if (params.sortDirection === SortDirection.DESCENDING) {\n                query.append('order', 'desc')\n            } else {\n                query.append('order', 'asc')\n            }\n        }\n        if (params.startAt) {\n            query.append('excludeupto', String(params.startAt.getTime()))\n        }\n\n        return fetch(this.url + '/group/' + groupId + '/requests?' + query.toString(), {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            },\n            mode: 'cors',\n            method: 'GET'\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error('Unexpected response: ' + response.status + ' : ' + response.statusText)\n                }\n                return response.json()\n            })\n    }\n\n    getTargetedRequests(params: GetRequestsParams): Promise<Array<Request>> {\n        const query = new URLSearchParams()\n        if (params.includeClosed) {\n            query.append('closed', 'closed')\n        }\n        if (params.sortDirection) {\n            if (params.sortDirection === SortDirection.DESCENDING) {\n                query.append('order', 'desc')\n            } else {\n                query.append('order', 'asc')\n            }\n        }\n        if (params.startAt) {\n            query.append('excludeupto', String(params.startAt.getTime()))\n        }\n        return fetch(this.url + '/request/targeted?' + query.toString(), {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            },\n            mode: 'cors',\n            method: 'GET'\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error('Unexpected response: ' + response.status + ' : ' + response.statusText)\n                }\n                return response.json()\n            })\n    }\n\n    getCreatedRequests(params: GetRequestsParams): Promise<Array<Request>> {\n        const query = new URLSearchParams()\n        if (params.includeClosed) {\n            query.append('closed', 'closed')\n        }\n        if (params.sortDirection) {\n            if (params.sortDirection === SortDirection.DESCENDING) {\n                query.append('order', 'desc')\n            } else {\n                query.append('order', 'asc')\n            }\n        }\n        if (params.startAt) {\n            query.append('excludeupto', String(params.startAt.getTime()))\n        }\n        return fetch(this.url + '/request/created?' + query.toString(), {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json',\n                'Content-Type': 'appcliation/json'\n            },\n            mode: 'cors',\n            method: 'GET'\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error('Unexpected response: ' + response.status + ' : ' + response.statusText)\n                }\n                return response.json()\n            })\n    }\n\n    addOrRequestNarrative(params: RequestNarrativeParams): Promise<RequestWithCompletion | Completion> {\n        const url = [\n            this.url,\n            'group',\n            params.groupId,\n            'resource',\n            'workspace',\n            String(params.workspaceId)\n        ].join('/')\n        return fetch(url, {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            },\n            mode: 'cors',\n            method: 'POST'\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error('Unexpected response: ' + response.status + ' : ' + response.statusText)\n                }\n                return response.json()\n            })\n            .then((result) => {\n                if (result.complete === false) {\n                    return result as RequestWithCompletion\n                } else {\n                    return result as Completion\n                }\n\n            })\n    }\n\n    async grantResourceAccess(groupId: string, resourceType: string, resourceId: string): Promise<null> {\n        const path = [\n            'group',\n            groupId,\n            'resource',\n            resourceType,\n            resourceId,\n            'getperm'\n        ]\n        return this.post<null>(path, null)\n    }\n\n    deleteResource(groupId: string, resourceType: string, resourceId: string): Promise<void> {\n        const url = [\n            this.url,\n            'group',\n            groupId,\n            'resource',\n            resourceType,\n            resourceId\n        ].join('/')\n        return fetch(url, {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            },\n            mode: 'cors',\n            method: 'DELETE'\n        })\n            .then((response) => {\n                if (response.status !== 204) {\n                    throw new Error('Unexpected response: ' + response.status + ' : ' + response.statusText)\n                }\n            })\n    }\n\n    cancelRequest({ requestId }: { requestId: string }): Promise<Request> {\n        return fetch(this.url + '/request/id/' + requestId + '/cancel', {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            },\n            mode: 'cors',\n            method: 'PUT'\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error('Unexpected response: ' + response.status)\n                }\n                return response.json()\n            })\n            .then((result) => {\n                return result as Request\n            })\n    }\n\n    acceptRequest({ requestId }: { requestId: string }): Promise<Request> {\n        return fetch(this.url + '/request/id/' + requestId + '/accept', {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            },\n            mode: 'cors',\n            method: 'PUT'\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error('Unexpected response: ' + response.status)\n                }\n                return response.json()\n            })\n            .then((result) => {\n                return result as Request\n            })\n    }\n\n    grantReadAccessToRequestedResource({ requestId }: { requestId: string }): Promise<null> {\n        const path = ['request', 'id', requestId, 'getperm']\n        return this.post<null>(path, null)\n    }\n\n\n    denyRequest({ requestId }: { requestId: string }): Promise<Request> {\n        return fetch(this.url + '/request/id/' + requestId + '/deny', {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            },\n            mode: 'cors',\n            method: 'PUT'\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error('Unexpected response: ' + response.status)\n                }\n                return response.json()\n            })\n            .then((result) => {\n                return result as Request\n            })\n    }\n\n    memberToAdmin({ groupId, member }: { groupId: string, member: string }): Promise<void> {\n        const url = [\n            this.url, 'group', groupId, 'user', member, 'admin'\n        ].join('/')\n        return fetch(url, {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json'\n            },\n            mode: 'cors',\n            method: 'PUT'\n        })\n            .then((response) => {\n                if (response.status !== 204) {\n                    throw new Error('Unexpected response: ' + response.status + ':' + response.statusText)\n                }\n\n            })\n    }\n\n    adminToMember({ groupId, member }: { groupId: string, member: string }): Promise<void> {\n        const url = [\n            this.url, 'group', groupId, 'user', member, 'admin'\n        ].join('/')\n        return fetch(url, {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json'\n            },\n            mode: 'cors',\n            method: 'DELETE'\n        })\n            .then((response) => {\n                if (response.status !== 204) {\n                    throw new Error('Unexpected response: ' + response.status + ':' + response.statusText)\n                }\n\n            })\n    }\n\n    removeMember({ groupId, member }: { groupId: string, member: string }): Promise<void> {\n        const url = [\n            this.url, 'group', groupId, 'user', member\n        ].join('/')\n        return fetch(url, {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json'\n            },\n            mode: 'cors',\n            method: 'DELETE'\n        })\n            .then((response) => {\n                if (response.status !== 204) {\n                    throw new Error('Unexpected response: ' + response.status + ':' + response.statusText)\n                }\n\n            })\n    }\n\n    requestMembership(params: RequestMemebershipParams): Promise<Request> {\n        return fetch(this.url + '/group/' + params.groupId + '/requestmembership', {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json',\n                'Content-Type': 'application/json',\n            },\n            mode: 'cors',\n            method: 'POST'\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error('Unexpected response: ' + response.status + ' : ' + response.statusText)\n                }\n                return response.json()\n            })\n            .then((result) => {\n                return result as Request\n            })\n    }\n\n    inviteUserToGroup({ groupId, username }: { groupId: string, username: string }): Promise<Request> {\n        const url = [\n            this.url, 'group', groupId, 'user', username\n        ].join('/')\n        return fetch(url, {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json'\n            },\n            mode: 'cors',\n            method: 'POST'\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error('Unexpected response: ' + response.status + ':' + response.statusText)\n                }\n                return response.json()\n            })\n            .then((result) => {\n                return result as Request\n            })\n    }\n}","import * as groupsApi from '../apis/groups'\nimport * as orgModel from './organization/model'\n\nexport type Username = string\n\nexport type RequestID = string\n\nexport enum RequestType {\n    REQUEST = 0,\n    INVITATION\n}\n\nexport enum RequestResourceType {\n    USER = 0,\n    WORKSPACE,\n    APP\n}\n\nexport enum RequestStatus {\n    OPEN = 0,\n    CANCELED,\n    EXPIRED,\n    ACCEPTED,\n    DENIED\n}\n\nexport interface BaseRequest {\n    id: string\n    organizationId: string\n    requester: Username\n    type: RequestType\n    status: RequestStatus\n    resourceType: RequestResourceType\n    createdAt: Date\n    expireAt: Date\n    modifiedAt: Date\n}\n\nexport interface UserRequest extends BaseRequest {\n    resourceType: RequestResourceType.USER\n    type: RequestType.REQUEST\n    user: Username\n}\n\nexport interface UserInvitation extends BaseRequest {\n    resourceType: RequestResourceType.USER\n    type: RequestType.INVITATION\n    user: Username\n}\n\nexport interface WorkspaceRequest extends BaseRequest {\n    resourceType: RequestResourceType.WORKSPACE\n    type: RequestType.REQUEST\n    narrativeId: string,\n}\n\nexport interface WorkspaceInvitation extends BaseRequest {\n    resourceType: RequestResourceType.WORKSPACE\n    type: RequestType.INVITATION\n    narrativeId: string\n}\n\nexport interface AppRequest extends BaseRequest {\n    resourceType: RequestResourceType.APP\n    type: RequestType.REQUEST\n    appId: string\n}\n\nexport interface AppInvitation extends BaseRequest {\n    resourceType: RequestResourceType.APP\n    type: RequestType.INVITATION\n    appId: string\n}\n\nexport type Request = UserRequest | UserInvitation | WorkspaceRequest | WorkspaceInvitation | AppRequest | AppInvitation\n\n\nfunction stringToRequestType(type: string): RequestType {\n    switch (type) {\n        case 'Invite':\n            return RequestType.INVITATION\n        case 'Request':\n            return RequestType.REQUEST\n        default:\n            throw new Error('unknown request type: ' + type)\n    }\n}\n\nfunction stringToResourceType(type: string) {\n    switch (type) {\n        case 'user':\n            return RequestResourceType.USER\n        case 'workspace':\n            return RequestResourceType.WORKSPACE\n        case 'catalogmethod':\n            return RequestResourceType.APP\n        default:\n            throw new Error('unknown resource type: ' + type)\n    }\n}\n\nfunction stringToRequestStatus(status: string): RequestStatus {\n    return RequestStatus.OPEN\n}\n\nexport function groupRequestToOrgRequest(request: groupsApi.Request): Request {\n\n    const requestType = stringToRequestType(request.type)\n    const resourceType = stringToResourceType(request.resourcetype)\n    const requestStatus = stringToRequestStatus(request.status)\n\n    switch (resourceType) {\n        case RequestResourceType.USER:\n            if (requestType === RequestType.REQUEST) {\n                return {\n                    id: request.id,\n                    organizationId: request.groupid,\n                    resourceType: resourceType,\n                    requester: request.requester,\n                    type: requestType,\n                    status: requestStatus,\n                    user: request.resource as Username,\n                    createdAt: new Date(request.createdate),\n                    expireAt: new Date(request.expiredate),\n                    modifiedAt: new Date(request.moddate)\n                } as UserRequest\n            } else {\n                return {\n                    id: request.id,\n                    organizationId: request.groupid,\n                    resourceType: resourceType,\n                    requester: request.requester,\n                    type: requestType,\n                    status: requestStatus,\n                    user: request.resource as Username,\n                    createdAt: new Date(request.createdate),\n                    expireAt: new Date(request.expiredate),\n                    modifiedAt: new Date(request.moddate)\n                } as UserInvitation\n            }\n\n        case RequestResourceType.WORKSPACE:\n            if (requestType === RequestType.REQUEST) {\n                return {\n                    id: request.id,\n                    organizationId: request.groupid,\n                    resourceType: resourceType,\n                    requester: request.requester,\n                    type: requestType,\n                    status: requestStatus,\n                    narrativeId: request.resource,\n                    createdAt: new Date(request.createdate),\n                    expireAt: new Date(request.expiredate),\n                    modifiedAt: new Date(request.moddate)\n                } as WorkspaceRequest\n            } else {\n                return {\n                    id: request.id,\n                    organizationId: request.groupid,\n                    resourceType: resourceType,\n                    requester: request.requester,\n                    type: requestType,\n                    status: requestStatus,\n                    narrativeId: request.resource,\n                    createdAt: new Date(request.createdate),\n                    expireAt: new Date(request.expiredate),\n                    modifiedAt: new Date(request.moddate)\n                } as WorkspaceInvitation\n            }\n\n        case RequestResourceType.APP:\n            if (requestType === RequestType.REQUEST) {\n                return {\n                    id: request.id,\n                    organizationId: request.groupid,\n                    resourceType: resourceType,\n                    requester: request.requester,\n                    type: requestType,\n                    status: requestStatus,\n                    appId: request.resource,\n                    createdAt: new Date(request.createdate),\n                    expireAt: new Date(request.expiredate),\n                    modifiedAt: new Date(request.moddate)\n                } as AppRequest\n            } else {\n                return {\n                    id: request.id,\n                    organizationId: request.groupid,\n                    resourceType: resourceType,\n                    requester: request.requester,\n                    type: requestType,\n                    status: requestStatus,\n                    appId: request.resource,\n                    createdAt: new Date(request.createdate),\n                    expireAt: new Date(request.expiredate),\n                    modifiedAt: new Date(request.moddate)\n                } as AppInvitation\n            }\n        default:\n            throw new Error('resource type not handled yet: ' + request.resourcetype)\n    }\n}\n\ninterface RequestsModelParams {\n    groupsServiceURL: string\n    token: string\n    username: Username\n}\n\nexport class RequestsModel {\n\n    params: RequestsModelParams\n    groupsClient: groupsApi.GroupsClient\n    cache: Map<RequestID, Request>\n\n    constructor(params: RequestsModelParams) {\n        this.params = params\n        this.groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n        this.cache = new Map()\n    }\n\n    async getRequest(requestId: RequestID): Promise<Request> {\n        if (this.cache.has(requestId)) {\n            return this.cache.get(requestId)!\n        }\n\n        const grequest = await this.groupsClient.getRequest(requestId)\n        const request = groupRequestToOrgRequest(grequest)\n\n        this.cache.set(request.id, request)\n        return request\n    }\n\n    async getUserRequests(): Promise<Array<Request>> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        const grequests = await groupsClient.getCreatedRequests({\n            includeClosed: false,\n            sortDirection: groupsApi.SortDirection.DESCENDING\n        })\n\n        const requests = grequests.map((request) => {\n            return groupRequestToOrgRequest(request)\n        })\n\n        requests.forEach((request) => {\n            if (!this.cache.has(request.id)) {\n                this.cache.set(request.id, request)\n            }\n        })\n\n        return requests\n    }\n\n    async getUserRequestForOrg(organizationId: orgModel.OrganizationID): Promise<UserRequest | null> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        const grequests = await groupsClient.getCreatedRequests({\n            includeClosed: false,\n            sortDirection: groupsApi.SortDirection.DESCENDING\n        })\n\n        // TODO should work in synchrony with above...\n        const grequest = grequests.find((r) => {\n            return r.groupid === organizationId\n        })\n\n        if (!grequest) {\n            return null\n        }\n\n        return groupRequestToOrgRequest(grequest) as UserRequest\n    }\n\n    async getPendingRequestsForOrg(organizationId: orgModel.OrganizationID): Promise<Array<Request>> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        const grequests = await groupsClient.getCreatedRequests({\n            includeClosed: false,\n            sortDirection: groupsApi.SortDirection.DESCENDING\n        })\n\n        // TODO should work in synchrony with above...\n        return grequests\n            .filter((r) => {\n                return r.groupid === organizationId\n            })\n            .map((r) => {\n                return groupRequestToOrgRequest(r)\n            })\n    }\n\n    async getOrganizationInvitations(): Promise<Array<Request>> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        const grequests = await groupsClient.getCreatedRequests({\n            includeClosed: false,\n            sortDirection: groupsApi.SortDirection.DESCENDING\n        })\n\n        const requests = grequests.map((request) => {\n            return groupRequestToOrgRequest(request)\n        }).filter((request) => {\n            return (request.type === RequestType.INVITATION)\n        })\n\n        requests.forEach((request) => {\n            if (!this.cache.has(request.id)) {\n                this.cache.set(request.id, request)\n            }\n        })\n\n        return requests\n    }\n\n    async getOrganizationInvitationsForOrg(organizationId: orgModel.OrganizationID): Promise<Array<Request>> {\n        const invitations = await this.getOrganizationInvitations()\n        return invitations.filter((invitation) => {\n            return (invitation.organizationId === organizationId)\n        })\n    }\n\n    async getUserInvitations(): Promise<Array<Request>> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        const grequests = await groupsClient.getTargetedRequests({\n            includeClosed: false,\n            sortDirection: groupsApi.SortDirection.DESCENDING\n        })\n\n        const requests = grequests.map((request) => {\n            return groupRequestToOrgRequest(request)\n        })\n\n        requests.forEach((request) => {\n            if (!this.cache.has(request.id)) {\n                this.cache.set(request.id, request)\n            }\n        })\n\n        return requests\n    }\n\n    async getUserInvitationForOrg(organizationId: orgModel.OrganizationID): Promise<UserInvitation | null> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        const grequests = await groupsClient.getTargetedRequests({\n            includeClosed: false,\n            sortDirection: groupsApi.SortDirection.DESCENDING\n        })\n\n        // TODO should work in synchrony with above...\n        const grequest = grequests.find((r) => {\n            return (r.groupid === organizationId)\n        })\n\n        if (!grequest) {\n            return null\n        }\n\n        return groupRequestToOrgRequest(grequest) as UserInvitation\n    }\n\n    async getPendingOrganizationRequestsForOrg(organizationId: orgModel.OrganizationID): Promise<Array<Request>> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        const groupRequests = await groupsClient.getGroupRequests(organizationId, {\n            includeClosed: false,\n            sortDirection: groupsApi.SortDirection.DESCENDING\n        })\n\n        return groupRequests.map((request) => {\n            return groupRequestToOrgRequest(request)\n        })\n\n        // const [groupRequests, adminRequests] = await Promise.all([\n        //     groupsClient.getGroupRequests(groupId, {\n        //         includeClosed: false,\n        //         sortDirection: groupsApi.SortDirection.DESCENDING\n        //     }),\n        //     groupsClient.getCreatedRequests({\n        //         includeClosed: false,\n        //         sortDirection: groupsApi.SortDirection.DESCENDING\n        //     })\n        // ])\n        // const groupAdminRequests = adminRequests.filter((request) => {\n        //     return (request.groupid === groupId)\n        // })\n\n        // return Promise.all(groupRequests.concat(groupAdminRequests).map((request) => {\n        //     return groupRequestToOrgRequest(request)\n        // }))\n    }\n\n    async getPendingOrganizationRequests(groupIds: Array<string>): Promise<Array<Request>> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        const groupRequests = await Promise.all(groupIds.map((groupId) => {\n            return groupsClient.getGroupRequests(groupId, {\n                includeClosed: false,\n                sortDirection: groupsApi.SortDirection.DESCENDING\n            })\n        }))\n\n        const allRequests = groupRequests.reduce((allRequests, requests) => {\n            return allRequests.concat(requests)\n        }, [])\n\n        return allRequests.map((request) => {\n            return groupRequestToOrgRequest(request)\n        })\n    }\n\n    async cancelRequest(requestId: string): Promise<Request> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        const request = await groupsClient.cancelRequest({\n            requestId\n        })\n        return groupRequestToOrgRequest(request)\n    }\n\n    async acceptRequest(requestId: string): Promise<Request> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        const request = await groupsClient.acceptRequest({\n            requestId\n        })\n        return groupRequestToOrgRequest(request)\n    }\n\n    async denyRequest(requestId: string): Promise<Request> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        const request = await groupsClient.denyRequest({\n            requestId\n        })\n        return groupRequestToOrgRequest(request)\n    }\n\n    async acceptJoinInvitation(requestId: string): Promise<Request> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        const request = await groupsClient.acceptRequest({\n            requestId\n        })\n        return groupRequestToOrgRequest(request)\n    }\n\n    async rejectJoinInvitation(requestId: string): Promise<Request> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        const request = await groupsClient.denyRequest({\n            requestId\n        })\n        return groupRequestToOrgRequest(request)\n    }\n\n    async inviteUserToJoinOrg(groupId: string, username: string): Promise<Request> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        return groupsClient.inviteUserToGroup({\n            groupId,\n            username\n        })\n            .then((request) => {\n                return groupRequestToOrgRequest(request)\n            })\n    }\n}","import * as groupsApi from '../../apis/groups'\nimport { SortDirection, EditableOrganization, UIErrorType, OrganizationUpdate, UIError } from '../../../types';\nimport * as requestModel from '../requests'\nimport * as userModel from '../user';\nimport Validation from './validation'\n\n\n\nexport interface User {\n    username: string\n    realname: string\n    title: string | null\n    organization: string | null\n    city: string | null\n    state: string | null\n    country: string | null\n    avatarOption: string | null\n    gravatarHash: string | null\n    gravatarDefault: string | null\n}\n\nexport enum MemberType {\n    MEMBER = 0,\n    ADMIN,\n    OWNER\n}\nexport interface Member {\n    username: groupsApi.Username,\n    joinedAt: Date\n    type: MemberType\n}\n\nexport enum UserRelationToOrganization {\n    NONE = 0,\n    VIEW,\n    MEMBER_REQUEST_PENDING,\n    MEMBER_INVITATION_PENDING,\n    MEMBER,\n    ADMIN,\n    OWNER\n}\n\nexport interface UserOrgRelation {\n    type: UserRelationToOrganization\n}\n\nexport interface NoRelation extends UserOrgRelation {\n    type: UserRelationToOrganization.NONE\n}\n\nexport interface ViewRelation extends UserOrgRelation {\n    type: UserRelationToOrganization.VIEW\n}\n\nexport interface MembershipRequestPendingRelation extends UserOrgRelation {\n    type: UserRelationToOrganization.MEMBER_REQUEST_PENDING,\n    requestId: string\n}\n\nexport interface MembershipInvitationPendingRelation extends UserOrgRelation {\n    type: UserRelationToOrganization.MEMBER_INVITATION_PENDING,\n    requestId: string\n}\n\nexport interface MemberRelation extends UserOrgRelation {\n    type: UserRelationToOrganization.MEMBER\n}\n\nexport interface AdminRelation extends UserOrgRelation {\n    type: UserRelationToOrganization.ADMIN\n}\n\nexport interface OwnerRelation extends UserOrgRelation {\n    type: UserRelationToOrganization.OWNER\n}\n\nexport type Relation = NoRelation | ViewRelation | MembershipRequestPendingRelation | MembershipInvitationPendingRelation | MemberRelation | AdminRelation | OwnerRelation\n\nexport type username = string\n\nexport interface Member {\n    username: username\n    type: MemberType\n}\n\nexport enum UserWorkspacePermission {\n    NONE = 0,\n    VIEW,\n    EDIT,\n    ADMIN,\n    OWNER\n}\n\nexport type WorkspaceID = number\n\nexport interface NarrativeInfo {\n    workspaceId: WorkspaceID,\n    title: string,\n    isPublic: boolean,\n    permission: UserWorkspacePermission\n}\n\nexport type AppID = string\n\nexport interface AppInfo {\n    appId: AppID\n}\n\nexport interface Organization {\n    id: string\n    name: string\n    isPrivate: boolean\n    isMember: boolean\n    gravatarHash: string | null\n    description: string\n    owner: Member\n    members: Array<Member>\n    // relation: UserOrgRelation\n    createdAt: Date\n    modifiedAt: Date,\n    narratives: Array<NarrativeInfo>,\n    apps: Array<AppInfo>\n}\n\nexport function determineRelation(\n    org: Organization,\n    username: userModel.Username,\n    request: requestModel.UserRequest | null,\n    invitation: requestModel.UserInvitation | null): Relation {\n    if (username === org.owner.username) {\n        return {\n            type: UserRelationToOrganization.OWNER\n        } as OwnerRelation\n    } else {\n        const member = org.members.find((member) => {\n            return (member.username === username)\n        })\n        if (member) {\n            switch (member.type) {\n                case MemberType.MEMBER:\n                    return {\n                        type: UserRelationToOrganization.MEMBER\n                    } as MemberRelation\n                case MemberType.ADMIN:\n                    return {\n                        type: UserRelationToOrganization.ADMIN\n                    } as AdminRelation\n                case MemberType.OWNER:\n                    return {\n                        type: UserRelationToOrganization.OWNER\n                    } as OwnerRelation\n                default:\n                    return {\n                        type: UserRelationToOrganization.NONE\n                    } as NoRelation\n            }\n        } else if (request && request.user === username) {\n            return {\n                type: UserRelationToOrganization.MEMBER_REQUEST_PENDING,\n                requestId: request.id\n            } as MembershipRequestPendingRelation\n        } else if (invitation && invitation.user === username) {\n            return {\n                type: UserRelationToOrganization.MEMBER_INVITATION_PENDING,\n                requestId: invitation.id\n            } as MembershipInvitationPendingRelation\n        } else {\n            return {\n                type: UserRelationToOrganization.NONE\n            } as NoRelation\n        }\n    }\n}\n\nfunction groupPermissionToWorkspacePermission(groupsPermission: string): UserWorkspacePermission {\n    switch (groupsPermission) {\n        case 'None':\n            return UserWorkspacePermission.NONE\n        case 'Read':\n            return UserWorkspacePermission.VIEW\n        case 'Write':\n            return UserWorkspacePermission.EDIT\n        case 'Admin':\n            return UserWorkspacePermission.ADMIN\n        case 'Own':\n            return UserWorkspacePermission.OWNER\n        default:\n            throw new Error('Invalid groups user permission: ' + groupsPermission)\n    }\n}\n\nexport function groupToOrganization(group: groupsApi.Group, currentUser: username): Organization {\n\n    const owner = {\n        username: group.owner.name,\n        joinedAt: new Date(group.owner.joined),\n        type: MemberType.OWNER\n    }\n\n    // We join admins and members, since they are all members, just different privileges in the org\n    const members: Array<Member> = (<Array<Member>>[\n        // owner\n    ]).concat(group.admins.map((admin) => {\n        return {\n            username: admin.name,\n            joinedAt: new Date(admin.joined),\n            type: MemberType.ADMIN\n        }\n    })).concat(group.members.map((member) => {\n        return {\n            username: member.name,\n            joinedAt: new Date(member.joined),\n            type: MemberType.MEMBER\n        }\n    }))\n\n    const narratives: Array<NarrativeInfo> = group.resources.workspace.map((info) => {\n        return {\n            workspaceId: parseInt(info.rid, 10),\n            title: info.narrname,\n            isPublic: info.public,\n            permission: groupPermissionToWorkspacePermission(info.perm)\n        }\n    })\n    const apps: Array<AppInfo> = []\n\n    return {\n        id: group.id,\n        name: group.name,\n        isPrivate: group.private,\n        isMember: group.ismember,\n        gravatarHash: group.custom.gravatarhash || null,\n        description: group.custom.description,\n        owner: owner,\n        members: members,\n        modifiedAt: new Date(group.moddate),\n        createdAt: new Date(group.createdate),\n        narratives: narratives,\n        apps: []\n    }\n}\n\n// export function determineRelation(group: Group, username: userModel.Username) {\n//     let relation: UserOrgRelation\n//     // TODO: when we have access to members, admins, and group publication status, we can \n//     // flesh out all user relations.\n//     // const orgMembers: Array<username> = this.membersAndAdminsToMembers(members, admins, profileMap)\n\n//     if (username === group.owner) {\n//         relation = {\n//             type: UserRelationToOrganization.OWNER\n//         } as OwnerRelation\n//     } else if (group.admins.indexOf(username) >= 0) {\n//         relation = {\n//             type: UserRelationToOrganization.ADMIN\n//         } as AdminRelation\n//     } else if (group.members.indexOf(username) >= 0) {\n//         relation = {\n//             type: UserRelationToOrganization.MEMBER\n//         } as MemberRelation\n//     } else if (pendingRequests.has(group.id)) {\n//         relation = {\n//             type: UserRelationToOrganization.MEMBER_REQUEST_PENDING,\n//             requestId: pendingRequests.get(group.id)!.id\n//         } as MembershipRequestPendingRelation\n//     } else if (pendingInvites.has(group.id)) {\n//         relation = {\n//             type: UserRelationToOrganization.MEMBER_INVITATION_PENDING,\n//             requestId: pendingInvites.get(group.id)!.id\n//         } as MembershipInvitationPendingRelation\n//     } else {\n//         relation = {\n//             type: UserRelationToOrganization.VIEW\n//         } as ViewRelation\n//     }\n// }\n\nexport type GroupID = string\nexport type OrganizationID = GroupID\n\n\nexport interface ConstructorParams {\n    groupsServiceURL: string\n    token: string\n    username: groupsApi.Username\n}\n\nexport interface QueryResults {\n    organizations: Array<Organization>\n    total: number\n}\n\nexport interface Query {\n    searchTerms: Array<string>\n    username: groupsApi.Username\n    sortBy: string\n    sortDirection: SortDirection\n    filter: string\n}\n\n\nexport interface NarrativeResource {\n    workspaceId: number\n    title: string\n    permission: UserWorkspacePermission\n    isPublic: boolean\n}\n\nexport function applyOrgSearch(orgs: Array<Organization>, searchTerms: Array<string>): Array<Organization> {\n    const searchTermsRe = searchTerms.map((term) => {\n        return new RegExp(term, 'i')\n    })\n    const filteredOrgs = orgs.filter((org) => {\n        if (searchTerms.length === 0) {\n            return true;\n        }\n        return searchTermsRe.every((termRe) => {\n            return termRe.test(org.name) ||\n                termRe.test(org.owner.username) ||\n                termRe.test(org.owner.username)\n        })\n    })\n\n    return filteredOrgs\n}\n\nfunction applySort(organizations: Array<Organization>, sortBy: string, sortDirection: SortDirection): Array<Organization> {\n    const direction = sortDirection === SortDirection.ASCENDING ? 1 : -1\n    switch (sortBy) {\n        case 'created':\n            return organizations.slice().sort((a, b) => {\n                return direction * (a.createdAt.getTime() - b.createdAt.getTime())\n            })\n        // case 'modifiedAt':\n        //     return organizations.slice().sort((a, b) => {\n        //         return direction * (a.modifiedAt.getTime() - b.modifiedAt.getTime())\n        //     })\n        case 'name':\n            return organizations.slice().sort((a, b) => {\n                return direction * a.name.localeCompare(b.name)\n            })\n        case 'owner':\n            return organizations.slice().sort((a, b) => {\n                return direction * a.owner.username.localeCompare(b.owner.username)\n            })\n        default:\n            console.warn('unimplemented sort field: ' + sortBy)\n            return organizations;\n    }\n}\n\n\n\nfunction applyFilter(organizations: Array<Organization>, filter: string, username: groupsApi.Username): Array<Organization> {\n    switch (filter) {\n        case 'all':\n            return organizations\n        case 'memberOf':\n            return organizations.filter((org) => (\n                (org.members.findIndex((member) => (member.username === username)) >= 0)\n            ))\n        case 'owned':\n            return organizations.filter((org) => (org.owner.username === username))\n        case 'notOwned':\n            return organizations.filter((org) => (org.owner.username !== username))\n        // TODO: re-enable when have relation again...\n        // case 'pending':\n        //     return organizations.filter((org) => (\n        //         org.relation.type === UserRelationToOrganization.MEMBER_INVITATION_PENDING ||\n        //         org.relation.type === UserRelationToOrganization.MEMBER_REQUEST_PENDING\n        //     ))\n        // case 'groupPending':\n        //     return organizations.filter((org) => (\n        //         (org.relation.type === UserRelationToOrganization.ADMIN ||\n        //             org.relation.type === UserRelationToOrganization.OWNER) &&\n        //         (org.adminRequests && org.adminRequests.length > 0)\n        //     ))\n        default:\n            console.warn('unknown filter : ' + filter)\n            return organizations\n    }\n}\n\nexport class OrganizationModel {\n\n    params: ConstructorParams\n    groupsClient: groupsApi.GroupsClient\n    organizations: Map<OrganizationID, Organization>\n\n    constructor(params: ConstructorParams) {\n        this.params = params\n        this.groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n        this.organizations = new Map<OrganizationID, Organization>()\n    }\n\n    async getOrg(id: OrganizationID): Promise<Organization> {\n        if (this.organizations.has(id)) {\n            return this.organizations.get(id)!\n        }\n        return this.groupsClient.getGroupById(id)\n            .then((group) => {\n                const org = groupToOrganization(group, this.params.username)\n                this.organizations.set(id, org)\n                return org\n            })\n    }\n\n    async getOrgs(ids: Array<OrganizationID>): Promise<Array<Organization>> {\n        return Promise.all(ids.map((id) => {\n            return this.getOrg(id)\n        }))\n    }\n\n    async getAllOrgs(): Promise<Array<Organization>> {\n        const groups = await this.groupsClient.getGroups()\n        const ids = groups.map((group) => {\n            return group.id\n        })\n        return this.getOrgs(ids)\n    }\n\n    async getOwnOrgs(): Promise<Array<Organization>> {\n        const orgs = await this.getAllOrgs()\n\n        return orgs.filter((org: Organization) => {\n            if (org.owner.username === this.params.username) {\n                return true\n            }\n            if (org.members.find(({ username }) => {\n                return (username === this.params.username)\n            })) {\n                return true\n            }\n            return false\n        })\n    }\n\n    async queryOrgs(query: Query): Promise<QueryResults> {\n        const orgs = await this.getAllOrgs()\n\n        const filtered = applyFilter(orgs, query.filter, query.username)\n        const searched = applyOrgSearch(filtered, query.searchTerms)\n        const sorted = applySort(searched, query.sortBy, query.sortDirection)\n\n        return {\n            organizations: sorted,\n            total: orgs.length\n        }\n    }\n\n    async ownOrgs(username: groupsApi.Username): Promise<QueryResults> {\n        const orgs = await this.getAllOrgs()\n\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        const groups = await groupsClient.getGroups()\n\n        const ownGroups = groups.filter((group: groupsApi.Group) => {\n            if (group.owner.name === username) {\n                return true\n            }\n            if (group.members.find((member) => {\n                return (member.name === username)\n            })) {\n                return true\n            }\n            if (group.admins.find((member) => {\n                return (member.name === username)\n            })) {\n                return true\n            }\n            return false\n        })\n\n\n        const ownOrganizations = ownGroups.map((group) => {\n            return groupToOrganization(group, username)\n        })\n\n        return {\n            organizations: ownOrganizations,\n            total: ownOrganizations.length\n        }\n    }\n\n    async grantViewAccess(requestId: string): Promise<requestModel.Request> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        await groupsClient.grantReadAccessToRequestedResource({ requestId })\n        const req = await groupsClient.getRequest(requestId)\n        return requestModel.groupRequestToOrgRequest(req)\n    }\n\n    async addOrg(newOrg: EditableOrganization, username: groupsApi.Username): Promise<Organization> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        // do record-level validation\n        if ((newOrg.id.error && newOrg.id.error.type === UIErrorType.ERROR) ||\n            (newOrg.name.error && newOrg.name.error.type === UIErrorType.ERROR) ||\n            (newOrg.gravatarHash.error && newOrg.gravatarHash.error.type === UIErrorType.ERROR) ||\n            (newOrg.description.error && newOrg.description.error.type === UIErrorType.ERROR) ||\n            (newOrg.isPrivate.error && newOrg.isPrivate.error.type === UIErrorType.ERROR)\n        ) {\n            return Promise.reject(new Error('One or more fields are invalid'))\n        }\n\n        return groupsClient.createGroup({\n            id: newOrg.id.value,\n            name: newOrg.name.value,\n            gravatarhash: newOrg.gravatarHash.value,\n            description: newOrg.description.value,\n            isPrivate: newOrg.isPrivate.value\n        })\n            .then((group) => {\n                return groupToOrganization(group, username)\n            })\n    }\n\n    async orgExists(id: string): Promise<boolean> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n        return groupsClient.groupExists(id)\n            .then(({ exists }) => {\n                return exists\n            })\n    }\n\n    async updateOrg(id: string, orgUpdate: OrganizationUpdate): Promise<void> {\n\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        // do record-level validation\n\n\n        return groupsClient.updateGroup(id, {\n            name: orgUpdate.name,\n            gravatarhash: orgUpdate.gravatarHash,\n            description: orgUpdate.description\n        })\n    }\n\n    validateOrgId(id: string): [string, UIError] {\n        return Validation.validateOrgId(id);\n    }\n\n    validateOrgName(name: string): [string, UIError] {\n        return Validation.validateOrgName(name)\n    }\n\n    validateOrgDescription(description: string): [string, UIError] {\n        return Validation.validateOrgDescription(description);\n    }\n\n    async removeNarrativeFromOrg(organizationId: OrganizationID, workspaceId: number): Promise<void> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        return groupsClient.deleteResource(\n            organizationId,\n            'workspace',\n            String(workspaceId)\n        )\n    }\n\n    async grantNarrativeAccess(groupId: string, resourceId: string): Promise<void> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        // TODO: yuck. need to \n        await groupsClient.grantResourceAccess(groupId, 'workspace', resourceId)\n        return\n    }\n\n    async requestMembershipToGroup(id: string): Promise<requestModel.Request> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        const request = await groupsClient.requestMembership({\n            groupId: id\n        })\n        return requestModel.groupRequestToOrgRequest(request)\n    }\n\n    async addOrRequestNarrativeToGroup(groupId: string, workspaceId: WorkspaceID): Promise<requestModel.Request | boolean> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        const request = await groupsClient.addOrRequestNarrative({\n            groupId: groupId,\n            workspaceId: workspaceId\n        })\n        if (request.complete === true) {\n            return true\n        } else {\n            return requestModel.groupRequestToOrgRequest(request)\n        }\n    }\n\n    memberToAdmin(groupId: string, member: string): Promise<void> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        return groupsClient.memberToAdmin({\n            groupId,\n            member\n        })\n    }\n\n    adminToMember(groupId: string, member: string): Promise<void> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        return groupsClient.adminToMember({\n            groupId,\n            member\n        })\n    }\n    removeMember(groupId: string, member: string): Promise<void> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        return groupsClient.removeMember({\n            groupId,\n            member\n        })\n    }\n\n}\n\n\n\nexport function userPermissionToWorkspacePermission(userPermission: string, isOwner: boolean) {\n    if (isOwner) {\n        return UserWorkspacePermission.OWNER\n    }\n    switch (userPermission) {\n        case 'r':\n            return UserWorkspacePermission.VIEW\n        case 'w':\n            return UserWorkspacePermission.EDIT\n        case 'a':\n            return UserWorkspacePermission.ADMIN\n        default:\n            throw new Error('Invalid workspace user permission: ' + userPermission)\n    }\n}","import { UIError, UIErrorType } from \"../../../types\";\n\nexport default class Validation {\n    static nonPrintableRe = /[\\000-\\031]/\n\n    static testNonPrintableCharacters(s: string) {\n        const firstNonPrintable = s.search(Validation.nonPrintableRe)\n        if (firstNonPrintable === -1) {\n            return false\n        }\n        const beforeStart = firstNonPrintable - 5 < 0 ? 0 : firstNonPrintable - 5\n        const before = s.slice(beforeStart, firstNonPrintable)\n        const after = s.slice(firstNonPrintable + 1, firstNonPrintable + 6)\n        return `Non-printable character at position ${firstNonPrintable}: \"${before}___${after}`\n    }\n    static validateOrgId(id: string): [string, UIError] {\n        // May not be empty\n        if (id.length === 0) {\n            return [\n                id, {\n                    type: UIErrorType.ERROR,\n                    message: 'Organization id may not be empty'\n                }]\n        }\n        // No spaces\n        if (id.match(/\\s/)) {\n            return [\n                id, {\n                    type: UIErrorType.ERROR,\n                    message: 'Organization id may not contain a space'\n                }]\n        }\n        // May not exceed maximum size\n        // todo: what is the real limit?\n        if (id.length > 100) {\n            return [\n                id, {\n                    type: UIErrorType.ERROR,\n                    message: 'Organization id may not be longer than 100 characters'\n                }]\n        }\n\n        // May not contain non-alphanumeric and underscore\n        const alphaRe = /^[a-zA-Z0-9_]+$/\n        if (!id.match(alphaRe)) {\n            return [\n                id, {\n                    type: UIErrorType.ERROR,\n                    message: 'Organization id may only contain alphanumeric (a-z, A-Z, 0-9) and underscore (_)'\n                }\n            ]\n        }\n\n        return [id, {\n            type: UIErrorType.NONE\n        }]\n    }\n\n    static validateOrgName(name: string): [string, UIError] {\n        if (name.length === 0) {\n            return [\n                name, {\n                    type: UIErrorType.ERROR,\n                    message: 'Organization name may not be empty'\n                }]\n        }\n        if (name.length > 256) {\n            return [\n                name, {\n                    type: UIErrorType.ERROR,\n                    message: 'Organization name may not be longer than 256 characters'\n                }]\n        }\n        return [\n            name, {\n                type: UIErrorType.NONE\n            }]\n    }\n\n    static validateOrgGravatarHash(gravatarHash: string): [string, UIError] {\n        if (gravatarHash.length === 0) {\n            return [\n                gravatarHash, {\n                    type: UIErrorType.NONE\n                }]\n        }\n        if (gravatarHash.length > 32) {\n            return [\n                gravatarHash, {\n                    type: UIErrorType.ERROR,\n                    message: 'Organization gravatar hash may not be longer than 32 characters'\n                }]\n        }\n        return [\n            gravatarHash, {\n                type: UIErrorType.NONE\n            }]\n    }\n\n    static validateOrgDescription(description: string): [string, UIError] {\n        if (description.length === 0) {\n            return [name, {\n                type: UIErrorType.NONE\n            }]\n            // return [name, {\n            //     type: UIErrorType.ERROR,\n            //     message: 'Organization description may not be empty'\n            // }]\n        }\n        // TODO: Is there really a limit?\n        // const nonPrintable = Validation.testNonPrintableCharacters(description)\n        // if (nonPrintable) {\n        //     return [\n        //         description, {\n        //             type: UIErrorType.ERROR,\n        //             message: nonPrintable\n        //         }\n        //     ]\n        // }\n        if (description.length > 4096) {\n            return [\n                description, {\n                    type: UIErrorType.ERROR,\n                    message: 'Organization description may not be longer than 4,096 characters'\n                }]\n        }\n        return [\n            description, {\n                type: UIErrorType.NONE\n            }\n        ]\n    }\n}","import { Action } from 'redux'\nimport * as actions from '../actions/inviteUser'\nimport * as types from '../../types'\nimport { ActionFlag } from '../actions'\nimport * as orgModel from '../../data/models/organization/model'\n\nexport function loadStart(state: types.StoreState, action: actions.LoadStart): types.StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            inviteUserView: {\n                ...state.views.inviteUserView,\n                loadingState: types.ComponentLoadingState.LOADING\n            }\n        }\n    }\n}\n\nexport function loadSuccess(state: types.StoreState, action: actions.LoadSuccess): types.StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            inviteUserView: {\n                ...state.views.inviteUserView,\n                loadingState: types.ComponentLoadingState.SUCCESS,\n                error: null,\n                viewModel: {\n                    editState: types.InviteUserViewState.EDITING,\n                    users: action.users,\n                    organization: action.organization,\n                    selectedUser: null\n                }\n            }\n        }\n    }\n}\n\nexport function loadError(state: types.StoreState, action: actions.LoadError): types.StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            inviteUserView: {\n                ...state.views.inviteUserView,\n                loadingState: types.ComponentLoadingState.SUCCESS,\n                error: action.error,\n                viewModel: null\n            }\n        }\n    }\n}\n\nexport function unload(state: types.StoreState, action: actions.Unload): types.StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            inviteUserView: {\n                ...state.views.inviteUserView,\n                loadingState: types.ComponentLoadingState.NONE,\n                error: null,\n                viewModel: null\n            }\n        }\n    }\n}\n\nexport function searchUsersSuccess(state: types.StoreState, action: actions.SearchUsersSuccess): types.StoreState {\n    if (state.views.inviteUserView.viewModel === null) {\n        throw new Error('view value is null')\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            inviteUserView: {\n                ...state.views.inviteUserView,\n                viewModel: {\n                    ...state.views.inviteUserView.viewModel,\n                    users: action.users\n                }\n            }\n        }\n    }\n}\n\nexport function selectUserSuccess(state: types.StoreState, action: actions.SelectUserSuccess): types.StoreState {\n    if (state.views.inviteUserView.viewModel === null) {\n        throw new Error('view value is null')\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            inviteUserView: {\n                ...state.views.inviteUserView,\n                viewModel: {\n                    ...state.views.inviteUserView.viewModel,\n                    selectedUser: {\n                        user: action.user,\n                        relation: action.relation\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function sendInvitationStart(state: types.StoreState, action: actions.SendInvitationStart): types.StoreState {\n    if (state.views.inviteUserView.viewModel === null) {\n        throw new Error('view value is null')\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            inviteUserView: {\n                ...state.views.inviteUserView,\n                viewModel: {\n                    ...state.views.inviteUserView.viewModel,\n                    editState: types.InviteUserViewState.SENDING\n                }\n            }\n        }\n    }\n}\n\nexport function sendInvitationSuccess(state: types.StoreState, action: actions.SendInvitationSuccess): types.StoreState {\n    if (state.views.inviteUserView.viewModel === null) {\n        throw new Error('view value is null')\n    }\n\n    const { views: { inviteUserView: { viewModel: { selectedUser, users } } } } = state\n\n    // const selectedUser = state.inviteUserView.value.selectedUser\n    if (!selectedUser) {\n        throw new Error('selected user is null')\n    }\n    selectedUser.relation = orgModel.UserRelationToOrganization.MEMBER_INVITATION_PENDING\n\n    if (!users) {\n        throw new Error('users is null')\n    }\n    const newUsers = users.map((user) => {\n        if (user.username === selectedUser.user.username) {\n            user.relation = orgModel.UserRelationToOrganization.MEMBER_INVITATION_PENDING\n        }\n        return user\n    })\n\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            inviteUserView: {\n                ...state.views.inviteUserView,\n                viewModel: {\n                    ...state.views.inviteUserView.viewModel,\n                    editState: types.InviteUserViewState.SUCCESS,\n                    selectedUser: selectedUser,\n                    users: newUsers\n                }\n            }\n        }\n    }\n}\n\nexport function sendInvitationError(state: types.StoreState, action: actions.SendInvitationError): types.StoreState {\n    if (state.views.inviteUserView.viewModel === null) {\n        throw new Error('view value is null')\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            inviteUserView: {\n                ...state.views.inviteUserView,\n                viewModel: {\n                    ...state.views.inviteUserView.viewModel,\n                    editState: types.InviteUserViewState.ERROR\n                }\n            }\n        }\n    }\n}\n\n\nfunction reducer(state: types.StoreState, action: Action): types.StoreState | null {\n    switch (action.type) {\n        case ActionFlag.INVITE_USER_LOAD_START:\n            return loadStart(state, action as actions.LoadStart)\n        case ActionFlag.INVITE_USER_LOAD_SUCCESS:\n            return loadSuccess(state, action as actions.LoadSuccess)\n        case ActionFlag.INVITE_USER_LOAD_ERROR:\n            return loadError(state, action as actions.LoadError)\n        case ActionFlag.INVITE_USER_UNLOAD:\n            return unload(state, action as actions.Unload)\n        case ActionFlag.INVITE_USER_SEARCH_USERS_SUCCESS:\n            return searchUsersSuccess(state, action as actions.SearchUsersSuccess)\n        case ActionFlag.INVITE_USER_SELECT_USER_SUCCESS:\n            return selectUserSuccess(state, action as actions.SelectUserSuccess)\n        case ActionFlag.INVITE_USER_SEND_INVITATION_START:\n            return sendInvitationStart(state, action as actions.SendInvitationStart)\n        case ActionFlag.INVITE_USER_SEND_INVITATION_SUCCESS:\n            return sendInvitationSuccess(state, action as actions.SendInvitationSuccess)\n        case ActionFlag.INVITE_USER_SEND_INVITATION_ERROR:\n            return sendInvitationError(state, action as actions.SendInvitationError)\n        default:\n            return null\n    }\n}\n\nexport default reducer","import { Action } from 'redux'\nimport * as actions from '../actions/manageMembership'\nimport * as types from '../../types'\nimport { ActionFlag } from '../actions'\n\nexport function loadStart(state: types.StoreState, action: actions.LoadStart): types.StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            manageMembershipView: {\n                loadingState: types.ComponentLoadingState.LOADING,\n                error: null,\n                viewModel: null\n            }\n        }\n    }\n}\n\nexport function loadSuccess(state: types.StoreState, action: actions.LoadSuccess): types.StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            manageMembershipView: {\n                loadingState: types.ComponentLoadingState.SUCCESS,\n                error: null,\n                viewModel: {\n                    organization: action.organization\n                }\n            }\n        }\n    }\n}\n\nexport function loadError(state: types.StoreState, action: actions.LoadError): types.StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            manageMembershipView: {\n                loadingState: types.ComponentLoadingState.LOADING,\n                error: action.error,\n                viewModel: null\n            }\n        }\n    }\n}\n\nexport function unload(state: types.StoreState, action: actions.Unload): types.StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            manageMembershipView: {\n                loadingState: types.ComponentLoadingState.NONE,\n                error: null,\n                viewModel: null\n            }\n        }\n    }\n}\n\nfunction reducer(state: types.StoreState, action: Action): types.StoreState | null {\n    switch (action.type) {\n        case ActionFlag.MANAGE_MEMBERSHIP_LOAD_START:\n            return loadStart(state, action as actions.LoadStart)\n        case ActionFlag.MANAGE_MEMBERSHIP_LOAD_SUCCESS:\n            return loadSuccess(state, action as actions.LoadSuccess)\n        case ActionFlag.MANAGE_MEMBERSHIP_LOAD_ERROR:\n            return loadError(state, action as actions.LoadError)\n        case ActionFlag.MANAGE_MEMBERSHIP_UNLOAD:\n            return unload(state, action as actions.Unload)\n        default:\n            return null\n    }\n}\n\nexport default reducer","import { Action } from 'redux'\nimport * as actions from '../actions/requestAddNarrative'\nimport * as types from '../../types'\nimport { ActionFlag } from '../actions'\nimport { OrganizationModel } from '../../data/models/organization/model';\n\nexport function loadStart(state: types.StoreState, action: actions.LoadStart): types.StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n\n            requestNarrativeView: {\n                ...state.views.requestNarrativeView,\n                loadingState: types.ComponentLoadingState.LOADING,\n                error: null,\n                viewModel: null\n            }\n        }\n    }\n}\n\nexport function loadSuccess(state: types.StoreState, action: actions.LoadSuccess): types.StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            requestNarrativeView: {\n                ...state.views.requestNarrativeView,\n                loadingState: types.ComponentLoadingState.SUCCESS,\n                error: null,\n                viewModel: {\n                    organization: action.organization,\n                    narratives: action.narratives,\n                    selectedNarrative: null,\n                    relation: action.relation,\n                    error: null,\n                    saveState: types.SaveState.SAVED\n                }\n            }\n        }\n    }\n}\n\nexport function loadError(state: types.StoreState, action: actions.LoadError): types.StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            requestNarrativeView: {\n                ...state.views.requestNarrativeView,\n                loadingState: types.ComponentLoadingState.ERROR,\n                error: action.error,\n                viewModel: null\n            }\n        }\n    }\n}\n\nexport function sendRequestStart(state: types.StoreState, action: actions.SendRequestStart): types.StoreState {\n\n    if (!state.views.requestNarrativeView.viewModel) {\n        throw new Error('view model missing')\n    }\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            requestNarrativeView: {\n                ...state.views.requestNarrativeView,\n                viewModel: {\n                    ...state.views.requestNarrativeView.viewModel,\n                    saveState: types.SaveState.SAVING\n                }\n            }\n        }\n    }\n}\n\nexport function sendRequestSuccess(state: types.StoreState, action: actions.SendRequestSuccess): types.StoreState {\n\n    if (!state.views.requestNarrativeView.viewModel) {\n        throw new Error('view model missing')\n    }\n\n    const newState: types.StoreState = {\n        ...state,\n        views: {\n            ...state.views,\n            requestNarrativeView: {\n                ...state.views.requestNarrativeView,\n                viewModel: {\n                    ...state.views.requestNarrativeView.viewModel,\n                    saveState: types.SaveState.SAVED\n                }\n            }\n        }\n    }\n\n    const viewModel = newState.views.requestNarrativeView.viewModel\n\n    if (!viewModel) {\n        throw new Error('view model missing')\n    }\n\n    const selectedNarrative = viewModel.selectedNarrative\n\n    // If the request is by an admin, it will be returned as true, not the request\n    // (the api returns {complete: true})\n    if (action.request === true) {\n        viewModel.narratives = viewModel.narratives.map((narrative) => {\n            if (narrative.workspaceId === selectedNarrative!.workspaceId) {\n                narrative.status = types.NarrativeState.ASSOCIATED\n            }\n            return narrative\n        })\n    } else {\n        viewModel.narratives = viewModel.narratives.map((narrative) => {\n            if (narrative.workspaceId === selectedNarrative!.workspaceId) {\n                narrative.status = types.NarrativeState.REQUESTED\n            }\n            return narrative\n        })\n    }\n\n    return newState\n}\n\nexport function sendRequestError(state: types.StoreState, action: actions.SendRequestError): types.StoreState {\n\n    if (!state.views.requestNarrativeView.viewModel) {\n        throw new Error('view model missing')\n    }\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            requestNarrativeView: {\n                ...state.views.requestNarrativeView,\n                viewModel: {\n                    ...state.views.requestNarrativeView.viewModel,\n                    saveState: types.SaveState.SAVE_ERROR,\n                    error: action.error\n                }\n            }\n        }\n    }\n}\n\nexport function selectNarrativeSuccess(state: types.StoreState, action: actions.SelectNarrativeSuccess): types.StoreState {\n    if (!state.views.requestNarrativeView.viewModel) {\n        throw new Error('view model missing')\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            requestNarrativeView: {\n                ...state.views.requestNarrativeView,\n                // TODO: a selected state?\n                error: null,\n                viewModel: {\n                    ...state.views.requestNarrativeView.viewModel,\n                    selectedNarrative: action.narrative\n                }\n            }\n        }\n    }\n}\n\nexport function unload(state: types.StoreState, action: actions.Unload): types.StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            requestNarrativeView: {\n                loadingState: types.ComponentLoadingState.NONE,\n                error: null,\n                viewModel: null\n            }\n        }\n    }\n}\n\nfunction reducer(state: types.StoreState, action: Action): types.StoreState | null {\n    switch (action.type) {\n        case ActionFlag.REQUEST_ADD_NARRATIVE_LOAD_START:\n            return loadStart(state, action as actions.LoadStart)\n        case ActionFlag.REQUEST_ADD_NARRATIVE_LOAD_SUCCESS:\n            return loadSuccess(state, action as actions.LoadSuccess)\n        case ActionFlag.REQUEST_ADD_NARRATIVE_LOAD_ERROR:\n            return loadError(state, action as actions.LoadError)\n        case ActionFlag.REQUEST_ADD_NARRATIVE_SEND_START:\n            return sendRequestStart(state, action as actions.SendRequestStart)\n        case ActionFlag.REQUEST_ADD_NARRATIVE_SEND_SUCCESS:\n            return sendRequestSuccess(state, action as actions.SendRequestSuccess)\n        case ActionFlag.REQUEST_ADD_NARRATIVE_LOAD_ERROR:\n            return sendRequestStart(state, action as actions.SendRequestStart)\n        case ActionFlag.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_SUCCESS:\n            return selectNarrativeSuccess(state, action as actions.SelectNarrativeSuccess)\n        case ActionFlag.REQUEST_ADD_NARRATIVE_UNLOAD:\n            return unload(state, action as actions.Unload)\n        default:\n            return null\n    }\n}\n\nexport default reducer","import { Action } from 'redux'\n\nimport { ActionFlag } from '../actions'\n\nimport { LoadStart, LoadSuccess, LoadError, DashboardAction, Unload } from '../actions/dashboard'\nimport { StoreState, ComponentLoadingState } from '../../types';\n\nfunction loadStart(state: StoreState, action: LoadStart): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            dashboardView: {\n                loadingState: ComponentLoadingState.LOADING,\n                error: null,\n                viewModel: null\n            }\n        }\n    }\n}\n\nfunction loadSuccess(state: StoreState, action: LoadSuccess): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            dashboardView: {\n                loadingState: ComponentLoadingState.SUCCESS,\n                error: null,\n                viewModel: {\n                    organizations: action.organizations,\n                    // users: action.users,\n                    notifications: [],\n                    pendingRequests: action.requests,\n                    pendingInvitations: action.invitations,\n                    pendingAdminRequests: action.pendingGroupRequests\n                }\n            }\n        }\n    }\n}\n\nfunction loadError(state: StoreState, action: LoadError): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            dashboardView: {\n                loadingState: ComponentLoadingState.ERROR,\n                error: action.error,\n                viewModel: null\n            }\n        }\n    }\n}\n\nfunction unload(state: StoreState, action: Unload): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            dashboardView: {\n                loadingState: ComponentLoadingState.NONE,\n                error: null,\n                viewModel: null\n            }\n        }\n    }\n}\n\nexport default function reducer(state: StoreState, action: DashboardAction): StoreState | null {\n    switch (action.type) {\n        case ActionFlag.DASHBOARD_LOAD_START:\n            return loadStart(state, action as LoadStart)\n        case ActionFlag.DASHBOARD_LOAD_SUCCESS:\n            return loadSuccess(state, action as LoadSuccess)\n        case ActionFlag.DASHBOARD_LOAD_ERROR:\n            return loadError(state, action as LoadError)\n        case ActionFlag.DASHBOARD_UNLOAD:\n            return unload(state, action as Unload)\n        default:\n            return null\n    }\n}","\nimport * as actions from '../actions/entities'\nimport { StoreState } from '../../types';\nimport { ActionFlag } from '../actions';\n\nfunction userLoaderSuccess(state: StoreState, action: actions.UserLoaderSuccess) {\n    const users = state.entities.users\n    // mutation ... horrible ;)\n    users.byId.set(action.user.username, action.user)\n    // return state\n\n    return {\n        ...state,\n        entities: {\n            ...state.entities,\n            users: {\n                ...state.entities.users,\n                byId: new Map(users.byId)\n            }\n        }\n    }\n}\n\nfunction organizationLoaderSuccess(state: StoreState, action: actions.OrganizationLoaderSuccess) {\n    const orgsMap = state.entities.orgs.byId\n    orgsMap.set(action.organization.id, action.organization)\n\n    return {\n        ...state,\n        entities: {\n            ...state.entities,\n            orgs: {\n                ...state.entities.orgs,\n                byId: new Map(orgsMap)\n            }\n        }\n    }\n}\n\nfunction loadNarrativeSuccess(state: StoreState, action: actions.LoadNarrativeSuccess) {\n    const narratives = state.entities.narratives\n    narratives.byId.set(action.narrative.workspaceId, action.narrative)\n\n    return {\n        ...state,\n        entities: {\n            ...state.entities,\n            narratives: {\n                byId: new Map(narratives.byId)\n            }\n        }\n    }\n}\n\n// TODO: start and error\n\nfunction reducer(state: StoreState, action: actions.EntityAction): StoreState | null {\n    switch (action.type) {\n        case ActionFlag.ENTITY_USER_LOADER_SUCCESS:\n            return userLoaderSuccess(state, action as actions.UserLoaderSuccess)\n        case ActionFlag.ENTITY_ORGANIZATION_LOADER_SUCCESS:\n            return organizationLoaderSuccess(state, action as actions.OrganizationLoaderSuccess)\n        case ActionFlag.ENTITY_NARRATIVE_LOAD_SUCCESS:\n            return loadNarrativeSuccess(state, action as actions.LoadNarrativeSuccess)\n        default:\n            return null\n    }\n}\n\nexport default reducer","import { Action } from 'redux'\nimport * as actions from '../actions/organizationCentric'\nimport { StoreState, ComponentLoadingState } from '../../types'\nimport { ActionFlag } from '../actions'\n\nexport function loadStart(state: StoreState, action: actions.LoadStart): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            organizationCentricView: {\n                loadingState: ComponentLoadingState.LOADING,\n                error: null,\n                viewModel: null\n            }\n        }\n    }\n}\n\nexport function loadError(state: StoreState, action: actions.LoadError): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            organizationCentricView: {\n                ...state.views.organizationCentricView,\n                loadingState: ComponentLoadingState.ERROR,\n                error: action.error,\n                viewModel: null\n            }\n        }\n    }\n}\n\nexport function loadSuccess(state: StoreState, action: actions.LoadSuccess): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            organizationCentricView: {\n                ...state.views.organizationCentricView,\n                loadingState: ComponentLoadingState.SUCCESS,\n                error: null,\n                viewModel: {\n                    organization: action.organization,\n                    pendingJoinRequest: action.pendingJoinRequest,\n                    pendingJoinInvitation: action.pendingJoinInvitation,\n                    relation: action.relation\n                }\n            }\n        }\n    }\n}\n\nexport function unload(state: StoreState, action: actions.Unload): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            organizationCentricView: {\n                loadingState: ComponentLoadingState.NONE,\n                error: null,\n                viewModel: null\n            }\n        }\n    }\n}\n\nfunction reducer(state: StoreState, action: Action): StoreState | null {\n    switch (action.type) {\n        case ActionFlag.ORGANIZATION_CENTRIC_VIEW_LOAD_START:\n            return loadStart(state, action as actions.LoadStart)\n        case ActionFlag.ORGANIZATION_CENTRIC_VIEW_LOAD_SUCCESS:\n            return loadSuccess(state, action as actions.LoadSuccess)\n        case ActionFlag.ORGANIZATION_CENTRIC_VIEW_LOAD_ERROR:\n            return loadError(state, action as actions.LoadError)\n        case ActionFlag.ORGANIZATION_CENTRIC_VIEW_UNLOAD:\n            return unload(state, action as actions.Unload)\n        default:\n            return null\n    }\n}\n\nexport default reducer","import * as actions from '../actions/global'\nimport { StoreState } from '../../types'\nimport { ActionFlag } from '../actions'\nimport { Action } from 'redux';\nimport { access } from 'fs';\n\nexport function accessNarrativeSuccess(state: StoreState, action: actions.AccessNarrativeSuccess): StoreState {\n    const narrativesById = state.entities.narratives.byId\n    narrativesById.set(action.narrative.workspaceId, action.narrative)\n\n    return {\n        ...state,\n        entities: {\n            ...state.entities,\n            narratives: {\n                ...state.entities.narratives,\n                byId: narrativesById\n            }\n        }\n    }\n}\n\nexport default function reducer(state: StoreState, action: Action): StoreState | null {\n    switch (action.type) {\n        case ActionFlag.GLOBAL_ACCESS_NARRATIVE_SUCCESS:\n            return accessNarrativeSuccess(state, action as actions.AccessNarrativeSuccess)\n        default:\n            return null\n    }\n}\n\n// function reducer(state: StoreState, action: actions.EntityAction): StoreState | null {\n//     switch (action.type) {\n//         case ActionFlag.ENTITY_USER_LOADER_SUCCESS:\n//             return userLoaderSuccess(state, action as actions.UserLoaderSuccess)\n//         case ActionFlag.ENTITY_ORGANIZATION_LOADER_SUCCESS:\n//             return organizationLoaderSuccess(state, action as actions.OrganizationLoaderSuccess)\n//         case ActionFlag.ENTITY_NARRATIVE_LOAD_SUCCESS:\n//             return loadNarrativeSuccess(state, action as actions.LoadNarrativeSuccess)\n//         default:\n//             return null\n//     }\n// }\n\n// export default reducer","import { Action } from 'redux'\nimport { StoreState } from '../../types'\nimport addOrgReducer from './addOrg'\nimport editOrgReducer from './editOrg'\nimport viewOrgReducer from './viewOrg'\nimport browseOrgsReducer from './browseOrgs'\nimport authReducer from './auth'\nimport appReducer from './app'\nimport manageOrganizatiopRequests from './manageOrganizationRequests'\nimport viewMembers from './viewMembers'\nimport inviteUser from './inviteUser'\nimport manageMembership from './manageMembership'\nimport requestAddNarrative from './requestAddNarrative'\nimport dashboard from './dashboard'\nimport entities from './entities'\nimport organizationCentric from './organizationCentric'\nimport global from './global'\n\n\nexport function reducer(state: StoreState, action: Action): StoreState {\n    return addOrgReducer(state, action) ||\n        editOrgReducer(state, action) ||\n        browseOrgsReducer(state, action) ||\n        viewOrgReducer(state, action) ||\n        authReducer(state, action) ||\n        appReducer(state, action) ||\n        manageOrganizatiopRequests(state, action) ||\n        viewMembers(state, action) ||\n        inviteUser(state, action) ||\n        manageMembership(state, action) ||\n        requestAddNarrative(state, action) ||\n        dashboard(state, action) ||\n        entities(state, action) ||\n        organizationCentric(state, action) ||\n        global(state, action) ||\n        state;\n}\n\nexport default reducer","import * as React from 'react'\nimport './Member.css'\n\nimport Avatar from './Avatar'\nimport { } from '../../types';\nimport { Icon } from 'antd';\nimport * as orgModel from '../../data/models/organization/model'\nimport * as userModel from '../../data/models/user'\nimport User from './UserContainer'\n\nenum View {\n    COMPACT = 0,\n    NORMAL\n}\n\nexport interface MemberProps {\n    member: orgModel.Member\n    user: userModel.User\n    avatarSize?: number\n}\n\ninterface MemberState {\n    view: View\n}\n\nfunction reverseView(v: View) {\n    switch (v) {\n        case View.COMPACT:\n            return View.NORMAL\n        case View.NORMAL:\n            return View.COMPACT\n    }\n}\n\nclass Member extends React.Component<MemberProps, MemberState> {\n    constructor(props: MemberProps) {\n        super(props)\n\n        this.state = {\n            view: View.COMPACT\n        }\n    }\n\n    onToggleView() {\n        this.setState({\n            view: reverseView(this.state.view)\n        })\n    }\n\n    renderRole() {\n        switch (this.props.member.type) {\n            case orgModel.MemberType.OWNER:\n                return (\n                    <span>\n                        <Icon type=\"crown\" /> owner\n                </span>\n                )\n            case orgModel.MemberType.ADMIN:\n                return (\n                    <span>\n                        <Icon type=\"unlock\" /> admin\n                </span>\n                )\n            case orgModel.MemberType.MEMBER:\n                return (\n                    <span>\n                        <Icon type=\"user\" /> member\n                </span>\n                )\n        }\n    }\n\n    renderCompact() {\n        return (\n            <div className=\"Member View-COMPACT\" >\n                <div className=\"avatarCol\">\n                    <Avatar user={this.props.user} size={this.props.avatarSize || 30} />\n                </div>\n                <div className=\"infoCol\">\n                    <div className=\"name\">\n                        <a href={\"#people/\" + this.props.member.username} target=\"_blank\">{this.props.user.realname}</a>\n                        {' '}\n                        {this.props.user.username}\n                    </div>\n                    <div className=\"role\">\n                        {this.renderRole()}\n                    </div>\n                    <div className=\"joinedAt\">\n                        <span className=\"field-label\">joined</span>{' '}{Intl.DateTimeFormat('en-US', {\n                            month: 'short',\n                            day: 'numeric',\n                            year: 'numeric'\n                        }).format(this.props.member.joinedAt)}\n                    </div>\n                </div>\n                <div className=\"controlCol\">\n                    <a onClick={this.onToggleView.bind(this)}\n                        className={`linkButton ${this.state.view === View.NORMAL ? \"pressed\" : \"\"}`}\n                    >\n                        <Icon type={`${this.state.view === View.NORMAL ? \"up\" : \"down\"}`} />\n                    </a>\n                </div>\n            </div>\n        )\n    }\n\n    renderNormal() {\n        return (\n            <div className=\"Member View-NORMAL\" >\n                <div className=\"avatarCol\">\n                    <Avatar user={this.props.user} size={this.props.avatarSize || 30} />\n                </div>\n                <div className=\"infoCol\">\n                    <div className=\"name\">\n                        <a href={\"#people/\" + this.props.member.username} target=\"_blank\">{this.props.user.realname}</a>\n                        {' '}\n                        {this.props.user.username}\n                    </div>\n                    <div className=\"role\">\n                        {this.renderRole()}\n                    </div>\n                    <div className=\"joinedAt\">\n                        <span className=\"field-label\">joined</span>{' '}{Intl.DateTimeFormat('en-US', {\n                            month: 'short',\n                            day: 'numeric',\n                            year: 'numeric'\n                        }).format(this.props.member.joinedAt)}\n                    </div>\n                    <div className=\"title\">\n                        {this.props.user.title || <i>no title in user profile</i>}\n                    </div>\n                    <div className=\"organization\">\n                        {this.props.user.organization || <i>no organization in user profile</i>}\n                    </div>\n                    <div className=\"location\">\n                        {[this.props.user.city, this.props.user.state, this.props.user.country].filter(x => x).join(', ') || <i>no location information in user profile</i>}\n                    </div>\n                </div>\n                <div className=\"controlCol\">\n                    <a onClick={this.onToggleView.bind(this)}\n                        className={`linkButton ${this.state.view === View.NORMAL ? \"pressed\" : \"\"}`}\n                    >\n                        <Icon type={`${this.state.view === View.NORMAL ? \"up\" : \"down\"}`} />\n                    </a>\n                </div>\n            </div>\n        )\n    }\n\n    render() {\n        switch (this.state.view) {\n            case View.COMPACT:\n                return this.renderCompact()\n\n            case View.NORMAL:\n                return this.renderNormal()\n        }\n    }\n\n    // render() {\n    //     return (\n    //         <div className=\"Member\" >\n    //             <div className=\"role\">\n    //                 {this.renderRole()}\n    //             </div>\n\n    //             <User userId={this.props.member.username} avatarSize={this.props.avatarSize || 30} />\n\n    //             {/* <div className=\"avatarCol\">\n    //                 <Avatar user={this.props.user} size={this.props.avatarSize || 30} />\n    //             </div>\n    //             <div className=\"infoCol\">\n    //                 <div className=\"name\">\n    //                     <a href={\"#people/\" + this.props.member.username} target=\"_blank\">{this.props.user.realname}</a>\n    //                     {' '}\n    //                     {this.props.user.username}\n    //                 </div>\n\n    //                 <div className=\"title\">\n    //                     {this.props.user.title || <i>no title in user profile</i>}\n    //                 </div>\n    //                 <div className=\"organization\">\n    //                     {this.props.user.organization || <i>no organization in user profile</i>}\n    //                 </div>\n    //                 <div className=\"location\">\n    //                     {[this.props.user.city, this.props.user.state, this.props.user.country].filter(x => x).join(', ') || <i>no location information in user profile</i>}\n    //                 </div>\n    //             </div> */}\n    //         </div>\n    //     )\n    // }\n}\n\nexport default Member","import * as React from 'react'\nimport './Avatar.css'\n\nimport { User } from '../../types'\n\nexport interface AvatarProps {\n    user: User,\n    size: number\n}\n\ninterface AvatarState {\n\n}\n\nexport class Avatar extends React.Component<AvatarProps, AvatarState> {\n    constructor(props: AvatarProps) {\n        super(props)\n    }\n\n    getAvatarUrl(user: User) {\n        switch (user.avatarOption || 'gravatar') {\n            case 'gravatar':\n                const gravatarDefault = user.gravatarDefault || 'identicon';\n                const gravatarHash = user.gravatarHash;\n                if (gravatarHash) {\n                    return 'https://www.gravatar.com/avatar/' + gravatarHash + '?s=60&amp;r=pg&d=' + gravatarDefault;\n                } else {\n                    return './nouserpic.png';\n                }\n            case 'silhouette':\n            case 'mysteryman':\n            default:\n                return './nouserpic.png';\n        }\n    }\n\n    render() {\n        const avatarUrl = this.getAvatarUrl(this.props.user)\n        return (\n            <img\n                src={avatarUrl}\n                style={{ width: this.props.size }}\n            />\n        )\n    }\n\n}\n\nexport default Avatar","export interface User {\n    username: string,\n    realname: string,\n    thumbnail: string\n}\n\nexport interface UserProfile {\n    user: User,\n    profile: {\n        synced: {\n            gravatarHash: string\n        },\n        userdata: {\n            jobTitle: string,\n            jobTitleOther: string,\n            organization: string\n            city: string\n            state: string\n            country: string\n            avatarOption: string\n            gravatarDefault: string\n        }\n    }\n}\n\nexport interface JSONPayload {\n    version: string,\n    method: string,\n    id: string,\n    params: any\n}\n\nexport class UserProfileClient {\n    url: string;\n    token: string\n\n    static profileCache: Map<string, UserProfile> = new Map()\n\n    constructor({ url, token }: { url: string, token: string }) {\n        this.url = url\n        this.token = token\n    }\n\n    makePayload(method: string, param: any): JSONPayload {\n        return {\n            version: '1.1',\n            method: 'UserProfile.' + method,\n            id: String(Math.random()).slice(2),\n            params: [param]\n        }\n    }\n\n    makeEmptyPayload(method: string): JSONPayload {\n        return {\n            version: '1.1',\n            method: 'UserProfile.' + method,\n            id: String(Math.random()).slice(2),\n            params: []\n        }\n    }\n\n    getVersion(): Promise<any> {\n        return fetch(this.url, {\n            method: 'POST',\n            mode: 'cors',\n            cache: 'no-store',\n            headers: {\n                Authorization: this.token,\n                'Content-Type': 'application/json',\n                Accept: 'application/json'\n            },\n            body: JSON.stringify(this.makeEmptyPayload('version'))\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error('User profile request error: ' + response.status + ', ' + response.statusText)\n                }\n                return response.json()\n            })\n    }\n\n    async getUserProfile(username: string): Promise<UserProfile> {\n\n        if (UserProfileClient.profileCache.has(username)) {\n            return Promise.resolve(UserProfileClient.profileCache.get(username)!)\n        }\n\n        return fetch(this.url, {\n            method: 'POST',\n            mode: 'cors',\n            cache: 'no-store',\n            headers: {\n                Authorization: this.token,\n                'Content-Type': 'application/json',\n                Accept: 'application/json'\n            },\n            body: JSON.stringify(this.makePayload('get_user_profile', [username]))\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error('User profile request error: ' + response.status + ', ' + response.statusText)\n                }\n                return response.json()\n            })\n            .then((result) => {\n                return result.result[0][0] as UserProfile\n            })\n    }\n\n    getUserProfiles(usernames: Array<string>): Promise<Array<UserProfile>> {\n\n        return fetch(this.url, {\n            method: 'POST',\n            mode: 'cors',\n            cache: 'no-store',\n            headers: {\n                Authorization: this.token,\n                'Content-Type': 'application/json',\n                Accept: 'application/json'\n            },\n            body: JSON.stringify(this.makePayload('get_user_profile', usernames))\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error('User profile request error: ' + response.status + ', ' + response.statusText)\n                }\n                return response.json()\n            })\n            .then((result) => {\n                return result.result[0] as Array<UserProfile>\n            })\n    }\n\n    getAllUsers(): Promise<Array<User>> {\n        return fetch(this.url, {\n            method: 'POST',\n            mode: 'cors',\n            cache: 'no-store',\n            headers: {\n                Authorization: this.token,\n                'Content-Type': 'application/json',\n                Accept: 'application/json'\n            },\n            body: JSON.stringify(this.makePayload('filter_users', { filter: '' }))\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error('User profile request error: ' + response.status + ', ' + response.statusText)\n                }\n                return response.json()\n            })\n            .then((result) => {\n                return result.result[0] as Array<User>\n            })\n    }\n\n    searchUsers(query: string): Promise<Array<User>> {\n        return fetch(this.url, {\n            method: 'POST',\n            mode: 'cors',\n            cache: 'no-store',\n            headers: {\n                Authorization: this.token,\n                'Content-Type': 'application/json',\n                Accept: 'application/json'\n            },\n            body: JSON.stringify(this.makePayload('filter_users', { filter: query }))\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error('User profile request error: ' + response.status + ', ' + response.statusText)\n                }\n                return response.json()\n            })\n            .then((result) => {\n                return result.result[0] as Array<User>\n            })\n    }\n}","import { UserProfileClient, UserProfile } from '../apis/userProfile'\n\n\nexport type Username = string\n\nexport interface User {\n    username: string\n    realname: string\n    title: string | null\n    organization: string | null\n    city: string | null\n    state: string | null\n    country: string | null\n    avatarOption: string | null\n    gravatarHash: string | null\n    gravatarDefault: string | null\n}\n\n\nfunction profileToUser(profile: UserProfile): User {\n    let jobTitle\n    if (!profile.profile.userdata) {\n        return {\n            username: profile.user.username,\n            realname: profile.user.realname,\n            city: null,\n            state: null,\n            country: null,\n            title: null,\n            organization: null,\n            avatarOption: null,\n            gravatarHash: null,\n            gravatarDefault: null\n        }\n    }\n    if (profile.profile.userdata.jobTitle === 'Other') {\n        jobTitle = profile.profile.userdata.jobTitleOther\n    } else {\n        jobTitle = profile.profile.userdata.jobTitle\n    }\n\n    return {\n        username: profile.user.username,\n        realname: profile.user.realname,\n        city: profile.profile.userdata.city,\n        state: profile.profile.userdata.state,\n        country: profile.profile.userdata.country,\n        title: jobTitle,\n        organization: profile.profile.userdata.organization,\n        avatarOption: profile.profile.userdata.avatarOption,\n        gravatarHash: profile.profile.synced.gravatarHash,\n        gravatarDefault: profile.profile.userdata.gravatarDefault\n    }\n}\n\nexport interface UserQuery {\n    query: string\n    excludedUsers: Array<string>\n}\n\nexport interface BriefUser {\n    username: string\n    realname: string\n}\n\n\n\n\ninterface UserModelParams {\n    userProfileServiceURL: string\n    token: string\n}\n\nexport class UserModel {\n\n    params: UserModelParams\n    userProfileClient: UserProfileClient\n\n    cache: Map<Username, User>\n\n    constructor(params: UserModelParams) {\n        this.params = params\n        this.userProfileClient = new UserProfileClient({\n            url: this.params.userProfileServiceURL,\n            token: this.params.token\n        })\n        this.cache = new Map<Username, User>()\n    }\n\n    async getUser(username: Username): Promise<User> {\n        if (this.cache.has(username)) {\n            return this.cache.get(username)!\n        }\n\n        const userProfile = await this.userProfileClient.getUserProfile(username)\n        const user = profileToUser(userProfile)\n        this.cache.set(username, user)\n        return user\n    }\n\n    async getUsers(usernames: Array<Username>): Promise<Map<Username, User>> {\n        const result: Map<Username, User> = new Map()\n\n        const toFetch: Array<Username> = []\n\n        usernames.forEach((username) => {\n            if (this.cache.has(username)) {\n                result.set(username, this.cache.get(username)!)\n            } else {\n                toFetch.push(username)\n            }\n        })\n\n        const userProfiles = await this.userProfileClient.getUserProfiles(toFetch)\n        const users = userProfiles.map((profile) => {\n            return profileToUser(profile)\n        })\n\n        userProfiles.forEach((userProfile) => {\n            const user = profileToUser(userProfile)\n            this.cache.set(user.username, user)\n            result.set(user.username, user)\n        })\n\n        return result\n    }\n\n    async searchUsers(query: UserQuery): Promise<Array<BriefUser>> {\n        const users = await this.userProfileClient.searchUsers(query.query)\n        return users\n            .filter(({ username }) => {\n                return (query.excludedUsers.indexOf(username) === -1)\n            })\n            .map(({ username, realname }) => {\n                return {\n                    username, realname\n                }\n            })\n    }\n\n    // searchUsers(query: UserQuery): Promise<Array<BriefUser>> {\n    //     const userProfileClient = new userProfile.UserProfileClient({\n    //         url: this.params.userProfileServiceURL,\n    //         token: this.params.token\n    //     })\n\n    //     return userProfileClient.searchUsers(query.query)\n    //         .then((users) => {\n    //             return users\n    //                 .filter(({ username }) => {\n    //                     return (query.excludedUsers.indexOf(username) === -1)\n    //                 })\n    //                 .map(({ username, realname }) => {\n    //                     return {\n    //                         username, realname\n    //                     }\n    //                 })\n\n    //         })\n    // }\n\n    // getUser(username: string): Promise<User> {\n    //     const userProfileClient = new userProfile.UserProfileClient({\n    //         url: this.params.userProfileServiceURL,\n    //         token: this.params.token\n    //     })\n\n    //     return userProfileClient.getUserProfile(username)\n    //         .then((userProfile) => {\n    //             return this.profileToUser(userProfile)\n    //         })\n    // }\n}","export interface GenericClientParams {\n    url: string\n    module: string\n    token?: string\n}\n\nexport interface JSONPayload {\n    version: string,\n    method: string,\n    id: string,\n    params: any\n}\n\nexport interface ErrorResult {\n    name: string\n    code: number\n    message: string\n    error: string\n}\n\nexport type JSONRPCResponse = [any, ErrorResult | null]\n\nexport class GenericClient {\n    url: string;\n    token: string | null\n    module: string\n\n    constructor({ url, token, module }: GenericClientParams) {\n        this.url = url\n        this.token = token || null\n        this.module = module\n    }\n\n    makePayload(method: string, param: any): JSONPayload {\n        return {\n            version: '1.1',\n            method: this.module + '.' + method,\n            id: String(Math.random()).slice(2),\n            params: param\n        }\n    }\n\n    makeEmptyPayload(method: string): JSONPayload {\n        return {\n            version: '1.1',\n            method: this.module + '.' + method,\n            id: String(Math.random()).slice(2),\n            params: []\n        }\n    }\n\n    async processResponse(response: Response): Promise<JSONRPCResponse> {\n        if (response.status === 200) {\n            const { result, error } = await response.json()\n            if (result) {\n                return [result, null]\n            } else {\n                return [null, error]\n            }\n\n        } else if (response.status === 204) {\n            return [null, null]\n        }\n        if (response.status === 500) {\n            if (response.headers.get('Content-Type') === 'application/json') {\n                const { error } = await response.json()\n                return [null, error]\n            } else {\n                const text = await response.text()\n                return [null, {\n                    code: 0,\n                    name: 'Internal Server Error (for real)',\n                    message: 'The service experienced an internal error',\n                    error: text\n                }]\n            }\n        }\n        throw new Error('Unexpected response: ' + response.status + ', ' + response.statusText)\n    }\n\n    async callFunc(func: string, param: any): Promise<JSONRPCResponse> {\n        return fetch(this.url, {\n            method: 'POST',\n            mode: 'cors',\n            cache: 'no-store',\n            headers: {\n                'Content-Type': 'application/json',\n                Accept: 'application/json'\n            },\n            body: JSON.stringify(this.makePayload(func, param))\n        })\n            .then((response) => {\n                return this.processResponse(response)\n            })\n    }\n}\n\nexport class AuthorizedGenericClient extends GenericClient {\n    token: string;\n\n    constructor(params: GenericClientParams) {\n        super(params)\n        if (!params.token) {\n            throw new Error('Authorized client requires token')\n        }\n        this.token = params.token\n    }\n\n    async callFunc(func: string, param: any): Promise<JSONRPCResponse> {\n        const response = await fetch(this.url, {\n            method: 'POST',\n            mode: 'cors',\n            cache: 'no-store',\n            headers: {\n                Authorization: this.token,\n                'Content-Type': 'application/json',\n                Accept: 'application/json'\n            },\n            body: JSON.stringify(this.makePayload(func, param))\n        })\n        return this.processResponse(response)\n    }\n}\n\n","import { AuthorizedServiceClient, ServiceClientParams } from './serviceClient'\n\n// types from module\n\nexport interface Service {\n    module_name: string\n    version: string | null\n}\n\nexport interface ServiceStatus {\n    module_name: string\n    version: string\n    git_commit_hash: string\n    release_tags: Array<string>\n    hash: string\n    url: string\n    up: number // aka boolean\n    status: string\n    health: string\n}\n\n// impl\n\nexport interface ServiceWizardClientParams extends ServiceClientParams {\n\n}\n\nexport interface GetServiceStatusParams extends Service { }\n\nexport interface GetServiceStatusResult extends ServiceStatus { }\n\nexport class ServiceWizardClient extends AuthorizedServiceClient {\n\n    static module: string = 'ServiceWizard'\n\n    constructor(params: ServiceWizardClientParams) {\n        super(params)\n    }\n\n\n    getServiceStatus(params: GetServiceStatusParams): Promise<GetServiceStatusResult> {\n        return this.callFunc('get_service_status', params)\n            .then((result) => {\n                if (result.result &&\n                    result.result.length > 0) {\n                    const theResult = result.result[0]\n                    if (!theResult) {\n                        throw new Error('Crazy at it seems, no result')\n                    }\n                    return theResult as GetServiceStatusResult\n                } else {\n                    throw new Error('Crazy at it seems, no result')\n                }\n            })\n    }\n\n}","export interface ServiceClientParams {\n    url: string\n    token?: string\n}\n\nexport interface JSONPayload {\n    version: string,\n    method: string,\n    id: string,\n    params: any\n}\n\nexport interface JSONResponse {\n    id: string\n    version: string\n    result: any\n    error: any\n}\n\nexport class ServiceClient {\n    url: string;\n    token: string | null;\n\n    static module: string;\n\n    constructor({ url, token }: ServiceClientParams) {\n        this.url = url\n        this.token = token || null\n    }\n\n    makePayload(method: string, param: any): JSONPayload {\n        return {\n            version: '1.1',\n            method: (<typeof ServiceClient>this.constructor).module + '.' + method,\n            id: String(Math.random()).slice(2),\n            params: [param]\n        }\n    }\n\n    makeEmptyPayload(method: string): JSONPayload {\n        return {\n            version: '1.1',\n            method: (<typeof ServiceClient>this.constructor).module + '.' + method,\n            id: String(Math.random()).slice(2),\n            params: []\n        }\n    }\n\n\n}\n\nexport class AuthorizedServiceClient extends ServiceClient {\n    token: string;\n\n    constructor(params: ServiceClientParams) {\n        super(params)\n        if (!params.token) {\n            throw new Error('Authorized client requires token')\n        }\n        this.token = params.token\n    }\n\n    callFunc(func: string, param: any): Promise<JSONResponse> {\n        return fetch(this.url, {\n            method: 'POST',\n            mode: 'cors',\n            cache: 'no-store',\n            headers: {\n                Authorization: this.token!,\n                'Content-Type': 'application/json',\n                Accept: 'application/json'\n            },\n            body: JSON.stringify(this.makePayload(func, param))\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error('Request error: ' + response.status + ', ' + response.statusText)\n                }\n                return <unknown>response.json() as JSONResponse\n            })\n    }\n}\n\n","import Bluebird from 'bluebird'\nimport { AuthorizedServiceClient } from './serviceClient'\n\nimport { ServiceWizardClient } from './serviceWizard'\nimport { GenericClient, AuthorizedGenericClient } from './genericClient'\n// now import the service wizard, and one auth generic client\n\n// type Promise<T> = Bluebird<T>\n\nexport interface CacheParams {\n    itemLifetime: number\n    monitoringFrequency: number\n    waiterTimeout: number\n    waiterFrequency: number\n}\n\nexport interface CacheItem<T> {\n    id: string\n    value: T | null\n    createdAt: number\n    fetcher: () => Bluebird<T>\n    reserved: boolean\n}\n\nexport class Cache<T> {\n\n    cache: Map<string, CacheItem<T>>\n    cacheLifetime: number\n    monitoringFrequency: number\n    waiterTimeout: number\n    waiterFrequency: number\n    isMonitoring: boolean\n\n    constructor({ itemLifetime, monitoringFrequency, waiterTimeout, waiterFrequency }: CacheParams) {\n        this.cache = new Map<string, CacheItem<T>>()\n\n        // 10 minute cache lifetime\n        this.cacheLifetime = itemLifetime || 1800000;\n\n        // Frequency with which to monitor the cache for expired items\n        // or refreshing them.\n        this.monitoringFrequency = monitoringFrequency || 60000;\n\n        // The waiter waits for a cache item to become available if it has\n        // been reserved. These settings determine how long to wait\n        // for a waiter to wait, and how often to check the cache item to see if it has\n        // yet been fulfilled.\n        this.waiterTimeout = waiterTimeout || 30000;\n        this.waiterFrequency = waiterFrequency || 100;\n\n        this.isMonitoring = false;\n    }\n\n    runMonitor() {\n        if (this.isMonitoring) {\n            return;\n        }\n        this.isMonitoring = true;\n        window.setTimeout(() => {\n            const newCache = new Map<string, any>();\n            let cacheRenewed = false;\n            Object.keys(this.cache).forEach((id) => {\n                const item = this.cache.get(id);\n                if (!this.isExpired(item)) {\n                    newCache.set(id, item)\n                    cacheRenewed = true\n                }\n            });\n            this.cache = newCache\n            this.isMonitoring = false\n            if (cacheRenewed) {\n                this.runMonitor()\n            }\n        }, this.monitoringFrequency)\n    }\n\n    isExpired(cacheItem: any) {\n        const now = new Date().getTime();\n        const elapsed = now - cacheItem.createdAt;\n        return (elapsed > this.cacheLifetime);\n    }\n\n    isReserved(cacheItem: any) {\n        return cacheItem.reserved;\n    }\n\n    getItem(id: string) {\n        if (this.cache.get(id) === undefined) {\n            return null\n        }\n        const cached = this.cache.get(id)\n        if (this.isExpired(cached)) {\n            this.cache.delete(id)\n            return;\n        }\n        return cached;\n    }\n\n    reserveWaiter(item: CacheItem<T>): Bluebird<CacheItem<T>> {\n        return new Bluebird<CacheItem<T>>((resolve, reject) => {\n            const started = new Date().getTime();\n            const waiting = true;\n\n            const waiter = () => {\n                if (!waiting) {\n                    return;\n                }\n                window.setTimeout(() => {\n                    if (this.cache.has(item.id)) {\n                        // If on a wait-loop cycle we discover that the\n                        // cache item has been deleted, we volunteer\n                        // to attempt to fetch it ourselves.\n                        // The only case now for this is a cancellation\n                        // of the first request to any dynamic service,\n                        // which may cancel the initial service wizard\n                        // call rather than the service call.\n                        return this.reserveAndFetch({\n                            id: item.id,\n                            fetcher: item.fetcher\n                        })\n                            .then(() => {\n                                // resolve(result);\n                                // we resolve with the cache item just\n                                // as if we had waited for it.\n                                resolve(this.cache.get(item.id))\n                            })\n                            .catch((err: Error) => {\n                                reject(err);\n                            });\n                    }\n                    if (!item.reserved) {\n                        resolve(item);\n                    } else {\n                        const elapsed = new Date().getTime() - started;\n                        if (elapsed > this.waiterTimeout) {\n                            this.cache.delete(item.id)\n                            reject(new Error(\n                                'Timed-out waiting for cache item to become available; timeout '\n                                + this.waiterTimeout + ', waited ' + elapsed));\n                        } else {\n                            waiter();\n                        }\n                    }\n                }, this.waiterFrequency);\n            };\n            waiter();\n        });\n    }\n\n    reserveAndFetch({ id, fetcher }: { id: string, fetcher: () => Bluebird<T> }) {\n        // now, reserve it.\n        this.reserveItem(id, fetcher)\n\n        // and then fetch it.\n        const fetchPromise = fetcher()\n            .then((result: any) => {\n                this.setItem(id, result, fetcher)\n                return result\n            })\n            .finally(() => {\n                // If the fetch was cancelled, we need to remove\n                // the reserved item. This should signal any queued waiters\n                // to spawn their own fetch.\n                if (fetchPromise.isCancelled()) {\n                    this.cache.get(id)\n                }\n            });\n        return fetchPromise;\n    }\n\n    getItemWithWait({ id, fetcher }: { id: string, fetcher: () => Bluebird<T> }) {\n        const cached = this.cache.get(id)\n        if (cached) {\n            if (this.isExpired(cached)) {\n                this.cache.delete(id)\n            } else if (this.isReserved(cached)) {\n                return this.reserveWaiter(cached)\n                    .then((cached) => {\n                        return cached.value;\n                    });\n            } else {\n                return Bluebird.resolve(cached.value)\n            }\n        }\n\n        return this.reserveAndFetch({ id, fetcher });\n    }\n\n    reserveItem(id: string, fetcher: () => Bluebird<T>) {\n        this.cache.set(id, {\n            id: id,\n            createdAt: new Date().getTime(),\n            reserved: true,\n            value: null,\n            fetcher: fetcher\n        });\n    }\n\n    setItem(id: string, value: T, fetcher: () => Bluebird<T>) {\n        if (this.cache.has(id)) {\n            const item = this.cache.get(id)\n            if (item && item.reserved) {\n                item.reserved = false\n                item.value = value\n                item.fetcher = fetcher\n            } else {\n                // overwriting? should we allow this?\n                this.cache.set(id, {\n                    id: id,\n                    createdAt: new Date().getTime(),\n                    fetcher: fetcher,\n                    reserved: false,\n                    value: value\n                })\n            }\n        } else {\n            this.cache.set(id, {\n                id: id,\n                createdAt: new Date().getTime(),\n                fetcher: fetcher,\n                reserved: false,\n                value: value\n            })\n        }\n        this.runMonitor();\n    }\n}\nvar moduleCache = new Cache<any>({\n    itemLifetime: 1800000,\n    monitoringFrequency: 60000,\n    waiterTimeout: 30000,\n    waiterFrequency: 100\n})\n\n\n/*\n * arg is:\n * url - service wizard url\n * timeout - request timeout\n * version - service release version or tag\n * auth - auth structure\n *   token - auth token\n *   username - username\n * rpcContext\n */\n\nexport interface DynamicServiceClientParams {\n    token: string\n    url: string\n    version?: string\n    timeout?: number\n    rpcContext?: any\n}\n\nexport class DynamicServiceClient {\n    token: string\n    timeout: number\n    rpcContext: any\n    url: string\n    version: string | null\n\n    static module: string\n\n    constructor({ token, url, version, timeout, rpcContext }: DynamicServiceClientParams) {\n        // Establish an auth object which has properties token and user_id.\n        this.token = token;\n        this.timeout = timeout || 10000;\n        this.rpcContext = rpcContext || null;\n\n        if (!url) {\n            throw new Error('The service discovery url was not provided');\n        }\n        this.url = url;\n\n        this.version = version || null;\n        if (version === 'auto') {\n            this.version = null;\n        }\n    }\n\n    options() {\n        return {\n            timeout: this.timeout,\n            authorization: this.token,\n            rpcContext: this.rpcContext\n        };\n    }\n\n    getModule() {\n        return (<typeof DynamicServiceClient>this.constructor).module\n    }\n\n    moduleId() {\n        let moduleId;\n        if (!this.version) {\n            moduleId = this.getModule() + ':auto';\n        } else {\n            moduleId = this.getModule() + ':' + this.version;\n        }\n        return moduleId;\n    }\n\n    getCached(fetcher: () => Bluebird<any>) {\n        return moduleCache.getItemWithWait({\n            id: this.moduleId(),\n            fetcher: fetcher\n        });\n    }\n\n    // setCached(value: any) {\n    //     moduleCache.setItem(this.moduleId(), value);\n    // }\n\n    lookupModule() {\n        return this.getCached((): Bluebird<any> => {\n            const func = 'get_service_status';\n            const params = [{\n                module_name: this.getModule(),\n                version: this.version\n            }];\n            // NB: pass null for numRets (number of return values) so we get the\n            // full return structure.\n            const client = new ServiceWizardClient({\n                url: this.url,\n                token: this.token\n            })\n\n            return Bluebird.resolve(\n                client.getServiceStatus({\n                    module_name: this.getModule(),\n                    version: this.version\n                })\n            )\n        })\n    }\n\n    callFunc(funcName: string, params: any) {\n        return this.lookupModule()\n            .then((serviceStatus) => {\n                const client = new AuthorizedGenericClient({\n                    module: serviceStatus.module_name,\n                    url: serviceStatus.url,\n                    token: this.token\n                })\n                return Bluebird.resolve(\n                    client.callFunc(funcName, params)\n                )\n            })\n            .catch((err) => {\n                console.error('ERROR: ' + err.name + \" = \" + err.message, err)\n                throw err\n            })\n    }\n}\n","import { AuthorizedGenericClient } from '../apis/genericClient'\nimport { NarrativeServiceClient } from '../apis/narrativeService'\nimport * as orgModel from './organization/model'\nimport * as requestModel from './requests'\nimport * as workspaceApi from '../apis/workspaceUtils'\nimport * as userModel from './user'\n\nexport enum NarrativeState {\n    NONE = 0,\n    ASSOCIATED,\n    REQUESTED\n}\n\nexport type NarrativeID = number\n\nexport type WorkspaceID = number\nexport type ObjectID = number\n\nexport enum NarrativeAccess {\n    NONE = 0,\n    VIEW,\n    EDIT,\n    ADMIN,\n    OWNER\n}\n\nexport interface NarrativeBase {\n    workspaceId: WorkspaceID,\n    access: NarrativeAccess\n}\n\nexport interface InaccessibleNarrative extends NarrativeBase {\n    access: NarrativeAccess.NONE\n}\n\nexport interface AccessibleNarrative extends NarrativeBase {\n    access: NarrativeAccess.VIEW | NarrativeAccess.EDIT | NarrativeAccess.ADMIN | NarrativeAccess.OWNER\n    isPublic: boolean\n    objectId: ObjectID\n    title: string\n    // description?: string\n    owner: userModel.Username\n    // creator: userModel.Username\n    // createdAt: Date\n    lastSavedAt: Date\n    lastSavedBy: userModel.Username\n}\n\nexport type Narrative = AccessibleNarrative | InaccessibleNarrative\n\nexport interface OrganizationNarrative {\n    workspaceId: WorkspaceID\n    objectId: ObjectID\n    title: string\n    status: NarrativeState\n    // inOrganization: boolean\n    // createdAt: Date\n    modifiedAt: Date\n}\n\nexport interface NarrativeWorkspaceInfo extends workspaceApi.WorkspaceInfo {\n    metadata: {\n        narrative_nice_name: string\n        version: string\n        is_temporary: string\n    }\n}\n// export interface GetOwnNarrativesResult {\n//     workspaceInfo: WorkspaceInfo\n//     objectInfo: ObjectInfo\n// }\n\ninterface NarrativeModelParams {\n    workspaceServiceURL: string\n    serviceWizardURL: string\n    groupsServiceURL: string\n    username: string\n    token: string\n}\n\nexport class NarrativeModel {\n\n    params: NarrativeModelParams\n\n    constructor(params: NarrativeModelParams) {\n        this.params = params\n    }\n\n    // Narratives\n\n    async getOwnNarratives(organizationId: string): Promise<Array<OrganizationNarrative>> {\n        const narrativeServiceClient = new NarrativeServiceClient({\n            url: this.params.serviceWizardURL,\n            token: this.params.token,\n            timeout: 10000,\n        })\n\n        const groupsClient = new orgModel.OrganizationModel({\n            token: this.params.token,\n            username: this.params.username,\n            groupsServiceURL: this.params.groupsServiceURL\n        })\n\n\n        const requestClient = new requestModel.RequestsModel({\n            token: this.params.token,\n            username: this.params.username,\n            groupsServiceURL: this.params.groupsServiceURL\n        })\n\n        const [narrativesResult, organization, pendingRequests] = await Promise.all([\n            narrativeServiceClient.listNarratives('mine'),\n            groupsClient.getOrg(organizationId),\n            requestClient.getPendingRequestsForOrg(organizationId)\n        ])\n\n        const workspacesInOrg = organization.narratives.map((narrative) => {\n            return narrative.workspaceId\n        })\n\n        return narrativesResult.narratives\n            .map((nar) => {\n                return {\n                    workspaceInfo: <unknown>workspaceApi.workspaceInfoToObject(nar.ws) as NarrativeWorkspaceInfo,\n                    objectInfo: workspaceApi.objectInfoToObject(nar.nar)\n                }\n            })\n            .filter((nar) => {\n                return (nar.workspaceInfo.metadata.is_temporary === 'false')\n            })\n            .map((narrative) => {\n                let status: NarrativeState\n\n                if (workspacesInOrg.indexOf(narrative.workspaceInfo.id) !== -1) {\n                    status = NarrativeState.ASSOCIATED\n                } else if (pendingRequests.find((request) => {\n                    // TODO: these requests should have already been converted to \n                    // model-friendly requests (typed!)\n                    return (request.resourceType === requestModel.RequestResourceType.WORKSPACE &&\n                        request.narrativeId === String(narrative.workspaceInfo.id))\n                })) {\n                    status = NarrativeState.REQUESTED\n                } else {\n                    status = NarrativeState.NONE\n                }\n                return {\n                    workspaceId: narrative.workspaceInfo.id,\n                    objectId: narrative.objectInfo.id,\n                    title: narrative.workspaceInfo.metadata.narrative_nice_name,\n                    status: status,\n                    modifiedAt: narrative.workspaceInfo.modifiedAt\n                }\n            })\n            .sort((a, b) => {\n                return (a.title.localeCompare(b.title))\n            })\n    }\n\n    async workspaceToNarrative(workspaceId: WorkspaceID): Promise<orgModel.NarrativeResource | null> {\n        const workspaceClient = new AuthorizedGenericClient({\n            module: 'Workspace',\n            url: this.params.workspaceServiceURL,\n            token: this.params.token\n        })\n        try {\n            const [[[rawObjectInfo], rawObjectInfoError], [[rawWorkspaceInfo], rawWorkspaceInfoError]] = await Promise.all([\n                workspaceClient.callFunc('get_object_info3', [{\n                    objects: [{\n                        wsid: workspaceId,\n                        // TODO: fix this!!\n                        objid: 1\n                    }],\n                    includeMetadata: 1,\n                    ignoreErrors: 0\n                }]),\n                workspaceClient.callFunc('get_workspace_info', [{\n                    id: workspaceId\n                }])\n            ])\n\n            if (rawObjectInfoError || rawWorkspaceInfoError) {\n                console.warn('narrative not accessible', rawObjectInfoError, rawWorkspaceInfoError)\n                return null\n            }\n\n            const workspaceInfo: NarrativeWorkspaceInfo = workspaceApi.workspaceInfoToObject(rawWorkspaceInfo) as NarrativeWorkspaceInfo\n\n            return {\n                workspaceId: workspaceInfo.id,\n                title: workspaceInfo.metadata.narrative_nice_name || 'Unknown',\n                permission: orgModel.userPermissionToWorkspacePermission(workspaceInfo.userPermission, workspaceInfo.owner === this.params.username),\n                isPublic: workspaceInfo.globalReadPermission\n            }\n\n        } catch (ex) {\n            // assume it is an inaccessible workspace\n            console.warn('narrative not accessible', ex)\n            return null\n        }\n    }\n\n    /*\n    getNarrative fetches the requested narrative and returns a Narrative object if found \n    and null otherwise. Note that this ignores the narrative state vis-a-vis any organization.\n    It also caches narratives.\n    */\n    async getNarrative(workspaceId: WorkspaceID): Promise<Narrative> {\n        const workspaceClient = new AuthorizedGenericClient({\n            module: 'Workspace',\n            url: this.params.workspaceServiceURL,\n            token: this.params.token\n        })\n        try {\n            const [[rawObjectInfo, rawObjectInfoError], [rawWorkspaceInfo, rawWorkspaceInfoError]] = await Promise.all([\n                workspaceClient.callFunc('get_object_info3', [{\n                    objects: [{\n                        wsid: workspaceId,\n                        // TODO: fix this!!\n                        objid: 1\n                    }],\n                    includeMetadata: 1,\n                    ignoreErrors: 0\n                }]),\n                workspaceClient.callFunc('get_workspace_info', [{\n                    id: workspaceId\n                }])\n            ])\n\n            if (rawObjectInfoError || rawWorkspaceInfoError) {\n                console.warn('narrative not accessible', rawObjectInfoError, rawWorkspaceInfoError)\n                return {\n                    workspaceId: workspaceId,\n                    access: NarrativeAccess.NONE\n                }\n            }\n\n            const workspaceInfo: NarrativeWorkspaceInfo = workspaceApi.workspaceInfoToObject(rawWorkspaceInfo[0]) as NarrativeWorkspaceInfo\n            const objectInfo: workspaceApi.ObjectInfo = workspaceApi.objectInfoToObject(rawObjectInfo[0].infos[0])\n\n            let access: NarrativeAccess.VIEW | NarrativeAccess.EDIT | NarrativeAccess.ADMIN | NarrativeAccess.OWNER\n            switch (workspaceInfo.userPermission) {\n                case 'n':\n                    if (workspaceInfo.globalReadPermission) {\n                        access = NarrativeAccess.VIEW\n                        break\n                    } else {\n                        throw new Error('Cannot have no access and no global read permission!')\n                    }\n                case 'r':\n                    access = NarrativeAccess.VIEW\n                    break\n                case 'w':\n                    access = NarrativeAccess.EDIT\n                    break\n                case 'a':\n                    if (workspaceInfo.owner === this.params.username) {\n                        access = NarrativeAccess.OWNER\n                    } else {\n                        access = NarrativeAccess.ADMIN\n                    }\n                    break\n                default:\n                    throw new Error('Unknown workspace permission: ' + workspaceInfo.userPermission)\n            }\n\n            return {\n                workspaceId: workspaceInfo.id,\n                access: access,\n                isPublic: workspaceInfo.globalReadPermission,\n                objectId: objectInfo.id,\n                title: workspaceInfo.metadata.narrative_nice_name || 'Unknown',\n                owner: workspaceInfo.owner,\n                lastSavedAt: objectInfo.savedAt,\n                lastSavedBy: objectInfo.savedBy\n            }\n        } catch (ex) {\n\n            console.error('Error fetching narrative!', ex)\n            throw ex\n        }\n    }\n}\n","// import { AuthorizedServiceClient, ServiceClientParams, JSONPayload } from './serviceClient'\n\nimport { DynamicServiceClient, DynamicServiceClientParams } from './dynamicServiceClient'\n\nimport { RawObjectInfo, RawWorkspaceInfo, WorkspaceInfo, ObjectInfo, workspaceInfoToObject, objectInfoToObject } from './workspaceUtils'\n\nexport interface NarrativeServiceClientParams extends DynamicServiceClientParams {\n\n}\n\nexport interface ListNarrativesParams {\n    type: string\n}\n\ntype Metadata = {}\n\n/* Information about an object, including user provided metadata.\n\n       obj_id objid - the numerical id of the object.\n       obj_name name - the name of the object.\n       type_string type - the type of the object.\n       timestamp save_date - the save date of the object.\n       obj_ver ver - the version of the object.\n       username saved_by - the user that saved or copied the object.\n       ws_id wsid - the workspace containing the object.\n       ws_name workspace - the workspace containing the object.\n       string chsum - the md5 checksum of the object.\n       int size - the size of the object in bytes.\n       usermeta meta - arbitrary user-supplied metadata about\n           the object.\n   */\n\n\n\n\nexport interface ListNarrativesResponseResult {\n    narratives: Array<{\n        ws: RawWorkspaceInfo\n        nar: RawObjectInfo\n    }>\n}\n\nexport interface ServiceResponse<T> {\n    id: string\n    version: string\n    result?: [T] | null\n    error?: any\n}\n\n\n\n// export type ListNarrativesResponse = ServiceResponse<ListNarrativesResponseResult>\n\n\n\nexport class NarrativeServiceClient extends DynamicServiceClient {\n\n    static module: string = 'NarrativeService'\n\n    constructor(params: NarrativeServiceClientParams) {\n        super(params)\n    }\n\n\n    async listNarratives(type: string): Promise<ListNarrativesResponseResult> {\n        // note usage of unknown below -- Bluebird and native Promise!\n        const [result, error] = await this.callFunc('list_narratives', [{\n            type: type\n        }])\n        // as Promise<ServiceResponse<ListNarrativesResponseResult>>\n\n        // should check id and version, or should call func do that?\n        if (result && result[0]) {\n            return result[0]\n            // return result[0].narratives.map((nar) => {\n            //     return {\n            //         workspaceInfo: workspaceInfoToObject(nar.ws),\n            //         objectInfo: objectInfoToObject(nar.nar)\n            //     }\n            // })\n        } else {\n            // TODO: handle error\n            // console.error('Result is missing', id, version, result, error)\n            throw new Error('Result is missing!')\n        }\n    }\n\n}","export type Metadata = {}\n\nexport type RawObjectInfo = [\n    number, // objid - object id\n    string, // name - object name\n    string, // type - object type\n    string, // save_date - iso8601 timestamp when last saved\n    number, // ver - object version\n    string, // saved_by - username who saved it last\n    number, // wsid - workspace id\n    string, // workspace - workspace name,\n    string, // chsum - checksum of the object\n    number, // size - size of the object (bytes)\n    Metadata   // meta - string to string object of stuff\n]\n\nexport type RawWorkspaceInfo = [\n    number, // id - workspace id\n    string, // workspace - workspace name\n    string, // owner - username who owns it\n    string, // moddate - iso8601 timestamp when last modified\n    number, // max_objid - last object id assigned to object in workspace\n    string, // user_permission - permission of user who made reqeust wrt workspace\n    number, // globalread - int bool whether this workspace is shared globally\n    string, // lockstat - status of the workspace lock\n    Metadata // metadata\n]\n\nexport interface WorkspaceInfo {\n    id: number\n    name: string\n    owner: string\n    modifiedAt: Date\n    objectCount: number\n    userPermission: string\n    globalReadPermission: boolean\n    lockStatus: string\n    metadata: Metadata\n}\n\nexport interface ObjectInfo {\n    id: number\n    name: string\n    type: {\n        module: string\n        name: string\n        majorVersion: number\n        minorVersion: number\n        id: string\n    }\n    version: number\n    savedAt: Date\n    savedBy: string\n    workspaceId: number\n    workspaceName: string\n    checksum: string\n    size: number\n    ref: string\n    metadata: Metadata\n}\n\nfunction iso8601ToDate(dateString: string) {\n    const isoRE = /(\\d\\d\\d\\d)-(\\d\\d)-(\\d\\d)T(\\d\\d):(\\d\\d):(\\d\\d)([\\+\\-])(\\d\\d)(:?[\\:]*)(\\d\\d)/;\n    const dateParts = isoRE.exec(dateString);\n    if (!dateParts) {\n        throw new TypeError('Invalid Date Format for ' + dateString);\n    }\n    // This is why we do this -- JS insists on the colon in the tz offset.\n    const offset = dateParts[7] + dateParts[8] + ':' + dateParts[10];\n    const newDateString = dateParts[1] + '-' + dateParts[2] + '-' + dateParts[3] + 'T' + dateParts[4] + ':' + dateParts[5] + ':' + dateParts[6] + offset;\n    return new Date(newDateString);\n}\n\nexport function workspaceInfoToObject(wsInfo: RawWorkspaceInfo): WorkspaceInfo {\n    return {\n        id: wsInfo[0],\n        name: wsInfo[1],\n        owner: wsInfo[2],\n        modifiedAt: iso8601ToDate(wsInfo[3]),\n        objectCount: wsInfo[4],\n        userPermission: wsInfo[5],\n        globalReadPermission: wsInfo[6] === 1 ? true : false,\n        lockStatus: wsInfo[7],\n        metadata: wsInfo[8]\n    }\n}\n\nexport function objectInfoToObject(data: RawObjectInfo): ObjectInfo {\n    const type = data[2].split(/[-.]/)\n\n    return {\n        id: data[0],\n        name: data[1],\n        // type: data[2],\n        type: {\n            id: data[2],\n            module: type[0],\n            name: type[1],\n            majorVersion: parseInt(type[2], 10),\n            minorVersion: parseInt(type[3], 10)\n        },\n        savedAt: iso8601ToDate(data[3]),\n        version: data[4],\n        savedBy: data[5],\n        workspaceId: data[6],\n        workspaceName: data[7],\n        checksum: data[8],\n        size: data[9],\n        metadata: data[10],\n        ref: data[6] + '/' + data[0] + '/' + data[4]\n    }\n}\n\n","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\n\nimport { ActionFlag } from './index'\nimport * as userModel from '../../data/models/user'\nimport * as orgModel from '../../data/models/organization/model'\nimport * as narrativeModel from '../../data/models/narrative'\nimport { AppError, StoreState } from '../../types'\n\nexport interface EntityAction extends Action {\n\n}\n\nexport interface UserLoader extends EntityAction {\n    type: ActionFlag.ENTITY_USER_LOADER,\n    userId: userModel.Username\n}\n\nexport interface UserLoaderStart extends EntityAction {\n    type: ActionFlag.ENTITY_USER_LOADER_START\n}\n\nexport interface UserLoaderSuccess extends EntityAction {\n    type: ActionFlag.ENTITY_USER_LOADER_SUCCESS,\n    user: userModel.User\n}\n\nexport interface UserLoaderError extends EntityAction {\n    type: ActionFlag.ENTITY_USER_LOADER_ERROR,\n    error: AppError\n}\n\n\nexport function userLoaderStart(): UserLoaderStart {\n    return {\n        type: ActionFlag.ENTITY_USER_LOADER_START\n    }\n}\n\nexport function userLoaderSuccess(user: userModel.User): UserLoaderSuccess {\n    return {\n        type: ActionFlag.ENTITY_USER_LOADER_SUCCESS,\n        user: user\n    }\n}\n\nexport function userLoaderError(error: AppError): UserLoaderError {\n    return {\n        type: ActionFlag.ENTITY_USER_LOADER_ERROR,\n        error: error\n    }\n}\n\nexport function userLoader(userId: userModel.Username) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(userLoaderStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config }\n        } = getState()\n\n        const model = new userModel.UserModel({\n            token,\n            userProfileServiceURL: config.services.UserProfile.url\n        })\n\n        try {\n            const user = await model.getUser(userId)\n            dispatch(userLoaderSuccess(user))\n        } catch (ex) {\n            dispatch(userLoaderError({\n                code: 'error',\n                message: ex.message\n            }))\n        }\n    }\n}\n\n\n\n\n\nexport interface OrganizationLoader extends EntityAction {\n    type: ActionFlag.ENTITY_ORGANIZATION_LOADER,\n    organizationId: orgModel.OrganizationID\n}\n\nexport interface OrganizationLoaderStart extends EntityAction {\n    type: ActionFlag.ENTITY_ORGANIZATION_LOADER_START\n}\n\nexport interface OrganizationLoaderSuccess extends EntityAction {\n    type: ActionFlag.ENTITY_ORGANIZATION_LOADER_SUCCESS,\n    organization: orgModel.Organization\n}\n\nexport interface OrganizationLoaderError extends EntityAction {\n    type: ActionFlag.ENTITY_ORGANIZATION_LOADER_ERROR,\n    error: AppError\n}\n\n\nexport function organizationLoaderStart(): OrganizationLoaderStart {\n    return {\n        type: ActionFlag.ENTITY_ORGANIZATION_LOADER_START\n    }\n}\n\nexport function organizationLoaderSuccess(organization: orgModel.Organization): OrganizationLoaderSuccess {\n    return {\n        type: ActionFlag.ENTITY_ORGANIZATION_LOADER_SUCCESS,\n        organization: organization\n    }\n}\n\nexport function organizationLoaderError(error: AppError): OrganizationLoaderError {\n    return {\n        type: ActionFlag.ENTITY_ORGANIZATION_LOADER_ERROR,\n        error: error\n    }\n}\n\nexport function organizationLoader(organizationId: orgModel.OrganizationID) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(organizationLoaderStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config }\n        } = getState()\n\n        const model = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        try {\n            const organization = await model.getOrg(organizationId)\n            dispatch(organizationLoaderSuccess(organization))\n        } catch (ex) {\n            dispatch(organizationLoaderError({\n                code: 'error',\n                message: ex.message\n            }))\n        }\n    }\n}\n\n// Narratives\n\nexport interface LoadNarrative {\n    type: ActionFlag.ENTITY_NARRATIVE_LOAD\n}\n\ninterface LoadNarrativeStart {\n    type: ActionFlag.ENTITY_NARRATIVE_LOAD_START\n}\n\nexport interface LoadNarrativeSuccess {\n    type: ActionFlag.ENTITY_NARRATIVE_LOAD_SUCCESS\n    narrative: narrativeModel.Narrative\n}\n\ninterface LoadNarrativeError {\n    type: ActionFlag.ENTITY_NARRATIVE_LOAD_ERROR\n    error: AppError\n}\n\nexport function loadNarrative(workspaceId: narrativeModel.WorkspaceID) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch({\n            type: ActionFlag.ENTITY_NARRATIVE_LOAD_START\n        })\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config }\n        } = getState()\n\n        const narrativeClient = new narrativeModel.NarrativeModel({\n            token, username,\n            workspaceServiceURL: config.services.Workspace.url,\n            groupsServiceURL: config.services.Groups.url,\n            serviceWizardURL: config.services.ServiceWizard.url\n        })\n\n        try {\n            const narrative = await narrativeClient.getNarrative(workspaceId)\n            dispatch({\n                type: ActionFlag.ENTITY_NARRATIVE_LOAD_SUCCESS,\n                narrative: narrative\n            })\n        } catch (ex) {\n            dispatch({\n                type: ActionFlag.ENTITY_NARRATIVE_LOAD_ERROR,\n                error: {\n                    code: ex.name,\n                    message: ex.message\n                }\n            })\n        }\n    }\n}\n\n\n// Access narrative\n\nexport interface AccessNarrative extends Action {\n    type: ActionFlag.VIEW_ORG_ACCESS_NARRATIVE,\n    narrative: orgModel.NarrativeResource\n}\n\nexport interface AccessNarrativeStart extends Action {\n    type: ActionFlag.VIEW_ORG_ACCESS_NARRATIVE_START\n}\n\nexport interface AccessNarrativeSuccess extends Action {\n    type: ActionFlag.VIEW_ORG_ACCESS_NARRATIVE_SUCCESS,\n    organization: orgModel.Organization\n}\n\nexport interface AccessNarrativeError extends Action {\n    type: ActionFlag.VIEW_ORG_ACCESS_NARRATIVE_ERROR,\n    error: AppError\n}\n\n// Generators\nexport function accessNarrativeStart(): AccessNarrativeStart {\n    return {\n        type: ActionFlag.VIEW_ORG_ACCESS_NARRATIVE_START\n    }\n}\n\nexport function accessNarrativeSuccess(organization: orgModel.Organization): AccessNarrativeSuccess {\n    return {\n        type: ActionFlag.VIEW_ORG_ACCESS_NARRATIVE_SUCCESS,\n        organization: organization\n    }\n}\n\nexport function accessNarrativeError(error: AppError): AccessNarrativeError {\n    return {\n        type: ActionFlag.VIEW_ORG_ACCESS_NARRATIVE_ERROR,\n        error: error\n    }\n}\n\n// Thunk\n\nexport function accessNarrative(narrative: orgModel.NarrativeResource) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(accessNarrativeStart())\n\n        const state = getState()\n        if (!state.views.viewOrgView.viewModel) {\n            dispatch(accessNarrativeError({\n                code: 'error',\n                message: 'No view model'\n            }))\n            return\n        }\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config },\n            views: {\n                viewOrgView: {\n                    viewModel: {\n                        organization\n                    }\n                }\n            }\n        } = state\n\n        if (!organization) {\n            return\n        }\n\n        const groupId = organization.id\n        const resourceId = String(narrative.workspaceId)\n\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        try {\n            await orgClient.grantNarrativeAccess(groupId, resourceId)\n            const org = await orgClient.getOrg(groupId)\n            dispatch(accessNarrativeSuccess(org))\n        } catch (ex) {\n            dispatch(accessNarrativeError({\n                code: 'error',\n                message: ex.message\n            }))\n        }\n\n    }\n}\n\n\n","import * as React from 'react'\nimport * as userModel from '../../data/models/user'\nimport Member from './Member'\n\ninterface LoaderProps {\n    member: orgModel.Member\n    user: userModel.User | undefined\n    avatarSize: number\n    onLoad: (userId: userModel.Username) => void\n}\n\ninterface LoaderState {\n\n}\n\nclass Loader extends React.Component<LoaderProps, LoaderState> {\n    constructor(props: LoaderProps) {\n        super(props)\n    }\n\n    render() {\n        if (this.props.user) {\n            return (\n                <Member member={this.props.member} user={this.props.user} avatarSize={this.props.avatarSize} />\n            )\n        } else {\n            this.props.onLoad(this.props.member.username)\n            return (\n                <div>\n                    Loading user...\n                </div>\n            )\n        }\n    }\n}\n\nimport { Dispatch } from 'redux'\nimport { connect } from 'react-redux'\nimport { StoreState } from '../../types';\nimport * as actions from '../../redux/actions/entities'\nimport * as orgModel from '../../data/models/organization/model'\n\n\nexport interface OwnProps {\n    member: orgModel.Member\n    avatarSize: number\n}\n\ninterface StateProps {\n    user: userModel.User | undefined\n}\n\ninterface DispatchProps {\n    onLoad: (userId: userModel.Username) => void\n}\n\nfunction mapStateToProps(state: StoreState, props: OwnProps): StateProps {\n    return {\n        user: state.entities.users.byId.get(props.member.username)\n    }\n}\n\nfunction mapDispatchToProps(dispatch: Dispatch<actions.EntityAction>): DispatchProps {\n    return {\n        onLoad: (userId: userModel.Username) => {\n            dispatch(actions.userLoader(userId) as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(Loader)","import * as React from 'react';\nimport './component.css';\nimport { NavLink } from 'react-router-dom';\nimport { Alert } from 'antd';\nimport * as orgModel from '../../data/models/organization/model'\nimport Member from '../entities/MemberContainer';\n\n// TODO: need more ergonomic way to resolve the common issue of data types interfering with \n// component types.\n\nexport interface OrganizationsProps {\n    organizations: Array<orgModel.Organization>\n}\n\nexport interface OrganizationsState {\n    searchTerms: Array<string>\n}\n\nexport class Organizations extends React.Component<OrganizationsProps, OrganizationsState> {\n\n    constructor(props: OrganizationsProps) {\n        super(props)\n\n        this.state = {\n            searchTerms: []\n        }\n    }\n\n    getAvatarUrl(org: orgModel.Organization) {\n        // const defaultImages = [\n        //     'orgs-64.png',\n        //     'unicorn-64.png'\n        // ]\n        // if (!org.gravatarHash) {\n        //     return defaultImages[Math.floor(Math.random() * 2)]\n        // }\n        if (!org.gravatarHash) {\n            return 'unicorn-64.png'\n        }\n        const gravatarDefault = 'identicon';\n\n        return 'https://www.gravatar.com/avatar/' + org.gravatarHash + '?s=64&amp;r=pg&d=' + gravatarDefault;\n    }\n\n    renderAvatar(org: orgModel.Organization) {\n        return (\n            <img style={{ width: 64, height: 64 }}\n                src={this.getAvatarUrl(org)} />\n        )\n    }\n\n    renderRelation(org: orgModel.Organization) {\n        return (\n            <div>\n                disabled\n            </div>\n        )\n    }\n\n    // renderRelation(org: orgModel.Organization) {\n    //     switch (org.relation.type) {\n    //         case (types.UserRelationToOrganization.NONE):\n    //             return (\n    //                 <span><Icon type=\"stop\" />None</span>\n    //             )\n    //         case (types.UserRelationToOrganization.VIEW):\n    //             return (\n    //                 <Tooltip\n    //                     placement=\"bottomRight\"\n    //                     mouseEnterDelay={0.5}\n    //                     title=\"You are not a member of this org, but you may access it; you may request membership\"\n    //                 >\n    //                     <span><Icon type=\"stop\" /> You are not a member - view group to join</span>\n    //                 </Tooltip>\n    //             )\n    //         case (types.UserRelationToOrganization.MEMBER_REQUEST_PENDING):\n    //             return (<span><Icon type=\"user\" style={{ color: 'orange' }} /> Your membership <b>request</b> is pending</span>)\n    //         case (types.UserRelationToOrganization.MEMBER_INVITATION_PENDING):\n    //             return (<span><Icon type=\"user\" style={{ color: 'blue' }} /> You have been <b>invited</b> to join</span>)\n    //         case (types.UserRelationToOrganization.MEMBER):\n    //             return (<span><Icon type=\"user\" /> You are a <b>member</b> of this organization</span>)\n    //         case (types.UserRelationToOrganization.ADMIN):\n    //             return (<span><Icon type=\"unlock\" />Admin</span>)\n    //         case (types.UserRelationToOrganization.OWNER):\n    //             return (\n    //                 <Tooltip\n    //                     placement=\"bottomRight\"\n    //                     mouseEnterDelay={0.5}\n    //                     title=\"You own this org\"\n    //                 >\n    //                     <span><Icon type=\"crown\" /> You are the <b>owner</b> of this Organization</span>\n    //                 </Tooltip>\n    //             )\n    //     }\n    // }\n\n    renderAdminInfo(org: orgModel.Organization) {\n        return (\n            <div>\n                disabled\n            </div>\n        )\n    }\n\n    // renderAdminInfo(org: orgModel.Organization) {\n    //     if (!(org.relation.type === types.UserRelationToOrganization.OWNER ||\n    //         org.relation.type === types.UserRelationToOrganization.ADMIN)) {\n    //         return\n    //     }\n    //     let requestsPending\n    //     if (org.adminRequests.length > 0) {\n    //         requestsPending = (\n    //             <div>\n    //                 <Icon type=\"exclamation-circle\" theme=\"twoTone\" twoToneColor=\"orange\" />\n    //                 {' '}\n    //                 there\n    //                 {' '}\n    //                 {org.adminRequests.length > 1 ? 'are' : 'is'}\n    //                 {' '}\n    //                 <b>{org.adminRequests.length} pending request{org.adminRequests.length > 1 ? 's' : ''}</b>\n    //             </div>\n    //         )\n    //     }\n\n    //     return (\n    //         <div className=\"admin\">\n    //             {requestsPending}\n    //         </div>\n    //     )\n    // }\n\n    pluralize(count: number, singular: string, plural: string) {\n        if (count === 0 || count > 1) {\n            return plural\n        }\n        return singular\n    }\n\n    renderMemberCount(org: orgModel.Organization) {\n        return (\n            <div className=\"memberCount\">\n                {org.members.length > 0 ? org.members.length : 'no'} {this.pluralize(org.members.length, 'member', 'members')}\n            </div>\n        )\n    }\n\n    renderRelationInfo(org: orgModel.Organization) {\n        return (\n            <div>\n                disabled\n            </div>\n        )\n    }\n\n    // renderRelationInfo(org: orgModel.Organization) {\n    //     switch (org.relation.type) {\n    //         case types.UserRelationToOrganization.NONE:\n    //             return (\n    //                 <div>\n    //                     Only members may view membership information\n    //                 </div>\n    //             )\n    //             break\n    //         case types.UserRelationToOrganization.VIEW:\n    //             return (\n    //                 <div>Only members may view membership information</div>\n    //             )\n    //             break\n    //         case types.UserRelationToOrganization.MEMBER:\n    //             return (\n    //                 <div>\n    //                     {this.renderMemberCount(org)}\n    //                 </div>\n    //             )\n    //             break\n    //         case types.UserRelationToOrganization.MEMBER_REQUEST_PENDING:\n    //             return (\n    //                 <div>Only members may view membership information</div>\n    //             )\n    //             break\n    //         case types.UserRelationToOrganization.MEMBER_INVITATION_PENDING:\n    //             return (\n    //                 <div>\n    //                     Only members may view membership information\n    //                 </div>\n    //             )\n    //             break\n    //         case types.UserRelationToOrganization.ADMIN:\n    //             return (\n    //                 <div>\n    //                     {this.renderMemberCount(org)}\n    //                 </div>\n    //             )\n    //             break\n    //         case types.UserRelationToOrganization.OWNER:\n    //             return (\n    //                 <div>\n    //                     {this.renderMemberCount(org)}\n    //                 </div>\n    //             )\n    //             break\n    //     }\n    // }\n\n    renderOrg(org: orgModel.Organization, index: Number) {\n        return (\n            <div className=\"row organization\" key={String(index)}>\n                <div className=\"col2\">\n                    <NavLink to={`/viewOrganization/${org.id}`}>\n                        {this.renderAvatar(org)}\n                    </NavLink>\n                </div>\n                <div className=\"col1\">\n                    <div className=\"orgName\">\n                        <NavLink to={`/viewOrganization/${org.id}`}>\n                            {org.name}\n                        </NavLink>\n                    </div>\n                    <div className=\"orgOwner\">\n                        <span className=\"field-label\">owner</span>\n                        {/* TODO: render as Member or Owner component */}\n                        <span className=\"field-value\">\n                            <Member member={org.owner} avatarSize={30} />\n                            {/* <a href={\"/#people/\" + org.owner.username} target=\"_blank\">{org.owner.username} {org.owner.username}</a> */}\n                        </span>\n                    </div>\n                    <div className=\"orgCreated\">\n                        <span className=\"field-label\">established</span>\n                        <span className=\"field-value\">{Intl.DateTimeFormat('en-US', {\n                            month: 'short',\n                            day: 'numeric',\n                            year: 'numeric'\n                        }).format(org.createdAt)}</span>\n                    </div>\n\n                    {/* <div className=\"relation\">\n                        {this.renderRelation(org)}\n                    </div>\n                    {this.renderRelationInfo(org)} */}\n\n                    {/* {this.renderAdminInfo(org)} */}\n                </div>\n            </div>\n        )\n    }\n\n    renderOrgs() {\n        if (this.props.organizations.length > 0) {\n            return (\n                this.props.organizations.map((org: orgModel.Organization, index) => {\n                    return (\n                        this.renderOrg(org, index)\n                    )\n                })\n            )\n        } else {\n            return (\n                <Alert type=\"warning\"\n                    style={{ maxWidth: '20em', margin: '20px auto 0 auto' }}\n                    message=\"Sorry, no organizations were found.\" />\n            )\n        }\n    }\n\n    render() {\n        return (\n            <div className=\"Organizations\">\n                <div style={{ overflowY: 'auto', display: 'flex', flexDirection: 'column' }}>\n                    {this.renderOrgs()}\n                </div>\n            </div >\n        )\n    }\n}\n\nexport default Organizations;","import { Organizations, OrganizationsProps } from './component';\nimport { StoreState } from '../../types';\nimport { connect } from 'react-redux';\n\nexport function mapStateToProps(state: StoreState): OrganizationsProps {\n    // TODO: wow, should not do this here\n    if (state.views.browseOrgsView.viewModel === null) {\n        throw new Error('view not ready')\n    }\n    const {\n        views: {\n            browseOrgsView: {\n                viewModel: { organizations }\n            }\n        }\n    } = state;\n    return {\n        organizations\n    }\n}\n\nexport default connect(mapStateToProps)(Organizations);","import * as React from 'react'\nimport { NavLink } from 'react-router-dom'\nimport './Header.css'\nimport { FaUsers, FaChevronRight } from 'react-icons/fa'\nimport { Icon } from 'antd';\n\nexport interface HeaderProps {\n    breadcrumbs: JSX.Element\n    buttons?: JSX.Element\n}\n\nclass Header extends React.Component<HeaderProps, object> {\n    // <FaChevronRight style={{ verticalAlign: 'middle', marginLeft: '4px', marginRight: '4px' }} />\n    buildSeparator() {\n        if (this.props.breadcrumbs) {\n            return (\n                <Icon type=\"right\" style={{ verticalAlign: 'middle', marginLeft: '4px', marginRight: '4px' }} />\n            )\n        }\n    }\n\n    render() {\n        return (\n            <div className=\"Header\">\n                <div className=\"defaultCrumbs\">\n                    <NavLink to=\"/\">\n                        <Icon type=\"team\" style={{ verticalAlign: 'middle' }} />\n                        {' '}\n                        <span data-test=\"orgs-label\">Orgs</span>\n                    </NavLink>\n                    {this.buildSeparator()}\n                    {/* {this.buildSeparator()}\n                    <NavLink to=\"/organizations\">\n                        <FaUsers style={{ verticalAlign: 'middle' }} />\n                        {' '}\n                        <span data-test=\"orgs-label\">Orgs</span>\n                    </NavLink> */}\n                </div>\n                <div className=\"userColumn\">\n\n                    <div className=\"breadcrumbs\">\n                        {this.props.breadcrumbs}\n                    </div>\n                    <div className=\"buttons\">\n                        {this.props.buttons}\n                    </div>\n\n                    {/* {this.props.children} */}\n                </div>\n            </div>\n        )\n    }\n}\n\nexport default Header;","import * as React from 'react';\nimport { NavLink } from 'react-router-dom'\n\nimport Organizations from '../../organizations/container';\nimport { SortDirection, AppError } from '../../../types';\n\nimport './component.css';\nimport { Button, Icon, Radio, Select, Modal, Alert } from 'antd'\nimport Header from '../../Header';\nimport { RadioChangeEvent } from 'antd/lib/radio';\n\nexport interface OrganizationsBrowserProps {\n    totalCount: number;\n    filteredCount: number;\n    sortBy: string;\n    sortDirection: SortDirection;\n    filter: string;\n    searching: boolean;\n    error: AppError | null;\n    onSearchOrgs: (searchTerms: Array<string>) => void;\n    onSortOrgs: (sortBy: string, sortDirection: SortDirection) => void;\n    onFilterOrgs: (filter: string) => void;\n}\n\nexport interface OrganizationsBrowserState {\n    searchInput: string\n    showInfo: boolean\n}\nclass OrganizationsBrowser extends React.Component<OrganizationsBrowserProps, OrganizationsBrowserState> {\n\n    searchInput: React.RefObject<HTMLInputElement>;\n    searchButton: React.RefObject<Button>;\n\n    constructor(props: OrganizationsBrowserProps) {\n        super(props)\n\n        this.searchInput = React.createRef()\n        this.searchButton = React.createRef()\n\n        this.state = {\n            searchInput: '',\n            showInfo: false\n        }\n\n        this.props.onSearchOrgs([])\n    }\n\n    onShowInfo() {\n        Modal.info({\n            title: 'Organizations Browser Help',\n            width: '50em',\n            content: (\n                <div>\n                    <p>This is the organizations browser...</p>\n                </div>\n            )\n        })\n    }\n\n    doSearch() {\n        if (this.searchInput.current === null) {\n            return\n        }\n        const searchTerms = this.searchInput.current.value.split(/[\\s+]/)\n        // dispatch the search event\n        this.props.onSearchOrgs(searchTerms);\n    }\n\n    haveSearchInput() {\n        if (this.state.searchInput && this.state.searchInput.length > 0) {\n            return true\n        }\n        return false\n    }\n\n    onSearchInputChange() {\n        let currentSearchInputValue;\n        if (this.searchInput.current) {\n            currentSearchInputValue = this.searchInput.current.value\n        } else {\n            currentSearchInputValue = ''\n        }\n        this.setState({ searchInput: currentSearchInputValue })\n    }\n\n    onSubmit(e: React.FormEvent<HTMLFormElement>) {\n        e.preventDefault()\n        this.doSearch()\n    }\n\n    onSortByChange(e: RadioChangeEvent) {\n        this.props.onSortOrgs(e.target.value, this.props.sortDirection)\n    }\n\n    onSortByChange2(value: string) {\n        this.props.onSortOrgs(value, this.props.sortDirection)\n    }\n\n\n    onSortDirectionChange(e: RadioChangeEvent) {\n        this.props.onSortOrgs(this.props.sortBy, e.target.value)\n    }\n\n    onSortDirectionChange2(value: string) {\n        this.props.onSortOrgs(this.props.sortBy, value as SortDirection)\n    }\n\n    onFilterChange(e: RadioChangeEvent) {\n        this.props.onFilterOrgs(e.target.value)\n    }\n\n    onFilterChange2(value: string) {\n        this.props.onFilterOrgs(value)\n    }\n\n    onClearSearch() {\n        if (this.searchInput.current === null) {\n            return\n        }\n        this.searchInput.current.value = ''\n        this.onSearchInputChange()\n        // this.searchButton.current!.handleClick(new MouseEvent<HTMLButtonElement>('click'))\n        // const event = new Event('change', { bubbles: true })\n        // this.searchInput.current.dispatchEvent(event)\n        this.doSearch()\n    }\n\n    renderSearchFeedback() {\n        if (this.props.totalCount === 0) {\n            return (\n                <span>\n                    No organizations in the system\n                </span>\n            )\n        }\n        if (this.props.filteredCount === 0) {\n            return (\n                <span>\n                    No organizations found out of\n                    {' '}\n                    {this.props.totalCount}\n                    {' '}\n                    available.\n                </span>\n            )\n\n        }\n        if (this.props.totalCount === this.props.filteredCount) {\n            return (\n                <span>\n                    Showing all\n                {' '}\n                    {this.props.totalCount}\n                    {' '}\n                    organizations\n                </span>\n            )\n        }\n\n        return (\n            <span>\n                Showing\n                {' '}\n                {this.props.filteredCount}\n                {' '}\n                out of\n                {' '}\n                {this.props.totalCount}\n                {' '}\n                organizations\n            </span>\n        )\n    }\n\n    renderSearchIcon() {\n        if (this.props.searching) {\n            return (<Icon type=\"loading\" />)\n        }\n        return (<Icon type=\"search\" />)\n    }\n\n    renderSearchBar() {\n        return (\n            <form id=\"searchForm\" className=\"OrganizationsBrowser-searchBar\" onSubmit={this.onSubmit.bind(this)}>\n                <input\n                    placeholder=\"Search Organizations\"\n                    onChange={this.onSearchInputChange.bind(this)}\n                    autoFocus\n                    ref={this.searchInput}></input>\n                {/* <Tooltip\n                    title=\"Enter one or more words to search organizations by name or owner\">\n                    <Icon type=\"info-circle\" theme=\"twoTone\" style={{ alignSelf: 'end' }} />\n                </Tooltip> */}\n                <Button\n                    disabled={!this.haveSearchInput()}\n                    ref={this.searchButton}\n                    form=\"searchForm\"\n                    key=\"submit\"\n                    htmlType=\"submit\">\n                    {this.renderSearchIcon()}\n                    {/* Search */}\n                </Button>\n                <Button\n                    onClick={this.onClearSearch.bind(this)}\n                    disabled={!this.haveSearchInput()}\n                    icon=\"close\"\n                >\n\n                    {/* Show all */}\n                </Button>\n                {/* <div className=\"message\">\n                    {this.renderSearchFeedback()}\n                </div> */}\n            </form>\n        )\n    }\n\n    renderHeader() {\n        const breadcrumbs = (\n            <React.Fragment>\n                <span>\n                    Browse and Search Organizations\n                        </span>\n                <Icon type=\"right\" style={{ margin: '0 4px' }} />\n                <span style={{ fontWeight: 'normal', fontStyle: 'italic' }}>\n                    {this.renderSearchFeedback()}\n                </span>\n            </React.Fragment>\n        )\n        const buttons = (\n            <React.Fragment>\n                <NavLink to=\"/newOrganization\"><Button icon=\"plus-circle\">Create Organization</Button></NavLink>\n                <Button shape=\"circle\" icon=\"info\" onClick={this.onShowInfo.bind(this)}></Button>\n            </React.Fragment>\n        )\n        return (\n            <Header breadcrumbs={breadcrumbs} buttons={buttons} />\n        )\n    }\n\n    renderSearchFilter() {\n        return (\n            <div>\n                <span className=\"field-label\">sort by</span>\n                <Select onChange={this.onSortByChange2.bind(this)}\n                    defaultValue={this.props.sortBy}\n                    style={{ width: '8em' }}\n                    dropdownMatchSelectWidth={true}>\n                    <Select.Option value=\"name\" key=\"name\">Org name</Select.Option>\n                    <Select.Option value=\"owner\" key=\"owner\">Owner</Select.Option>\n                    <Select.Option value=\"created\" key=\"created\">Date created</Select.Option>\n                </Select>\n                <Select onChange={this.onSortDirectionChange2.bind(this)}\n                    style={{ width: '10em' }}\n                    dropdownMatchSelectWidth={true}\n                    defaultValue={this.props.sortDirection}>\n                    <Select.Option value={SortDirection.ASCENDING} key=\"name\"><Icon type=\"sort-ascending\" />Ascending</Select.Option>\n                    <Select.Option value={SortDirection.DESCENDING} key=\"owner\"><Icon type=\"sort-descending\" />Descending</Select.Option>\n                </Select>\n                <span className=\"field-label\" style={{ marginLeft: '10px' }}>filter</span>\n                <Select onChange={this.onFilterChange2.bind(this)}\n                    defaultValue={this.props.filter}\n                    style={{ width: '16em' }}\n                    dropdownMatchSelectWidth={true}>\n                    <Select.Option value=\"all\" key=\"all\">All</Select.Option>\n                    <Select.Option value=\"memberOf\" key=\"memberOf\">You are a member of</Select.Option>\n                    <Select.Option value=\"owned\" key=\"owned\">Owned by you</Select.Option>\n                    <Select.Option value=\"notOwned\" key=\"notOwned\">Not owned by you</Select.Option>\n                    {/* <Select.Option value=\"pending\" key=\"pending\">Pending request or invitation</Select.Option>\n                    <Select.Option value=\"groupPending\" key=\"groupPending\">Pending group requests</Select.Option> */}\n                </Select>\n            </div>\n        )\n    }\n\n    renderOrganizations() {\n        if (this.props.error) {\n            return (\n                <Alert\n                    type=\"error\"\n                    message={this.props.error.code}\n                    description={this.props.error.message} />\n            )\n        } else {\n            return (\n                <Organizations />\n            )\n        }\n    }\n\n    render() {\n        return (\n            <div className=\"OrganizationsBrowser scrollable-flex-column\">\n                {this.renderHeader()}\n                <div className=\"searchBarRow\">\n                    <div className=\"searchBarCol\">\n                        {this.renderSearchBar()}\n                    </div>\n                    <div className=\"sortCol\">\n                        {this.renderSearchFilter()}\n                    </div>\n                </div>\n                <div className=\"bodyRow scrollable-flex-column\">\n\n                    <div className=\"col2 scrollable-flex-column\">\n                        {this.renderOrganizations()}\n                    </div>\n                    {/* <div className=\"col1\">\n                        {this.renderControlArea()}\n                    </div> */}\n                </div>\n            </div>\n        )\n    }\n}\n\nexport default OrganizationsBrowser","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\n\nimport { ActionFlag } from './index'\nimport {\n    StoreState,\n    AppError, SortDirection, BrowseOrgsViewModel\n} from '../../types'\n\nimport * as orgModel from '../../data/models/organization/model'\nimport * as uberModel from '../../data/models/uber'\n\n\nexport interface Load extends Action<ActionFlag.BROWSE_ORGS_LOAD> {\n    type: ActionFlag.BROWSE_ORGS_LOAD\n}\n\nexport interface LoadStart extends Action<ActionFlag.BROWSE_ORGS_LOAD_START> {\n    type: ActionFlag.BROWSE_ORGS_LOAD_START\n}\n\nexport interface LoadSuccess extends Action<ActionFlag.BROWSE_ORGS_LOAD_SUCCESS> {\n    type: ActionFlag.BROWSE_ORGS_LOAD_SUCCESS\n    defaultViewModel: BrowseOrgsViewModel\n}\n\nexport interface LoadError extends Action<ActionFlag.BROWSE_ORGS_LOAD_ERROR> {\n    type: ActionFlag.BROWSE_ORGS_LOAD_ERROR\n    error: AppError\n}\n\nexport interface Unload extends Action<ActionFlag.BROWSE_ORGS_UNLOAD> {\n    type: ActionFlag.BROWSE_ORGS_UNLOAD\n}\n\nfunction loadStart(): LoadStart {\n    return {\n        type: ActionFlag.BROWSE_ORGS_LOAD_START\n    }\n}\n\nfunction loadSuccess(defaultViewModel: BrowseOrgsViewModel): LoadSuccess {\n    return {\n        type: ActionFlag.BROWSE_ORGS_LOAD_SUCCESS,\n        defaultViewModel: defaultViewModel\n    }\n}\n\nfunction loadError(error: AppError): LoadError {\n    return {\n        type: ActionFlag.BROWSE_ORGS_LOAD_ERROR,\n        error: error\n    }\n}\n\nexport function unload(): Unload {\n    return {\n        type: ActionFlag.BROWSE_ORGS_UNLOAD\n    }\n}\n\n// SORTING\n\nexport interface SortOrgs extends Action<ActionFlag.BROWSE_ORGS_SORT> {\n    type: ActionFlag.BROWSE_ORGS_SORT,\n    sortBy: string,\n    sortDirection: SortDirection\n}\n\nexport interface SortOrgsStart extends Action<ActionFlag.BROWSE_ORGS_SORT_START> {\n    type: ActionFlag.BROWSE_ORGS_SORT_START,\n    sortBy: string,\n    sortDirection: SortDirection\n}\n\nexport interface SortOrgsSuccess extends Action<ActionFlag.BROWSE_ORGS_SORT_SUCCESS> {\n    type: ActionFlag.BROWSE_ORGS_SORT_SUCCESS\n}\n\nexport interface SortOrgsError extends Action<ActionFlag.BROWSE_ORGS_SORT_ERROR> {\n    type: ActionFlag.BROWSE_ORGS_SORT_ERROR,\n    error: AppError\n}\n\n\nexport function sortOrgsStart(sortBy: string, sortDirection: SortDirection): SortOrgsStart {\n    return {\n        type: ActionFlag.BROWSE_ORGS_SORT_START,\n        sortBy: sortBy,\n        sortDirection: sortDirection\n    }\n}\n\n// SEARCHING\n\nexport interface SearchOrgs extends Action<ActionFlag.BROWSE_ORGS_SEARCH> {\n    type: ActionFlag.BROWSE_ORGS_SEARCH,\n    searchTerms: Array<string>\n}\n\n// Called upon the start of a search call\n// Sets the ui state to enable a spinner\n// and also search query data to be reflected in the ui\nexport interface SearchOrgs extends Action<ActionFlag.BROWSE_ORGS_SEARCH> {\n    type: ActionFlag.BROWSE_ORGS_SEARCH,\n    searchTerms: Array<string>\n}\n\nexport interface SearchOrgsStart extends Action<ActionFlag.BROWSE_ORGS_SEARCH_START> {\n    type: ActionFlag.BROWSE_ORGS_SEARCH_START\n}\n\n// Called upon successful completion of a search\n// Sets the organizations found\nexport interface SearchOrgsSuccess extends Action<ActionFlag.BROWSE_ORGS_SEARCH_SUCCESS> {\n    type: ActionFlag.BROWSE_ORGS_SEARCH_SUCCESS,\n    organizations: Array<orgModel.Organization>,\n    totalCount: number\n}\n\n// Called upon a search error\n// Sets error state\nexport interface SearchOrgsError extends Action<ActionFlag.BROWSE_ORGS_SEARCH_ERROR> {\n    type: ActionFlag.BROWSE_ORGS_SEARCH_ERROR,\n    error: AppError\n}\n\n\n// searchTerms: Array<string>\nfunction searchOrgsStart(): SearchOrgsStart {\n    return {\n        type: ActionFlag.BROWSE_ORGS_SEARCH_START\n    }\n}\n\nfunction searchOrgsSuccess(organizations: Array<orgModel.Organization>, totalCount: number): SearchOrgsSuccess {\n    return {\n        type: ActionFlag.BROWSE_ORGS_SEARCH_SUCCESS,\n        organizations: organizations,\n        totalCount: totalCount\n    }\n}\n\nfunction searchOrgsError(error: AppError): SearchOrgsError {\n    return {\n        type: ActionFlag.BROWSE_ORGS_SEARCH_ERROR,\n        error: error\n    }\n}\n\n// FILTER \n\n// Filter orgs\nexport interface FilterOrgs extends Action<ActionFlag.BROWSE_ORGS_FILTER> {\n    type: ActionFlag.BROWSE_ORGS_FILTER,\n    filter: string\n}\n\nexport interface FilterOrgsStart extends Action<ActionFlag.BROWSE_ORGS_FILTER_START> {\n    type: ActionFlag.BROWSE_ORGS_FILTER_START,\n    filter: string\n}\n\n\nexport function filterOrgsStart(filter: string): FilterOrgsStart {\n    return {\n        type: ActionFlag.BROWSE_ORGS_FILTER_START,\n        filter: filter\n    }\n}\n\nexport function load() {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(loadStart())\n\n        // populate default browse orgs props\n        const defaultViewModel: BrowseOrgsViewModel = {\n            rawOrganizations: [],\n            organizations: [],\n            totalCount: 0,\n            filteredCount: 0,\n            sortBy: 'name',\n            sortDirection: SortDirection.ASCENDING,\n            filter: 'all',\n            searchTerms: [],\n            selectedOrganizationId: null,\n            searching: false,\n            error: null\n        }\n        // done!\n        dispatch(loadSuccess(defaultViewModel))\n    }\n}\n\n\n\n// TODO: proper typing here \nexport function searchOrgs(searchTerms: Array<string>) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(searchOrgsStart())\n\n        const {\n            views: { browseOrgsView },\n            auth: { authorization: { token, username } },\n            app: { config }\n        } = getState()\n\n        if (browseOrgsView.viewModel === null) {\n            dispatch(searchOrgsError({\n                code: 'invalid-state',\n                message: 'Search orgs may not be called without a defined view'\n            }))\n            return\n        }\n\n        const { viewModel: { sortBy, sortDirection, filter } } = browseOrgsView\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        return orgClient.queryOrgs({\n            searchTerms: searchTerms,\n            sortBy, sortDirection, filter, username\n        })\n            .then(({ organizations, total }) => {\n                // TODO: also total.\n                dispatch(searchOrgsSuccess(organizations, total))\n            })\n            .catch((error) => {\n                console.error('Error querying orgs', error.name, error.message)\n                dispatch(searchOrgsError({\n                    code: error.name,\n                    message: error.message\n                }))\n            })\n    }\n}\n\nexport function sortOrgs(sortBy: string, sortDirection: SortDirection) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(sortOrgsStart(sortBy, sortDirection))\n\n        const {\n            views: { browseOrgsView },\n            auth: { authorization: { token, username } },\n            app: { config } } = getState()\n\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        if (browseOrgsView.viewModel === null) {\n            dispatch(searchOrgsError({\n                code: 'invalid-state',\n                message: 'Search orgs may not be called without a defined view'\n            }))\n            return\n        }\n\n        const { viewModel: { searchTerms, filter } } = browseOrgsView\n\n        return orgClient.queryOrgs({\n            searchTerms,\n            sortBy, sortDirection, filter, username\n        })\n            .then(({ organizations, total }) => {\n                // TODO: also total.\n                dispatch(searchOrgsSuccess(organizations, total))\n            })\n            .catch((error) => {\n                dispatch(searchOrgsError({\n                    code: error.name,\n                    message: error.message\n                }))\n            })\n    }\n}\n\nexport function filterOrgs(filter: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(filterOrgsStart(filter))\n\n        const {\n            views: { browseOrgsView },\n            auth: { authorization: { token, username } },\n            app: { config } } = getState()\n\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        if (browseOrgsView.viewModel === null) {\n            dispatch(searchOrgsError({\n                code: 'invalid-state',\n                message: 'Search orgs may not be called without a defined view'\n            }))\n            return\n        }\n\n        const { viewModel: { searchTerms, sortBy, sortDirection } } = browseOrgsView\n\n        return orgClient.queryOrgs({\n            searchTerms,\n            sortBy, sortDirection, filter, username\n        })\n            .then(({ organizations, total }) => {\n                // TODO: also total.\n                dispatch(searchOrgsSuccess(organizations, total))\n            })\n            .catch((error) => {\n                dispatch(searchOrgsError({\n                    code: error.name,\n                    message: error.message\n                }))\n            })\n    }\n}\n\n\n\n\n\n","import OrganizationsBrowser from './component'\nimport { StoreState, SortDirection, BrowseOrgsState, AppError } from '../../../types'\nimport * as actions from '../../../redux/actions/browseOrgs'\nimport { Dispatch } from 'redux'\nimport { connect } from 'react-redux'\nimport * as orgModel from '../../../data/models/organization/model'\n//\n// Typing for the mapState and mapDispatch\n//\nexport interface LinkStateProps {\n    organizations: Array<orgModel.Organization>\n    totalCount: number\n    filteredCount: number\n    sortBy: string\n    sortDirection: SortDirection\n    filter: string\n    searching: boolean,\n    error: AppError | null\n}\n\nexport interface LinkDispatchProps {\n    onSearchOrgs: (searchTerms: Array<string>) => void,\n    onSortOrgs: (sortBy: string, sortDirection: SortDirection) => void,\n    onFilterOrgs: (filter: string) => void\n}\n\n// note second arg is the component props, but we don't have any component props to merge in.\nexport function mapStateToProps(storeState: StoreState): LinkStateProps {\n    if (!storeState.views.browseOrgsView.viewModel) {\n        throw new Error('No view model!')\n    }\n\n    const {\n        views: {\n            browseOrgsView: {\n                viewModel: {\n                    organizations, error, searchTerms, selectedOrganizationId,\n                    totalCount, filteredCount, sortBy, sortDirection, filter, searching }\n            }\n        }\n    } = storeState\n\n    return {\n        organizations,\n        totalCount,\n        filteredCount,\n        sortBy,\n        sortDirection,\n        filter,\n        error,\n        searching: searching\n    }\n\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<actions.SearchOrgs | actions.SortOrgs | actions.FilterOrgs>): LinkDispatchProps {\n    return {\n        onSearchOrgs: (searchTerms: Array<string>) => {\n            // TODO proper typing here\n            dispatch(actions.searchOrgs(searchTerms) as any)\n        },\n        onSortOrgs: (sortBy: string, sortDirection: SortDirection) => {\n            // TODO proper typing here\n            dispatch(actions.sortOrgs(sortBy, sortDirection) as any)\n        },\n        onFilterOrgs: (filter: string) => {\n            dispatch(actions.filterOrgs(filter) as any)\n        }\n    }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(OrganizationsBrowser)","import * as React from 'react'\nimport { ComponentLoadingState, StoreState, BrowseOrgsView } from '../../../types';\nimport Container from './container'\n\n// First the loader component, which takes care of a loading view, error view, and the \n// container.\n\nexport interface LoaderProps {\n    view: BrowseOrgsView\n    onLoad: () => void\n    onUnload: () => void\n}\n\ninterface LoaderState {\n\n}\n\nclass Loader extends React.Component<LoaderProps, LoaderState> {\n    constructor(props: LoaderProps) {\n        super(props)\n    }\n\n    renderLoading() {\n        return (\n            <div>\n                Fetching your orgs and other stuff...\n            </div>\n        )\n    }\n\n    renderError() {\n        if (!this.props.view.error) {\n            return\n        }\n        return (\n            <div>\n                Error! {this.props.view.error.message}\n            </div>\n        )\n    }\n\n    render() {\n        switch (this.props.view.loadingState) {\n            case ComponentLoadingState.NONE:\n                // should only appear briefly as the LOAD event is processed.\n                this.props.onLoad()\n                return this.renderLoading()\n            case ComponentLoadingState.LOADING:\n                return this.renderLoading()\n            case ComponentLoadingState.ERROR:\n                return this.renderError()\n            case ComponentLoadingState.SUCCESS:\n                return (\n                    <Container />\n                )\n        }\n    }\n\n    componentWillUnmount() {\n        this.props.onUnload()\n    }\n}\n\n// THe redux connection\n\nimport { Dispatch, Action } from 'redux'\nimport { connect } from 'react-redux'\n\nimport * as actions from '../../../redux/actions/browseOrgs'\n\nexport interface OwnProps {\n\n}\n\ninterface StateProps {\n    view: BrowseOrgsView\n}\n\ninterface DispatchProps {\n    onLoad: () => void\n    onUnload: () => void\n}\n\nfunction mapStateToProps(state: StoreState, props: OwnProps): StateProps {\n    return {\n        view: state.views.browseOrgsView\n    }\n}\n\nfunction mapDispatchToProps(dispatch: Dispatch<Action>): DispatchProps {\n    return {\n        onLoad: () => {\n            dispatch(actions.load() as any)\n        },\n        onUnload: () => {\n            dispatch(actions.unload() as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(Loader)","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\n\nimport { ActionFlag } from './index'\nimport { StoreState, AppError, UIError, UIErrorType, EditableOrganization, EditState, ValidationState } from '../../types'\n\nimport * as orgModel from '../../data/models/organization/model'\nimport Validation from '../../data/models/organization/validation'\n\n// ACTIONS\n\nexport interface Save extends Action<ActionFlag.ADD_ORG_SAVE> {\n    type: ActionFlag.ADD_ORG_SAVE\n}\n\nexport interface SaveStart extends Action<ActionFlag.ADD_ORG_SAVE_START> {\n    type: ActionFlag.ADD_ORG_SAVE_START\n}\n\nexport interface SaveSuccess extends Action<ActionFlag.ADD_ORG_SAVE_SUCCESS> {\n    type: ActionFlag.ADD_ORG_SAVE_SUCCESS,\n    organization: orgModel.Organization\n}\n\nexport interface SaveError extends Action<ActionFlag.ADD_ORG_SAVE_ERROR> {\n    type: ActionFlag.ADD_ORG_SAVE_ERROR,\n    error: AppError\n}\n\n// Editing\n\nexport interface Load extends Action<ActionFlag.ADD_ORG_LOAD> {\n    type: ActionFlag.ADD_ORG_LOAD;\n}\n\nexport interface LoadStart {\n    type: ActionFlag.ADD_ORG_LOAD_START\n}\n\nexport interface LoadSuccess {\n    type: ActionFlag.ADD_ORG_LOAD_SUCCESS,\n    newOrganization: EditableOrganization\n}\n\nexport interface LoadError {\n    type: ActionFlag.ADD_ORG_LOAD_ERROR,\n    error: AppError\n}\n\nexport interface Unload {\n    type: ActionFlag.ADD_ORG_UNLOAD\n}\n\n// Evaluating state of form \n\nexport interface AddOrgEvaluate extends Action<ActionFlag.ADD_ORG_EVALUATE> {\n    type: ActionFlag.ADD_ORG_EVALUATE\n}\n\nexport interface AddOrgEvaluateOK extends Action<ActionFlag.ADD_ORG_EVALUATE_OK> {\n    type: ActionFlag.ADD_ORG_EVALUATE_OK\n}\n\nexport interface AddOrgEvaluateErrors extends Action<ActionFlag.ADD_ORG_EVALUATE_ERRORS> {\n    type: ActionFlag.ADD_ORG_EVALUATE_ERRORS\n}\n\n// Updating name field\n\nexport interface UpdateName extends Action {\n    type: ActionFlag.ADD_ORG_UPDATE_NAME,\n    name: string\n}\n\nexport interface UpdateNameSuccess {\n    type: ActionFlag.ADD_ORG_UPDATE_NAME_SUCCESS,\n    name: string\n}\n\nexport interface UpdateNameError extends Action {\n    type: ActionFlag.ADD_ORG_UPDATE_NAME_ERROR,\n    name: string,\n    error: UIError\n}\n\n// Updating gravatar hash field\n\nexport interface UpdateGravatarHash extends Action {\n    type: ActionFlag.ADD_ORG_UPDATE_GRAVATAR_HASH,\n    name: string\n}\n\nexport interface UpdateGravatarHashSuccess {\n    type: ActionFlag.ADD_ORG_UPDATE_GRAVATAR_HASH_SUCCESS,\n    gravatarHash: string\n}\n\nexport interface UpdateGravatarHashError extends Action {\n    type: ActionFlag.ADD_ORG_UPDATE_GRAVATAR_HASH_ERROR,\n    gravatarHash: string,\n    error: UIError\n}\n\n// Updating id Field\n\nexport interface UpdateId extends Action {\n    type: ActionFlag.ADD_ORG_UPDATE_ID,\n    id: string\n}\n\nexport interface UpdateIdSuccess {\n    type: ActionFlag.ADD_ORG_UPDATE_ID_SUCCESS,\n    id: string\n}\n\nexport interface UpdateIdError extends Action {\n    type: ActionFlag.ADD_ORG_UPDATE_ID_ERROR,\n    id: string,\n    error: UIError\n}\n\nexport interface UpdateIdPass extends Action {\n    type: ActionFlag.ADD_ORG_UPDATE_ID_PASS,\n    id: string\n}\n\n// Updating description field\n\nexport interface UpdateDescription extends Action {\n    type: ActionFlag.ADD_ORG_UPDATE_DESCRIPTION,\n    description: string\n}\n\nexport interface UpdateDescriptionSuccess {\n    type: ActionFlag.ADD_ORG_UPDATE_DESCRIPTION_SUCCESS,\n    description: string\n}\n\nexport interface UpdateDescriptionError extends Action {\n    type: ActionFlag.ADD_ORG_UPDATE_DESCRIPTION_ERROR,\n    description: string,\n    error: UIError\n}\n\n// Update is private field\n\nexport interface UpdateIsPrivate extends Action<ActionFlag.ADD_ORG_UPDATE_IS_PRIVATE> {\n    type: ActionFlag.ADD_ORG_UPDATE_IS_PRIVATE\n    isPrivate: boolean\n}\n\nexport interface UpdateIsPrivateSuccess extends Action<ActionFlag.ADD_ORG_UPDATE_IS_PRIVATE_SUCCESS> {\n    type: ActionFlag.ADD_ORG_UPDATE_IS_PRIVATE_SUCCESS,\n    isPrivate: boolean\n}\n\nexport interface UpdateIsPrivateError extends Action<ActionFlag.ADD_ORG_UPDATE_IS_PRIVATE_ERROR> {\n    type: ActionFlag.ADD_ORG_UPDATE_IS_PRIVATE_ERROR,\n    error: UIError\n}\n\n\n// ACTION CREATORS\n\nexport function saveStart(): SaveStart {\n    return {\n        type: ActionFlag.ADD_ORG_SAVE_START\n    }\n}\n\nexport function saveSuccess(org: orgModel.Organization): SaveSuccess {\n    return {\n        type: ActionFlag.ADD_ORG_SAVE_SUCCESS,\n        organization: org\n    }\n}\n\nexport function saveError(error: AppError): SaveError {\n    return {\n        type: ActionFlag.ADD_ORG_SAVE_ERROR,\n        error: error\n    }\n}\n\n// Eiditing\n\nfunction loadStart() {\n    return {\n        type: ActionFlag.ADD_ORG_LOAD_START\n    }\n}\n\nfunction loadSuccess(newOrganization: EditableOrganization) {\n    return {\n        type: ActionFlag.ADD_ORG_LOAD_SUCCESS,\n        newOrganization: newOrganization\n    }\n}\n\nfunction loadError(error: AppError) {\n    return {\n        type: ActionFlag.ADD_ORG_LOAD_ERROR,\n        error: error\n    }\n}\n\nexport function unload() {\n    return {\n        type: ActionFlag.ADD_ORG_UNLOAD\n    }\n}\n\n// Evaluate\n\nexport function addOrgEvaluateOk(): AddOrgEvaluateOK {\n    return {\n        type: ActionFlag.ADD_ORG_EVALUATE_OK\n    }\n}\n\nexport function AddOrgEvaluateErrors(): AddOrgEvaluateErrors {\n    return {\n        type: ActionFlag.ADD_ORG_EVALUATE_ERRORS\n    }\n}\n\n// Update Name\n\nexport function updateNameSuccess(name: string): UpdateNameSuccess {\n    return {\n        type: ActionFlag.ADD_ORG_UPDATE_NAME_SUCCESS,\n        name: name\n    }\n}\n\nexport function updateNameError(name: string, error: UIError): UpdateNameError {\n    return {\n        type: ActionFlag.ADD_ORG_UPDATE_NAME_ERROR,\n        name: name,\n        error: error\n    }\n}\n\nexport function updateIdSuccess(id: string): UpdateIdSuccess {\n    return {\n        type: ActionFlag.ADD_ORG_UPDATE_ID_SUCCESS,\n        id: id\n    }\n}\n\nexport function updateIdPass(id: string): UpdateIdPass {\n    return {\n        type: ActionFlag.ADD_ORG_UPDATE_ID_PASS,\n        id: id\n    }\n}\n\n// Update Gravatar Hash\n\nexport function updateGravatarHashSuccess(gravatarHash: string): UpdateGravatarHashSuccess {\n    return {\n        type: ActionFlag.ADD_ORG_UPDATE_GRAVATAR_HASH_SUCCESS,\n        gravatarHash: gravatarHash\n    }\n}\n\nexport function updateGravatarHashError(gravatarHash: string, error: UIError): UpdateGravatarHashError {\n    return {\n        type: ActionFlag.ADD_ORG_UPDATE_GRAVATAR_HASH_ERROR,\n        gravatarHash: gravatarHash,\n        error: error\n    }\n}\n\n\n// Update Id\n\nexport function updateIdError(id: string, error: UIError): UpdateIdError {\n    return {\n        type: ActionFlag.ADD_ORG_UPDATE_ID_ERROR,\n        id: id,\n        error: error\n    }\n}\n\nexport function updateDescriptionSuccess(description: string): UpdateDescriptionSuccess {\n    return {\n        type: ActionFlag.ADD_ORG_UPDATE_DESCRIPTION_SUCCESS,\n        description: description\n    }\n}\n\nexport function updateDescriptionError(description: string, error: UIError): UpdateDescriptionError {\n    return {\n        type: ActionFlag.ADD_ORG_UPDATE_DESCRIPTION_ERROR,\n        description: description,\n        error: error\n    }\n}\n\n// ACTION THUNKS\n\nexport function load() {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(loadStart())\n\n        const newOrg: EditableOrganization = {\n            id: {\n                value: '',\n                editState: EditState.NONE,\n                validationState: ValidationState.NONE,\n                validatedAt: null,\n                error: {\n                    type: UIErrorType.NONE\n                }\n            },\n            name: {\n                value: '',\n                editState: EditState.NONE,\n                validationState: ValidationState.NONE,\n                validatedAt: null,\n                error: {\n                    type: UIErrorType.NONE\n                }\n            },\n            gravatarHash: {\n                value: '',\n                editState: EditState.NONE,\n                validationState: ValidationState.NONE,\n                validatedAt: null,\n                error: {\n                    type: UIErrorType.NONE\n                }\n            },\n            description: {\n                value: '',\n                editState: EditState.NONE,\n                validationState: ValidationState.NONE,\n                validatedAt: null,\n                error: {\n                    type: UIErrorType.NONE\n                }\n            },\n            isPrivate: {\n                value: false,\n                editState: EditState.NONE,\n                validationState: ValidationState.NONE,\n                validatedAt: null,\n                error: {\n                    type: UIErrorType.NONE\n                }\n            }\n        }\n        dispatch(loadSuccess(newOrg))\n        dispatch(addOrgEvaluate())\n    }\n}\n\nexport function addOrg() {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        const state = getState()\n\n        // This check is to satisfy TS. Since viewModel is nullable, it has no way \n        // of knowing that our app flow ensures that it is populated.\n        // In terms of generalized usage of the redux store, though, there is no\n        // way to ensure this! So we really should perform our state checks before \n        // handling any event\n        if (!state.views.addOrgView.viewModel) {\n            dispatch(saveError({\n                code: 'invalid',\n                message: 'Unexpected condition: no view model'\n            }))\n            return\n        }\n\n        // TODO: other validations!!!\n\n        dispatch(saveStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            views: {\n                addOrgView: { viewModel: { newOrganization } },\n            },\n            app: { config }\n        } = state\n\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        if (!newOrganization) {\n            dispatch(saveError({\n                code: 'app',\n                message: 'The new organization data does not yet exist'\n            }))\n            return;\n        }\n\n        orgClient.addOrg(newOrganization, username)\n            .then((org: orgModel.Organization) => {\n                dispatch(saveSuccess(org))\n            })\n            .catch((error) => {\n                console.error('error adding', newOrganization, error)\n\n                // note that we dispatch an AppError compliant object,\n                // which wraps the original exception object.\n                dispatch(saveError({\n                    code: error.code || error.name,\n                    message: error.message,\n                    exception: error\n                }))\n            })\n    }\n}\n\nexport function addOrgEvaluate() {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        const state = getState()\n        if (!state.views.addOrgView.viewModel) {\n            dispatch(saveError({\n                code: 'invalid',\n                message: 'Unexpected condition: no view model'\n            }))\n            return\n        }\n\n\n        const {\n            views: {\n                addOrgView: {\n                    viewModel: { editState, newOrganization } }\n            }\n        } = state\n\n        if (!newOrganization) {\n            dispatch(AddOrgEvaluateErrors())\n            return\n        }\n\n        if (newOrganization.name.validationState !== ValidationState.VALID) {\n            dispatch(AddOrgEvaluateErrors())\n            return\n        }\n\n        if (newOrganization.id.validationState !== ValidationState.VALID) {\n            dispatch(AddOrgEvaluateErrors())\n            return\n        }\n\n        if (newOrganization.gravatarHash.validationState !== ValidationState.VALID) {\n            dispatch(AddOrgEvaluateErrors())\n            return\n        }\n\n        if (newOrganization.description.validationState !== ValidationState.VALID) {\n            dispatch(AddOrgEvaluateErrors())\n            return\n        }\n\n        if (newOrganization.isPrivate.validationState !== ValidationState.VALID) {\n            dispatch(AddOrgEvaluateErrors())\n            return\n        }\n\n        dispatch(addOrgEvaluateOk())\n    }\n}\n\nfunction orgModelFromState(state: StoreState) {\n    const {\n        auth: { authorization: { token, username } },\n        app: { config } } = state\n    return new orgModel.OrganizationModel({\n        token, username,\n        groupsServiceURL: config.services.Groups.url\n    })\n}\n\nexport function updateName(name: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>) => {\n        const [validatedName, error] = Validation.validateOrgName(name)\n\n        if (error.type === UIErrorType.ERROR) {\n            dispatch(updateNameError(validatedName, error))\n        } else {\n            dispatch(updateNameSuccess(validatedName))\n        }\n        dispatch(addOrgEvaluate())\n    }\n}\n\nexport function updateGravatarHash(name: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>) => {\n        const [validateGravatarHash, error] = Validation.validateOrgGravatarHash(name)\n\n        if (error.type === UIErrorType.ERROR) {\n            dispatch(updateGravatarHashError(validateGravatarHash, error))\n        } else {\n            dispatch(updateGravatarHashSuccess(validateGravatarHash))\n        }\n        dispatch(addOrgEvaluate())\n    }\n}\n\nexport function updateIsPrivate(isPrivate: boolean) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>) => {\n        // no validation for now ... what is there to validate?\n\n        dispatch({\n            type: ActionFlag.ADD_ORG_UPDATE_IS_PRIVATE_SUCCESS,\n            isPrivate\n        })\n        dispatch(addOrgEvaluate())\n    }\n}\n\nclass Debouncer {\n\n    delay: number\n    fun: () => void\n    canceled: boolean\n    timer: number | null\n\n    constructor(delay: number, fun: () => void) {\n        this.delay = delay\n        this.fun = fun\n        this.canceled = false\n        this.timer = null\n        this.startWaiting()\n    }\n\n    startWaiting() {\n        if (this.timer) {\n            window.clearTimeout(this.timer)\n        }\n        this.timer = window.setTimeout(() => {\n            this.fun()\n        }, this.delay)\n    }\n\n    cancel() {\n        this.canceled = true\n    }\n}\n\nlet activeDebouncer: Debouncer | null = null\n\nexport function updateId(id: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        const [validatedId, error] = Validation.validateOrgId(id)\n        if (error.type === UIErrorType.ERROR) {\n            dispatch(updateIdError(validatedId, error))\n            dispatch(addOrgEvaluate())\n            return\n        }\n\n        const {\n            views: {\n                addOrgView: { viewModel }\n            }\n        } = getState()\n\n        if (!viewModel) {\n            // do nothing\n            return\n        }\n\n        const lastValidatedAt = viewModel.newOrganization.id.validatedAt\n        const now = new Date().getTime()\n        const debounce = 500 // ms\n        if (lastValidatedAt) {\n\n            const elapsed = now - lastValidatedAt.getTime()\n            if (elapsed < debounce) {\n                dispatch(updateIdPass(validatedId))\n                if (!activeDebouncer) {\n                    activeDebouncer = new Debouncer(500, () => {\n                        dispatch(evaluateId())\n                    })\n                }\n                return\n            }\n        }\n\n        if (activeDebouncer) {\n            activeDebouncer.cancel()\n        }\n        activeDebouncer = null\n\n\n        const model = orgModelFromState(getState())\n        model.orgExists(validatedId)\n            .then((exists) => {\n                if (exists) {\n                    dispatch(updateIdError(validatedId, {\n                        type: UIErrorType.ERROR,\n                        message: 'This org id is already in use'\n                    }))\n                } else {\n                    dispatch(updateIdSuccess(validatedId))\n                }\n\n                dispatch(addOrgEvaluate())\n            })\n    }\n}\n\nexport function evaluateId() {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n\n        const {\n            views: {\n                addOrgView: { viewModel }\n            }\n        } = getState()\n        if (!viewModel) {\n            // do nothing\n            return\n        }\n\n        const id = viewModel.newOrganization.id\n\n        const [validatedId, error] = Validation.validateOrgId(id.value)\n        if (error.type === UIErrorType.ERROR) {\n            dispatch(updateIdError(validatedId, error))\n            dispatch(addOrgEvaluate())\n            return\n        }\n\n        const model = orgModelFromState(getState())\n        model.orgExists(validatedId)\n            .then((exists) => {\n                if (exists) {\n                    dispatch(updateIdError(validatedId, {\n                        type: UIErrorType.ERROR,\n                        message: 'This org id is already in use'\n                    }))\n                } else {\n                    dispatch(updateIdSuccess(validatedId))\n                }\n\n                dispatch(addOrgEvaluate())\n            })\n    }\n}\n\nexport function updateDescription(description: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        const model = orgModelFromState(getState())\n\n        const [validatedDescription, error] = model.validateOrgDescription(description)\n\n        if (error.type === UIErrorType.ERROR) {\n            dispatch(updateDescriptionError(validatedDescription, error))\n        } else {\n            dispatch(updateDescriptionSuccess(validatedDescription))\n        }\n        dispatch(addOrgEvaluate())\n    }\n}","import * as React from 'react'\nimport { Redirect } from 'react-router-dom';\nimport marked from 'marked';\nimport { Button, Icon, Modal, Input, Checkbox } from 'antd';\nimport md5 from 'md5'\n\nimport { EditableOrganization, SaveState, ValidationState, EditState, AppError } from '../../../types';\n\nimport './component.css'\n\nimport Header from '../../Header';\nimport { CheckboxChangeEvent } from 'antd/lib/checkbox';\n\nexport interface NewOrganizationProps {\n    editState: EditState,\n    saveState: SaveState,\n    validationState: ValidationState,\n    error: AppError | null,\n    newOrganization: EditableOrganization,\n    onSave: () => void,\n    onUpdateName: (name: string) => void,\n    onUpdateGravatarHash: (gravatarHash: string) => void;\n    onUpdateId: (id: string) => void,\n    onUpdateDescription: (description: string) => void\n    onUpdateIsPrivate: (isPrivate: boolean) => void\n}\n\n\nexport interface NewOrganizationState {\n    cancelToBrowser: boolean\n    showError: boolean\n}\n\nclass NewOrganization extends React.Component<NewOrganizationProps, NewOrganizationState> {\n\n    origin: string;\n    gravatarEmail: React.RefObject<HTMLInputElement>\n\n    // idDebounceTime: number | null\n\n    constructor(props: NewOrganizationProps) {\n        super(props)\n\n        this.state = {\n            cancelToBrowser: false,\n            showError: true\n        }\n\n        this.gravatarEmail = React.createRef()\n\n        this.origin = document.location!.origin\n\n        // this.idDebounceTime = null\n    }\n\n    onShowInfo() {\n        Modal.info({\n            title: 'New Organization Help',\n            width: '50em',\n            content: (\n                <div>\n                    <p>\n                        As a KBase user, you may create your own organizations.\n                    </p>\n                    <p>\n                        Once you have created an Organization, you will be the sole owner of it, forever.\n                    </p>\n                    <p>\n                        In order to create an Org, you need to complete the following fields.\n                    </p>\n                    <dl>\n                        <dt>\n                            name\n                        </dt>\n                        <dd>\n                            The organization <i>name</i> is whatever you wish to have your Org known as. It may be\n                            composed of any text (including unicode characters) up to 200 characters in length. You\n                            may also change it at any time.\n                        </dd>\n                        <dt>\n                            gravatar\n                        </dt>\n                        <dd>\n                            You should associate your Organization with an avatar hosted with the Gravatar service. To do so,\n                            simply enter the email address associated with your gravatar into the first\n                        </dd>\n                        <dt>\n                            id\n                        </dt>\n                        <dd>\n                            <p>\n                                Your Org <i>id</i> forms a url endpoint for your org as well as the identifier used throughout\n                            KBase to, well, identify your organization uniquely among all current and future organizations.\n                            As such, the Org ID may not be changed once created.\n                            </p>\n                            <p>\n                                The id may only be composed of the restricted characters a-Z, A-Z, 0-9 and _, and is also\n                                restricted to 100 characters in length.\n                            </p>\n\n                        </dd>\n                        <dt>\n                            description\n                        </dt>\n                        <dd>\n                            <p>\n                                Up to 4000 characters, a description allows you to express to other KBase users the purpose,\n                            history, associations, and science domain of your Org.</p>\n                            <p>\n                                The description is in \"markdown\" format, and the editor will show you a preview of the\n                                rendered description.\n                            </p>\n                        </dd>\n                    </dl>\n                </div>\n            )\n        })\n    }\n\n    onGravatarEmailSync() {\n        let email;\n        if (this.gravatarEmail.current) {\n            email = this.gravatarEmail.current.value\n        } else {\n            email = 'n/a'\n        }\n        const hashed = md5(email)\n        this.props.onUpdateGravatarHash(hashed);\n    }\n\n    onClickCancelToBrowser() {\n        if (!this.isModified()) {\n            this.setState({ cancelToBrowser: true })\n            return\n        }\n\n        const confirm = () => {\n            this.setState({ cancelToBrowser: true })\n        }\n        const cancel = () => {\n        }\n        Modal.confirm({\n            title: 'Leave the editor?',\n            content: (\n                <div>\n                    <p>You have entered information for this new organization.</p>\n\n                    <p>If you leave the editor without first saving, the new organization <i>will not be created</i>.</p>\n\n                    <p><b>Continue to leave the editor?</b></p>\n                </div>\n            ),\n            onOk: confirm,\n            onCancel: cancel,\n            okText: 'Yes',\n            cancelText: 'No'\n        })\n    }\n\n    onSubmit(e: React.FormEvent<HTMLFormElement>) {\n        e.preventDefault();\n        this.props.onSave();\n    }\n\n    onNameChange(e: React.ChangeEvent<HTMLInputElement>) {\n        e.persist();\n        this.props.onUpdateName(e.target.value);\n    }\n\n    onGravatarHashChange(e: React.ChangeEvent<HTMLInputElement>) {\n        e.persist();\n        this.props.onUpdateGravatarHash(e.target.value);\n    }\n\n    onDescriptionChange(e: React.ChangeEvent<HTMLTextAreaElement>): void {\n        e.persist()\n        this.props.onUpdateDescription(e.target.value);\n    }\n\n    onIdChange(e: React.ChangeEvent<HTMLInputElement>) {\n        e.persist()\n        this.props.onUpdateId(e.target.value)\n    }\n\n    onIsPrivateChange(e: CheckboxChangeEvent) {\n        this.props.onUpdateIsPrivate(e.target.checked)\n    }\n\n    canSave() {\n        return (\n            this.props.editState === EditState.EDITED &&\n            this.props.validationState === ValidationState.VALID &&\n            (this.props.saveState === SaveState.NEW ||\n                this.props.saveState === SaveState.READY ||\n                this.props.saveState === SaveState.SAVED)\n        )\n    }\n\n    isModified() {\n        return (\n            this.props.editState === EditState.EDITED &&\n            this.props.saveState === SaveState.NEW\n        )\n    }\n\n    renderForm() {\n        return (\n            <form id=\"newOrganizationForm\" className=\"editor\" onSubmit={this.onSubmit.bind(this)}>\n                <div className=\"row\">\n                    <div className=\"col1 field-label\">name</div>\n                    <div className=\"col2\">\n                        <Input value={this.props.newOrganization.name.value || ''}\n                            onChange={this.onNameChange.bind(this)} />\n                        {this.props.newOrganization.name.error ? (<span style={{ color: 'red' }}>{this.props.newOrganization.name.error.message}</span>) : ''}\n                    </div>\n                </div>\n                <div className=\"row\">\n                    <div className=\"col1 field-label\">is private?</div>\n                    <div className=\"col2\">\n                        <Checkbox\n                            checked={this.props.newOrganization.isPrivate.value}\n                            onChange={this.onIsPrivateChange.bind(this)} />\n                        {this.props.newOrganization.id.error ? (<span style={{ color: 'red' }}>{this.props.newOrganization.id.error.message}</span>) : ''}\n                    </div>\n                </div>\n                <div className=\"row gravatarHash\">\n                    <div className=\"col1 field-label\">gravatar hash</div>\n                    <div className=\"col2\">\n                        <div style={{ display: 'flex', flexDirection: 'row', marginBottom: '4px' }}>\n                            <div style={{ flex: '1 1 0px' }}>\n                                <input\n                                    ref={this.gravatarEmail}\n                                    placeholder=\"Provide your gravatar-linked email address, if any\" />\n                            </div>\n                            <div style={{ flex: '0 0 auto' }}>\n                                <Button\n                                    icon=\"arrow-down\"\n                                    style={{ height: '100%' }}\n                                    onClick={this.onGravatarEmailSync.bind(this)} />\n                            </div>\n                        </div>\n                        <Input\n                            value={this.props.newOrganization.gravatarHash.value || ''}\n                            onChange={this.onGravatarHashChange.bind(this)} />\n                        {this.props.newOrganization.gravatarHash.error ? (<span style={{ color: 'red' }}>{this.props.newOrganization.gravatarHash.error.message}</span>) : ''}\n                    </div>\n                </div>\n                <div className=\"row\">\n                    <div className=\"col1 field-label\">id</div>\n                    <div className=\"col2\">\n                        <Input\n                            value={this.props.newOrganization.id.value || ''}\n                            onChange={this.onIdChange.bind(this)} />\n                        {this.props.newOrganization.id.error ? (<span style={{ color: 'red' }}>{this.props.newOrganization.id.error.message}</span>) : ''}\n                    </div>\n                </div>\n                <div className=\"row\" style={{ flex: '1 1 0px', minHeight: '30em', maxHeight: '60em' }}>\n                    <div className=\"col1 field-label\">description</div>\n                    <div className=\"col2\">\n                        <textarea value={this.props.newOrganization.description.value || ''}\n                            onChange={this.onDescriptionChange.bind(this)} />\n                        {this.props.newOrganization.description.error ? (<div style={{ color: 'red' }}>{this.props.newOrganization.description.error.message}</div>) : ''}\n                    </div>\n                </div>\n                <div className=\"row\">\n                    <div className=\"col1\"></div>\n                    <div className=\"col2\">\n                        {/* <div className=\"footer\">\n                            <Button form=\"newOrganizationForm\"\n                                key=\"submit\"\n                                htmlType=\"submit\">Save</Button>\n                            <Button type=\"danger\"\n                                onClick={this.onClickCancel.bind(this)}>Cancel</Button>\n                        </div> */}\n                    </div>\n                </div>\n            </form>\n        )\n    }\n\n    getOrgAvatarUrl(org: EditableOrganization) {\n        // const defaultImages = [\n        //     'orgs-64.png',\n        //     'unicorn-64.png'\n        // ]\n        // if (!org.gravatarHash.value) {\n        //     return defaultImages[Math.floor(Math.random() * 2)]\n        // }\n        if (!org.gravatarHash.value) {\n            return 'unicorn-64.png'\n        }\n        const gravatarDefault = 'identicon';\n\n        return 'https://www.gravatar.com/avatar/' + org.gravatarHash.value + '?s=64&amp;r=pg&d=' + gravatarDefault;\n    }\n\n    renderOrgAvatar(org: EditableOrganization) {\n        return (\n            <img style={{ width: 64, height: 64 }}\n                src={this.getOrgAvatarUrl(org)} />\n        )\n    }\n\n    renderPreview() {\n        return <form className=\"preview\">\n            <div className=\"row\">\n                <div className=\"col2\">\n                    <div className=\"name\">\n                        {this.props.newOrganization.name.value || ''}\n                    </div>\n                </div>\n            </div>\n            <div className=\"row\">\n                <div className=\"col2\">\n                    <div className=\"gravatarHash\">\n                        {this.renderOrgAvatar(this.props.newOrganization)}\n                    </div>\n                </div>\n            </div>\n            <div className=\"row\">\n                <div className=\"col2\">\n                    <div className=\"id\">\n                        <span style={{ color: 'silver' }}>{this.origin}/#orgs/organizations/</span>\n                        {this.props.newOrganization.id.value || (<span style={{ fontStyle: 'italic' }}>organization id here</span>)}\n                    </div>\n                </div>\n            </div>\n            <div className=\"row\" style={{ flex: '1 1 0px' }}>\n                <div className=\"col2\">\n                    <div className=\"description\"\n                        dangerouslySetInnerHTML={({ __html: marked(this.props.newOrganization.description.value || '') })}\n                    />\n                </div>\n            </div>\n        </form>\n    }\n\n    renderState() {\n        const { editState, validationState, saveState } = this.props;\n        const label = 'edit: ' + editState + ', valid: ' + validationState + ', save: ' + saveState\n        return (\n            <span style={{ marginRight: '10px' }}>{label}</span>\n        )\n    }\n\n    toggleError() {\n        this.setState({ showError: !this.state.showError })\n    }\n\n    renderHeader() {\n        const orgName = this.props.newOrganization!.name.value || (<span style={{ fontStyle: 'italic', color: 'gray' }}>org name will appear here when you edit the name field</span>)\n        let errorButton\n        if (this.props.error) {\n            errorButton = (\n                <Button shape=\"circle\" icon=\"exclamation\" type=\"danger\" onClick={this.toggleError.bind(this)}></Button>\n            )\n        }\n        const breadcrumbs = (\n            <React.Fragment>\n                <span>\n                    {/* <FaPlusCircle style={{ verticalAlign: 'middle' }} /> */}\n                    <Icon type=\"plus-circle\" />\n                    {' '}\n                    Adding a New Org \"\n                            {orgName}\n                    \"\n                        </span>\n            </React.Fragment>\n        )\n        const buttons = (\n            <React.Fragment>\n                <Button icon=\"save\"\n                    form=\"newOrganizationForm\"\n                    key=\"submit\"\n                    disabled={!this.canSave.call(this)}\n                    htmlType=\"submit\">\n                    {/* <Icon type=\"save\" /> */}\n                    {/* <FaSave style={{ verticalAlign: 'center' }} /> */}\n                    Save\n                        </Button>\n\n                <Button shape=\"circle\" icon=\"info\" onClick={this.onShowInfo.bind(this)}></Button>\n                {errorButton}\n            </React.Fragment>\n        )\n        return (\n            <Header breadcrumbs={breadcrumbs} buttons={buttons} />\n        )\n    }\n\n    renderLoadingHeader() {\n        const breadcrumbs = (\n            <span>\n                Loading New Org Editor...\n            </span>\n        )\n        return (\n            <Header breadcrumbs={breadcrumbs} />\n        )\n    }\n\n    renderError() {\n        if (this.props.error && this.state.showError) {\n            const onOk = () => {\n                this.setState({ showError: false })\n            }\n            const onCancel = () => {\n                this.setState({ showError: false })\n            }\n            let trace\n            if (this.props.error.trace) {\n                trace = this.props.error.trace.map((line, index) => {\n                    return (\n                        <div key={\"line_\" + index}>{line}</div>\n                    )\n                })\n            }\n            if (trace) {\n                trace = (\n                    <div>\n                        <div>trace</div>\n                        {trace}\n                    </div>\n                )\n            }\n            return (\n                <Modal visible={true}\n                    title=\"Error\"\n                    okType=\"danger\"\n                    okText=\"Close\"\n                    cancelText=\"Clear Error\"\n                    onCancel={onCancel}\n                    onOk={onOk}>\n                    <div style={{ fontWeight: 'bold' }}>\n                        {this.props.error.code}\n                    </div>\n                    <div>\n                        {this.props.error.message}\n                    </div>\n                    {trace}\n\n                </Modal>\n            )\n        }\n    }\n\n    render() {\n        if (this.state.cancelToBrowser) {\n            return <Redirect push to=\"/organizations\" />\n        }\n\n        // TODO: this is just a prop for today.\n        if (this.props.saveState === SaveState.SAVED) {\n            return <Redirect push to={\"/editOrganization/\" + this.props.newOrganization.id.value} />\n        }\n\n        if (!this.props.newOrganization) {\n            return (\n                <div className=\"NewOrganization\">\n                    {this.renderLoadingHeader()}\n                </div>\n            )\n        }\n\n        return (\n            <div className=\"NewOrganization\">\n                {this.renderHeader()}\n                <div className=\"mainRow\">\n                    <div className=\"editorColumn\">\n                        <h3>Editor</h3>\n                        {this.renderForm()}\n                    </div>\n                    <div className=\"previewColumn\">\n                        <h3>Preview</h3>\n                        {this.renderPreview()}\n                    </div>\n                </div>\n                {this.renderError()}\n            </div>\n        )\n    }\n}\n\nexport default NewOrganization","import { Dispatch, Action } from 'redux';\nimport { connect } from 'react-redux';\n\nimport { StoreState, EditState, SaveState, ValidationState, EditableOrganization, AppError } from '../../../types';\nimport {\n    addOrg, updateName, updateGravatarHash, updateId, updateDescription, updateIsPrivate\n} from '../../../redux/actions/addOrg';\n\nimport Component from './component';\n\ninterface OwnProps {\n}\n\nexport interface StateProps {\n    editState: EditState\n    saveState: SaveState\n    validationState: ValidationState\n    newOrganization: EditableOrganization\n    error: AppError | null\n}\n\nexport interface DispatchProps {\n    onSave: () => void\n    onUpdateName: (name: string) => void\n    onUpdateGravatarHash: (gravatarHash: string) => void\n    onUpdateId: (id: string) => void\n    onUpdateDescription: (description: string) => void\n    onUpdateIsPrivate: (isPrivate: boolean) => void\n}\n\nexport function mapStateToProps(state: StoreState): StateProps {\n    if (!state.views.addOrgView.viewModel) {\n        throw new Error('View model missing in state')\n    }\n    const {\n        views: {\n            addOrgView: {\n                viewModel: { editState, saveState, validationState, newOrganization, error }\n            }\n        }\n    } = state\n\n    return {\n        editState,\n        saveState,\n        validationState,\n        newOrganization,\n        error\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<Action>): DispatchProps {\n    return {\n        onSave: () => {\n            dispatch(addOrg() as any)\n        },\n        onUpdateName: (name) => {\n            dispatch(updateName(name) as any)\n        },\n        onUpdateGravatarHash: (gravatarHash: string) => {\n            dispatch(updateGravatarHash(gravatarHash) as any)\n        },\n        onUpdateId: (id) => {\n            dispatch(updateId(id) as any)\n        },\n        onUpdateDescription: (description) => {\n            dispatch(updateDescription(description) as any)\n        },\n        onUpdateIsPrivate: (isPrivate: boolean) => {\n            dispatch(updateIsPrivate(isPrivate) as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(Component)","import * as React from 'react'\n\nimport { AppError, AddOrgView, ComponentLoadingState, StoreState } from '../../../types'\nimport Container from './container'\nimport './loader.css'\n\ninterface LoaderProps {\n    view: AddOrgView\n    onLoad: () => void\n    onUnload: () => void\n}\n\ninterface LoaderState {\n\n}\n\nclass Loader extends React.Component<LoaderProps, LoaderState> {\n    constructor(props: LoaderProps) {\n        super(props)\n    }\n\n    renderLoading() {\n        return (\n            <div>\n                Loading \"Add New Organization\" form...\n            </div>\n        )\n    }\n\n    renderError(error: AppError) {\n        return (\n            <div>\n                Error!\n                <div>\n                    {error.message}\n                </div>\n            </div>\n        )\n    }\n\n    render() {\n        switch (this.props.view.loadingState) {\n            case ComponentLoadingState.NONE:\n                this.props.onLoad()\n                return this.renderLoading()\n            case ComponentLoadingState.LOADING:\n                return this.renderLoading()\n            case ComponentLoadingState.ERROR:\n                if (this.props.view.error) {\n                    return this.renderError(this.props.view.error)\n                } else {\n                    return this.renderError({\n                        code: 'Missing Error',\n                        message: 'The error appears to be missing'\n                    })\n                }\n            case ComponentLoadingState.SUCCESS:\n            default:\n                return (\n                    <Container />\n                )\n        }\n    }\n\n    componentWillUnmount() {\n        this.props.onUnload()\n    }\n}\n\n// redux interface\n\nimport { Dispatch } from 'redux'\nimport { connect } from 'react-redux'\n\nimport * as actions from '../../../redux/actions/addOrg'\n\nexport interface OwnProps {\n\n}\n\ninterface StateProps {\n\n}\n\ninterface DispatchProps {\n    onLoad: () => void\n    onUnload: () => void\n}\n\nfunction mapStateToProps(state: StoreState, props: OwnProps): StateProps {\n    return {\n        view: state.views.addOrgView\n    }\n}\n\nfunction mapDispatchToProps(dispatch: Dispatch<actions.Load | actions.Unload>): DispatchProps {\n    return {\n        onLoad: () => {\n            dispatch(actions.load() as any)\n        },\n        onUnload: () => {\n            dispatch(actions.unload() as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(Loader)","import * as requestModel from './requests'\nimport * as orgModel from './organization/model'\nimport { RequestType } from '../../types';\n\nexport interface UberOrganization {\n    organization: orgModel.Organization\n    request: requestModel.UserRequest | null\n    invitation: requestModel.UserInvitation | null\n    relation: orgModel.Relation,\n    groupRequests: Array<requestModel.Request> | null\n}\n\ninterface UberModelParams {\n    token: string\n    username: string\n    groupsServiceURL: string\n    userProfileServiceURL: string\n    workspaceServiceURL: string\n    serviceWizardURL: string\n}\n\nexport class UberModel {\n\n    params: UberModelParams\n\n    constructor(params: UberModelParams) {\n        this.params = params\n    }\n\n    async getOrganizationForUser(organizationId: string): Promise<UberOrganization> {\n        // const {\n        //     auth: { authorization: { token, username } },\n        //     app: { config }\n        // } = getState()\n\n        const orgClient = new orgModel.OrganizationModel({\n            token: this.params.token, username: this.params.username,\n            groupsServiceURL: this.params.groupsServiceURL\n        })\n\n        const requestClient = new requestModel.RequestsModel({\n            token: this.params.token, username: this.params.username,\n            groupsServiceURL: this.params.groupsServiceURL\n        })\n\n        // get org\n        const organization = await orgClient.getOrg(organizationId)\n\n        // get pending requests\n        const request = await requestClient.getUserRequestForOrg(organizationId) as requestModel.UserRequest | null\n\n        const invitation = await requestClient.getUserInvitationForOrg(organizationId) as requestModel.UserInvitation | null\n\n        const relation = orgModel.determineRelation(organization, this.params.username, request, invitation)\n\n        let groupRequests\n        if (relation.type === orgModel.UserRelationToOrganization.ADMIN ||\n            relation.type === orgModel.UserRelationToOrganization.OWNER) {\n            groupRequests = await requestClient.getPendingOrganizationRequestsForOrg(organizationId)\n        } else {\n            groupRequests = null\n        }\n\n        return {\n            organization, request, invitation, relation, groupRequests\n        }\n    }\n\n    async getOrganizationsForUser(): Promise<Array<UberOrganization>> {\n        // const {\n        //     auth: { authorization: { token, username } },\n        //     app: { config }\n        // } = getState()\n\n        const orgClient = new orgModel.OrganizationModel({\n            token: this.params.token, username: this.params.username,\n            groupsServiceURL: this.params.groupsServiceURL\n        })\n\n        const requestClient = new requestModel.RequestsModel({\n            token: this.params.token, username: this.params.username,\n            groupsServiceURL: this.params.groupsServiceURL\n        })\n\n        const orgs = await orgClient.getOwnOrgs()\n\n        const requests = await requestClient.getUserRequests()\n        const invitations = await requestClient.getUserInvitations()\n\n        return await Promise.all(orgs.map(async (organization) => {\n            const request = requests.find((request) => {\n                if (request.organizationId === organization.id) {\n                    if (request.type === RequestType.REQUEST &&\n                        request.resourceType === requestModel.RequestResourceType.USER) {\n                        return true\n                    }\n                }\n                return false\n            }) as requestModel.UserRequest\n\n            const invitation = invitations.find((request) => {\n                if (request.organizationId === organization.id) {\n                    if (request.type === RequestType.INVITATION &&\n                        request.resourceType === requestModel.RequestResourceType.USER) {\n                        return true\n                    }\n                }\n                return false\n            }) as requestModel.UserInvitation\n\n            const relation = orgModel.determineRelation(organization, this.params.username, request || null, invitation)\n\n            let groupRequests\n            if (relation.type === orgModel.UserRelationToOrganization.ADMIN ||\n                relation.type === orgModel.UserRelationToOrganization.OWNER) {\n                groupRequests = await requestClient.getPendingOrganizationRequestsForOrg(organization.id)\n            } else {\n                groupRequests = null\n            }\n\n            return {\n                organization, request, invitation, relation, groupRequests\n            }\n        }))\n    }\n}","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\n\nimport { ActionFlag } from './index'\nimport {\n    StoreState,\n    AppError, UIError, UIErrorType\n} from '../../types'\n\nimport * as orgModel from '../../data/models/organization/model'\nimport * as requestModel from '../../data/models/requests'\nimport * as uberModel from '../../data/models/uber'\n\n\n// Action Types\n\nexport interface Load extends Action {\n    type: ActionFlag.VIEW_ORG_LOAD\n    organizationId: string\n}\n\nexport interface LoadStart extends Action {\n    type: ActionFlag.VIEW_ORG_LOAD_START\n}\n\nexport interface LoadSuccess extends Action {\n    type: ActionFlag.VIEW_ORG_LOAD_SUCCESS\n    organization: orgModel.Organization\n    relation: orgModel.Relation\n    groupRequests: Array<requestModel.Request> | null\n    groupInvitations: Array<requestModel.Request> | null\n}\n\nexport interface LoadError extends Action {\n    type: ActionFlag.VIEW_ORG_LOAD_ERROR\n    error: AppError\n}\n\nexport interface Unload extends Action {\n    type: ActionFlag.VIEW_ORG_UNLOAD\n}\n\n// Join Requests\n\nexport interface ViewOrgJoinRequest extends Action {\n    type: ActionFlag.VIEW_ORG_JOIN_REQUEST\n    requestId: string\n}\n\nexport interface ViewOrgJoinRequestStart extends Action {\n    type: ActionFlag.VIEW_ORG_JOIN_REQUEST_START\n}\n\nexport interface ViewOrgJoinRequestSuccess extends Action {\n    type: ActionFlag.VIEW_ORG_JOIN_REQUEST_SUCCESS\n}\n\nexport interface ViewOrgJoinRequestError extends Action {\n    type: ActionFlag.VIEW_ORG_JOIN_REQUEST_ERROR\n    error: UIError\n}\n\n// Join Request cancellation\n\nexport interface ViewOrgCancelJoinRequest extends Action {\n    type: ActionFlag.VIEW_ORG_CANCEL_JOIN_REQUEST\n}\n\nexport interface ViewOrgCancelJoinRequestStart extends Action {\n    type: ActionFlag.VIEW_ORG_CANCEL_JOIN_REQUEST_START\n}\n\nexport interface ViewOrgCancelJoinRequestSuccess extends Action {\n    type: ActionFlag.VIEW_ORG_CANCEL_JOIN_REQUEST_SUCCESS\n}\n\nexport interface ViewOrgCancelJoinRequestError extends Action {\n    type: ActionFlag.VIEW_ORG_CANCEL_JOIN_REQUEST_ERROR,\n    error: UIError\n}\n\n// Join Invitation Acceptance\n\nexport interface AcceptJoinInvitation extends Action {\n    type: ActionFlag.VIEW_ORG_ACCEPT_JOIN_INVITATION\n}\n\nexport interface AcceptJoinInvitationStart extends Action {\n    type: ActionFlag.VIEW_ORG_ACCEPT_JOIN_INVITATION_START\n}\n\nexport interface AcceptJoinInvitationSuccess extends Action {\n    type: ActionFlag.VIEW_ORG_ACCEPT_JOIN_INVITATION_SUCCESS\n}\n\nexport interface AcceptJoinInvitationError extends Action {\n    type: ActionFlag.VIEW_ORG_ACCEPT_JOIN_INVITATION_ERROR,\n    error: AppError\n}\n\n// Join Invitation Denial\n\nexport interface RejectJoinInvitation extends Action {\n    type: ActionFlag.VIEW_ORG_REJECT_JOIN_INVITATION\n}\n\nexport interface RejectJoinInvitationStart extends Action {\n    type: ActionFlag.VIEW_ORG_REJECT_JOIN_INVITATION_START\n}\n\nexport interface RejectJoinInvitationSuccess extends Action {\n    type: ActionFlag.VIEW_ORG_REJECT_JOIN_INVITATION_SUCCESS\n}\n\nexport interface RejectJoinInvitationError extends Action {\n    type: ActionFlag.VIEW_ORG_REJECT_JOIN_INVITATION_ERROR,\n    error: AppError\n}\n\n// Delete Narrative\n\nexport interface RemoveNarrative extends Action {\n    type: ActionFlag.VIEW_ORG_REMOVE_NARRATIVE\n}\n\nexport interface RemoveNarrativeStart extends Action {\n    type: ActionFlag.VIEW_ORG_REMOVE_NARRATIVE_START\n}\n\nexport interface RemoveNarrativeSuccess extends Action {\n    type: ActionFlag.VIEW_ORG_REMOVE_NARRATIVE_SUCCESS,\n    narrative: orgModel.NarrativeResource\n}\n\nexport interface RemoveNarrativeError extends Action {\n    type: ActionFlag.VIEW_ORG_REMOVE_NARRATIVE_ERROR,\n    error: AppError\n}\n\n// Generators\n\nexport function removeNarrativeStart(): RemoveNarrativeStart {\n    return {\n        type: ActionFlag.VIEW_ORG_REMOVE_NARRATIVE_START\n    }\n}\n\nexport function removeNarrativeSuccess(narrative: orgModel.NarrativeResource): RemoveNarrativeSuccess {\n    return {\n        type: ActionFlag.VIEW_ORG_REMOVE_NARRATIVE_SUCCESS,\n        narrative: narrative\n    }\n}\n\nexport function removeNarrativeError(error: AppError): RemoveNarrativeError {\n    return {\n        type: ActionFlag.VIEW_ORG_REMOVE_NARRATIVE_ERROR,\n        error: error\n    }\n}\n\n// Thunk\n\nexport function removeNarrative(narrative: orgModel.NarrativeResource) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(removeNarrativeStart())\n\n        // TODO: need to restructure this view -- this is crazy\n\n        const state = getState()\n        if (!state.views.viewOrgView.viewModel) {\n            dispatch(removeNarrativeError({\n                code: 'bad state',\n                message: 'View orgs does not have an org'\n            }))\n            return\n        }\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config },\n            views: {\n                viewOrgView: {\n                    viewModel: {\n                        organization\n                    }\n                }\n            }\n        } = state\n\n        if (!organization) {\n            dispatch(removeNarrativeError({\n                code: 'bad state',\n                message: 'View orgs does not have an org'\n            }))\n            return\n        }\n\n        const groupId = organization.id\n\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n\n        try {\n            await orgClient.removeNarrativeFromOrg(groupId, narrative.workspaceId)\n            dispatch(removeNarrativeSuccess(narrative))\n        } catch (ex) {\n            dispatch(removeNarrativeError({\n                code: ex.name,\n                message: ex.message\n            }))\n        }\n    }\n}\n\n// Access narrative\n\nexport interface AccessNarrative extends Action {\n    type: ActionFlag.VIEW_ORG_ACCESS_NARRATIVE,\n    narrative: orgModel.NarrativeResource\n}\n\nexport interface AccessNarrativeStart extends Action {\n    type: ActionFlag.VIEW_ORG_ACCESS_NARRATIVE_START\n}\n\nexport interface AccessNarrativeSuccess extends Action {\n    type: ActionFlag.VIEW_ORG_ACCESS_NARRATIVE_SUCCESS,\n    organization: orgModel.Organization\n}\n\nexport interface AccessNarrativeError extends Action {\n    type: ActionFlag.VIEW_ORG_ACCESS_NARRATIVE_ERROR,\n    error: AppError\n}\n\n// Generators\nexport function accessNarrativeStart(): AccessNarrativeStart {\n    return {\n        type: ActionFlag.VIEW_ORG_ACCESS_NARRATIVE_START\n    }\n}\n\nexport function accessNarrativeSuccess(organization: orgModel.Organization): AccessNarrativeSuccess {\n    return {\n        type: ActionFlag.VIEW_ORG_ACCESS_NARRATIVE_SUCCESS,\n        organization: organization\n    }\n}\n\nexport function accessNarrativeError(error: AppError): AccessNarrativeError {\n    return {\n        type: ActionFlag.VIEW_ORG_ACCESS_NARRATIVE_ERROR,\n        error: error\n    }\n}\n\n// Thunk\n\nexport function accessNarrative(narrative: orgModel.NarrativeResource) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(accessNarrativeStart())\n\n        const state = getState()\n        if (!state.views.viewOrgView.viewModel) {\n            dispatch(accessNarrativeError({\n                code: 'error',\n                message: 'No view model'\n            }))\n            return\n        }\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config },\n            views: {\n                viewOrgView: {\n                    viewModel: {\n                        organization\n                    }\n                }\n            }\n        } = state\n\n        if (!organization) {\n            return\n        }\n\n        const groupId = organization.id\n        const resourceId = String(narrative.workspaceId)\n\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        try {\n            await orgClient.grantNarrativeAccess(groupId, resourceId)\n            const org = await orgClient.getOrg(groupId)\n            dispatch(accessNarrativeSuccess(org))\n        } catch (ex) {\n            dispatch(accessNarrativeError({\n                code: 'error',\n                message: ex.message\n            }))\n        }\n\n    }\n}\n\n// Generators\n\nexport function loadStart(): LoadStart {\n    return {\n        type: ActionFlag.VIEW_ORG_LOAD_START\n    }\n}\n\nexport function unload(): Unload {\n    return {\n        type: ActionFlag.VIEW_ORG_UNLOAD\n    }\n}\n\nexport function loadSuccess(\n    organization: orgModel.Organization,\n    relation: orgModel.Relation,\n    groupRequests: Array<requestModel.Request> | null,\n    groupInvitations: Array<requestModel.Request> | null): LoadSuccess {\n    return {\n        type: ActionFlag.VIEW_ORG_LOAD_SUCCESS,\n        organization, relation, groupRequests, groupInvitations\n    }\n}\n\n\nexport function loadError(error: AppError): LoadError {\n    return {\n        type: ActionFlag.VIEW_ORG_LOAD_ERROR,\n        error: error\n    }\n}\n\n// Join requests\n\nexport function viewOrgJoinRequestStart(): ViewOrgJoinRequestStart {\n    return {\n        type: ActionFlag.VIEW_ORG_JOIN_REQUEST_START\n    }\n}\n\nexport function viewOrgJoinRequestSuccess(): ViewOrgJoinRequestSuccess {\n    return {\n        type: ActionFlag.VIEW_ORG_JOIN_REQUEST_SUCCESS\n    }\n}\n\nexport function viewOrgJoinRequestError(error: UIError): ViewOrgJoinRequestError {\n    return {\n        type: ActionFlag.VIEW_ORG_JOIN_REQUEST_ERROR,\n        error: error\n    }\n}\n\n// Join Request Cancellation\n\nexport function viewOrgCancelJoinRequestStart(): ViewOrgCancelJoinRequestStart {\n    return {\n        type: ActionFlag.VIEW_ORG_CANCEL_JOIN_REQUEST_START\n    }\n}\n\nexport function viewOrgCancelJoinRequestSuccess(): ViewOrgCancelJoinRequestSuccess {\n    return {\n        type: ActionFlag.VIEW_ORG_CANCEL_JOIN_REQUEST_SUCCESS\n    }\n}\n\nexport function viewOrgCancelJoinRequestError(error: UIError): ViewOrgCancelJoinRequestError {\n    return {\n        type: ActionFlag.VIEW_ORG_CANCEL_JOIN_REQUEST_ERROR,\n        error: error\n    }\n}\n\n// Invitation Acceptance\n\nexport function acceptJoinInvitationStart(): AcceptJoinInvitationStart {\n    return {\n        type: ActionFlag.VIEW_ORG_ACCEPT_JOIN_INVITATION_START\n    }\n}\n\nexport function acceptJoinInvitationSuccess(): AcceptJoinInvitationSuccess {\n    return {\n        type: ActionFlag.VIEW_ORG_ACCEPT_JOIN_INVITATION_SUCCESS\n    }\n}\n\nexport function acceptJoinInvitationError(error: AppError): AcceptJoinInvitationError {\n    return {\n        type: ActionFlag.VIEW_ORG_ACCEPT_JOIN_INVITATION_ERROR,\n        error: error\n    }\n}\n\n// Invitation Rejection \n\nexport function rejectJoinInvitationStart(): RejectJoinInvitationStart {\n    return {\n        type: ActionFlag.VIEW_ORG_REJECT_JOIN_INVITATION_START\n    }\n}\n\nexport function rejectJoinInvitationSuccess(): RejectJoinInvitationSuccess {\n    return {\n        type: ActionFlag.VIEW_ORG_REJECT_JOIN_INVITATION_SUCCESS\n    }\n}\n\nexport function rejectJoinInvitationError(error: AppError): RejectJoinInvitationError {\n    return {\n        type: ActionFlag.VIEW_ORG_REJECT_JOIN_INVITATION_ERROR,\n        error: error\n    }\n}\n\n\n// Join invitation acceptance\n\n// TODO\n\n// Thunks\n\nexport function load(organizationId: string) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(loadStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config }\n        } = getState()\n\n        const uberClient = new uberModel.UberModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url,\n            serviceWizardURL: config.services.ServiceWizard.url,\n            userProfileServiceURL: config.services.UserProfile.url,\n            workspaceServiceURL: config.services.Workspace.url\n        })\n\n        const requestClient = new requestModel.RequestsModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url,\n        })\n\n        try {\n            const { organization, relation } = await uberClient.getOrganizationForUser(organizationId)\n            let requests: Array<requestModel.Request> | null\n            let invitations: Array<requestModel.Request> | null\n            if (relation.type === orgModel.UserRelationToOrganization.OWNER ||\n                relation.type === orgModel.UserRelationToOrganization.ADMIN) {\n                requests = await requestClient.getPendingOrganizationRequestsForOrg(organizationId)\n                invitations = await requestClient.getOrganizationInvitationsForOrg(organizationId)\n            } else {\n                requests = null\n                invitations = null\n            }\n\n            dispatch(loadSuccess(organization, relation, requests, invitations))\n        } catch (ex) {\n            dispatch(loadError({\n                code: ex.name,\n                message: ex.message\n            }))\n        }\n    }\n}\n\nexport function viewOrgJoinRequest() {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        //TODO: could do a start here...\n        const state = getState()\n        if (!state.views.viewOrgView.viewModel) {\n            dispatch(viewOrgJoinRequestError({\n                type: UIErrorType.ERROR,\n                message: 'Now view model!'\n            }))\n            return\n        }\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config },\n            views: {\n                viewOrgView: { viewModel: { organization } }\n            }\n        } = state\n\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        try {\n            await orgClient.requestMembershipToGroup(organization.id)\n            dispatch(viewOrgJoinRequestSuccess())\n            dispatch(load((organization.id)))\n        } catch (ex) {\n            dispatch(viewOrgJoinRequestError({\n                type: UIErrorType.ERROR,\n                message: ex.message\n            }))\n        }\n    }\n}\n\nexport function viewOrgCancelJoinRequest(requestId: string) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(viewOrgJoinRequestStart())\n\n        const state = getState()\n        if (!state.views.viewOrgView.viewModel) {\n            dispatch(viewOrgJoinRequestError({\n                type: UIErrorType.ERROR,\n                message: 'Now view model!'\n            }))\n            return\n        }\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config },\n            views: {\n                viewOrgView: {\n                    viewModel: { organization } } } } = state\n\n        const requestClient = new requestModel.RequestsModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        try {\n            const newRequest = await requestClient.cancelRequest(requestId)\n            dispatch(viewOrgCancelJoinRequestSuccess())\n            dispatch(load(newRequest.organizationId))\n        } catch (ex) {\n            dispatch(viewOrgCancelJoinRequestError({\n                type: UIErrorType.ERROR,\n                message: ex.message\n            }))\n        }\n    }\n}\n\nexport function acceptJoinInvitation(requestId: string) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(acceptJoinInvitationStart())\n\n        const state = getState()\n        if (!state.views.viewOrgView.viewModel) {\n            dispatch(viewOrgJoinRequestError({\n                type: UIErrorType.ERROR,\n                message: 'Now view model!'\n            }))\n            return\n        }\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config },\n            views: {\n                viewOrgView: {\n                    viewModel: { organization } } } } = state\n\n        const requestClient = new requestModel.RequestsModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        try {\n            const newRequest = await requestClient.acceptJoinInvitation(requestId)\n            dispatch(acceptJoinInvitationSuccess())\n            // quick 'n easy\n            dispatch(load(newRequest.organizationId))\n        } catch (ex) {\n            dispatch(acceptJoinInvitationError({\n                code: ex.name,\n                message: ex.message\n            }))\n        }\n\n    }\n}\n\n\nexport function rejectJoinInvitation(requestId: string) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(acceptJoinInvitationStart())\n\n        const state = getState()\n        if (!state.views.viewOrgView.viewModel) {\n            dispatch(viewOrgJoinRequestError({\n                type: UIErrorType.ERROR,\n                message: 'Now view model!'\n            }))\n            return\n        }\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config },\n            views: {\n                viewOrgView: {\n                    viewModel: { organization } } } } = state\n\n        const requestClient = new requestModel.RequestsModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        try {\n            const newRequest = await requestClient.rejectJoinInvitation(requestId)\n            dispatch(rejectJoinInvitationSuccess())\n            dispatch(load(newRequest.organizationId))\n        } catch (ex) {\n            dispatch(rejectJoinInvitationError({\n                code: ex.name,\n                message: ex.message\n            }))\n        }\n\n    }\n}\n","import * as React from 'react'\nimport { MemberType } from '../../../types'\nimport { Icon, Tooltip, Button, message, Menu, Dropdown } from 'antd'\nimport { Redirect } from 'react-router-dom'\n\nimport * as orgModel from '../../../data/models/organization/model'\nimport * as requestModel from '../../../data/models/requests'\nimport * as userModel from '../../../data/models/user'\n\nimport './component.css'\n\n\nexport interface OrganizationHeaderProps {\n    organization: orgModel.Organization\n    pendingJoinRequest: requestModel.UserRequest | null\n    pendingJoinInvitation: requestModel.UserInvitation | null\n    currentUsername: userModel.Username\n    onCancelJoinRequest: (requestId: string) => void\n    onAcceptInvitation: (requestId: string) => void\n    onRejectInvitation: (requestId: string) => void\n    onJoinOrg: () => void\n}\n\ninterface OrganizationHeaderState {\n    navigateTo: NavigateTo\n}\n\nenum NavigateTo {\n    NONE = 0,\n    MANAGE_MEMBERSHIP,\n    VIEW_MEMBERS,\n    MANAGE_REQUESTS,\n    VIEW_ORGANIZATION,\n    EDIT_ORGANIZATION,\n    INVITE_USER\n}\n\nexport class OrganizationHeader extends React.Component<OrganizationHeaderProps, OrganizationHeaderState> {\n\n    relation: orgModel.UserOrgRelation\n\n    constructor(props: OrganizationHeaderProps) {\n        super(props)\n\n        this.state = {\n            navigateTo: NavigateTo.NONE\n        }\n\n        this.relation = this.getUserRelation()\n    }\n\n    getUserRelation(): orgModel.UserOrgRelation {\n        const currentUsername = this.props.currentUsername\n        const org = this.props.organization\n        if (currentUsername === org.owner.username) {\n            return {\n                type: orgModel.UserRelationToOrganization.OWNER\n            } as orgModel.OwnerRelation\n        } else {\n            const member = org.members.find(({ username }) => {\n                return (username === currentUsername)\n            })\n            if (member) {\n                switch (member.type) {\n                    case MemberType.MEMBER:\n                        return {\n                            type: orgModel.UserRelationToOrganization.MEMBER\n                        } as orgModel.MemberRelation\n                    case MemberType.ADMIN:\n                        return {\n                            type: orgModel.UserRelationToOrganization.ADMIN\n                        } as orgModel.AdminRelation\n                    case MemberType.OWNER:\n                        return {\n                            type: orgModel.UserRelationToOrganization.OWNER\n                        } as orgModel.OwnerRelation\n                    default:\n                        return {\n                            type: orgModel.UserRelationToOrganization.NONE\n                        } as orgModel.NoRelation\n                }\n            } else if (this.props.pendingJoinRequest && this.props.pendingJoinRequest.user === currentUsername) {\n                return {\n                    type: orgModel.UserRelationToOrganization.MEMBER_REQUEST_PENDING,\n                    requestId: this.props.pendingJoinRequest.id\n                } as orgModel.MembershipRequestPendingRelation\n            } else if (this.props.pendingJoinInvitation && this.props.pendingJoinInvitation.user === currentUsername) {\n                return {\n                    type: orgModel.UserRelationToOrganization.MEMBER_INVITATION_PENDING,\n                    requestId: this.props.pendingJoinInvitation.id\n                } as orgModel.MembershipInvitationPendingRelation\n            } else {\n                return {\n                    type: orgModel.UserRelationToOrganization.NONE\n                } as orgModel.NoRelation\n            }\n        }\n    }\n\n    onJoinClick() {\n        this.props.onJoinOrg()\n        message.success('Join request has been submitted')\n    }\n\n    // LEFT OFF HERE... \n    // OK ... the relation should actually capture more info ... such as the request id\n    // but in reality don't we always have just one of request or invitation (or none)?\n    // in which case, we can just pick the appropriate one.\n    // but ... it also makes sense for the relation to carry information appropriate for the\n    // relation.\n\n    onCancelJoinRequest() {\n        const relation = this.relation as orgModel.MembershipRequestPendingRelation\n        this.props.onCancelJoinRequest(relation.requestId)\n        message.success('Submitted cancellation request')\n    }\n\n    onAcceptInvitation() {\n        const relation = this.relation as orgModel.MembershipRequestPendingRelation\n        this.props.onAcceptInvitation(relation.requestId)\n        message.success('Invitation acceptance has been sent')\n    }\n\n    onRejectInvitation() {\n        const relation = this.relation as orgModel.MembershipRequestPendingRelation\n        this.props.onRejectInvitation(relation.requestId)\n        message.success('Invitation rejection has been sent')\n    }\n\n    onNavigateToMembership() {\n        this.setState({ navigateTo: NavigateTo.MANAGE_MEMBERSHIP })\n    }\n\n    onNavigateToViewMembers() {\n        this.setState({ navigateTo: NavigateTo.VIEW_MEMBERS })\n    }\n\n    onNavigateToManageRequests() {\n        this.setState({ navigateTo: NavigateTo.MANAGE_REQUESTS })\n    }\n\n    onNavigateToEditOrganization() {\n        this.setState({ navigateTo: NavigateTo.EDIT_ORGANIZATION })\n    }\n\n    onNavigateToInviteUser() {\n        this.setState({ navigateTo: NavigateTo.INVITE_USER })\n    }\n\n    onNavigateToViewOrganization() {\n        this.setState({ navigateTo: NavigateTo.VIEW_ORGANIZATION })\n    }\n\n    onMenuClick({ key }: { key: string }) {\n        switch (key) {\n            case 'manageMyMembership':\n                this.setState({ navigateTo: NavigateTo.MANAGE_MEMBERSHIP })\n                break\n            case 'viewMembers':\n                this.setState({ navigateTo: NavigateTo.VIEW_MEMBERS })\n                break\n            case 'editOrg':\n                this.setState({ navigateTo: NavigateTo.EDIT_ORGANIZATION })\n                break\n            case 'inviteUser':\n                this.setState({ navigateTo: NavigateTo.INVITE_USER })\n                break\n            case 'manageRequests':\n                this.setState({ navigateTo: NavigateTo.MANAGE_REQUESTS })\n                break\n        }\n    }\n\n\n    getOrgAvatarUrl(org: orgModel.Organization) {\n        // const defaultImages = [\n        //     'orgs-64.png',\n        //     'unicorn-64.png'\n        // ]\n        // if (!org.gravatarHash) {\n        //     return defaultImages[Math.floor(Math.random() * 2)]\n        // }\n        if (!org.gravatarHash) {\n            return 'unicorn-64.png'\n        }\n        const gravatarDefault = 'identicon';\n\n        return 'https://www.gravatar.com/avatar/' + org.gravatarHash + '?s=64&amp;r=pg&d=' + gravatarDefault;\n    }\n\n    renderOrgAvatar(org: orgModel.Organization) {\n        return (\n            <img style={{ width: 64, height: 64 }}\n                onClick={this.onNavigateToViewOrganization.bind(this)}\n                className=\"avatarImage\"\n                src={this.getOrgAvatarUrl(this.props.organization)} />\n        )\n    }\n\n    renderRelation() {\n        const org = this.props.organization\n        switch (this.relation.type) {\n            case (orgModel.UserRelationToOrganization.NONE):\n                return (\n                    <span><Icon type=\"stop\" />None</span>\n                )\n            case (orgModel.UserRelationToOrganization.VIEW):\n                return (\n                    <div>\n                        <Tooltip\n                            placement=\"bottomRight\"\n                            mouseEnterDelay={0.5}\n                            title=\"You are not a member of this org, but you may access it, you may request membership\"\n                        >\n                            <div style={{ textAlign: 'center' }}>\n                                <Icon type=\"eye\" style={{ marginRight: '4px' }} />You are not a member of this Organization\n                            </div>\n                        </Tooltip>\n                        <div style={{ textAlign: 'center' }}>\n                            <Button\n                                type=\"primary\"\n                                onClick={this.onJoinClick.bind(this)}>\n                                Join this Organization\n                            </Button>\n                        </div>\n                    </div>\n\n                )\n            case (orgModel.UserRelationToOrganization.MEMBER_REQUEST_PENDING):\n                return (\n                    <div>\n                        <Tooltip\n                            placement=\"bottomRight\"\n                            mouseEnterDelay={0.5}\n                            title=\"You have requested membership in this Organization\"\n                        >   <div style={{ textAlign: 'center' }}>\n                                <span>\n                                    <Icon type=\"user\" style={{ color: 'orange' }} spin={true} />\n                                    Your membership <b>request</b> is pending\n                                {' '}\n                                    <Icon type=\"question-circle\" />\n                                </span>\n                            </div>\n                        </Tooltip>\n                        <div style={{ textAlign: 'center' }}>\n                            <Button icon=\"delete\" type=\"danger\" onClick={this.onCancelJoinRequest.bind(this)}>Cancel Request</Button>\n                        </div>\n                    </div>\n\n                )\n            case (orgModel.UserRelationToOrganization.MEMBER_INVITATION_PENDING):\n                return (\n                    <Tooltip\n                        placement=\"bottomRight\"\n                        mouseEnterDelay={0.5}\n                        title=\"You have been invited to join this Organization\"\n                    >\n                        <div style={{ textAlign: 'center' }}>\n                            <div>\n                                <Icon type=\"user\" style={{ color: 'blue' }} />You have been <b>invited</b> to join this Organization\n                            </div>\n                            <div>\n                                <Button icon=\"check\" type=\"default\" onClick={this.onAcceptInvitation.bind(this)}>Accept Invitation</Button>\n                                <Button icon=\"stop\" type=\"danger\" onClick={this.onRejectInvitation.bind(this)}>Reject Invitation</Button>\n                            </div>\n                        </div>\n                    </Tooltip>\n                )\n            case (orgModel.UserRelationToOrganization.MEMBER):\n                const menu = (\n                    <Menu onClick={this.onMenuClick.bind(this)}>\n                        <Menu.Item key=\"manageMyMembership\">\n                            Manage My Membership\n                        </Menu.Item>\n                    </Menu>\n                )\n                return (\n                    <div className=\"relationRow\">\n                        <div className=\"relationLabel\">\n                            <Tooltip\n                                placement=\"bottomRight\"\n                                mouseEnterDelay={0.5}\n                                title=\"You are a member of this organization\"\n                            >\n                                <div><Icon type=\"user\" />You are a <b>member</b> of this Organization</div>\n                            </Tooltip>\n                        </div>\n                        <div className=\"relationMenu\">\n                            <div>\n                                <Dropdown overlay={menu} trigger={['click']}>\n                                    <Button shape=\"circle\">\n                                        <Icon type=\"setting\" theme=\"filled\" style={{ fontSize: '120%' }} />\n                                    </Button>\n                                </Dropdown>\n                            </div>\n                        </div>\n                        {/* <div style={{ textAlign: 'center' }}>\n                            <Button type=\"default\">Manage your Profile</Button>\n                        </div> */}\n                    </div>\n                )\n            case (orgModel.UserRelationToOrganization.ADMIN):\n                const adminMenu = (\n                    <Menu onClick={this.onMenuClick.bind(this)}>\n                        <Menu.Item key=\"manageMyMembership\">\n                            Manage My Membership\n                        </Menu.Item>\n                        <Menu.Item key=\"viewMembers\">\n                            Members\n                        </Menu.Item>\n                        <Menu.Item key=\"manageRequests\">\n                            Requests and Invitations\n                        </Menu.Item>\n                        <Menu.Item key=\"editOrg\" >\n                            Edit this Org\n                        </Menu.Item>\n                        <Menu.Item key=\"inviteUser\">\n                            Invite User\n                        </Menu.Item>\n                    </Menu>\n                )\n                return (\n                    <div className=\"relationRow\">\n                        <div className=\"relationLabel\">\n                            <Tooltip\n                                placement=\"bottomRight\"\n                                mouseEnterDelay={0.5}\n                                title=\"You are and Administrator for this group\"\n                            >\n                                <div><Icon type=\"unlock\" />You are a <b>administrator</b> of this Organization</div>\n                            </Tooltip>\n                        </div>\n                        <div className=\"relationMenu\">\n                            <div>\n                                <Dropdown overlay={adminMenu} trigger={['click']}>\n                                    <Button shape=\"circle\">\n                                        <Icon type=\"setting\" theme=\"filled\" style={{ fontSize: '120%' }} />\n                                    </Button>\n                                </Dropdown>\n                            </div>\n                        </div>\n                        {/* <div style={{ textAlign: 'center' }}>\n                            <Button type=\"default\">Manage your Profile</Button>\n                        </div> */}\n                    </div>\n                )\n            case (orgModel.UserRelationToOrganization.OWNER):\n                const ownerMenu = (\n                    <Menu onClick={this.onMenuClick.bind(this)}>\n                        <Menu.Item key=\"manageMyMembership\">\n                            Manage My Membership\n                        </Menu.Item>\n                        <Menu.Item key=\"viewMembers\" >\n                            Members\n                        </Menu.Item>\n                        <Menu.Item key=\"manageRequests\">\n                            Requests and Invitations\n                        </Menu.Item>\n                        <Menu.Item key=\"editOrg\">\n                            Edit this Org\n                        </Menu.Item>\n                        <Menu.Item key=\"inviteUser\">\n                            Invite User\n                        </Menu.Item>\n                    </Menu>\n                )\n                return (\n                    <div className=\"relationRow\">\n                        <div className=\"relationLabel\">\n                            <Tooltip\n                                placement=\"bottomRight\"\n                                mouseEnterDelay={0.5}\n                                title=\"You own this group\"\n                            >\n                                <div>\n                                    <Icon type=\"crown\" style={{ color: 'gold' }} />\n                                    {' '}\n                                    You <b>own</b> this Organization\n                                    </div>\n                            </Tooltip>\n                        </div>\n                        <div className=\"relationMenu\">\n                            <div>\n                                <Dropdown overlay={ownerMenu} trigger={['click']}>\n                                    <Button shape=\"circle\">\n                                        <Icon type=\"setting\" theme=\"filled\" style={{ fontSize: '120%' }} />\n                                    </Button>\n                                </Dropdown>\n                            </div>\n                        </div>\n                        {/* <div style={{ textAlign: 'center' }}>\n                        <Button type=\"default\">Manage your Profile</Button>\n                    </div> */}\n                    </div>\n                )\n        }\n    }\n\n    renderOrgInfo() {\n        const org = this.props.organization\n        return (\n            <div>\n                <div className=\"name\">\n                    {org.name}\n                </div>\n                {/* <div className=\"id\">\n                    <span className=\"label\">permalink</span>{' '}\n                    <span className=\"permalinkBase\">https://narrative.kbase.us#orgs/</span>{org.id}\n                </div> */}\n                <div className=\"owner\">\n                    <span className=\"field-label\">owner</span>\n                    <a href={\"#people/\" + org.owner.username} target=\"_blank\">{org.owner.username}</a>\n                    {' '}\n                    {org.owner.username}\n                                </div>\n            </div>\n        )\n    }\n\n    getRelationClass(org: orgModel.Organization) {\n        switch (this.relation.type) {\n            case (orgModel.UserRelationToOrganization.NONE):\n                return 'relationRequest'\n            case (orgModel.UserRelationToOrganization.VIEW):\n                return 'relationRequest relationNonMember'\n            case (orgModel.UserRelationToOrganization.MEMBER_REQUEST_PENDING):\n                return 'relationRequest relationRequestPending'\n            case (orgModel.UserRelationToOrganization.MEMBER_INVITATION_PENDING):\n                return 'relationRequest relationInvitationPending'\n            case (orgModel.UserRelationToOrganization.MEMBER):\n                return 'relationRequest relationMember'\n            case (orgModel.UserRelationToOrganization.ADMIN):\n                return 'relationRequest relationAdmin'\n            case (orgModel.UserRelationToOrganization.OWNER):\n                return 'relationRequest relationOwner'\n        }\n    }\n\n    render() {\n        // apparently TS is not smart enough to know this from the conditional branch in render()!\n        switch (this.state.navigateTo) {\n            case NavigateTo.MANAGE_MEMBERSHIP:\n                return <Redirect push to={\"/membership/\" + this.props.organization.id} />\n            case NavigateTo.VIEW_MEMBERS:\n                return <Redirect push to={\"/viewMembers/\" + this.props.organization.id} />\n            case NavigateTo.EDIT_ORGANIZATION:\n                return <Redirect push to={\"/editOrganization/\" + this.props.organization.id} />\n            case NavigateTo.MANAGE_REQUESTS:\n                return <Redirect push to={\"/manageOrganizationRequests/\" + this.props.organization.id} />\n            case NavigateTo.INVITE_USER:\n                return <Redirect push to={\"/inviteUser/\" + this.props.organization.id} />\n            case NavigateTo.VIEW_ORGANIZATION:\n                return <Redirect push to={\"/viewOrganization/\" + this.props.organization.id} />\n            default:\n            // nothing, fall through\n        }\n\n        return (\n            <div className=\"OrganizationHeader\">\n                <div className=\"avatar\">\n                    {this.renderOrgAvatar(this.props.organization)}\n                </div>\n                <div className=\"orgInfo\">\n                    {this.renderOrgInfo()}\n                </div>\n                <div className={\"yourRelation \" + this.getRelationClass(this.props.organization)}>\n                    {this.renderRelation()}\n                </div>\n\n            </div>\n        )\n    }\n}\n\nexport default OrganizationHeader","import { Dispatch, Action } from 'redux'\nimport { connect } from 'react-redux'\n\nimport * as types from '../../../types'\n// we steal the view org actions...\nimport * as actions from '../../../redux/actions/viewOrg'\n\nimport Component from './component'\nimport * as orgModel from '../../../data/models/organization/model'\nimport * as requestModel from '../../../data/models/requests'\nimport * as userModel from '../../../data/models/user'\n\n// Props for this component\n\n// The interface for this container component\nexport interface OwnProps {\n}\n\n// the interface for mapStateTo props\ninterface StateProps {\n    organization: orgModel.Organization\n    pendingJoinRequest: requestModel.UserRequest | null\n    pendingJoinInvitation: requestModel.UserInvitation | null\n    currentUsername: userModel.Username\n}\n\n// the interface for mapDispatchToProps\ninterface DispatchProps {\n    onJoinOrg: () => void\n    onCancelJoinRequest: (requestId: string) => void\n    onAcceptInvitation: (requestId: string) => void\n    onRejectInvitation: (requestId: string) => void\n}\n\nfunction mapStateToProps(state: types.StoreState, props: OwnProps): StateProps {\n    const {\n        views: {\n            organizationCentricView: { viewModel }\n        },\n        auth: { authorization: { username } }\n    } = state\n\n    if (!viewModel) {\n        throw new Error('View model is unexpectedly missing')\n    }\n\n    return {\n        organization: viewModel.organization,\n        pendingJoinRequest: viewModel.pendingJoinRequest,\n        pendingJoinInvitation: viewModel.pendingJoinInvitation,\n        currentUsername: username\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<Action>): DispatchProps {\n    return {\n        onJoinOrg: () => {\n            dispatch(actions.viewOrgJoinRequest() as any)\n        },\n        onCancelJoinRequest: (requestId: string) => {\n            dispatch(actions.viewOrgCancelJoinRequest(requestId) as any)\n        },\n        onAcceptInvitation: (requestId: string) => {\n            dispatch(actions.acceptJoinInvitation(requestId) as any)\n        },\n        onRejectInvitation: (requestId: string) => {\n            dispatch(actions.rejectJoinInvitation(requestId) as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, types.StoreState>(mapStateToProps, mapDispatchToProps)(Component)\n","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\nimport { ActionFlag } from './index'\nimport * as orgModel from '../../data/models/organization/model'\nimport * as requestModel from '../../data/models/requests'\nimport * as userModel from '../../data/models/user'\nimport { AppError, StoreState } from '../../types';\n\nexport interface OrganizationCentricAction<T> extends Action<T> {\n\n}\n\nexport interface Load extends OrganizationCentricAction<ActionFlag.ORGANIZATION_CENTRIC_VIEW_LOAD> {\n    type: ActionFlag.ORGANIZATION_CENTRIC_VIEW_LOAD\n}\n\nexport interface LoadStart extends OrganizationCentricAction<ActionFlag.ORGANIZATION_CENTRIC_VIEW_LOAD_START> {\n    type: ActionFlag.ORGANIZATION_CENTRIC_VIEW_LOAD_START\n}\n\nexport interface LoadSuccess extends OrganizationCentricAction<ActionFlag.ORGANIZATION_CENTRIC_VIEW_LOAD_SUCCESS> {\n    type: ActionFlag.ORGANIZATION_CENTRIC_VIEW_LOAD_SUCCESS,\n    organization: orgModel.Organization,\n    pendingJoinRequest: requestModel.UserRequest | null\n    pendingJoinInvitation: requestModel.UserInvitation | null\n    relation: orgModel.Relation\n}\n\nexport interface LoadError extends OrganizationCentricAction<ActionFlag.ORGANIZATION_CENTRIC_VIEW_LOAD_ERROR> {\n    type: ActionFlag.ORGANIZATION_CENTRIC_VIEW_LOAD_ERROR,\n    error: AppError\n}\n\nexport interface Unload extends OrganizationCentricAction<ActionFlag.ORGANIZATION_CENTRIC_VIEW_UNLOAD> {\n    type: ActionFlag.ORGANIZATION_CENTRIC_VIEW_UNLOAD\n}\n\n\nexport function loadStart(): LoadStart {\n    return {\n        type: ActionFlag.ORGANIZATION_CENTRIC_VIEW_LOAD_START\n    }\n}\n\nexport function loadSuccess({\n    organization,\n    pendingJoinRequest,\n    pendingJoinInvitation,\n    relation\n}: {\n        organization: orgModel.Organization,\n        pendingJoinRequest: requestModel.UserRequest | null,\n        pendingJoinInvitation: requestModel.UserInvitation | null,\n        relation: orgModel.Relation\n    }\n): LoadSuccess {\n    return {\n        type: ActionFlag.ORGANIZATION_CENTRIC_VIEW_LOAD_SUCCESS,\n        organization, pendingJoinRequest, pendingJoinInvitation, relation\n    }\n}\n\nexport function loadError(error: AppError): LoadError {\n    return {\n        type: ActionFlag.ORGANIZATION_CENTRIC_VIEW_LOAD_ERROR,\n        error: error\n    }\n}\n\nexport function unload(): Unload {\n    return {\n        type: ActionFlag.ORGANIZATION_CENTRIC_VIEW_UNLOAD\n    }\n}\n\n\nexport function load(organizationId: orgModel.OrganizationID) {\n    return async (dispatch: ThunkDispatch<StoreState, ValidityState, Action>, getState: () => StoreState) => {\n        dispatch(loadStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config }\n        } = getState()\n\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        const requestClient = new requestModel.RequestsModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n\n        try {\n            // get org\n            const organization = await orgClient.getOrg(organizationId)\n\n            // get pending requests\n            const request = await requestClient.getUserRequestForOrg(organizationId)\n            const invitation = await requestClient.getUserInvitationForOrg(organizationId)\n\n            const relation = orgModel.determineRelation(organization, username, request, invitation)\n\n            // current username is already here.\n            dispatch(loadSuccess({\n                organization, relation,\n                pendingJoinRequest: request,\n                pendingJoinInvitation: invitation\n            }))\n        } catch (ex) {\n            dispatch(loadError({\n                code: ex.name,\n                message: ex.message\n            }))\n        }\n    }\n}","import * as React from 'react'\n\nimport Container from './container'\n\nexport interface Props {\n    organizationId: string\n    view: types.OrganizationCentricView\n    onLoad: (organizationId: string) => void\n    onUnload: () => void\n}\n\ninterface State {\n}\n\nclass Loader extends React.Component<Props, State> {\n    constructor(props: Props) {\n        super(props)\n    }\n\n    renderLoading() {\n        return (\n            <div>\n                Loading header...\n            </div>\n        )\n    }\n\n    renderError(error: types.AppError) {\n        return (\n            <div>\n                Error!\n                <div>\n                    {error.message}\n                </div>\n            </div>\n        )\n    }\n\n    render() {\n\n        switch (this.props.view.loadingState) {\n            case types.ComponentLoadingState.NONE:\n                this.props.onLoad(this.props.organizationId)\n                return this.renderLoading()\n            case types.ComponentLoadingState.LOADING:\n                return this.renderLoading()\n            case types.ComponentLoadingState.ERROR:\n                if (this.props.view.error) {\n                    return this.renderError(this.props.view.error)\n                } else {\n                    return this.renderError({\n                        code: 'Missing Error',\n                        message: 'The error appears to be missing'\n                    })\n                }\n            default:\n                return (\n                    <Container />\n                )\n        }\n    }\n\n    componentWillUnmount() {\n        this.props.onUnload()\n    }\n}\n\n//\n\nimport { Dispatch } from 'redux'\nimport { connect } from 'react-redux'\n\nimport * as types from '../../../types'\nimport * as actions from '../../../redux/actions/organizationCentric'\n\nexport interface OwnProps {\n    organizationId: string\n}\n\ninterface StateProps {\n    view: types.OrganizationCentricView\n}\n\ninterface DispatchProps {\n    onLoad: (organizationId: string) => void\n    onUnload: () => void\n}\n\nfunction mapStateToProps(state: types.StoreState, props: OwnProps): StateProps {\n    return {\n        view: state.views.organizationCentricView\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<actions.Load>): DispatchProps {\n    return {\n        onLoad: (organizationId: string) => {\n            dispatch(actions.load(organizationId) as any)\n        },\n        onUnload: () => {\n            dispatch(actions.unload() as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, types.StoreState>(mapStateToProps, mapDispatchToProps)(Loader)","import * as React from 'react'\nimport marked from 'marked'\nimport { NavLink, Redirect } from 'react-router-dom'\n\nimport './component.css'\n\nimport { } from '../../../types'\nimport { Button, Modal, Icon, Tooltip, Card, Dropdown, Menu, Alert } from 'antd'\nimport Header from '../../Header'\nimport Member from '../../entities/MemberContainer';\nimport OrganizationHeader from '../organizationHeader/loader'\nimport * as orgModel from '../../../data/models/organization/model'\nimport * as requestModel from '../../../data/models/requests';\nimport OrganizationNarrative from '../../OrganizationNarrative'\n\nenum NavigateTo {\n    NONE = 0,\n    REQUEST_ADD_NARRATIVE\n}\n\nexport interface ViewOrganizationState {\n    showInfo: boolean\n    navigateTo: NavigateTo\n    requestAccess: {\n        narrative: orgModel.NarrativeResource | null\n    }\n}\n\nexport interface ViewOrganizationProps {\n    organization: orgModel.Organization\n    relation: orgModel.Relation\n    groupRequests: Array<requestModel.Request> | null\n    groupInvitations: Array<requestModel.Request> | null\n    onViewOrg: (id: string) => void\n    onJoinOrg: () => void\n    onCancelJoinRequest: (requestId: string) => void\n    onAcceptInvitation: (requestId: string) => void\n    onRejectInvitation: (requestId: string) => void\n    onRemoveNarrative: (narrative: orgModel.NarrativeResource) => void\n    onGetViewAccess: (narrative: orgModel.NarrativeResource) => void\n}\n\nclass ViewOrganization extends React.Component<ViewOrganizationProps, ViewOrganizationState> {\n    constructor(props: ViewOrganizationProps) {\n        super(props)\n\n        this.state = {\n            showInfo: false,\n            navigateTo: NavigateTo.NONE,\n            requestAccess: {\n                narrative: null\n            }\n        }\n    }\n\n    onViewMembers() {\n\n    }\n\n    onJoinClick() {\n        this.props.onJoinOrg()\n    }\n\n    onCancelJoinRequest() {\n        if (!this.props.organization) {\n            return\n        }\n        const relation = this.props.relation as orgModel.MembershipRequestPendingRelation\n        this.props.onCancelJoinRequest(relation.requestId)\n    }\n\n    onAcceptInvitation() {\n        if (!this.props.organization) {\n            return\n        }\n        const relation = this.props.relation as orgModel.MembershipRequestPendingRelation\n        this.props.onAcceptInvitation(relation.requestId)\n    }\n\n    onRejectInvitation() {\n        if (!this.props.organization) {\n            return\n        }\n        const relation = this.props.relation as orgModel.MembershipRequestPendingRelation\n        this.props.onRejectInvitation(relation.requestId)\n    }\n\n    onRequestAddNarrative() {\n        this.setState({ navigateTo: NavigateTo.REQUEST_ADD_NARRATIVE })\n    }\n\n    onRemoveNarrative(narrative: orgModel.NarrativeResource) {\n        this.props.onRemoveNarrative(narrative)\n    }\n\n    onNarrativeMenu(key: string, narrative: orgModel.NarrativeResource) {\n        switch (key) {\n            case 'removeNarrative':\n                this.props.onRemoveNarrative(narrative)\n                break\n        }\n    }\n\n    onShowInfo() {\n        // this.setState({ showInfo: true })\n        Modal.info({\n            title: 'View Organization Help',\n            width: '50em',\n            content: (\n                <div>\n                    <p>This is the organizations viewer...</p>\n                </div>\n            )\n        })\n    }\n\n    onRequestShare(narrative: orgModel.NarrativeResource) {\n        // Drawer.\n        // Drawer.open({\n        //     title: 'Request Access to Narrative',\n        //     content: 'Are you sure?'\n        // })\n        this.setState({ requestAccess: { narrative: narrative } })\n        // alert('not yet implemented')\n    }\n\n    onCloseRequestAccess() {\n        this.setState({ requestAccess: { narrative: null } })\n    }\n\n    buildFooter() {\n        return (\n            <div>\n                {this.renderEditRow()}\n                {/* <p style={{ textAlign: 'center' }}>\n                    You may also  <NavLink to={`/organizations`}><Button type=\"danger\" icon=\"undo\">Return to Orgs</Button></NavLink> to the organizations browser.\n                </p> */}\n            </div>\n        )\n    }\n\n    renderEditRow() {\n        if (this.props.relation.type === orgModel.UserRelationToOrganization.ADMIN ||\n            this.props.relation.type === orgModel.UserRelationToOrganization.OWNER) {\n            return (\n                <p style={{ textAlign: 'center' }}>\n                    As the owner of this group, you may <NavLink to={`/editOrganization/${this.props.organization!.id}`}><Button icon=\"edit\">Edit</Button></NavLink> it.\n                </p>\n            )\n        }\n    }\n\n    renderEditButton() {\n        if (this.props.relation.type === orgModel.UserRelationToOrganization.ADMIN ||\n            this.props.relation.type === orgModel.UserRelationToOrganization.OWNER) {\n            return (\n                <NavLink to={`/editOrganization/${this.props.organization!.id}`}><Button icon=\"edit\">Edit</Button></NavLink>\n            )\n        }\n    }\n\n    renderOrg() {\n        // apparently TS is not smart enough to know this from the conditional branch in render()!\n        if (!this.props.organization) {\n            return\n        }\n        return (\n            <div className=\"org\">\n                {/* <div className=\"nameAndLogo\">\n                    <div className=\"avatar\">\n                        {this.renderOrgAvatar(this.props.organization)}\n                    </div>\n                    <div className=\"nameAndLink\">\n                        <div className=\"name\">\n                            {this.props.organization.name}\n                        </div>\n                        <div className=\"id\">\n                            <span className=\"label\">permalink</span>{' '}\n                            <span className=\"permalinkBase\">https://narrative.kbase.us#orgs/</span>{this.props.organization.id}\n                        </div>\n                    </div>\n                </div> */}\n                <div className=\"description\"\n                    dangerouslySetInnerHTML={({ __html: marked(this.props.organization.description || '') })}\n                />\n\n            </div>\n        )\n    }\n\n    // TODO: this should be a component, so we can pick up all the good stuff, which is now commented out...\n    renderOwnerInfo(org: orgModel.Organization) {\n        return (\n            <div className=\"ownerTable\">\n                {/* <div className=\"avatarCol\">\n                    <Avatar user={org.owner.user} size={60} />\n                </div> */}\n                <div className=\"proprietorCol\">\n\n                    <div className=\"owner\">\n                        <a href={\"#people/\" + org.owner.username} target=\"_blank\">{org.owner.username}</a>\n                        {' '}\n                        {org.owner.username}\n                                </div>\n                    {/* <div className=\"profileOrganization\">\n                        {org.owner.user.organization}\n                    </div>\n                    <div className=\"profileOrganization\">\n                        {org.owner.user.city}, {org.owner.user.state}, {org.owner.user.country}\n                    </div> */}\n                </div>\n            </div>\n        )\n    }\n\n    renderOrgHeader() {\n        // apparently TS is not smart enough to know this from the conditional branch in render()!\n        if (!this.props.organization) {\n            return\n        }\n        return (\n            <OrganizationHeader organizationId={this.props.organization.id} />\n        )\n        // return (\n        //     <div className=\"orgHeader\">\n        //         <div className=\"avatar\">\n        //             {this.renderOrgAvatar(this.props.organization)}\n        //         </div>\n        //         <div className=\"orgInfo\">\n        //             <div className=\"name\">\n        //                 {this.props.organization.name}\n        //             </div>\n        //             <div className=\"id\">\n        //                 <span className=\"label\">permalink</span>{' '}\n        //                 <span className=\"permalinkBase\">https://narrative.kbase.us#orgs/</span>{this.props.organization.id}\n        //             </div>\n        //         </div>\n        //         <div className=\"ownerInfo\">\n        //             {this.renderOwnerInfo(this.props.organization)}\n        //         </div>\n        //         <div className=\"yourRelation\">\n        //             {this.renderRelation(this.props.organization)}\n        //         </div>\n\n        //     </div>\n        // )\n    }\n\n    getOrgAvatarUrl(org: orgModel.Organization) {\n        // const defaultImages = [\n        //     'orgs-64.png',\n        //     'unicorn-64.png'\n        // ]\n        // if (!org.gravatarHash) {\n        //     return defaultImages[Math.floor(Math.random() * 2)]\n        // }\n        if (!org.gravatarHash) {\n            return 'unicorn-64.png'\n        }\n        const gravatarDefault = 'identicon';\n\n        return 'https://www.gravatar.com/avatar/' + org.gravatarHash + '?s=64&amp;r=pg&d=' + gravatarDefault;\n    }\n\n    renderOrgAvatar(org: orgModel.Organization) {\n        return (\n            <img style={{ width: 64, height: 64 }}\n                src={this.getOrgAvatarUrl(org)} />\n        )\n    }\n\n\n    renderRelation(relation: orgModel.Relation) {\n        switch (relation.type) {\n            case (orgModel.UserRelationToOrganization.NONE):\n                return (\n                    <span><Icon type=\"stop\" />None</span>\n                )\n            case (orgModel.UserRelationToOrganization.VIEW):\n                return (\n                    <Tooltip\n                        placement=\"bottomRight\"\n                        mouseEnterDelay={0.5}\n                        title=\"You are not a member of this org, but you may access it; you may request membership\"\n                    >\n                        <div><Icon type=\"eye\" style={{ marginRight: '4px' }} />You are not a member of this Organization</div>\n                        <div style={{ marginTop: '10px' }}>\n                            <Button\n                                onClick={this.onJoinClick.bind(this)}>\n                                Join this Organization\n                            </Button>\n                        </div>\n                    </Tooltip>\n                )\n            case (orgModel.UserRelationToOrganization.MEMBER_REQUEST_PENDING):\n                return (\n                    <div>\n                        <div><Icon type=\"user\" style={{ color: 'orange' }} spin={true} />Your membership <b>request</b> is pending</div>\n                        <div><Button icon=\"delete\" type=\"danger\" onClick={this.onCancelJoinRequest.bind(this)}>Cancel Request</Button></div>\n                    </div>\n                )\n            case (orgModel.UserRelationToOrganization.MEMBER_INVITATION_PENDING):\n                return (\n                    <div>\n                        <div><Icon type=\"user\" style={{ color: 'blue' }} />You have been <b>invited</b> to join this Organization</div>\n                        <div style={{ marginTop: '10px' }}>\n                            <Button icon=\"check\" type=\"default\" onClick={this.onAcceptInvitation.bind(this)}>Accept Invitation</Button>\n                            <Button icon=\"stop\" type=\"danger\" onClick={this.onRejectInvitation.bind(this)}>Reject Invitation</Button>\n                        </div>\n                    </div>\n                )\n            case (orgModel.UserRelationToOrganization.MEMBER):\n                return (<span><Icon type=\"user\" />Member</span>)\n            case (orgModel.UserRelationToOrganization.ADMIN):\n                return (<span><Icon type=\"unlock\" />Admin</span>)\n            case (orgModel.UserRelationToOrganization.OWNER):\n                return (\n                    <Tooltip\n                        placement=\"bottomRight\"\n                        mouseEnterDelay={0.5}\n                        title=\"You own this org\"\n                    >\n                        <span><Icon type=\"unlock\" theme=\"filled\" style={{ marginRight: '4px' }} />You own this organization</span>\n                    </Tooltip>\n                )\n        }\n    }\n\n    isMember(): boolean {\n        if (!this.props.organization) {\n            return false\n        }\n        if (this.props.relation.type === orgModel.UserRelationToOrganization.OWNER ||\n            this.props.relation.type === orgModel.UserRelationToOrganization.ADMIN ||\n            this.props.relation.type === orgModel.UserRelationToOrganization.MEMBER) {\n            return true\n        }\n        return false\n    }\n\n    renderMembers() {\n        let members: JSX.Element | Array<JSX.Element>\n        if (this.props.organization.members.length === 0) {\n            members = (\n                <p style={{ fontStyle: 'italic', textAlign: 'center' }}>\n                    This organization has no members\n                </p>\n            )\n        } else {\n            members = this.props.organization.members.map((member) => {\n                return (\n                    <div className=\"row\" key={member.username}>\n                        <div className=\"col0\">\n                            <Member member={member} avatarSize={50} />\n                        </div>\n                    </div>\n                )\n            })\n        }\n        return (\n            <div className=\"infoTable\">\n                {members}\n            </div>\n        )\n    }\n\n    renderInfo() {\n        // apparently TS is not smart enough to know this from the conditional branch in render()!\n        if (!this.props.organization) {\n            return\n        }\n        return (\n            <Card\n                title={<span><Icon type=\"info-circle\"></Icon> info</span>}\n                headStyle={{ backgroundColor: 'gray', color: 'white' }}\n                className=\"slimCard\">\n                <div>\n                    <div>\n                        <div className=\"label\">owner</div>\n                    </div>\n                    <div className=\"ownerTable\">\n                        <Member member={this.props.organization.owner} avatarSize={50} />\n                        {/* TODO: fix avatar component */}\n                        {/* <div className=\"avatarCol\">\n                            <Avatar user={this.props.organization.owner.username} size={60} />\n                        </div>\n                        <div className=\"proprietorCol\">\n                            <div className=\"owner\">\n                                <a href={\"#people/\" + this.props.organization.owner.user.username} target=\"_blank\">{this.props.organization.owner.user.realname}</a>\n                                {' '}\n                                {this.props.organization.owner.user.username}\n                                        </div>\n                            <div className=\"profileOrganization\">\n                                {this.props.organization.owner.user.organization}\n                            </div>\n                            <div className=\"profileOrganization\">\n                                {this.props.organization.owner.user.city}, {this.props.organization.owner.user.state}, {this.props.organization.owner.user.country}\n                            </div>\n                        </div> */}\n                    </div>\n                    <div className='infoTable'>\n                        <div className=\"row\">\n                            <div className=\"col1\">\n                                <span className=\"label\">established</span>\n                            </div>\n                            <div className=\"col2\">\n                                <div className=\"createdAt\">\n                                    {Intl.DateTimeFormat('en-US', {\n                                        month: 'long',\n                                        day: 'numeric',\n                                        year: 'numeric'\n                                    }).format(this.props.organization.createdAt)}\n                                </div>\n                            </div>\n                        </div>\n\n                        <div className=\"row\">\n                            <div className=\"col1\">\n                                <span className=\"label\">last updated</span>\n                            </div>\n                            <div className=\"col2\">\n                                <div className=\"modifiedAt\">\n                                    {Intl.DateTimeFormat('en-US', {\n                                        month: 'long',\n                                        day: 'numeric',\n                                        year: 'numeric'\n                                    }).format(this.props.organization.modifiedAt)}\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </Card>\n        )\n    }\n\n    renderGroupRequestsRow() {\n        const relation = this.props.relation\n        const requests = this.props.groupRequests\n        const invitations = this.props.groupInvitations\n\n        if (!(relation.type === orgModel.UserRelationToOrganization.ADMIN ||\n            relation.type === orgModel.UserRelationToOrganization.OWNER)) {\n            return\n        }\n        // TODO: bad. should not get here in this case...\n        if (requests === null || invitations === null) {\n            return\n        }\n        let inner\n        if (requests.length) {\n            inner = (\n                <div>\n                    group has no pending requests\n                </div>\n            )\n        } else {\n            inner = (\n                <div>\n                    <div>\n                        <Icon type=\"exclamation-circle\" theme=\"twoTone\" twoToneColor=\"orange\" /> group has\n                        {' '}\n                        <span style={{ fontWeight: 'bold' }}>{requests.length}</span>\n                        {' '}\n                        pending request{requests.length > 1 ? 's' : ''}\n                        {' '}\n                        and\n                        {' '}\n                        <span style={{ fontWeight: 'bold' }}>{invitations.length}</span>\n                        {' '}\n                        pending request{invitations.length > 1 ? 's' : ''}\n\n                    </div>\n                    <div>\n                        <NavLink to={\"/manageOrganizationRequests/\" + this.props.organization.id}>\n                            <Button>Manage Requests</Button>\n                        </NavLink>\n                    </div>\n                </div>\n            )\n        }\n        return (\n            <div className=\"row\">\n                <div className=\"col1\">\n                    <span className=\"label\">admin</span>\n                </div>\n                <div className=\"col2\">\n                    <div className=\"relation\">\n                        {inner}\n                    </div>\n                </div>\n            </div>\n\n        )\n    }\n\n    renderGroupRequests(requests: Array<requestModel.Request>, invitations: Array<requestModel.Request>) {\n        if (!requests.length) {\n            return (\n                <div>\n                    There are no pending group requests\n                </div>\n            )\n        } else {\n            return (\n                <div>\n                    <div>\n                        <Icon type=\"exclamation-circle\" theme=\"twoTone\" twoToneColor=\"orange\" /> There\n                        {' '}\n                        {requests.length > 1 ? 'are' : 'is'}\n                        {' '}\n                        <span style={{ fontWeight: 'bold' }}>{requests.length}</span>\n                        {' '}\n                        pending request{requests.length > 1 ? 's' : ''}\n                        {' '}\n                        and\n                        {' '}\n                        <span style={{ fontWeight: 'bold' }}>{invitations.length}</span>\n                        {' '}\n                        pending invitation{invitations.length > 1 ? 's' : ''}\n                    </div>\n                    <div>\n                        <NavLink to={\"/manageOrganizationRequests/\" + this.props.organization!.id}>\n                            <Button>Manage Requests</Button>\n                        </NavLink>\n                    </div>\n                </div>\n            )\n        }\n        // return (\n        //     <div className=\"row\">\n        //         <div className=\"col1\">\n        //             <span className=\"label\">admin</span>\n        //         </div>\n        //         <div className=\"col2\">\n        //             <div className=\"relation\">\n        //                 {inner}\n        //             </div>\n        //         </div>\n        //     </div>\n\n        // )\n\n        // return (\n        //     <div>\n        //         <div>\n        //             <Icon type=\"exclamation-circle\" theme=\"twoTone\" twoToneColor=\"orange\" /> group has\n        //             {' '}\n        //             <span style={{ fontWeight: 'bold' }}>{org.adminRequests.length}</span>\n        //             {' '}\n        //             pending request{org.adminRequests.length > 1 ? 's' : ''}\n        //         </div>\n        //         <div>\n        //             <NavLink to={\"/manageOrganizationRequests/\" + this.props.organization!.id}>\n        //                 <Button>Manage Requests</Button>\n        //             </NavLink>\n        //         </div>\n        //     </div>\n        // )\n    }\n\n    renderRelationClass(relation: orgModel.Relation) {\n        switch (relation.type) {\n            case (orgModel.UserRelationToOrganization.NONE):\n                return 'infoBox'\n            case (orgModel.UserRelationToOrganization.VIEW):\n                return 'infoBox'\n            case (orgModel.UserRelationToOrganization.MEMBER_REQUEST_PENDING):\n                return 'infoBox relationRequestPending'\n            case (orgModel.UserRelationToOrganization.MEMBER_INVITATION_PENDING):\n                return 'infoBox relationInvitationPending'\n            case (orgModel.UserRelationToOrganization.MEMBER):\n                return 'infoBox'\n            case (orgModel.UserRelationToOrganization.ADMIN):\n                return 'infoBox'\n            case (orgModel.UserRelationToOrganization.OWNER):\n                return 'infoBox'\n        }\n    }\n\n    renderUserRelationship() {\n        // apparently TS is not smart enough to know this from the conditional branch in render()!\n        return (\n            <form className=\"infoTable\">\n                {/* <div className=\"row\">\n                    <div className=\"col1\">\n                        <span className=\"label\">your relation</span>\n                    </div>\n                    <div className=\"col2\">\n                        <div className='relation'>\n                            {this.renderRelation(this.props.organization)}\n                        </div>\n                    </div>\n                </div> */}\n                {this.renderGroupRequestsRow()}\n            </form>\n        )\n    }\n\n    renderAdminTasks() {\n        const relation = this.props.relation\n        if (!(relation.type === orgModel.UserRelationToOrganization.ADMIN ||\n            relation.type === orgModel.UserRelationToOrganization.OWNER)) {\n            return\n        }\n        // TODO: ditto -- silly to test both conditions (this is only to make TS happy btw)\n        const { groupRequests, groupInvitations } = this.props\n        if (groupInvitations === null || groupRequests === null) {\n            return\n        }\n        const count = groupRequests.length + groupInvitations.length\n        const title = (\n            <span><Icon type=\"unlock\" />\n                {' '}\n                group requests\n                {' '}\n                <span className=\"titleCount\">({count})</span>\n            </span>\n        )\n        return (\n            <div className=\"adminTasksBox\">\n                <Card\n                    className=\"slimCard adminTasksCard\"\n                    headStyle={{ backgroundColor: 'gray', color: 'white' }}\n                    title={title} >\n                    {this.renderGroupRequests(groupRequests, groupInvitations)}\n                </Card>\n            </div>\n        )\n    }\n\n    renderJoinButton() {\n        if (!this.props.organization) {\n            return\n        }\n        if (this.props.relation.type !== orgModel.UserRelationToOrganization.VIEW) {\n            return\n        }\n        return (\n            <Button\n                onClick={this.onJoinClick.bind(this)}\n            >\n                Join this Organization\n                </Button>\n        )\n    }\n\n    renderHeader() {\n        const breadcrumbs = (\n            <div style={{ flex: '0 0 auto' }}>\n                <span>\n                    Viewing Org \"\n                    {this.props.organization && this.props.organization.name}\n                    \"\n                </span>\n            </div>\n        )\n        const buttons = (\n            <React.Fragment>\n                {this.renderEditButton()}\n                {this.renderJoinButton()}\n                <Button shape=\"circle\" icon=\"info\" onClick={this.onShowInfo.bind(this)}></Button>\n            </React.Fragment>\n        )\n        return (\n            <Header breadcrumbs={breadcrumbs} buttons={buttons} />\n        )\n    }\n\n    renderLoadingHeader() {\n        const breadcrumbs = (\n            <span>\n                Loading Org...\n            </span>\n        )\n        return (\n            <Header breadcrumbs={breadcrumbs} />\n        )\n    }\n\n    renderMembersCard() {\n        const extras = [\n            (\n                <NavLink\n                    key=\"viewMembers\"\n                    to={`/viewMembers/${this.props.organization!.id}`}>\n                    <Button\n                        onClick={this.onViewMembers.bind(this)}\n                        icon=\"team\"></Button>\n                </NavLink>\n            )\n        ]\n        if (!this.props.organization) {\n            return\n        }\n        // if (this.props.organization.relation.type === UserRelationToOrganization.OWNER ||\n        //     this.props.organization.relation.type === UserRelationToOrganization.ADMIN) {\n        //     extras.push((\n        //         <Button icon=\"setting\"></Button>\n        //     ))\n        // }\n        let memberCount\n        if (this.isMember()) {\n            memberCount = (\n                <span className=\"titleCount\">({this.props.organization.members.length})</span>\n            )\n        } else {\n            memberCount = ''\n        }\n        return (\n            <Card\n                className=\"slimCard membersCard\"\n                headStyle={{ backgroundColor: 'gray', color: 'white' }}\n                title={<span><Icon type=\"team\" /> members {memberCount}</span>}\n                extra={extras}\n            >\n                {this.renderMembers()}\n            </Card>\n        )\n    }\n\n\n    renderNarrativeMenu(narrative: orgModel.NarrativeResource) {\n        const relation = this.props.relation\n        const isAdmin = (relation.type === orgModel.UserRelationToOrganization.OWNER ||\n            relation.type === orgModel.UserRelationToOrganization.ADMIN)\n        let menu\n        switch (relation.type) {\n            case (orgModel.UserRelationToOrganization.NONE):\n                // should never occur\n                break;\n            case (orgModel.UserRelationToOrganization.VIEW):\n            case (orgModel.UserRelationToOrganization.MEMBER_REQUEST_PENDING):\n            case (orgModel.UserRelationToOrganization.MEMBER_INVITATION_PENDING):\n            case (orgModel.UserRelationToOrganization.MEMBER):\n                break;\n            case (orgModel.UserRelationToOrganization.ADMIN):\n            case (orgModel.UserRelationToOrganization.OWNER):\n                menu = (\n                    <Menu onClick={({ key }) => { this.onNarrativeMenu(key, narrative) }}>\n                        <Menu.Item key=\"removeNarrative\">\n                            <Icon type=\"delete\" /> Remove Narrative from Organization\n                        </Menu.Item>\n                    </Menu>\n                )\n        }\n        if (!menu) {\n            return\n        }\n        return (\n            <Dropdown overlay={menu} trigger={['click']}>\n                <Button shape=\"circle\">\n                    <Icon type=\"setting\" theme=\"filled\" style={{ fontSize: '120%' }} />\n                </Button>\n            </Dropdown>\n        )\n    }\n\n    renderNarratives() {\n        if (!this.isMember()) {\n            return (\n                <Card\n                    className=\"slimCard  narratives\"\n                    headStyle={{ backgroundColor: 'gray', color: 'white' }}\n                    title={<span><Icon type=\"folder-open\" /> narratives</span>}\n                >\n                    <p style={{ textAlign: 'center', fontStyle: 'italic' }}>\n                        Sorry, Narratives are restricted to members only\n                </p>\n                </Card>\n            )\n        }\n        const extras = [\n            (\n                <NavLink\n                    key=\"requestAddNarrative\"\n                    to={`/requestAddNarrative/${this.props.organization!.id}`}>\n                    <Button\n                        onClick={this.onRequestAddNarrative.bind(this)}>\n                        <Icon type=\"plus\" /> Add a Narrative\n                    </Button>\n                </NavLink>\n            )\n        ]\n\n        if (this.props.organization.narratives.length === 0) {\n            const message = 'Sorry, no Narratives are yet associated with this Organization'\n            return (\n                <Card\n                    className=\"slimCard  narratives\"\n                    headStyle={{ backgroundColor: 'gray', color: 'white' }}\n                    title={<span><Icon type=\"folder-open\" /> narratives (none)</span>}\n                    extra={extras}\n                >\n                    <Alert type=\"info\" message={message} />\n                </Card>\n            )\n\n        }\n\n        const narrativesTable = this.props.organization.narratives.map((narrative) => {\n            // create buttons or not, depending on being an admin\n\n            return (\n                <div className=\"narrative\" key={String(narrative.workspaceId)}>\n                    <div className=\"dataCol\">\n                        <OrganizationNarrative\n                            narrative={narrative}\n                            onGetViewAccess={this.props.onGetViewAccess} />\n                    </div>\n                    <div className=\"buttonCol\">\n                        {this.renderNarrativeMenu(narrative)}\n                    </div>\n                </div>\n            )\n        })\n\n        const narrativeCount = this.props.organization.narratives.length\n        const title = (\n            <span>\n                <Icon type=\"folder-open\" />\n                {' '}\n                narratives\n                {' '}\n                <span className=\"titleCount\">({narrativeCount})</span>\n            </span>\n        )\n        return (\n            <Card\n                className=\"slimCard narratives narrativesCard scrollable-flex-column\"\n                headStyle={{ backgroundColor: 'gray', color: 'white' }}\n                title={title}\n                extra={extras}\n            >\n                <div className=\"narrativesTable\">\n                    {narrativesTable}\n                </div>\n            </Card>\n        )\n    }\n\n    render() {\n        switch (this.state.navigateTo) {\n            case NavigateTo.REQUEST_ADD_NARRATIVE:\n                return (\n                    <Redirect to={\"/requestAddNarrative\"} />\n                )\n            case NavigateTo.NONE:\n            default:\n            // do nothing.\n        }\n        let accessModal\n        if (this.state.requestAccess.narrative && this.props.organization) {\n            // TODO: replace with our own implementation...n\n            // accessModal = (\n            //     <Drawer title=\"Request Access to Narrative\"\n            //         placement=\"right\"\n            //         closable={true}\n            //         visible={true}\n            //         onClose={() => { this.onCloseRequestAccess.call(this) }}\n            //     >\n            //         Requesting access...\n            //     </Drawer>\n            // )\n            const relation = this.props.relation\n            const isMember = relation.type === orgModel.UserRelationToOrganization.MEMBER ||\n                relation.type === orgModel.UserRelationToOrganization.ADMIN ||\n                relation.type === orgModel.UserRelationToOrganization.OWNER\n\n            // another type narrowing hack \n            // TODO: restore this ... requestaccess component needs a container to load the username \n            // from the store\n            // if (isMember) {\n            //     accessModal = (\n            //         <RequestAccess\n            //             narrative={this.state.requestAccess.narrative}\n            //             organization={this.props.organization}\n            //             // member={member}\n            //             onClose={() => { this.onCloseRequestAccess.call(this) }} />\n            //     )\n            // }\n        }\n        if (typeof this.props.organization !== 'undefined') {\n            return (\n                <div className=\"ViewOrganization  scrollable-flex-column\">\n                    {this.renderHeader()}\n                    {this.renderOrgHeader()}\n                    <div className=\"mainRow  scrollable-flex-column\">\n                        <div className=\"mainColumn  scrollable-flex-column\">\n                            <div className=\"orgRow\">\n                                {this.renderOrg()}\n                            </div>\n                            <div className=\"narrativesRow scrollable-flex-column\">\n                                {this.renderNarratives()}\n                            </div>\n                        </div>\n                        <div className=\"infoColumn\">\n                            {/* <div className={this.renderRelationClass(this.props.organization)}>\n                                {this.renderAdminTasks()}\n                            </div> */}\n                            {this.renderAdminTasks()}\n                            <div className=\"infoBox\">\n                                {this.renderInfo()}\n                            </div>\n                            {this.renderMembersCard()}\n                        </div>\n                    </div>\n                    {accessModal}\n                </div>\n            )\n        }\n        return (\n            <div className=\"ViewOrganization\">\n                {this.renderLoadingHeader()}\n                Loading...\n            </div>\n        )\n    }\n}\n\nexport default ViewOrganization","import * as React from 'react'\nimport * as orgModel from '../data/models/organization/model'\nimport { Button, Tooltip, Icon, Drawer } from 'antd';\n\nexport interface Props {\n    narrative: orgModel.NarrativeResource\n    onGetViewAccess: (narrative: orgModel.NarrativeResource) => void\n}\n\ninterface State {\n    requestAccess: boolean\n}\n\nexport default class OrganizationNarrative extends React.Component<Props, State> {\n    constructor(props: Props) {\n        super(props)\n\n        this.state = {\n            requestAccess: false\n        }\n    }\n\n    onGetViewAccess() {\n        this.props.onGetViewAccess(this.props.narrative)\n    }\n\n    onRequestAccess() {\n        this.setState({ requestAccess: true })\n    }\n\n    onCloseRequestAccess() {\n        this.setState({ requestAccess: false })\n    }\n\n    renderNarrativePermission(narrative: orgModel.NarrativeResource) {\n        let label\n        let shareButton\n        let permissionTooltip\n        let buttonTooltip\n        switch (narrative.permission) {\n            case orgModel.UserWorkspacePermission.NONE:\n                if (narrative.isPublic) {\n                    permissionTooltip = \"You have View access to this narrative narrative because it is shared publicly; you may view it, but not edit, run, or share it\"\n                    label = (\n                        <span>\n                            View Only (public)\n                            </span>\n                    )\n                    buttonTooltip = 'Although you have View-Only access to this Narrative due to it being shared globally, you can obtain personal View-Only access by clicking this button'\n                    shareButton = (\n                        <Button size=\"small\" onClick={() => { this.onGetViewAccess.call(this) }}>\n                            Click for Access\n                        </Button>\n                    )\n                } else {\n                    permissionTooltip = \"You have No access to this narrative narrative; you may not view, edit, run, or share it\"\n                    label = (\n                        <span>\n                            No Access\n                        </span>\n                    )\n                    buttonTooltip = 'You cannot access this Narrative; in order to immediately obtain View-Only access click this button.'\n                    shareButton = (\n                        <Button size=\"small\" onClick={() => { this.onGetViewAccess.call(this) }}>\n                            Click for Access\n                        </Button>\n                    )\n                }\n                break\n            case orgModel.UserWorkspacePermission.VIEW:\n                permissionTooltip = \"You have View access to this narrative narrative; you may view it, but not edit, run, or share it\"\n                label = (\n                    <span>\n                        View Only\n                        </span>\n                )\n                buttonTooltip = 'You already have View-Only access to this Narrative, but may request additional access'\n                shareButton = (\n                    <Button size=\"small\" onClick={() => { this.onRequestAccess.call(this) }}>\n                        Request Additional Access\n                    </Button>\n                )\n                break\n            case orgModel.UserWorkspacePermission.EDIT:\n                permissionTooltip = \"You have Edit access to this Narrative; you may view, edit, and run, but not share it\"\n                label = (\n                    <span>\n                        Edit\n                        </span>\n                )\n                buttonTooltip = 'You already have Edit access to this Narrative, but may request additional access by clicking this button'\n                shareButton = (\n                    <Button size=\"small\" onClick={() => { this.onRequestAccess.call(this) }}>\n                        Request Admin Access\n                    </Button>\n                )\n                break\n            case orgModel.UserWorkspacePermission.ADMIN:\n                permissionTooltip = \"You have Admin access to this narrative narrative; you may view, edit, run, and share it\"\n                label = (\n                    <span>\n                        Admin\n                        </span>\n                )\n                break\n            case orgModel.UserWorkspacePermission.OWNER:\n                permissionTooltip = \"You are the Owner of this narrative; you may view, edit, run, and share it\"\n                label = (\n                    <span>\n                        Owner\n                        </span>\n                )\n                break\n            default:\n                label = (\n                    <span>\n                        Unknown\n                    </span>\n                )\n        }\n\n        return (\n            <React.Fragment>\n                <Tooltip title={permissionTooltip} placement=\"right\">\n                    <span style={{ cursor: 'help' }}>\n                        <span className=\"field-label\">your permission</span>\n                        {label}\n                    </span>\n                </Tooltip>\n                {' '}\n                <Tooltip title={buttonTooltip} placement=\"right\">\n                    {shareButton}\n                </Tooltip>\n            </React.Fragment>\n        )\n    }\n\n    renderPublicPermission(narrative: orgModel.NarrativeResource) {\n        if (narrative.isPublic) {\n            return (\n                <Tooltip title=\"This narrative is viewable by all KBase users\" placement=\"right\">\n                    <span style={{ cursor: 'help' }}>\n                        <Icon type=\"globe\" /> Public Narrative\n                    </span>\n                </Tooltip>\n            )\n        } else {\n            return (\n                <Tooltip title=\"This narrative is only accessible to those with whom it is directly shared\" placement=\"right\">\n                    <span style={{ cursor: 'help' }}>\n                        <Icon type=\"lock\" /> Private Narrative\n                    </span>\n                </Tooltip>\n            )\n        }\n    }\n\n    renderNarrative() {\n        const narrative = this.props.narrative\n        if (narrative.permission === orgModel.UserWorkspacePermission.NONE) {\n            return (\n                <React.Fragment>\n                    <div className=\"title\">{narrative.title}</div>\n                    <div>{this.renderPublicPermission(narrative)}</div>\n                    <div>{this.renderNarrativePermission(narrative)}</div>\n\n                    {/* <div><i>abstract here?</i></div> */}\n                    <div><i>One-liner abstract?</i></div>\n                    <div><i>created, saved info here?</i></div>\n                </React.Fragment>\n            )\n        } else {\n            return (\n                <React.Fragment>\n                    <div className=\"title\"><a href={'https://ci.kbase.us/narrative/ws.' + narrative.workspaceId + '.obj.' + '1'} target=\"_blank\">{narrative.title}</a></div>\n                    <div>{this.renderPublicPermission(narrative)}</div>\n                    <div>{this.renderNarrativePermission(narrative)}</div>\n\n                    {/* <div><i>abstract here?</i></div> */}\n                    <div><i>One-liner abstract?</i></div>\n                    <div><i>created, saved info here?</i></div>\n                </React.Fragment>\n            )\n        }\n    }\n\n    render() {\n        let accessModal\n        if (this.state.requestAccess) {\n            // TODO: replace with our own implementation...n\n            accessModal = (\n                <Drawer title=\"Request Access to Narrative\"\n                    placement=\"right\"\n                    closable={true}\n                    visible={true}\n                    onClose={() => { this.onCloseRequestAccess.call(this) }}\n                >\n                    Requesting access...\n                </Drawer>\n            )\n        }\n\n        return (\n            <div>\n                {this.renderNarrative()}\n                {accessModal}\n            </div>\n        )\n    }\n}","import { Dispatch, Action } from 'redux'\nimport { connect } from 'react-redux'\n\nimport { StoreState } from '../../../types'\nimport * as actions from '../../../redux/actions/viewOrg'\n\nimport ViewOrganization from './component'\n\nimport * as orgModel from '../../../data/models/organization/model'\nimport * as requestModel from '../../../data/models/requests';\n\n// Props for this component\n\n// The interface for this container component\nexport interface OwnProps {\n}\n\n// the interface for mapStateTo props\ninterface StateProps {\n    organization: orgModel.Organization\n    relation: orgModel.Relation\n    groupRequests: Array<requestModel.Request> | null\n    groupInvitations: Array<requestModel.Request> | null\n}\n\n// the interface for mapDispatchToProps\ninterface DispatchProps {\n    onViewOrg: (id: string) => void\n    onJoinOrg: () => void\n    onCancelJoinRequest: (requestId: string) => void\n    onAcceptInvitation: (requestId: string) => void\n    onRejectInvitation: (requestId: string) => void\n    onRemoveNarrative: (narrative: orgModel.NarrativeResource) => void\n    onGetViewAccess: (narrative: orgModel.NarrativeResource) => void\n}\n\n// hmm this bit would be for the interface for the wrapped component.\n// can't really do that here, but _could_ export the interfaces above\n// and compose them thus in the wrapped component. But the wrapped component\n// should know nothing about this business\n// type Props = StateProps & DispatchProps & OwnProps\n\n\nfunction mapStateToProps(state: StoreState, ownProps: OwnProps): StateProps {\n    if (!state.views.viewOrgView.viewModel) {\n        throw new Error('argh, view model missing')\n    }\n    const {\n        views: {\n            viewOrgView: {\n                viewModel: {\n                    organization, relation, groupRequests, groupInvitations\n                }\n            }\n        }\n    } = state\n    // TODO: of course this really needs to be an async fetch of the org info!\n    return {\n        organization, relation, groupRequests, groupInvitations\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<Action>): DispatchProps {\n    return {\n        onViewOrg: (id: string) => {\n            dispatch(actions.load(id) as any)\n        },\n        onJoinOrg: () => {\n            dispatch(actions.viewOrgJoinRequest() as any)\n        },\n        onCancelJoinRequest: (requestId: string) => {\n            dispatch(actions.viewOrgCancelJoinRequest(requestId) as any)\n        },\n        onAcceptInvitation: (requestId: string) => {\n            dispatch(actions.acceptJoinInvitation(requestId) as any)\n        },\n        onRejectInvitation: (requestId: string) => {\n            dispatch(actions.rejectJoinInvitation(requestId) as any)\n        },\n        onRemoveNarrative: (narrative: orgModel.NarrativeResource) => {\n            dispatch(actions.removeNarrative(narrative) as any)\n        },\n        onGetViewAccess: (narrative: orgModel.NarrativeResource) => {\n            dispatch(actions.accessNarrative(narrative) as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(ViewOrganization)\n\n// export default connect(mapStateToProps, mapDispatchToProps)(ViewOrganization) \n\n","import * as React from 'react'\n\nimport Container from './container'\n\nexport interface Props {\n    organizationId: string\n    view: types.ViewOrgView\n    onLoad: (organizationId: string) => void\n    onUnload: () => void\n}\n\ninterface State {\n}\n\nclass Loader extends React.Component<Props, State> {\n    constructor(props: Props) {\n        super(props)\n    }\n\n    renderLoading() {\n        return (\n            <div>\n                Loading Your Narratives...\n            </div>\n        )\n    }\n\n    renderError(error: types.AppError) {\n        return (\n            <div>\n                Error!\n                <div>\n                    {error.message}\n                </div>\n            </div>\n        )\n    }\n\n    render() {\n\n        switch (this.props.view.loadingState) {\n            case types.ComponentLoadingState.NONE:\n                this.props.onLoad(this.props.organizationId)\n                return this.renderLoading()\n            case types.ComponentLoadingState.LOADING:\n                return this.renderLoading()\n            case types.ComponentLoadingState.ERROR:\n                if (this.props.view.error) {\n                    return this.renderError(this.props.view.error)\n                } else {\n                    return this.renderError({\n                        code: 'Missing Error',\n                        message: 'The error appears to be missing'\n                    })\n                }\n            default:\n                return (\n                    <Container />\n                )\n        }\n    }\n\n    componentWillUnmount() {\n        this.props.onUnload()\n    }\n}\n\n//\n\nimport { Dispatch } from 'redux'\nimport { connect } from 'react-redux'\n\nimport * as types from '../../../types'\nimport * as actions from '../../../redux/actions/viewOrg'\n\nexport interface OwnProps {\n    organizationId: string\n}\n\ninterface StateProps {\n    view: types.ViewOrgView\n}\n\ninterface DispatchProps {\n    onLoad: (organizationId: string) => void\n    onUnload: () => void\n}\n\nfunction mapStateToProps(state: types.StoreState, props: OwnProps): StateProps {\n    return {\n        view: state.views.viewOrgView\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<actions.Load>): DispatchProps {\n    return {\n        onLoad: (organizationId: string) => {\n            dispatch(actions.load(organizationId) as any)\n        },\n        onUnload: () => {\n            dispatch(actions.unload() as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, types.StoreState>(mapStateToProps, mapDispatchToProps)(Loader)","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\n\nimport { ActionFlag } from './index'\nimport { StoreState, AppError, UIError, UIErrorType, EditableOrganization, ValidationState, EditState } from '../../types'\nimport Validation from '../../data/models/organization/validation'\nimport * as orgModel from '../../data/models/organization/model'\n\n// ACTIONS\n\n// Loading the editor\nexport interface Load extends Action {\n    type: ActionFlag.EDIT_ORG_LOAD,\n    organizationId: string\n}\n\nexport interface LoadStart extends Action {\n    type: ActionFlag.EDIT_ORG_LOAD_START\n}\n\nexport interface LoadSuccess extends Action {\n    type: ActionFlag.EDIT_ORG_LOAD_SUCCESS,\n    editedOrganization: EditableOrganization,\n    organization: orgModel.Organization\n}\n\nexport interface LoadError extends Action<ActionFlag.EDIT_ORG_LOAD_ERROR> {\n    type: ActionFlag.EDIT_ORG_LOAD_ERROR,\n    error: AppError\n}\n\nexport interface Unload extends Action<ActionFlag.EDIT_ORG_UNLOAD> {\n    type: ActionFlag.EDIT_ORG_UNLOAD\n}\n\n// Evaluating state of form \n\nexport interface EditOrgEvaluate extends Action<ActionFlag.EDIT_ORG_EVALUATE> {\n    type: ActionFlag.EDIT_ORG_EVALUATE\n}\n\nexport interface EditOrgEvaluateOK extends Action<ActionFlag.EDIT_ORG_EVALUATE_OK> {\n    type: ActionFlag.EDIT_ORG_EVALUATE_OK\n}\n\nexport interface EditOrgEvaluateErrors extends Action<ActionFlag.EDIT_ORG_EVALUATE_ERRORS> {\n    type: ActionFlag.EDIT_ORG_EVALUATE_ERRORS\n}\n\n// Saving\n\nexport interface EditOrgSave extends Action<ActionFlag.EDIT_ORG_SAVE> {\n    type: ActionFlag.EDIT_ORG_SAVE\n}\n\nexport interface EditOrgSaveStart extends Action<ActionFlag.EDIT_ORG_SAVE_START> {\n    type: ActionFlag.EDIT_ORG_SAVE_START\n}\n\nexport interface EditOrgSaveSuccess extends Action<ActionFlag.EDIT_ORG_SAVE_SUCCESS> {\n    type: ActionFlag.EDIT_ORG_SAVE_SUCCESS\n}\n\nexport interface EditOrgSaveError extends Action<ActionFlag.EDIT_ORG_SAVE_ERROR> {\n    type: ActionFlag.EDIT_ORG_SAVE_ERROR,\n    error: AppError\n}\n\n// Updating name field\n\nexport interface EditOrgUpdateName extends Action {\n    type: ActionFlag.EDIT_ORG_UPDATE_NAME,\n    name: string\n}\n\nexport interface EditOrgUpdateNameSuccess {\n    type: ActionFlag.EDIT_ORG_UPDATE_NAME_SUCCESS,\n    name: string\n}\n\nexport interface EditOrgUpdateNameError extends Action {\n    type: ActionFlag.EDIT_ORG_UPDATE_NAME_ERROR,\n    name: string,\n    error: UIError\n}\n\n// Updating gravatar hash field\n\nexport interface EditOrgUpdateGravatarHash extends Action {\n    type: ActionFlag.EDIT_ORG_UPDATE_GRAVATAR_HASH,\n    name: string\n}\n\nexport interface EditOrgUpdateGravatarHashSuccess {\n    type: ActionFlag.EDIT_ORG_UPDATE_GRAVATAR_HASH_SUCCESS,\n    gravatarHash: string\n}\n\nexport interface EditOrgUpdateGravatarHashError extends Action {\n    type: ActionFlag.EDIT_ORG_UPDATE_GRAVATAR_HASH_ERROR,\n    gravatarHash: string,\n    error: UIError\n}\n\n// Updating id Field\n\n// export interface EditOrgUpdateId extends Action {\n//     type: ActionFlag.EDIT_ORG_UPDATE_ID,\n//     id: string\n// }\n\n// export interface EditOrgUpdateIdSuccess {\n//     type: ActionFlag.EDIT_ORG_UPDATE_ID_SUCCESS,\n//     id: string\n// }\n\n// export interface EditOrgUpdateIdError extends Action {\n//     type: ActionFlag.EDIT_ORG_UPDATE_ID_ERROR,\n//     id: string,\n//     error: UIError\n// }\n\n// Updating description field\n\nexport interface EditOrgUpdateDescription extends Action {\n    type: ActionFlag.EDIT_ORG_UPDATE_DESCRIPTION,\n    description: string\n}\n\nexport interface EditOrgUpdateDescriptionSuccess {\n    type: ActionFlag.EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS,\n    description: string\n}\n\nexport interface EditOrgUpdateDescriptionError extends Action {\n    type: ActionFlag.EDIT_ORG_UPDATE_DESCRIPTION_ERROR,\n    description: string,\n    error: UIError\n}\n\n\n// ACTION CREATORS\n\n// export function editOrgStart(id: string): LoadStart {\n//     return {\n//         type: ActionFlag.EDIT_ORG_LOAD_START,\n//         id: id\n//     }\n// }\n\nexport function loadStart(): LoadStart {\n    return {\n        type: ActionFlag.EDIT_ORG_LOAD_START\n    }\n}\n\nexport function loadSuccess(editedOrganization: EditableOrganization, organization: orgModel.Organization): LoadSuccess {\n    return {\n        type: ActionFlag.EDIT_ORG_LOAD_SUCCESS,\n        editedOrganization: editedOrganization,\n        organization: organization\n    }\n}\n\nexport function loadError(error: AppError): LoadError {\n    return {\n        type: ActionFlag.EDIT_ORG_LOAD_ERROR,\n        error: error\n    }\n}\n\nexport function unload(): Unload {\n    return {\n        type: ActionFlag.EDIT_ORG_UNLOAD\n    }\n}\n\n// Evaluate\n\nexport function editOrgEvaluateOk(): EditOrgEvaluateOK {\n    return {\n        type: ActionFlag.EDIT_ORG_EVALUATE_OK\n    }\n}\n\nexport function editOrgEvaluateErrors(): EditOrgEvaluateErrors {\n    return {\n        type: ActionFlag.EDIT_ORG_EVALUATE_ERRORS\n    }\n}\n\n// Save\n\n// export function editOrgSave(): EditOrgSave {\n//     return {\n//         type: ActionFlag.EDIT_ORG_SAVE\n//     }\n// }\n\nexport function editOrgSaveStart(): EditOrgSaveStart {\n    return {\n        type: ActionFlag.EDIT_ORG_SAVE_START\n    }\n}\n\nexport function editOrgSaveSuccess(): EditOrgSaveSuccess {\n    return {\n        type: ActionFlag.EDIT_ORG_SAVE_SUCCESS\n    }\n}\n\nexport function editOrgSaveError(error: AppError): EditOrgSaveError {\n    return {\n        type: ActionFlag.EDIT_ORG_SAVE_ERROR,\n        error: error\n    }\n}\n\n// Update Name\n\nexport function editOrgUpdateNameSuccess(name: string): EditOrgUpdateNameSuccess {\n    return {\n        type: ActionFlag.EDIT_ORG_UPDATE_NAME_SUCCESS,\n        name: name\n    }\n}\n\nexport function editOrgUpdateNameError(name: string, error: UIError): EditOrgUpdateNameError {\n    return {\n        type: ActionFlag.EDIT_ORG_UPDATE_NAME_ERROR,\n        name: name,\n        error: error\n    }\n}\n\n// export function editOrgUpdateIdSuccess(id: string): EditOrgUpdateIdSuccess {\n//     return {\n//         type: ActionFlag.EDIT_ORG_UPDATE_ID_SUCCESS,\n//         id: id\n//     }\n// }\n\n// Update Gravatar Hash\n\nexport function editOrgUpdateGravatarHashSuccess(gravatarHash: string): EditOrgUpdateGravatarHashSuccess {\n    return {\n        type: ActionFlag.EDIT_ORG_UPDATE_GRAVATAR_HASH_SUCCESS,\n        gravatarHash: gravatarHash\n    }\n}\n\nexport function editOrgUpdateGravatarHashError(gravatarHash: string, error: UIError): EditOrgUpdateGravatarHashError {\n    return {\n        type: ActionFlag.EDIT_ORG_UPDATE_GRAVATAR_HASH_ERROR,\n        gravatarHash: gravatarHash,\n        error: error\n    }\n}\n\n\n// Update Id\n\n// export function editOrgUpdateIdError(id: string, error: UIError): EditOrgUpdateIdError {\n//     return {\n//         type: ActionFlag.EDIT_ORG_UPDATE_ID_ERROR,\n//         id: id,\n//         error: error\n//     }\n// }\n\nexport function editOrgUpdateDescriptionSuccess(description: string): EditOrgUpdateDescriptionSuccess {\n    return {\n        type: ActionFlag.EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS,\n        description: description\n    }\n}\n\nexport function editOrgUpdateDescriptionError(description: string, error: UIError): EditOrgUpdateDescriptionError {\n    return {\n        type: ActionFlag.EDIT_ORG_UPDATE_DESCRIPTION_ERROR,\n        description: description,\n        error: error\n    }\n}\n\n// ACTION THUNKS\n\nexport function load(organizationId: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(loadStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config }\n        } = getState()\n\n        // const model = new Model({\n        //     token, username,\n        //     groupsServiceURL: config.services.Groups.url,\n        //     userProfileServiceURL: config.services.UserProfile.url,\n        //     workspaceServiceURL: config.services.Workspace.url,\n        //     serviceWizardURL: config.services.ServiceWizard.url\n        // })\n\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        return orgClient.getOrg(organizationId)\n            .then((org) => {\n                const editableOrg: EditableOrganization = {\n                    id: {\n                        value: org.id,\n                        validationState: ValidationState.VALID,\n                        editState: EditState.NONE,\n                        validatedAt: null,\n                        error: {\n                            type: UIErrorType.NONE,\n                            message: ''\n                        }\n                    },\n                    name: {\n                        value: org.name,\n                        validationState: ValidationState.VALID,\n                        editState: EditState.NONE,\n                        validatedAt: null,\n                        error: {\n                            type: UIErrorType.NONE,\n                            message: ''\n                        }\n                    },\n                    gravatarHash: {\n                        value: org.gravatarHash,\n                        validationState: ValidationState.VALID,\n                        editState: EditState.NONE,\n                        validatedAt: null,\n                        error: {\n                            type: UIErrorType.NONE,\n                            message: ''\n                        }\n                    },\n                    description: {\n                        value: org.description,\n                        validationState: ValidationState.VALID,\n                        editState: EditState.NONE,\n                        validatedAt: null,\n                        error: {\n                            type: UIErrorType.NONE,\n                            message: ''\n                        }\n                    },\n                    isPrivate: {\n                        value: org.isPrivate,\n                        validationState: ValidationState.VALID,\n                        editState: EditState.NONE,\n                        validatedAt: null,\n                        error: {\n                            type: UIErrorType.NONE,\n                            message: ''\n                        }\n                    }\n                }\n                dispatch(loadSuccess(editableOrg, org))\n            })\n            .catch((err) => {\n                console.error('load org error', err)\n                dispatch(loadError({\n                    code: err.name,\n                    message: err.message\n                }))\n            })\n    }\n}\n\n\nexport function editOrgSave() {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(editOrgSaveStart())\n\n        const state = getState()\n        if (!state.views.editOrgView.viewModel) {\n            throw new Error('Argh, no view model')\n        }\n\n        const {\n            auth: { authorization: { token, username } },\n            views: {\n                editOrgView: {\n                    viewModel: { organization, editedOrganization }\n                }\n            },\n            app: { config } } = state\n\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        if (!editedOrganization) {\n            dispatch(editOrgSaveError({\n                code: 'app',\n                message: 'The new organization data does not yet exist'\n            }))\n            return;\n        }\n\n        const update = {\n            name: editedOrganization.name.value,\n            gravatarHash: editedOrganization.gravatarHash.value,\n            description: editedOrganization.description.value\n        }\n\n        orgClient.updateOrg(organization.id, update)\n            .then(() => {\n                dispatch(editOrgSaveSuccess())\n            })\n            .catch((error) => {\n                console.error('error adding', editedOrganization, error)\n                dispatch(editOrgSaveError({\n                    code: 'invalid',\n                    message: error.message\n                }))\n            })\n    }\n}\n\nexport function editOrgEvaluate() {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        const state = getState()\n        if (!state.views.editOrgView.viewModel) {\n            throw new Error('Argh, no view model')\n        }\n\n        const {\n            views: {\n                editOrgView: {\n                    viewModel: {\n                        editedOrganization\n                    }\n                }\n            }\n        } = state\n\n        if (!editedOrganization) {\n            dispatch(editOrgEvaluateErrors())\n            return\n        }\n\n        if (editedOrganization.name.validationState !== ValidationState.VALID) {\n            dispatch(editOrgEvaluateErrors())\n            return\n        }\n\n        // if (editedOrganization.id.status !== FieldState.EDITED_OK) {\n        //     dispatch(EditOrgEvaluateErrors())\n        //     return\n        // }\n\n        if (editedOrganization.gravatarHash.validationState !== ValidationState.VALID) {\n            dispatch(editOrgEvaluateErrors())\n            return\n        }\n\n        if (editedOrganization.description.validationState !== ValidationState.VALID) {\n            dispatch(editOrgEvaluateErrors())\n            return\n        }\n\n        dispatch(editOrgEvaluateOk())\n    }\n}\n\nexport function editOrgUpdateName(name: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>) => {\n        const [validatedName, error] = Validation.validateOrgName(name)\n\n        if (error.type === UIErrorType.ERROR) {\n            dispatch(editOrgUpdateNameError(validatedName, error))\n        } else {\n            dispatch(editOrgUpdateNameSuccess(validatedName))\n        }\n        dispatch(editOrgEvaluate())\n    }\n}\n\nexport function editOrgUpdateGravatarHash(name: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>) => {\n        const [validateGravatarHash, error] = Validation.validateOrgGravatarHash(name)\n\n        if (error.type === UIErrorType.ERROR) {\n            dispatch(editOrgUpdateGravatarHashError(validateGravatarHash, error))\n        } else {\n            dispatch(editOrgUpdateGravatarHashSuccess(validateGravatarHash))\n        }\n        dispatch(editOrgEvaluate())\n    }\n}\n\nexport function editOrgUpdateDescription(description: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>,\n        getState: () => StoreState) => {\n        const {\n            auth: { authorization: { token, username } },\n            app: { config }\n        } = getState()\n\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n        const [validatedDescription, error] = orgClient.validateOrgDescription(description)\n\n        if (error.type === UIErrorType.ERROR) {\n            dispatch(editOrgUpdateDescriptionError(validatedDescription, error))\n        } else {\n            dispatch(editOrgUpdateDescriptionSuccess(validatedDescription))\n        }\n        dispatch(editOrgEvaluate())\n    }\n}","import * as React from 'react'\nimport { Redirect, NavLink } from 'react-router-dom';\nimport marked from 'marked';\nimport { Button, Icon, Modal } from 'antd';\nimport md5 from 'md5'\n\nimport { EditableOrganization, SaveState, ValidationState, EditState } from '../../../types';\n\nimport './component.css'\n\nimport Header from '../../Header';\nimport OrganizationHeader from '../organizationHeader/loader';\nimport * as orgModel from '../../../data/models/organization/model'\n\nexport interface EditOrganizationProps {\n    editState: EditState\n    saveState: SaveState\n    validationState: ValidationState\n    editedOrganization: EditableOrganization\n    organization: orgModel.Organization\n    onEditOrgSave: () => void\n    onUpdateName: (name: string) => void\n    onUpdateGravatarHash: (gravatarHash: string) => void\n    // onUpdateId: (id: string) => void,\n    onUpdateDescription: (description: string) => void\n}\n\nenum NavigateTo {\n    NONE = 0,\n    BROWSER,\n    VIEWER\n}\n\nexport interface EditOrganizationState {\n    cancelToBrowser: boolean;\n    cancelToViewer: boolean;\n    navigateTo: NavigateTo;\n}\n\nclass EditOrganization extends React.Component<EditOrganizationProps, EditOrganizationState> {\n\n    origin: string;\n\n    gravatarEmail: React.RefObject<HTMLInputElement>\n\n    constructor(props: EditOrganizationProps) {\n        super(props)\n\n        this.state = {\n            cancelToBrowser: false,\n            cancelToViewer: false,\n            navigateTo: NavigateTo.NONE\n        }\n\n        this.gravatarEmail = React.createRef()\n\n        this.origin = document.location!.origin\n    }\n\n    onShowInfo() {\n        Modal.info({\n            title: 'Organization Editor Help',\n            width: '50em',\n            content: (\n                <div>\n                    <p>This is the organizations editor...</p>\n                </div>\n            )\n        })\n    }\n\n\n    onGravatarEmailSync() {\n        let email;\n        if (this.gravatarEmail.current) {\n            email = this.gravatarEmail.current.value\n        } else {\n            email = 'n/a'\n        }\n        const hashed = md5(email)\n        this.props.onUpdateGravatarHash(hashed);\n    }\n\n    onClickCancelToBrowser() {\n        if (!this.isModified()) {\n            this.setState({ cancelToBrowser: true })\n            return\n        }\n\n        const confirm = () => {\n            this.setState({ cancelToBrowser: true })\n        }\n        const cancel = () => {\n        }\n        Modal.confirm({\n            title: 'Leave the editor?',\n            content: (\n                <div>\n                    <p>You have made changes on this edit form.</p>\n\n                    <p>If you leave the editor without saving, any <i>changes they will be lost</i>.</p>\n\n                    <p><b>Continue to leave the editor?</b></p>\n                </div>\n            ),\n            onOk: confirm,\n            onCancel: cancel,\n            okText: 'Yes',\n            cancelText: 'No'\n        })\n    }\n\n    onClickCancelToViewer() {\n        if (!this.isModified()) {\n            this.setState({ cancelToViewer: true })\n            return\n        }\n\n        const confirm = () => {\n            this.setState({ cancelToViewer: true })\n        }\n        const cancel = () => {\n        }\n        Modal.confirm({\n            title: 'Leave the editor?',\n            content: (\n                <div>\n                    <p>You have made changes on this edit form.</p>\n\n                    <p>If you leave the editor without saving, any <i>changes they will be lost</i>.</p>\n\n                    <p><b>Continue to leave the editor?</b></p>\n                </div>\n            ),\n            onOk: confirm,\n            onCancel: cancel,\n            okText: 'Yes',\n            cancelText: 'No'\n        })\n    }\n\n    onSubmit(e: React.FormEvent<HTMLFormElement>) {\n        e.preventDefault();\n        this.props.onEditOrgSave();\n    }\n\n    onNameChange(e: React.ChangeEvent<HTMLInputElement>) {\n        e.persist();\n        this.props.onUpdateName(e.target.value);\n    }\n\n    onGravatarHashChange(e: React.ChangeEvent<HTMLInputElement>) {\n        e.persist();\n        this.props.onUpdateGravatarHash(e.target.value);\n    }\n\n    onDescriptionChange(e: React.ChangeEvent<HTMLTextAreaElement>): void {\n        e.persist()\n        this.props.onUpdateDescription(e.target.value);\n    }\n\n    onIdChange(e: React.ChangeEvent<HTMLInputElement>) {\n        e.persist();\n        // this.props.onUpdateId(e.target.value);\n        console.warn('no updating id, naughty!')\n    }\n\n    canSave() {\n        return (\n            this.props.editState === EditState.EDITED &&\n            this.props.validationState === ValidationState.VALID &&\n            (this.props.saveState === SaveState.NEW ||\n                this.props.saveState === SaveState.READY ||\n                this.props.saveState === SaveState.SAVED)\n        )\n    }\n\n    isModified() {\n        return (\n            this.props.editState === EditState.EDITED &&\n            (this.props.saveState === SaveState.NEW ||\n                this.props.saveState === SaveState.READY)\n        )\n    }\n\n    renderForm() {\n        return (\n            <form id=\"editOrganizationForm\" className=\"editor\" onSubmit={this.onSubmit.bind(this)}>\n                <div className=\"row\">\n                    <div className=\"col1 field-label\">name</div>\n                    <div className=\"col2\">\n                        <input value={this.props.editedOrganization.name.value || ''}\n                            onChange={this.onNameChange.bind(this)} />\n                        {this.props.editedOrganization.name.error ? (<span style={{ color: 'red' }}>{this.props.editedOrganization.name.error.message}</span>) : ''}\n                    </div>\n                </div>\n                <div className=\"row gravatarHash\">\n                    <div className=\"col1 field-label\">gravatar hash</div>\n                    <div className=\"col2\">\n                        <div style={{ display: 'flex', flexDirection: 'row', marginBottom: '4px' }}>\n                            <div style={{ flex: '1 1 0px' }}>\n                                <input ref={this.gravatarEmail} placeholder=\"Provide your gravatar-linked email address, if any\" />\n                            </div>\n                            <div style={{ flex: '0 0 auto' }}>\n                                <Button\n                                    icon=\"arrow-down\"\n                                    style={{ height: '100%' }}\n                                    onClick={this.onGravatarEmailSync.bind(this)} />\n                            </div>\n                        </div>\n\n                        <input value={this.props.editedOrganization.gravatarHash.value || ''}\n                            onChange={this.onGravatarHashChange.bind(this)} />\n                        {this.props.editedOrganization.gravatarHash.error ? (<span style={{ color: 'red' }}>{this.props.editedOrganization.gravatarHash.error.message}</span>) : ''}\n                    </div>\n                </div>\n                <div className=\"row\">\n                    <div className=\"col1 field-label\">id</div>\n                    <div className=\"col2\">\n                        <input value={this.props.editedOrganization.id.value || ''}\n                            onChange={this.onIdChange.bind(this)} />\n                        {this.props.editedOrganization.id.error ? (<span style={{ color: 'red' }}>{this.props.editedOrganization.id.error.message}</span>) : ''}\n                    </div>\n                </div>\n                <div className=\"row\" style={{ flex: '1 1 0px', minHeight: '30em', maxHeight: '60em' }}>\n                    <div className=\"col1 field-label\">description</div>\n                    <div className=\"col2\">\n                        <textarea value={this.props.editedOrganization.description.value || ''}\n                            onChange={this.onDescriptionChange.bind(this)} />\n                        {this.props.editedOrganization.description.error ? (<div style={{ color: 'red' }}>{this.props.editedOrganization.description.error.message}</div>) : ''}\n                    </div>\n                </div>\n                <div className=\"row\">\n                    <div className=\"col1\"></div>\n                    <div className=\"col2\">\n                        {/* <div className=\"footer\">\n                            <Button form=\"newOrganizationForm\"\n                                key=\"submit\"\n                                htmlType=\"submit\">Save</Button>\n                            <Button type=\"danger\"\n                                onClick={this.onClickCancel.bind(this)}>Cancel</Button>\n                        </div> */}\n                    </div>\n                </div>\n            </form>\n        )\n    }\n\n    getOrgAvatarUrl(org: EditableOrganization) {\n        // const defaultImages = [\n        //     'orgs-64.png',\n        //     'unicorn-64.png'\n        // ]\n        // if (!org.gravatarHash.value) {\n        //     return defaultImages[Math.floor(Math.random() * 2)]\n        // }\n        if (!org.gravatarHash.value) {\n            return 'unicorn-64.png'\n        }\n        const gravatarDefault = 'identicon';\n\n        return 'https://www.gravatar.com/avatar/' + org.gravatarHash.value + '?s=64&amp;r=pg&d=' + gravatarDefault;\n    }\n\n    renderOrgAvatar(org: EditableOrganization) {\n        return (\n            <img style={{ width: 64, height: 64 }}\n                src={this.getOrgAvatarUrl(org)} />\n        )\n    }\n\n    renderPreview() {\n        return <form className=\"preview\">\n            <div className=\"row\">\n                <div className=\"col2\">\n                    <div className=\"name\">\n                        {this.props.editedOrganization.name.value || ''}\n                    </div>\n                </div>\n            </div>\n            <div className=\"row\">\n                <div className=\"col2\">\n                    <div className=\"gravatarHash\">\n                        {this.renderOrgAvatar(this.props.editedOrganization)}\n                    </div>\n                </div>\n            </div>\n            <div className=\"row\">\n                <div className=\"col2\">\n                    <div className=\"id\">\n                        <span style={{ color: 'silver' }}>{this.origin}/#orgs/organizations/</span>\n                        {this.props.editedOrganization.id.value || (<span style={{ fontStyle: 'italic' }}>organization id here</span>)}\n                    </div>\n                </div>\n            </div>\n            <div className=\"row\" style={{ flex: '1 1 0px' }}>\n                <div className=\"col2\">\n                    <div className=\"description\"\n                        dangerouslySetInnerHTML={({ __html: marked(this.props.editedOrganization.description.value || '') })}\n                    />\n                </div>\n            </div>\n        </form>\n    }\n\n    renderState() {\n        const { editState, validationState, saveState } = this.props;\n        const label = 'edit: ' + editState + ', valid: ' + validationState + ', save: ' + saveState\n        return (\n            <span style={{ marginRight: '10px' }}>{label}</span>\n        )\n    }\n\n    renderOrgName(name: string) {\n        const maxLength = 25\n        if (name.length < 25) {\n            return name\n        }\n        return (\n            <span>\n                {name.slice(0, 25)}\n                \n            </span>\n        )\n    }\n\n    renderHeader() {\n        const breadcrumbs = (\n            <React.Fragment>\n                <span>\n                    <NavLink to={`/viewOrganization/${this.props.organization.id}`}>\n                        <span style={{ fontWeight: 'bold' }}>\n                            {this.renderOrgName(this.props.editedOrganization.name.value)}\n                        </span>\n                    </NavLink>\n\n                    <Icon type=\"right\" style={{ verticalAlign: 'middle', marginLeft: '4px', marginRight: '4px' }} />\n\n                    <Icon type=\"tool\" />\n                    {' '}\n                    <span style={{ fontSize: '120%' }}>Managing Org Requests</span>\n                </span>\n            </React.Fragment>\n        )\n        const buttons = (\n            <React.Fragment>\n                <Button icon=\"save\"\n                    form=\"editOrganizationForm\"\n                    key=\"submit\"\n                    disabled={!this.canSave.call(this)}\n                    htmlType=\"submit\">\n                    {/* <Icon type=\"save\" /> */}\n                    {/* <FaSave style={{ verticalAlign: 'center' }} /> */}\n                    Save\n                        </Button>\n                <Button icon=\"undo\"\n                    type=\"danger\"\n                    onClick={this.onClickCancelToViewer.bind(this)}>\n                    {/* <FaUndo style={{ verticalAlign: 'center' }} />  */}\n                    Return to this Org\n                        </Button>\n                <Button shape=\"circle\" icon=\"info\" onClick={this.onShowInfo.bind(this)}></Button>\n            </React.Fragment>\n        )\n        return (\n            <Header breadcrumbs={breadcrumbs} buttons={buttons} />\n        )\n    }\n\n    // renderFooter() {\n    //     return (\n    //         <div className=\"footerRow\">\n    //             <div className=\"editorColumn\">\n    //                 <div className=\"row\">\n    //                     <div className=\"col1\">\n    //                     </div>\n    //                     <div className=\"col2\">\n    //                         <div className=\"footer\">\n    //                             <Button form=\"editOrganizationForm\"\n    //                                 key=\"submit\"\n    //                                 htmlType=\"submit\">Save</Button>\n    //                             <Button type=\"danger\"\n    //                                 onClick={this.onClickCancel.bind(this)}>Cancel</Button>\n    //                         </div>\n    //                     </div>\n    //                 </div>\n    //             </div>\n    //             <div className=\"previewColumn\">\n\n    //             </div>\n    //         </div>\n    //     )\n    // }\n\n    renderLoadingHeader() {\n        const breadcrumbs = (\n            <span>\n                Loading Org Editor...\n            </span>\n        )\n        return (\n            <Header breadcrumbs={breadcrumbs} />\n        )\n    }\n\n    // renderHeader() {\n    //     let orgName: string\n    //     return (\n    //         <Header>\n    //             <div style={{ flex: '1 1 0px', display: 'flex', flexDirection: 'row', alignItems: 'center' }}>\n    //                 <div style={{ flex: '0 0 auto' }}>\n    //                     <span>\n    //                         <Icon type=\"tool\" />\n    //                         {' '}\n    //                         Managing your membership in the Organization \"\n    //                         {this.props.organization.name}\n    //                         \"\n    //                     </span>\n    //                 </div>\n    //                 <div style={{ flex: '1 1 0px', display: 'flex', flexDirection: 'row', justifyContent: 'flex-end', alignItems: 'center' }}>\n    //                     <Button icon=\"undo\"\n    //                         type=\"danger\"\n    //                         onClick={this.doCancelToViewer.bind(this)}>\n    //                         Return to this Org\n    //                     </Button>\n    //                     <Button icon=\"undo\"\n    //                         type=\"danger\"\n    //                         onClick={this.doCancelToBrowser.bind(this)}>\n    //                         Return to Orgs Browser\n    //                     </Button>\n    //                     <Button\n    //                         shape=\"circle\"\n    //                         icon=\"info\"\n    //                         onClick={this.doShowInfo.bind(this)}>\n    //                     </Button>\n    //                 </div>\n    //             </div>\n    //         </Header>\n    //     )\n    // }\n\n    renderOrgHeader() {\n        // apparently TS is not smart enough to know this from the conditional branch in render()!\n        if (!this.props.organization) {\n            return\n        }\n\n        return (\n            <OrganizationHeader organizationId={this.props.organization.id} />\n        )\n    }\n\n    render() {\n        if (this.state.cancelToBrowser) {\n            return <Redirect push to=\"/organizations\" />\n        }\n\n        if (this.state.cancelToViewer) {\n            return <Redirect push to={\"/viewOrganization/\" + this.props.organization.id} />\n        }\n\n        // // TODO: this is just a prop for today.\n        // if (this.props.saveState === SaveState.SAVED) {\n        //     return <Redirect push to={\"/editOrganization/\" + this.props.editedOrganization.id.value} />\n        // }\n\n        if (!this.props.editedOrganization) {\n            return (\n                <div className=\"EditOrganization\">\n                    {this.renderLoadingHeader()}\n                </div>\n            )\n        }\n\n        return (\n            <div className=\"EditOrganization\">\n                {this.renderHeader()}\n                {this.renderOrgHeader()}\n                <div className=\"mainRow\">\n                    <div className=\"editorColumn\">\n                        <h3>Editor</h3>\n                        {this.renderForm()}\n                    </div>\n                    <div className=\"previewColumn\">\n                        <h3>Preview</h3>\n                        {this.renderPreview()}\n                    </div>\n                </div>\n                {/* {this.renderFooter()} */}\n            </div>\n        )\n    }\n}\n\nexport default EditOrganization","import { Dispatch, Action } from 'redux';\nimport { connect } from 'react-redux';\n\nimport { StoreState, EditableOrganization, EditState, SaveState, ValidationState } from '../../../types';\nimport {\n    editOrgSave,\n    editOrgUpdateName,\n    // editOrgUpdateId, \n    editOrgUpdateDescription, editOrgUpdateGravatarHash\n} from '../../../redux/actions/editOrg';\n\nimport EditOrganization from './component';\n\nimport * as orgModel from '../../../data/models/organization/model'\n\ninterface OwnProps {\n}\n\nexport interface StateProps {\n    editState: EditState,\n    saveState: SaveState,\n    validationState: ValidationState,\n    editedOrganization: EditableOrganization,\n    organization: orgModel.Organization\n}\n\nexport interface DispatchProps {\n    onEditOrgSave: () => void,\n    onUpdateName: (name: string) => void,\n    onUpdateGravatarHash: (gravatarHash: string) => void,\n    // onUpdateId: (id: string) => void,\n    onUpdateDescription: (description: string) => void\n}\n\nexport function mapStateToProps(state: StoreState): StateProps {\n    if (!state.views.editOrgView.viewModel) {\n        throw new Error('What, no view model??')\n    }\n    const {\n        views: {\n            editOrgView: {\n                viewModel: { editState, saveState, validationState, editedOrganization, organization }\n            }\n        }\n    } = state\n\n    return {\n        editState,\n        saveState,\n        validationState,\n        editedOrganization,\n        organization\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<Action>): DispatchProps {\n    return {\n        onEditOrgSave: () => {\n            dispatch(editOrgSave() as any)\n        },\n        onUpdateName: (name: string) => {\n            dispatch(editOrgUpdateName(name) as any)\n        },\n        onUpdateGravatarHash: (gravatarHash: string) => {\n            dispatch(editOrgUpdateGravatarHash(gravatarHash) as any)\n        },\n        // onUpdateId: (id) => {\n        //     dispatch(editOrgUpdateId(id) as any)\n        // },\n        onUpdateDescription: (description) => {\n            dispatch(editOrgUpdateDescription(description) as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(EditOrganization)","import * as React from 'react'\nimport { ComponentLoadingState, DashboardView, StoreState, EditOrgView } from '../../../types';\nimport Container from './container'\nimport * as orgModel from '../../../data/models/organization/model'\n\n// First the loader component, which takes care of a loading view, error view, and the \n// container.\n\nexport interface LoaderProps {\n    organizationId: orgModel.OrganizationID\n    view: EditOrgView\n    onLoad: (organizationId: orgModel.OrganizationID) => void\n    onUnload: () => void\n}\n\ninterface LoaderState {\n\n}\n\nclass Loader extends React.Component<LoaderProps, LoaderState> {\n    constructor(props: LoaderProps) {\n        super(props)\n    }\n\n    renderLoading() {\n        return (\n            <div>\n                Fetching your orgs and other stuff...\n            </div>\n        )\n    }\n\n    renderError() {\n        if (!this.props.view.error) {\n            return\n        }\n        return (\n            <div>\n                Error! {this.props.view.error.message}\n            </div>\n        )\n    }\n\n    render() {\n        switch (this.props.view.loadingState) {\n            case ComponentLoadingState.NONE:\n                // should only appear briefly as the LOAD event is processed.\n                this.props.onLoad(this.props.organizationId)\n                return this.renderLoading()\n            case ComponentLoadingState.LOADING:\n                return this.renderLoading()\n            case ComponentLoadingState.ERROR:\n                return this.renderError()\n            case ComponentLoadingState.SUCCESS:\n                return (\n                    <Container />\n                )\n        }\n    }\n\n    componentWillUnmount() {\n        this.props.onUnload()\n    }\n}\n\n// THe redux connection\n\nimport { Dispatch, Action } from 'redux'\nimport { connect } from 'react-redux'\n\nimport * as actions from '../../../redux/actions/editOrg'\n\nexport interface OwnProps {\n    organizationId: orgModel.OrganizationID\n}\n\ninterface StateProps {\n    view: EditOrgView\n}\n\ninterface DispatchProps {\n    onLoad: (organizationId: orgModel.OrganizationID) => void\n    onUnload: () => void\n}\n\nfunction mapStateToProps(state: StoreState, props: OwnProps): StateProps {\n    return {\n        view: state.views.editOrgView\n    }\n}\n\nfunction mapDispatchToProps(dispatch: Dispatch<Action>): DispatchProps {\n    return {\n        onLoad: (organizationId: orgModel.OrganizationID) => {\n            dispatch(actions.load(organizationId) as any)\n        },\n        onUnload: () => {\n            dispatch(actions.unload() as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(Loader)","import * as React from 'react'\nimport './Auth.css'\n\nimport * as types from '../types'\nimport { Button } from 'antd';\n\n\nexport interface AuthState {\n\n}\n\nclass Auth extends React.Component<types.AuthProps, AuthState> {\n\n    tokenRef: React.RefObject<HTMLInputElement>\n\n    constructor(props: types.AuthProps) {\n        super(props)\n\n        this.tokenRef = React.createRef()\n\n        this.props.checkAuth()\n    }\n\n    onLogoutClick() {\n        this.props.onRemoveAuthorization()\n    }\n\n    onLoginClick() {\n        if (this.tokenRef.current === null) {\n            return\n        }\n        const token = this.tokenRef.current.value\n        if (token.length === 0) {\n            return\n        }\n        this.props.onAddAuthorization(token)\n    }\n\n    buildAuthForm() {\n        return (\n            <div className=\"Auth-form\">\n                Token: <input ref={this.tokenRef} />\n                <Button\n                    icon=\"save\"\n                    htmlType=\"submit\"\n                    onClick={this.onLoginClick.bind(this)} >\n                    Assign Token\n                </Button>\n            </div>\n        )\n    }\n\n    buildAuthToolbar() {\n        return (\n            <div className=\"Auth-toolbar\">\n                Logged in as <b><span>{this.props.authorization.authorization.realname}</span> (<span>{this.props.authorization.authorization.username}</span></b>)\n                {' '}\n                <Button icon=\"logout\" onClick={this.onLogoutClick.bind(this)}></Button>\n            </div>\n        )\n    }\n\n    buildAuthDev() {\n        switch (this.props.authorization.status) {\n            case types.AuthState.NONE:\n            case types.AuthState.CHECKING:\n                return (\n                    <div></div>\n                )\n            case types.AuthState.AUTHORIZED:\n                return (\n                    <div className=\"Auth Auth-authorized scrollable-flex-column\">\n                        {this.buildAuthToolbar()}\n                        {this.props.children}\n                    </div>\n                )\n            case types.AuthState.UNAUTHORIZED:\n                return (\n                    <div className=\"Auth Auth-unauthorized scrollable-flex-column\">\n                        <p>Not authorized! Enter a user token below</p>\n                        {this.buildAuthForm()}\n                    </div>\n                )\n            case types.AuthState.ERROR:\n                return (\n                    <div className=\"Auth Auth-unauthorized scrollable-flex-column\">\n                        <p>Error</p>\n                        {this.props.authorization.message}\n                    </div>\n                )\n            default:\n                return (\n                    <div></div>\n                )\n        }\n    }\n\n    buildAuthProd() {\n        switch (this.props.authorization.status) {\n            case types.AuthState.NONE:\n            case types.AuthState.CHECKING:\n                return (\n                    <div></div>\n                )\n            case types.AuthState.AUTHORIZED:\n                return (\n                    <div className=\"Auth Auth-authorized scrollable-flex-column\">\n                        {this.props.children}\n                    </div>\n                )\n            case types.AuthState.UNAUTHORIZED:\n                return (\n                    <div className=\"Auth Auth-unauthorized scrollable-flex-column\">\n                        <p>Not authorized!</p>\n                    </div>\n                )\n            case types.AuthState.ERROR:\n                return (\n                    <div className=\"Auth Auth-error scrollable-flex-column\">\n                        <p>Error: ??</p>\n                    </div>\n                )\n            default:\n                return (\n                    <div></div>\n                )\n        }\n\n    }\n\n    render() {\n        return (\n            <div className=\"Auth scrollable-flex-column\">\n                {this.props.hosted ? this.buildAuthProd() : this.buildAuthDev()}\n            </div>\n        )\n\n    }\n}\n\nexport default Auth","\nexport interface RootInfo {\n    version: string,\n    servertime: number\n}\n\ninterface AuthEndpoints {\n    root: string,\n    tokenInfo: string,\n    apiMe: string,\n    me: string,\n    loginStart: string,\n    loginChoice: string,\n    loginCreate: string,\n    loginUsernameSuggest: string,\n    loginPick: string,\n    loginCancel: string,\n    logout: string,\n    linkStart: string,\n    linkCancel: string,\n    linkChoice: string,\n    linkPick: string,\n    linkRemove: string,\n    tokens: string,\n    tokensRevoke: string,\n    tokensRevokeAll: string,\n    userSearch: string,\n    adminUserSearch: string,\n    adminUser: string\n}\n\nconst endpoints: AuthEndpoints = {\n    root: '',\n    tokenInfo: 'api/V2/token',\n    apiMe: 'api/V2/me',\n    me: 'me',\n    loginStart: 'login/start',\n    logout: 'logout',\n    loginChoice: 'login/choice',\n    loginCreate: 'login/create',\n    loginUsernameSuggest: 'login/suggestname',\n    loginPick: 'login/pick',\n    loginCancel: 'login/cancel',\n    linkStart: 'link/start',\n    linkCancel: 'link/cancel',\n    linkChoice: 'link/choice',\n    linkPick: 'link/pick',\n    linkRemove: 'me/unlink',\n    tokens: 'tokens',\n    tokensRevoke: 'tokens/revoke',\n    tokensRevokeAll: 'tokens/revokeall',\n    userSearch: 'api/V2/users/search',\n    adminUserSearch: 'api/V2/admin/search',\n    adminUser: 'api/V2/admin/user'\n}\n\nexport interface TokenInfo {\n    created: number,\n    expires: number,\n    id: string,\n    name: string | null,\n    token: string,\n    type: string,\n    user: string,\n    cachefor: number\n}\n\nexport interface Identity {\n    id: string,\n    provider: string,\n    username: string\n}\n\nexport interface Role {\n    id: string,\n    desc: string\n}\n\nexport interface Account {\n    created: number,\n    customroles: Array<string>,\n    display: string,\n    email: string,\n    idents: Array<Identity>,\n    lastLogin: number,\n    local: boolean,\n    roles: Array<Role>,\n    user: string\n}\nexport class AuthClient {\n    url: string;\n\n    constructor({ url }: { url: string }) {\n        this.url = url\n    }\n\n    makePath(path: Array<string> | string): string {\n        if (typeof path === 'string') {\n            return [this.url].concat([path]).join('/');\n        }\n        return [this.url].concat(path).join('/');\n    }\n\n\n    root(): Promise<RootInfo> {\n        return fetch(this.makePath([endpoints.root]), {\n            headers: {\n                Accept: 'application/json'\n            },\n            mode: 'cors'\n        })\n            .then((response) => {\n                return response.json()\n            })\n            .then((result) => {\n                return result as RootInfo\n            })\n    }\n\n    getTokenInfo(token: string): Promise<TokenInfo> {\n        return fetch(this.makePath([endpoints.tokenInfo]), {\n            headers: {\n                Accept: 'application/json',\n                Authorization: token\n            },\n            mode: 'cors'\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error(response.statusText)\n                }\n                return response.json()\n            })\n            .then((result) => {\n                return result as TokenInfo\n            })\n    }\n\n    getMe(token: string): Promise<Account> {\n        return fetch(this.makePath([endpoints.apiMe]), {\n            headers: {\n                Accept: 'application/json',\n                Authorization: token\n            },\n            mode: 'cors'\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error(response.statusText)\n                }\n                return response.json()\n            })\n            .then((result) => {\n                return result as Account\n            })\n    }\n\n\n    // getInfo() : Promise<GroupsServiceInfo> {\n    //     return fetch(this.url + '/', {\n    //         headers: {\n    //             Authorization: this.token,\n    //             Accept: 'application/json'\n    //         },\n    //         mode: 'cors'\n    //     })\n    //         .then((response) => {\n    //             return response.json();\n    //         })\n    //         .then((result) => {\n    //             return result as GroupsServiceInfo;\n    //         });\n    // }\n\n}","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\nimport * as Cookies from 'es-cookie'\n\nimport { ActionFlag } from './index'\nimport { AppError, StoreState } from '../../types';\nimport { AuthClient, TokenInfo, Account } from '../../data/auth';\n\n// Action Definitions\n\nexport interface AuthCheck extends Action {\n    type: ActionFlag.AUTH_CHECK\n}\n\nexport interface AuthCheckStart extends Action {\n    type: ActionFlag.AUTH_CHECK_START\n}\n\nexport interface AuthCheckError extends Action {\n    type: ActionFlag.AUTH_CHECK_ERROR,\n    error: AppError\n}\n\nexport interface AuthAuthorized extends Action {\n    type: ActionFlag.AUTH_AUTHORIZED,\n    token: string\n    username: string,\n    realname: string,\n    roles: Array<string>\n}\n\nexport interface AuthUnauthorized extends Action {\n    type: ActionFlag.AUTH_UNAUTHORIZED\n}\n\nexport interface AuthRemoveAuthorization extends Action {\n    type: ActionFlag.AUTH_REMOVE_AUTHORIZATION\n}\n\nexport interface AuthAddAuthorization extends Action {\n    type: ActionFlag.AUTH_ADD_AUTHORIZATION,\n    token: string\n}\n\n// Action Creators\n\n\nexport function authCheckStart(): AuthCheckStart {\n    return {\n        type: ActionFlag.AUTH_CHECK_START\n    }\n}\n\nexport function authCheckError(error: AppError): AuthCheckError {\n    return {\n        type: ActionFlag.AUTH_CHECK_ERROR,\n        error\n    }\n}\n\nexport function authAuthorized(token: string, username: string, realname: string, roles: Array<string>): AuthAuthorized {\n    return {\n        type: ActionFlag.AUTH_AUTHORIZED,\n        token, username, realname, roles\n    }\n}\n\nexport function authUnauthorized(): AuthUnauthorized {\n    return {\n        type: ActionFlag.AUTH_UNAUTHORIZED\n    }\n}\n\n// export function authRemoveAuthorization(): AuthRemoveAuthorization {\n//     return {\n//         type: ActionFlag.AUTH_REMOVE_AUTHORIZATION\n//     }\n// }\n\n// export function authAddAuthorization(token: string): AuthAddAuthorization {\n//     return {\n//         type: ActionFlag.AUTH_ADD_AUTHORIZATION,\n//         token: token\n//     }\n// }\n\n// Action Thunks\n\nexport function checkAuth() {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(authCheckStart())\n\n        // TODO: get the auth from the kbase-ui integration api, perhaps a postmessage call\n\n        const token = Cookies.get('kbase_session')\n        if (!token) {\n            dispatch(authUnauthorized())\n            return\n        }\n        const auth = new AuthClient({ url: '/services/auth' })\n        Promise.all([\n            auth.getTokenInfo(token),\n            auth.getMe(token)\n        ])\n            .then(([tokenInfo, account]) => {\n                const roles = account.roles.map(({ id, desc }) => id)\n                dispatch(authAuthorized(token, account.user, account.display, roles))\n            })\n            .catch((err) => {\n                console.error('auth check error', err)\n                dispatch(authCheckError({\n                    code: 'error',\n                    message: err.message\n                }))\n            })\n    }\n}\n\nexport function authRemoveAuthorization() {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        // remove cookie\n        Cookies.remove('kbase_session')\n\n        // remove auth in state\n        dispatch(authUnauthorized())\n    }\n}\n\nexport function authAddAuthorization(token: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        // add cookie\n        Cookies.set('kbase_session', token)\n\n        // TODO: get auth info\n        const auth = new AuthClient({ url: '/services/auth' })\n        Promise.all([\n            auth.getTokenInfo(token),\n            auth.getMe(token)\n        ])\n            .then(([tokenInfo, account]) => {\n                const roles = account.roles.map(({ id, desc }) => id)\n                dispatch(authAuthorized(token, account.user, account.display, roles))\n            })\n            .catch((err) => {\n                console.error('auth check error', err)\n                dispatch(authCheckError({\n                    code: 'error',\n                    message: err.message\n                }))\n            })\n\n    }\n}","import { Dispatch, Action } from 'redux'\nimport { connect } from 'react-redux'\n\nimport { StoreState, AuthState, Authorization } from '../types'\nimport Auth from '../components/Auth'\nimport * as actions from '../redux/actions/auth'\n\nexport interface OwnProps {\n    hosted: boolean\n}\n\ninterface StateProps {\n    authorization: Authorization\n    // authStatus: AuthState,\n    // token: string | null,\n    // username: string | null,\n    // realname: string | null,\n}\n\ninterface DispatchProps {\n    checkAuth: () => void,\n    onRemoveAuthorization: () => void,\n    onAddAuthorization: (token: string) => void\n}\n\nfunction mapStateToProps(state: StoreState, props: OwnProps): StateProps {\n    const { auth } = state\n    return {\n        authorization: auth\n        // authStatus: status,\n        // token: authorization.token || null,\n        // username: authorization.username || null,\n        // realname: authorization.realname || null\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<Action>): DispatchProps {\n    return {\n        checkAuth: () => {\n            dispatch(actions.checkAuth() as any)\n        },\n        onRemoveAuthorization: () => {\n            dispatch(actions.authRemoveAuthorization() as any)\n        },\n        onAddAuthorization: (token: string) => {\n            dispatch(actions.authAddAuthorization(token) as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(Auth)","\nimport uuidv4 from 'uuid/v4'\n\ninterface ListenerParams {\n    name: string,\n    onSuccess: (payload: Payload) => void,\n    onError: (error: Error) => void\n}\n\nclass Listener {\n    name: string;\n    onSuccess: (payload: Payload) => void;\n    onError: (error: Error) => void;\n\n    constructor({ name, onSuccess, onError }: ListenerParams) {\n        this.name = name;\n        this.onSuccess = onSuccess;\n        this.onError = onError;\n    }\n}\n\ntype Payload = any;\n\ninterface WaitingListenerParams extends ListenerParams {\n    timeout?: number\n}\n\nclass WaitingListener extends Listener {\n    started: Date;\n    timeout: number;\n\n    constructor(params: WaitingListenerParams) {\n        super(params);\n        this.started = new Date();\n        this.timeout = params.timeout || 5000;\n    }\n}\n\ninterface Envelope {\n    channelId: string\n    id: string\n}\n\nclass Message {\n    name: string;\n    payload: any;\n    id: string;\n    created: Date;\n    channel: any\n    envelope: Envelope | null\n\n    constructor({ name, payload, channel }: { name: string, payload: any, channel: any }) {\n        this.name = name\n        this.payload = payload\n        this.id = uuidv4()\n        this.created = new Date()\n        this.channel = channel\n        this.envelope = null;\n    }\n\n    getMessage() {\n        return {\n            envelope: {\n                id: this.id,\n                created: this.created,\n                channel: this.channel\n            },\n            name: this.name,\n            payload: this.payload\n        };\n    }\n}\n\ninterface Handler {\n    started: Date,\n    handler: (response: any) => any\n}\n\ninterface ChannelParams {\n    window: Window,\n    host: string,\n    channelId?: string\n}\n\nexport class Channel {\n    window: Window\n    host: string\n    id: string\n    awaitingResponse: Map<string, Handler>\n    waitingListeners: Map<string, Array<Listener>>\n    listeners: Map<string, Array<Listener>>\n    lastId: number\n    sentCount: number\n    receivedCount: number\n    unwelcomeReceivedCount: number\n    unwelcomeReceivedCountThreshhold: number\n    unwelcomeReceiptWarning: boolean\n    unwelcomeReceiptWarningCount: number\n    currentListener: ((message: MessageEvent) => void) | null\n\n    constructor(params: ChannelParams) {\n        // The given window upon which we will listen for messages.\n        this.window = params.window;\n\n        // The host for the window; required for postmessage\n        if (this.window.document === null) {\n            throw new Error('No document')\n        }\n        if (this.window.document.location === null) {\n            throw new Error('No location')\n        }\n        this.host = params.host || this.window.document.location.origin;\n\n        // The channel id. Used to filter all messages received to\n        // this channel.\n        this.id = params.channelId || uuidv4()\n\n\n        this.awaitingResponse = new Map<string, Handler>()\n        this.waitingListeners = new Map<string, Array<Listener>>()\n        this.listeners = new Map<string, Array<Listener>>()\n\n        this.lastId = 0\n        this.sentCount = 0\n        this.receivedCount = 0\n\n        this.unwelcomeReceivedCount = 0\n        this.unwelcomeReceivedCountThreshhold = 100\n        this.unwelcomeReceiptWarning = true\n        this.unwelcomeReceiptWarningCount = 0\n        this.currentListener = null\n    }\n\n    genId() {\n        this.lastId += 1;\n        return 'msg_' + String(this.lastId);\n    }\n\n    receiveMessage(messageEvent: MessageEvent) {\n        const message = messageEvent.data as Message;\n        if (!message) {\n            this.unwelcomeReceivedCount++;\n            if (this.unwelcomeReceiptWarning) {\n                console.warn('No message data; message ignored', messageEvent);\n            }\n            return;\n        }\n        if (!message.envelope) {\n            this.unwelcomeReceivedCount++;\n            if (this.unwelcomeReceiptWarning) {\n                console.warn('No message envelope, not from KBase; message ignored', messageEvent);\n            }\n            return;\n        }\n        if (!(message.envelope.channelId === this.id)) {\n            this.unwelcomeReceivedCount++;\n            if (this.unwelcomeReceiptWarning) {\n                console.warn('Message envelope does not match this channel\\'s id', messageEvent);\n            }\n            return;\n        }\n        if (this.unwelcomeReceiptWarningCount > this.unwelcomeReceivedCountThreshhold) {\n            this.unwelcomeReceiptWarning = false;\n            console.warn('Unwelcome message warning disabled after ' + this.unwelcomeReceiptWarningCount + ' instances.');\n        }\n\n        // A message sent as a request will have registered a response handler\n        // in the awaitingResponse hash, using a generated id as the key.\n        // TODO: to to rethink using the message id here. Perhaps somehting like a\n        // chain of ids, the root of which is the origination id, which is the one\n        // known here when it it is sent; the message \"id\" should be assigned whenver\n        // a message is sent, but a response  message would include the original\n        // message in the \"chain\"...\n\n        // We can also have awaiting responses without an originating request.\n        // These are useful for, e.g., a promise which awaits a message to be sent\n        // within some window...\n        if (message.envelope.id && this.awaitingResponse.has(message.envelope.id)) {\n            try {\n                const response = this.awaitingResponse.get(message.envelope.id)\n                this.awaitingResponse.delete(message.envelope.id)\n                if (response) {\n                    response.handler(message.payload)\n                }\n            } catch (ex) {\n                console.error('Error handling response for message ', message, ex);\n            }\n        }\n\n        // and also awaiting by message name. Like a listener, but they are only used\n        // once.\n        if (this.waitingListeners.has(message.name)) {\n            const awaiting = this.waitingListeners.get(message.name)!\n            this.waitingListeners.delete(message.name)\n            awaiting.forEach((listener) => {\n                try {\n                    listener.onSuccess(message.payload);\n                } catch (ex) {\n                    console.error('Error handling listener for message', message, ex);\n                    if (listener.onError) {\n                        listener.onError(ex);\n                    }\n                }\n            });\n        }\n\n        // Otherwise, permanently registered handlers are found in the listeners for the\n        // message name.\n        if (this.listeners.has(message.name)) {\n            this.listeners.get(message.name)!.forEach((listener) => {\n                if (!listener.onSuccess) {\n                    console.warn('no handler for listener!', listener);\n                }\n                try {\n                    listener.onSuccess(message.payload);\n                } catch (ex) {\n                    console.error('Error handling listener for message', message, ex);\n                    if (listener.onError) {\n                        listener.onError(ex);\n                    }\n                }\n            });\n        }\n    }\n\n    listen(listener: Listener) {\n        if (!this.listeners.has(listener.name)) {\n            this.listeners.set(listener.name, [])\n        }\n        this.listeners.get(listener.name)!.push(listener)\n    }\n\n    on(messageId: string, success: (payload: any) => any, error: (error: Error) => void) {\n        this.listen(new Listener({\n            name: messageId,\n            onSuccess: success,\n            onError: error\n        }));\n    }\n\n    sendMessage(message: Message) {\n        this.window.postMessage(message.getMessage(), this.host);\n    }\n\n    send(name: string, payload: Payload) {\n        const message = new Message({ name, payload, channel: this.id });\n        this.sendMessage(message);\n    }\n\n    sendRequest(message: Message, handler: (response: any) => any) {\n        this.awaitingResponse.set('message.id', {\n            started: new Date(),\n            handler: handler\n        })\n\n        this.sendMessage(message);\n    }\n\n    request(name: string, payload: Payload) {\n        return new Promise((resolve, reject) => {\n            try {\n                this.sendRequest(new Message({ name, payload, channel: this.id }), (response: any) => {\n                    resolve(response);\n                });\n            } catch (ex) {\n                reject(ex);\n            }\n        });\n    }\n\n    startMonitor() {\n        window.setTimeout(() => {\n            const now = new Date().getTime();\n\n            // first take care of listeners awaiting a message.\n            for (const [id, listeners] of this.waitingListeners.entries()) {\n                const newListeners = listeners.filter((listener) => {\n                    if (listener instanceof WaitingListener) {\n                        const elapsed = now - listener.started.getTime();\n                        if (elapsed > listener.timeout) {\n                            try {\n                                if (listener.onError) {\n                                    listener.onError(new Error('timout after ' + elapsed));\n                                }\n                            } catch (ex) {\n                                console.error('Error calling error handler', id, ex);\n                            }\n                            return false;\n                        } else {\n                            return true;\n                        }\n                    } else {\n                        return true;\n                    }\n                });\n                if (newListeners.length === 0) {\n                    this.waitingListeners.delete(id)\n                }\n            }\n\n            if (this.waitingListeners.size > 0) {\n                this.startMonitor()\n            }\n        }, 100);\n    }\n\n    listenOnce(listener: WaitingListener) {\n        if (!this.waitingListeners.has(listener.name)) {\n            this.waitingListeners.set(listener.name, [])\n        }\n        this.waitingListeners.get(listener.name)!.push(listener);\n        if (listener.timeout) {\n            this.startMonitor();\n        }\n    }\n\n    once(name: string, success: (payload: Payload) => void, error: (error: Error) => void) {\n        this.listenOnce(new WaitingListener({\n            name: name,\n            onSuccess: success,\n            onError: error\n        }));\n    }\n\n    when(name: string, timeout: number) {\n        return new Promise((resolve, reject) => {\n            return this.listenOnce(new WaitingListener({\n                name: name,\n                timeout: timeout,\n                onSuccess: (payload) => {\n                    resolve(payload);\n                },\n                onError: (error) => {\n                    reject(error);\n                }\n            }));\n        });\n    }\n\n    stats() {\n        return {\n            sent: this.sentCount,\n            received: this.receivedCount\n        };\n    }\n\n    attach(window: Window) {\n        this.window = window;\n    }\n\n    start() {\n        this.currentListener = (message: MessageEvent) => {\n            this.receiveMessage(message);\n        };\n        this.window.addEventListener('message', this.currentListener, false);\n    }\n\n    stop() {\n        if (this.currentListener) {\n            this.window.removeEventListener('message', this.currentListener, false);\n        }\n    }\n}\n","import uuid from 'uuid/v4'\nimport { Channel } from './windowChannel'\nimport { runInThisContext } from 'vm';\n\nexport interface IFrameParams {\n    channelId: string\n    frameId: string\n    params: {\n        groupsServiceURL: string\n        userProfileServiceURL: string\n        workspaceServiceURL: string\n        serviceWizardURL: string\n        feedsServiceURL: string\n    },\n    parentHost: string\n}\n/*\n channelId: \"3b33179e-8a6d-4ae9-bc95-af4c0492eaa6\"\nframeId: \"frame_kb_html_be553ee5-645c-4737-80ba-dcb642632f0c\"\nhostId: \"host_kb_html_9a3b5d5d-bb92-43ff-a443-73267aa31323\"\nparams: {}\nparentHost: \"https://ci.kbase.us\"\n\n*/\n\n/*\nIFrameSimulator\nThis little doozey allows us to create a simulated iframe. We can query it for\n the params placed on the iframe, and talk to it via the window channel -- it has \n its own window channel.\n Good thing we designed the channel for multiple channels per window.\n*/\nclass IFrameSimulator {\n    params: IFrameParams | null\n    channel: Channel\n\n    constructor() {\n        this.params = null\n\n        // create a window channel.\n\n        this.channel = new Channel({\n            window: window,\n            host: document.location!.origin\n        })\n\n    }\n\n    getParamsFromIFrame(): IFrameParams {\n        return {\n            channelId: this.channel.id,\n            frameId: uuid(),\n            params: {\n                groupsServiceURL: 'services/groups',\n                userProfileServiceURL: 'services/user_profile/rpc',\n                workspaceServiceURL: 'services/ws',\n                serviceWizardURL: 'services/service_wizard',\n                feedsServiceURL: 'services/feeds'\n            },\n            parentHost: document.location!.origin\n        }\n    }\n}\n\n\n\nexport default IFrameSimulator","export interface IFrameParams {\n    channelId: string\n    frameId: string\n    params: {\n        groupsServiceURL: string\n        userProfileServiceURL: string\n        workspaceServiceURL: string\n        serviceWizardURL: string\n        feedsServiceURL: string\n    },\n    parentHost: string\n}\n\nexport class IFrameIntegration {\n    getParamsFromIFrame() {\n        if (!window.frameElement) {\n            return null\n        }\n        if (!window.frameElement.hasAttribute('data-params')) {\n            // throw new Error('No params found in window!!');\n            return null\n        }\n        const params = window.frameElement.getAttribute('data-params');\n        if (params === null) {\n            // throw new Error('No params found in window!')\n            return null\n        }\n        return JSON.parse(decodeURIComponent(params)) as IFrameParams\n    }\n}","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\n\nimport { ActionFlag } from './index'\nimport * as types from '../../types'\nimport IFrameSimulator, { IFrameParams } from '../../lib/IFrameSimulator';\nimport { IFrameIntegration } from '../../lib/IFrameIntegration';\n\n// Action Definitions\n\n// export interface AppStart extends Action {\n//     type: ActionFlag.APP_START,\n\n// }\n\nexport interface AppSuccess extends Action {\n    type: ActionFlag.APP_SUCCESS,\n    config: types.AppConfig\n}\n\nexport interface AppError extends Action {\n    type: ActionFlag.APP_ERROR,\n    error: AppError\n}\n\n// Action Creators\n\nexport function appSuccess(config: types.AppConfig): AppSuccess {\n    return {\n        type: ActionFlag.APP_SUCCESS,\n        config: config\n    }\n}\n\nexport function appError(error: AppError): AppError {\n    return {\n        type: ActionFlag.APP_ERROR,\n        error: error\n    }\n}\n\n// Action Thunks\n\nexport function appStart() {\n    return (dispatch: ThunkDispatch<types.StoreState, void, Action>, getState: () => types.StoreState) => {\n        // check and see if we are in an iframe\n        const iframeParams = new IFrameIntegration().getParamsFromIFrame()\n\n        if (iframeParams) {\n            dispatch(appSuccess({\n                baseUrl: '',\n                services: {\n                    Groups: {\n                        url: iframeParams.params.groupsServiceURL\n                    },\n                    UserProfile: {\n                        url: iframeParams.params.userProfileServiceURL\n                    },\n                    Workspace: {\n                        url: iframeParams.params.workspaceServiceURL\n                    },\n                    ServiceWizard: {\n                        url: iframeParams.params.serviceWizardURL\n                    },\n                    Feeds: {\n                        url: iframeParams.params.feedsServiceURL\n                    }\n                }\n            }))\n        } else {\n            const fakeIframeParams = new IFrameSimulator().getParamsFromIFrame()\n            dispatch(appSuccess({\n                baseUrl: '',\n                services: {\n                    Groups: {\n                        url: fakeIframeParams.params.groupsServiceURL\n                    },\n                    UserProfile: {\n                        url: fakeIframeParams.params.userProfileServiceURL\n                    },\n                    Workspace: {\n                        url: fakeIframeParams.params.workspaceServiceURL\n                    },\n                    ServiceWizard: {\n                        url: fakeIframeParams.params.serviceWizardURL\n                    },\n                    Feeds: {\n                        url: fakeIframeParams.params.feedsServiceURL\n                    }\n                }\n            }))\n        }\n\n\n        // if so, get the params\n\n        // if not, use the fake to get it\n    }\n}\n","import * as React from 'react'\nimport './KBaseIntegration.css'\n\nimport { AppState } from '../types'\nimport { } from '../lib/IFrameSimulator'\n\nexport interface KBaseIntegrationProps {\n    status: AppState,\n    onAppStart: () => void\n}\nclass KBaseIntegration extends React.Component<KBaseIntegrationProps, object> {\n    constructor(props: KBaseIntegrationProps) {\n        super(props)\n\n        // const params = this.getParamsFromIFrame()\n\n        this.props.onAppStart()\n    }\n\n    render() {\n        // TODO: some test like \n        // {this.props.env === 'dev' ? this.buildAuthDev() : this.buildAuthProd()}\n\n        if (this.props.status === AppState.NONE) {\n            return (\n                <div className=\"KBaseIntegration\">\n                    Loading...\n                </div>\n            )\n        } else {\n            return (\n                <div className=\"KBaseIntegration scrollable-flex-column\">\n                    {this.props.children}\n                </div>\n            )\n        }\n    }\n\n    // getParamsFromIFrame() {\n    //     if (!window.frameElement) {\n    //         return null\n    //     }\n    //     if (!window.frameElement.hasAttribute('data-params')) {\n    //         // throw new Error('No params found in window!!');\n    //         return null\n    //     }\n    //     const params = window.frameElement.getAttribute('data-params');\n    //     if (params === null) {\n    //         // throw new Error('No params found in window!')\n    //         return null\n    //     }\n    //     return JSON.parse(decodeURIComponent(params));\n    // }\n}\n\nexport default KBaseIntegration","import { Dispatch, Action } from 'redux'\nimport { connect } from 'react-redux'\n\nimport * as types from '../types'\nimport * as actions from '../redux/actions/app'\n\nimport KBaseIntegration from '../components/KBaseIntegration'\n\nexport interface OwnProps {\n\n}\n\ninterface StateProps {\n    status: types.AppState\n}\n\ninterface DispatchProps {\n    onAppStart: () => void\n}\n\nexport function mapStateToProps(state: types.StoreState, props: OwnProps): StateProps {\n    const { app: { status } } = state\n    return {\n        status\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<Action>): DispatchProps {\n    return {\n        onAppStart: () => {\n            dispatch(actions.appStart() as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, types.StoreState>(mapStateToProps, mapDispatchToProps)(KBaseIntegration)","import { ActionFlag } from './index'\nimport { StoreState, AppError } from '../../types'\nimport { ThunkDispatch } from 'redux-thunk'\nimport { Action } from 'redux'\nimport * as requestModel from '../../data/models/requests'\nimport * as orgModel from '../../data/models/organization/model'\n\n// Action types\n\n// Start up requests manager\n\nexport interface Load extends Action {\n    type: ActionFlag.ADMIN_MANAGE_REQUESTS_LOAD\n}\n\nexport interface LoadStart extends Action {\n    type: ActionFlag.ADMIN_MANAGE_REQUESTS_LOAD_START\n}\n\nexport interface LoadSuccess extends Action {\n    type: ActionFlag.ADMIN_MANAGE_REQUESTS_LOAD_SUCCESS\n    organization: orgModel.Organization\n    requests: Array<requestModel.Request>\n    invitations: Array<requestModel.Request>\n}\n\nexport interface LoadError extends Action {\n    type: ActionFlag.ADMIN_MANAGE_REQUESTS_LOAD_ERROR,\n    error: AppError\n}\n\nexport interface Unload extends Action {\n    type: ActionFlag.ADMIN_MANAGE_REQUESTS_UNLOAD\n}\n\n// Accept join requests\n\nexport interface AcceptJoinRequest extends Action {\n    type: ActionFlag.ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST,\n    requestId: string\n}\n\nexport interface AcceptJoinRequestStart extends Action {\n    type: ActionFlag.ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_START,\n    requestId: string\n}\n\nexport interface AcceptJoinRequestSuccess extends Action {\n    type: ActionFlag.ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_SUCCESS,\n    request: requestModel.Request\n}\n\nexport interface AcceptJoinRequestError extends Action {\n    type: ActionFlag.ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_ERROR,\n    error: AppError\n}\n\nexport function acceptJoinRequestStart(requestId: string): AcceptJoinRequestStart {\n    return {\n        type: ActionFlag.ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_START,\n        requestId: requestId\n    }\n}\n\nexport function acceptJoinRequestSuccess(request: requestModel.Request): AcceptJoinRequestSuccess {\n    return {\n        type: ActionFlag.ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_SUCCESS,\n        request: request\n    }\n}\n\nexport function acceptJoinRequestError(error: AppError): AcceptJoinRequestError {\n    return {\n        type: ActionFlag.ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_ERROR,\n        error: error\n    }\n}\n\n// Deny join requests\n\nexport interface DenyJoinRequest extends Action {\n    type: ActionFlag.ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST,\n    requestId: string\n}\n\nexport interface DenyJoinRequestStart extends Action {\n    type: ActionFlag.ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_START,\n    requestId: string\n}\n\nexport interface DenyJoinRequestSuccess extends Action {\n    type: ActionFlag.ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_SUCCESS,\n    request: requestModel.Request\n}\n\nexport interface DenyJoinRequestError extends Action {\n    type: ActionFlag.ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_ERROR,\n    error: AppError\n}\n\n\nexport function denyJoinRequestStart(requestId: string): DenyJoinRequestStart {\n    return {\n        type: ActionFlag.ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_START,\n        requestId: requestId\n    }\n}\n\nexport function denyJoinRequestSuccess(request: requestModel.Request): DenyJoinRequestSuccess {\n    return {\n        type: ActionFlag.ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_SUCCESS,\n        request: request\n    }\n}\n\nexport function denyJoinRequestError(error: AppError): DenyJoinRequestError {\n    return {\n        type: ActionFlag.ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_ERROR,\n        error: error\n    }\n}\n\n// Cancel join invitations\n\nexport interface CancelJoinInvitation extends Action {\n    type: ActionFlag.ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION\n    requestId: string\n}\n\nexport interface CancelJoinInvitationStart extends Action {\n    type: ActionFlag.ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_START\n}\n\nexport interface CancelJoinInvitationSuccess extends Action {\n    type: ActionFlag.ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_SUCCESS\n    request: requestModel.Request\n}\n\nexport interface CancelJoinInvitationError extends Action {\n    type: ActionFlag.ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_ERROR,\n    error: AppError\n}\n\n\nexport function cancelJoinInvitationStart(): CancelJoinInvitationStart {\n    return {\n        type: ActionFlag.ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_START\n    }\n}\n\nexport function cancelJoinInvitationSuccess(request: requestModel.Request): CancelJoinInvitationSuccess {\n    return {\n        type: ActionFlag.ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_SUCCESS,\n        request: request\n    }\n}\n\nexport function cancelJoinInvitationError(error: AppError): CancelJoinInvitationError {\n    return {\n        type: ActionFlag.ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_ERROR,\n        error: error\n    }\n}\n\n// Admin obtains view access\nexport interface GetViewAccess extends Action {\n    type: ActionFlag.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS\n    requestId: string\n}\n\nexport interface GetViewAccessStart extends Action {\n    type: ActionFlag.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_START\n}\n\nexport interface GetViewAccessSuccess extends Action {\n    type: ActionFlag.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_SUCCESS,\n    request: requestModel.Request\n}\n\nexport interface GetViewAccessError extends Action {\n    type: ActionFlag.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_ERROR,\n    error: AppError\n}\n\n\n\nexport function getViewAccessStart(): GetViewAccessStart {\n    return {\n        type: ActionFlag.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_START\n    }\n}\n\nexport function getViewAccessSuccess(request: requestModel.Request): GetViewAccessSuccess {\n    return {\n        type: ActionFlag.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_SUCCESS,\n        request: request\n    }\n}\n\nexport function getViewAccessError(error: AppError): GetViewAccessError {\n    return {\n        type: ActionFlag.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_ERROR,\n        error: error\n    }\n}\n\nexport function getViewAccess(requestId: string) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(getViewAccessStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config }\n        } = getState()\n\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url,\n        })\n\n        // get requests \n        try {\n            const request = await orgClient.grantViewAccess(requestId)\n            dispatch(getViewAccessSuccess(request))\n        } catch (ex) {\n            dispatch(getViewAccessError({\n                code: ex.name,\n                message: ex.message\n            }))\n        }\n    }\n}\n\n// Action generators\n\nexport function loadStart(): LoadStart {\n    return {\n        type: ActionFlag.ADMIN_MANAGE_REQUESTS_LOAD_START\n    }\n}\n\nexport function loadSuccess(organization: orgModel.Organization, requests: Array<requestModel.Request>, invitations: Array<requestModel.Request>): LoadSuccess {\n    return {\n        type: ActionFlag.ADMIN_MANAGE_REQUESTS_LOAD_SUCCESS,\n        organization: organization,\n        requests: requests,\n        invitations: invitations\n    }\n}\n\nexport function loadError(error: AppError): LoadError {\n    return {\n        type: ActionFlag.ADMIN_MANAGE_REQUESTS_LOAD_ERROR,\n        error: error\n    }\n}\n\nexport function unload(): Unload {\n    return {\n        type: ActionFlag.ADMIN_MANAGE_REQUESTS_UNLOAD\n    }\n}\n\n// Action thunks\n\nexport function load(organizationId: string) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        const {\n            auth: { authorization: { token, username } },\n            app: { config }\n        } = getState()\n\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url,\n        })\n\n        const requestClient = new requestModel.RequestsModel({\n            token, username, groupsServiceURL: config.services.Groups.url\n        })\n\n        // get requests \n        try {\n            const [organization, requests, invitations] = await Promise.all([\n                orgClient.getOrg(organizationId),\n                requestClient.getPendingOrganizationRequestsForOrg(organizationId),\n                requestClient.getOrganizationInvitationsForOrg(organizationId)\n            ])\n            dispatch(loadSuccess(organization, requests, invitations))\n        } catch (ex) {\n            dispatch(loadError({\n                code: ex.name,\n                message: ex.message\n            }))\n        }\n    }\n}\n\nexport function acceptJoinRequest(requestId: string) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        const {\n            auth: { authorization: { token, username } },\n            views: { manageOrganizationRequestsView },\n            app: { config }\n        } = getState()\n\n        const requestClient = new requestModel.RequestsModel({\n            token, username, groupsServiceURL: config.services.Groups.url\n        })\n\n        if (!manageOrganizationRequestsView) {\n            return\n        }\n\n        try {\n            const request = await requestClient.acceptRequest(requestId)\n            dispatch(acceptJoinRequestSuccess(request))\n        } catch (ex) {\n            dispatch(acceptJoinRequestError({\n                code: ex.name,\n                message: ex.message\n            }))\n        }\n    }\n}\n\nexport function denyJoinRequest(requestId: string) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        const {\n            auth: { authorization: { token, username } },\n            views: { manageOrganizationRequestsView },\n            app: { config }\n        } = getState()\n\n        if (!manageOrganizationRequestsView) {\n            return\n        }\n\n        const requestClient = new requestModel.RequestsModel({\n            token, username, groupsServiceURL: config.services.Groups.url\n        })\n\n        try {\n            const request = await requestClient.denyRequest(requestId)\n            dispatch(denyJoinRequestSuccess(request))\n            if (manageOrganizationRequestsView.viewModel) {\n                dispatch(load(manageOrganizationRequestsView.viewModel.organization.id))\n            }\n        } catch (ex) {\n            dispatch(denyJoinRequestError({\n                code: ex.name,\n                message: ex.message\n            }))\n        }\n    }\n}\n\nexport function cancelJoinInvitation(requestId: string) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        const {\n            auth: { authorization: { token, username } },\n            views: { manageOrganizationRequestsView },\n            app: { config }\n        } = getState()\n\n        if (!manageOrganizationRequestsView) {\n            return\n        }\n\n        const requestClient = new requestModel.RequestsModel({\n            token, username, groupsServiceURL: config.services.Groups.url\n        })\n\n        try {\n            const request = await requestClient.cancelRequest(requestId)\n            if (manageOrganizationRequestsView.viewModel) {\n                dispatch(load(manageOrganizationRequestsView.viewModel.organization.id))\n            }\n        } catch (ex) {\n            dispatch(cancelJoinInvitationError({\n                code: ex.name,\n                message: ex.message\n            }))\n        }\n    }\n}\n","import * as React from 'react'\nimport './User.css'\nimport Avatar from './Avatar'\nimport * as userModel from '../../data/models/user'\nimport { Button, Icon } from 'antd';\n\nexport interface UserProps {\n    user: userModel.User\n    avatarSize?: number\n}\n\nenum View {\n    COMPACT = 0,\n    NORMAL\n}\n\ninterface UserState {\n    view: View\n}\n\nfunction reverseView(v: View) {\n    switch (v) {\n        case View.COMPACT:\n            return View.NORMAL\n        case View.NORMAL:\n            return View.COMPACT\n    }\n}\n\nfunction viewLabel(v: View) {\n    switch (v) {\n        case View.COMPACT:\n            return 'Compact'\n        case View.NORMAL:\n            return 'Normal'\n    }\n}\n\nclass User extends React.Component<UserProps, UserState> {\n    constructor(props: UserProps) {\n        super(props)\n\n        this.state = {\n            view: View.COMPACT\n        }\n    }\n\n    onToggleView() {\n        this.setState({\n            view: reverseView(this.state.view)\n        })\n    }\n\n    renderCompact() {\n        return (\n            <React.Fragment>\n                <div className=\"avatarCol\">\n                    <Avatar user={this.props.user} size={this.props.avatarSize || 30} />\n                </div>\n                <div className=\"infoCol\">\n                    <div className=\"name\">\n                        <a href={\"#people/\" + this.props.user.username} target=\"_blank\">{this.props.user.realname}</a>\n                        {' '}\n                        {this.props.user.username}\n                    </div>\n                </div>\n                <div className=\"controlCol\">\n                    <a onClick={this.onToggleView.bind(this)}\n                        className={`linkButton ${this.state.view === View.NORMAL ? \"pressed\" : \"\"}`}\n                    >\n                        <Icon type={`${this.state.view === View.NORMAL ? \"up\" : \"down\"}`} />\n                    </a>\n                </div>\n            </React.Fragment>\n        )\n    }\n\n    renderNormal() {\n        return (\n            <React.Fragment>\n                <div className=\"avatarCol\">\n                    <Avatar user={this.props.user} size={this.props.avatarSize || 30} />\n                </div>\n                <div className=\"infoCol\">\n                    <div className=\"name\">\n                        <a href={\"#people/\" + this.props.user.username} target=\"_blank\">{this.props.user.realname}</a>\n                        {' '}\n                        {this.props.user.username}\n                    </div>\n                    <div className=\"organization\">\n                        {this.props.user.organization || <i>no organization in user profile</i>}\n                    </div>\n                    <div className=\"location\">\n                        {[this.props.user.city, this.props.user.state, this.props.user.country].filter(x => x).join(', ') || <i>no location information in user profile</i>}\n                    </div>\n                </div>\n                <div className=\"controlCol\">\n                    <a onClick={this.onToggleView.bind(this)}\n                        className={`linkButton ${this.state.view === View.NORMAL ? \"pressed\" : \"\"}`}\n                    >\n                        <Icon type={`${this.state.view === View.NORMAL ? \"up\" : \"down\"}`} />\n                    </a>\n                </div>\n            </React.Fragment>\n        )\n    }\n\n    render() {\n        switch (this.state.view) {\n            case View.COMPACT:\n                return (\n                    <div className=\"User View-COMPACT\">\n                        {this.renderCompact()}\n                    </div>\n                )\n            case View.NORMAL:\n                return (\n                    <div className=\"User View-NORMAL\">\n                        {this.renderNormal()}\n                    </div>\n                )\n        }\n    }\n}\n\nexport default User","import * as React from 'react'\nimport * as userModel from '../../data/models/user'\nimport User from './User'\n\ninterface LoaderProps {\n    userId: userModel.Username\n    user: userModel.User | undefined\n    avatarSize: number\n    onLoad: (userId: userModel.Username) => void\n}\n\ninterface LoaderState {\n\n}\n\nclass Loader extends React.Component<LoaderProps, LoaderState> {\n    constructor(props: LoaderProps) {\n        super(props)\n    }\n\n    render() {\n        if (this.props.user) {\n            return (\n                <User user={this.props.user} avatarSize={this.props.avatarSize} />\n            )\n        } else {\n            this.props.onLoad(this.props.userId)\n            return (\n                <div>\n                    Loading user...\n                </div>\n            )\n        }\n    }\n}\n\nimport { Dispatch } from 'redux'\nimport { connect } from 'react-redux'\nimport { StoreState } from '../../types';\nimport * as actions from '../../redux/actions/entities'\n\n\nexport interface OwnProps {\n    userId: userModel.Username\n    avatarSize: number\n}\n\ninterface StateProps {\n    user: userModel.User | undefined\n}\n\ninterface DispatchProps {\n    onLoad: (userId: userModel.Username) => void\n}\n\nfunction mapStateToProps(state: StoreState, props: OwnProps): StateProps {\n    return {\n        user: state.entities.users.byId.get(props.userId)\n    }\n}\n\nfunction mapDispatchToProps(dispatch: Dispatch<actions.EntityAction>): DispatchProps {\n    return {\n        onLoad: (userId: userModel.Username) => {\n            dispatch(actions.userLoader(userId) as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(Loader)","import * as React from 'react'\nimport * as narrativeModel from '../../data/models/narrative'\nimport { Tooltip, Icon } from 'antd';\nimport './Narrative.css'\n\nexport interface NarrativeProps {\n    narrative: narrativeModel.Narrative\n}\n\n\nenum View {\n    COMPACT = 0,\n    NORMAL\n}\n\nfunction reverseView(v: View) {\n    switch (v) {\n        case View.COMPACT:\n            return View.NORMAL\n        case View.NORMAL:\n            return View.COMPACT\n    }\n}\n\ninterface NarrativeState {\n    view: View\n}\n\nexport default class Narrative extends React.Component<NarrativeProps, NarrativeState> {\n    constructor(props: NarrativeProps) {\n        super(props)\n\n        this.state = {\n            view: View.COMPACT\n        }\n    }\n\n    onToggleView() {\n        this.setState({\n            view: reverseView(this.state.view)\n        })\n    }\n\n    renderPublicPermission(narrative: narrativeModel.AccessibleNarrative) {\n        if (narrative.isPublic) {\n            return (\n                <Tooltip title=\"This narrative is viewable by all KBase users\" placement=\"right\">\n                    <span style={{ cursor: 'help' }}>\n                        <Icon type=\"globe\" /> Public Narrative\n                    </span>\n                </Tooltip>\n            )\n        } else {\n            return (\n                <Tooltip title=\"This narrative is only accessible to those with whom it is directly shared\" placement=\"right\">\n                    <span style={{ cursor: 'help' }}>\n                        <Icon type=\"lock\" /> Private Narrative\n                    </span>\n                </Tooltip>\n            )\n        }\n    }\n\n    renderUserPermission(narrative: narrativeModel.AccessibleNarrative) {\n        let label\n        switch (narrative.access) {\n            case narrativeModel.NarrativeAccess.VIEW:\n                label = 'View-Only'\n                break\n            case narrativeModel.NarrativeAccess.EDIT:\n                label = 'Edit'\n                break\n            case narrativeModel.NarrativeAccess.ADMIN:\n                label = 'Admin'\n                break\n            case narrativeModel.NarrativeAccess.OWNER:\n                label = 'Owner'\n                break\n            default:\n                label = 'Unknown'\n        }\n        return (\n            <span>\n                {label}\n            </span>\n        )\n    }\n\n    renderCompact(narrative: narrativeModel.AccessibleNarrative) {\n        return (\n            <React.Fragment>\n                <div className=\"iconCol\">\n                    <Icon type=\"file\" style={{ fontSize: '30px', width: '30px' }} />\n                </div>\n                <div className=\"mainCol\">\n                    <div className=\"title\">\n                        {narrative.title}\n                    </div>\n                </div>\n                <div className=\"controlCol\">\n                    <a onClick={this.onToggleView.bind(this)}\n                        className={`linkButton ${this.state.view === View.NORMAL ? \"pressed\" : \"\"}`}\n                    >\n                        <Icon type={`${this.state.view === View.NORMAL ? \"up\" : \"down\"}`} />\n                    </a>\n                </div>\n            </React.Fragment>\n        )\n    }\n\n    renderNormal(narrative: narrativeModel.AccessibleNarrative) {\n        // const narrative = this.props.narrative\n        return (\n            <React.Fragment>\n                <div className=\"iconCol\">\n                    <Icon type=\"file\" style={{ fontSize: '30px', width: '30px' }} />\n                </div>\n                <div className=\"mainCol\">\n                    <div className=\"title\">\n                        {narrative.title}\n                    </div>\n                    <div>\n                        {this.renderPublicPermission(narrative)}\n                    </div>\n                    <div>\n                        <span className=\"field-label\">your permission</span>\n                        {this.renderUserPermission(narrative)}\n                    </div>\n                    <div>\n                        <span className=\"field-label\">owner</span>{narrative.owner}\n                    </div>\n                    <div>\n                        <span className=\"field-label\">last saved</span>{Intl.DateTimeFormat('en-US', {\n                            month: 'short',\n                            day: 'numeric',\n                            year: 'numeric'\n                        }).format(narrative.lastSavedAt)}\n                    </div>\n                    <div>\n                        <span className=\"field-label\">by</span>{narrative.lastSavedBy}\n                    </div>\n                </div>\n                <div className=\"controlCol\">\n                    <a onClick={this.onToggleView.bind(this)}\n                        className={`linkButton ${this.state.view === View.NORMAL ? \"pressed\" : \"\"}`}\n                    >\n                        <Icon type={`${this.state.view === View.NORMAL ? \"up\" : \"down\"}`} />\n                    </a>\n                </div>\n            </React.Fragment>\n        )\n    }\n\n    render() {\n        const narrative = this.props.narrative\n        if (narrative.access === narrativeModel.NarrativeAccess.NONE) {\n            return (\n                <div>\n                    You don't have access to this Narrative\n                </div>\n            )\n        }\n        switch (this.state.view) {\n            case View.COMPACT:\n                return (\n                    <div className=\"Narrative View-COMPACT\">\n                        {this.renderCompact(narrative)}\n                    </div>\n                )\n            case View.NORMAL:\n                return (\n                    <div className=\"Narrative View-NORMAL\">\n                        {this.renderNormal(narrative)}\n                    </div>\n                )\n        }\n\n    }\n}","import * as React from 'react'\nimport * as narrativeModel from '../../data/models/narrative'\nimport * as orgModel from '../../data/models/organization/model'\nimport Narrative from './Narrative'\n\ninterface LoaderProps {\n    workspaceId: narrativeModel.WorkspaceID\n    narrative: narrativeModel.Narrative | null\n    onLoad: (workspaceId: narrativeModel.WorkspaceID) => void\n}\n\ninterface LoaderState { }\n\nclass Loader extends React.Component<LoaderProps, LoaderState> {\n    constructor(props: LoaderProps) {\n        super(props)\n    }\n\n    render() {\n        if (this.props.narrative) {\n            return (\n                <Narrative\n                    narrative={this.props.narrative}\n                />\n            )\n        } else {\n            this.props.onLoad(this.props.workspaceId)\n            return (\n                <div>\n                    Loading narrative...\n                </div>\n            )\n        }\n    }\n}\n\n// redux wrapper\n\nimport { Dispatch } from 'redux'\nimport { connect } from 'react-redux'\nimport { StoreState } from '../../types'\nimport * as actions from '../../redux/actions/entities'\n\nexport interface OwnProps {\n    workspaceId: narrativeModel.WorkspaceID\n}\n\ninterface StateProps {\n    narrative: narrativeModel.Narrative | null\n}\n\ninterface DispatchProps {\n    onLoad: (workspaceId: narrativeModel.WorkspaceID) => void\n}\n\n\nfunction mapStateToProps(state: StoreState, props: OwnProps): StateProps {\n    return {\n        narrative: state.entities.narratives.byId.get(props.workspaceId) || null\n    }\n}\n\nfunction mapDispatchToProps(dispatch: Dispatch<actions.EntityAction>): DispatchProps {\n    return {\n        onLoad: (workspaceId: narrativeModel.WorkspaceID) => {\n            dispatch(actions.loadNarrative(workspaceId) as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(Loader)\n","import * as React from 'react'\n\nimport './component.css'\nimport * as types from '../../../types'\nimport Header from '../../Header'\nimport { Icon, Button, Modal, Card, Alert } from 'antd'\nimport { Redirect } from 'react-router'\nimport User from '../../entities/UserContainer'\nimport OrganizationHeader from '../organizationHeader/loader'\nimport Narrative from '../../entities/NarrativeContainer'\nimport * as requestModel from '../../../data/models/requests'\nimport * as orgModel from '../../../data/models/organization/model'\nimport { NavLink } from 'react-router-dom';\n\nexport interface ManageGroupRequestsProps {\n    // organizationId: string,\n    viewModel: types.ManageOrganizationRequestsViewModel\n    // onStart: (organizationId: string) => void,\n    onAcceptJoinRequest: (requestId: string) => void\n    onDenyJoinRequest: (requestId: string) => void\n    onCancelJoinInvitation: (requestId: string) => void\n    onGetViewAccess: (requestId: string) => void\n}\n\nexport interface ManageGroupRequestsState {\n    cancelToBrowser: boolean\n    cancelToViewer: boolean\n}\n\nclass ManageGroupRequests extends React.Component<ManageGroupRequestsProps, ManageGroupRequestsState> {\n\n    constructor(props: ManageGroupRequestsProps) {\n        super(props)\n\n        this.state = {\n            cancelToBrowser: false,\n            cancelToViewer: false\n        }\n\n        // this.props.onStart(this.props.organizationId)\n    }\n\n    onClickCancelToBrowser() {\n        this.setState({ cancelToBrowser: true })\n    }\n\n    onClickCancelToViewer() {\n        this.setState({ cancelToViewer: true })\n    }\n    onAcceptJoinRequest(requestId: string) {\n        this.props.onAcceptJoinRequest(requestId)\n    }\n    onDenyJoinRequest(requestId: string) {\n        this.props.onDenyJoinRequest(requestId)\n    }\n    onCancelJoinInvitation(requestId: string) {\n        this.props.onCancelJoinInvitation(requestId)\n    }\n    onGetViewAccess(requestId: string) {\n        this.props.onGetViewAccess(requestId)\n    }\n    onViewProfile(username: string) {\n        window.open('#people/' + username, '_blank')\n    }\n    onShowInfo() {\n        Modal.info({\n            title: 'Manage Requests Help',\n            width: '50em',\n            content: (\n                <div>\n                    <p>This is the manage requests tool...</p>\n                </div>\n            )\n        })\n    }\n\n    renderOrgName(name: string) {\n        const maxLength = 25\n        if (name.length < 25) {\n            return name\n        }\n        return (\n            <span>\n                {name.slice(0, 25)}\n                \n            </span>\n        )\n    }\n\n    renderHeader() {\n        let orgName: string\n        // if (this.props.manageOrganizationRequestsView && this.props.manageOrganizationRequestsView.viewState) {\n        //     orgName = this.props.manageOrganizationRequestsView.viewState.organization.name\n        // } else {\n        //     orgName = 'loading...'\n        // }\n        const breadcrumbs = (\n            <React.Fragment>\n                <span>\n                    <NavLink to={`/viewOrganization/${this.props.viewModel.organization.id}`}>\n                        <span style={{ fontWeight: 'bold' }}>\n                            {this.renderOrgName(this.props.viewModel.organization.name)}\n                        </span>\n                    </NavLink>\n\n                    <Icon type=\"right\" style={{ verticalAlign: 'middle', marginLeft: '4px', marginRight: '4px' }} />\n\n                    <Icon type=\"tool\" />\n                    {' '}\n                    <span style={{ fontSize: '120%' }}>Managing Org Requests</span>\n                </span>\n            </React.Fragment>\n        )\n        const buttons = (\n            <React.Fragment>\n                <Button icon=\"undo\"\n                    type=\"danger\"\n                    onClick={this.onClickCancelToViewer.bind(this)}>\n                    Return to this Org\n                </Button>\n                <Button\n                    shape=\"circle\"\n                    icon=\"info\"\n                    onClick={this.onShowInfo.bind(this)}>\n                </Button>\n            </React.Fragment>\n        )\n        return (\n            <Header breadcrumbs={breadcrumbs} buttons={buttons} />\n        )\n    }\n\n    renderLoadingHeader() {\n        const breadcrumbs = (\n            <span>\n                Loading Org Editor...\n            </span>\n        )\n\n        return (\n            <Header breadcrumbs={breadcrumbs} />\n        )\n    }\n\n    // renderRequestType(type: types.RequestType) {\n\n    //     switch (type) {\n    //         case types.RequestType.JOIN_GROUP_REQUEST:\n    //             return 'Join Group Request'\n    //         case types.RequestType.JOIN_GROUP_INVITE:\n    //             return 'Join Group Invitation'\n    //         case types.RequestType.ADD_WORKSPACE_REQUEST:\n    //             return 'Add Workspace Request'\n    //         case types.RequestType.ADD_WORKSPACE_INVITE:\n    //             return 'Add Workspace Invitation'\n    //     }\n    // }\n\n    niceElapsed(someDate: Date) {\n        const nowDate = new Date()\n\n        const elapsed = Math.round((nowDate.getTime() - someDate.getTime()) / 1000);\n        const elapsedAbs = Math.abs(elapsed);\n\n        let measure, measureAbs, unit;\n        const maxDays = 90\n        if (elapsedAbs < 60 * 60 * 24 * maxDays) {\n            if (elapsedAbs === 0) {\n                return 'now';\n            } else if (elapsedAbs < 60) {\n                measure = elapsed;\n                measureAbs = elapsedAbs;\n                unit = 'second';\n            } else if (elapsedAbs < 60 * 60) {\n                measure = Math.round(elapsed / 60);\n                measureAbs = Math.round(elapsedAbs / 60);\n                unit = 'minute';\n            } else if (elapsedAbs < 60 * 60 * 24) {\n                measure = Math.round(elapsed / 3600);\n                measureAbs = Math.round(elapsedAbs / 3600);\n                unit = 'hour';\n            } else {\n                measure = Math.round(elapsed / (3600 * 24));\n                measureAbs = Math.round(elapsedAbs / (3600 * 24));\n                unit = 'day';\n            }\n\n            if (measureAbs > 1) {\n                unit += 's';\n            }\n\n            let prefix = null;\n            let suffix = null;\n            if (measure < 0) {\n                prefix = 'in';\n            } else if (measure > 0) {\n                suffix = 'ago';\n            }\n\n            return (prefix ? prefix + ' ' : '') + measureAbs + ' ' + unit + (suffix ? ' ' + suffix : '');\n        } else {\n            // otherwise show the actual date, with or without the year.\n            if (nowDate.getFullYear() === nowDate.getFullYear()) {\n                return Intl.DateTimeFormat('en-US', {\n                    month: 'short',\n                    day: 'numeric'\n                }).format(someDate)\n                // return shortMonths[date.getMonth()] + ' ' + date.getDate();\n            } else {\n                return Intl.DateTimeFormat('en-US', {\n                    month: 'short',\n                    day: 'numeric',\n                    year: 'numeric'\n                }).format(someDate)\n                // return shortMonths[date.getMonth()] + ' ' + date.getDate() + ', ' + date.getFullYear();\n            }\n        }\n    }\n\n    renderRequestJoinRequest(request: requestModel.UserRequest) {\n        const title = (\n            <span>\n                <Icon type=\"user\" />\n                <Icon type=\"arrow-right\" />\n                <Icon type=\"team\" />\n                {' '}\n                Request to Join Group\n            </span>\n        )\n        const actions = [\n            <Button\n                type=\"primary\"\n                style={{ margin: '0 5px' }}\n                onClick={() => this.onAcceptJoinRequest.call(this, request.id)}>\n                Approve\n            </Button>,\n            <Button\n                type=\"danger\"\n                style={{ margin: '0 5px' }}\n                onClick={() => this.onDenyJoinRequest.call(this, request.id)}>\n                Deny\n            </Button>\n        ]\n\n        return (\n            <Card key={request.id}\n                title={title}\n                hoverable={true}\n                actions={actions}\n                headStyle={{ backgroundColor: 'rgba(200, 200, 200,0.3' }}\n                style={{ marginBottom: '10px' }}>\n                <table className=\"pendingRequestsTable\">\n                    <tbody>\n                        <tr>\n                            <th>from</th>\n                            <td className=\"requester\">\n                                <User userId={request.requester} avatarSize={50} />\n                            </td>\n                        </tr>\n                        <tr>\n                            <th>sent</th>\n                            <td className=\"createdAt\">{Intl.DateTimeFormat('en-US', {\n                                month: 'long',\n                                day: 'numeric',\n                                year: 'numeric'\n                            }).format(request.createdAt)}</td>\n                        </tr>\n                        <tr>\n                            <th>expires</th>\n                            <td className=\"expiresAt\">{Intl.DateTimeFormat('en-US', {\n                                month: 'long',\n                                day: 'numeric',\n                                year: 'numeric'\n                            }).format(request.expireAt)} ({this.niceElapsed(request.expireAt)})</td>\n                        </tr>\n                    </tbody>\n                </table>\n            </Card>\n        )\n    }\n\n    renderRequestJoinInvitation(request: requestModel.UserInvitation) {\n        const title = (\n            <span>\n                <Icon type=\"team\" />\n                <Icon type=\"mail\" />\n                <Icon type=\"arrow-right\" />\n                <Icon type=\"user\" />\n\n                {' '}\n                Invitation to Join Group\n            </span>\n        )\n        const actions = [\n            <Button\n                type=\"danger\"\n                style={{ margin: '0 5px' }}\n                onClick={() => this.onCancelJoinInvitation.call(this, request.id)}>\n                Cancel\n            </Button>\n        ]\n\n        return (\n            <Card key={request.id}\n                title={title}\n                hoverable={true}\n                actions={actions}\n                headStyle={{ backgroundColor: 'rgba(200, 200, 200,0.3' }}\n                style={{ marginBottom: '10px' }}>\n                <table className=\"pendingRequestsTable\">\n                    <tbody>\n                        <tr>\n                            <th>invitation to</th>\n                            <td className=\"requester\">\n                                <User userId={request.user} avatarSize={30} />\n                            </td>\n                        </tr>\n                        <tr>\n                            <th>sent</th>\n                            <td className=\"createdAt\">{Intl.DateTimeFormat('en-US', {\n                                month: 'long',\n                                day: 'numeric',\n                                year: 'numeric'\n                            }).format(request.createdAt)}</td>\n                        </tr>\n                        <tr>\n                            <th>expires</th>\n                            <td className=\"expiresAt\">{Intl.DateTimeFormat('en-US', {\n                                month: 'long',\n                                day: 'numeric',\n                                year: 'numeric'\n                            }).format(request.expireAt)} ({this.niceElapsed(request.expireAt)})</td>\n                        </tr>\n                    </tbody>\n                </table>\n            </Card>\n        )\n    }\n\n    renderNarrativePermission(permission: orgModel.UserWorkspacePermission) {\n        switch (permission) {\n            case orgModel.UserWorkspacePermission.NONE:\n                return 'None'\n            case orgModel.UserWorkspacePermission.VIEW:\n                return 'View Only'\n            // return 'View and Copy'\n            case orgModel.UserWorkspacePermission.EDIT:\n                return 'Edit'\n            // return 'View, Copy, Save, Run'\n            case orgModel.UserWorkspacePermission.ADMIN:\n                return 'Admin'\n            // return 'View, Copy, Save, Run, Manage Sharing'\n            case orgModel.UserWorkspacePermission.OWNER:\n                return 'Owner'\n            // return 'View, Copy, Save, Run, Manage Sharing, Own'\n        }\n    }\n\n    renderRequestNarrativeRequest(request: requestModel.WorkspaceRequest) {\n        const title = (\n            <span>\n                <Icon type=\"file\" />\n                <Icon type=\"arrow-right\" />\n                <Icon type=\"team\" />\n                {' '}\n                Request to Add Narrative\n            </span>\n        )\n\n        const actions = [\n            <Button\n                type=\"primary\"\n                style={{ margin: '0 5px' }}\n                onClick={() => this.onAcceptJoinRequest.call(this, request.id)}>\n                Approve\n            </Button>,\n            <Button\n                type=\"danger\"\n                style={{ margin: '0 5px' }}\n                onClick={() => this.onDenyJoinRequest.call(this, request.id)}>\n                Deny\n            </Button>\n        ]\n\n        let narrativeAccess\n        narrativeAccess = (\n            <Narrative workspaceId={parseInt(request.narrativeId, 10)} />\n        )\n        // TODO: Revive me!!\n        // if (request.narrativeId) {\n        //     // TODO: note the '1' below -- we dont' get the object id from the groups service,\n        //     // and the narrative will soon accept just the workspace id (and will look up the object id by itself)\n        //     // but not yet, so we just use 1, which is INCORRECT.\n        //     narrativeAccess = (\n        //         <div>\n        //             <div>\n        //                 <a href={\"/narrative/ws.\" + request.narrativeId + '.obj.' + '1'} target=\"_blank\">{request.title}</a>\n        //             </div>\n        //             <div>\n        //                 <span className=\"field-label\">your access</span>{' '}{this.renderNarrativePermission(request.narrative.permission)}\n        //             </div>\n        //             <div>\n        //                 <span className=\"field-label\">public?</span>{' '}{request.isPublic ? 'yes' : 'no'}\n        //             </div>\n\n        //         </div>\n        //     )\n        // } else {\n        //     narrativeAccess = (\n        //         <span>\n        //             You don't have access to this narrative\n        //             {' '}\n        //             <Button\n        //                 onClick={() => { this.onGetViewAccess.call(this, request.id) }}>\n        //                 Click for View Access\n        //             </Button>\n        //         </span>\n        //     )\n        // }\n\n        return (\n            <Card key={request.id}\n                title={title}\n                hoverable={true}\n                actions={actions}\n                headStyle={{ backgroundColor: 'rgba(200, 200, 200,0.3' }}\n                style={{ marginBottom: '10px' }}>\n                <table className=\"pendingRequestsTable\">\n                    <tbody>\n                        <tr>\n                            <th>from</th>\n                            <td className=\"requester\">\n                                <User userId={request.requester} avatarSize={30} />\n                            </td>\n                        </tr>\n                        <tr>\n                            <th>narrative</th>\n                            <td className=\"narrative\">\n                                {narrativeAccess}\n                            </td>\n                        </tr>\n                        <tr>\n                            <th>sent</th>\n                            <td className=\"createdAt\">{Intl.DateTimeFormat('en-US', {\n                                month: 'long',\n                                day: 'numeric',\n                                year: 'numeric'\n                            }).format(request.createdAt)}</td>\n                        </tr>\n                        <tr>\n                            <th>expires</th>\n                            <td className=\"expiresAt\">{Intl.DateTimeFormat('en-US', {\n                                month: 'long',\n                                day: 'numeric',\n                                year: 'numeric'\n                            }).format(request.expireAt)} ({this.niceElapsed(request.expireAt)})</td>\n                        </tr>\n                    </tbody>\n                </table>\n            </Card>\n        )\n    }\n\n    renderRequestAppRequest(request: requestModel.AppRequest) {\n        const title = (\n            <span>\n                <Icon type=\"appstore\" />\n                <Icon type=\"arrow-right\" />\n                <Icon type=\"team\" />\n                {' '}\n                Request to Add App\n            </span>\n        )\n        const actions = [\n            <Button\n                type=\"primary\"\n                style={{ margin: '0 5px' }}\n                onClick={() => this.onAcceptJoinRequest.call(this, request.id)}>\n                Approve\n            </Button>,\n            <Button\n                type=\"danger\"\n                style={{ margin: '0 5px' }}\n                onClick={() => this.onDenyJoinRequest.call(this, request.id)}>\n                Deny\n            </Button>\n        ]\n\n        return (\n            <Card key={request.id}\n                title={title}\n                hoverable={true}\n                actions={actions}\n                headStyle={{ backgroundColor: 'rgba(200, 200, 200,0.3' }}\n                style={{ marginBottom: '10px' }}>\n                <table className=\"pendingRequestsTable\">\n                    <tbody>\n                        <tr>\n                            <th>from</th>\n                            <td className=\"requester\">\n                                <User userId={request.requester} avatarSize={50} />\n                            </td>\n                        </tr>\n                        <tr>\n                            <th>app</th>\n                            <td className=\"requester\">\n                                {request.appId}\n                            </td>\n                        </tr>\n                        <tr>\n                            <th>sent</th>\n                            <td className=\"createdAt\">{Intl.DateTimeFormat('en-US', {\n                                month: 'long',\n                                day: 'numeric',\n                                year: 'numeric'\n                            }).format(request.createdAt)}</td>\n                        </tr>\n                        <tr>\n                            <th>expires</th>\n                            <td className=\"expiresAt\">{Intl.DateTimeFormat('en-US', {\n                                month: 'long',\n                                day: 'numeric',\n                                year: 'numeric'\n                            }).format(request.expireAt)} ({this.niceElapsed(request.expireAt)})</td>\n                        </tr>\n                    </tbody>\n                </table>\n            </Card>\n        )\n    }\n\n    renderRequest(request: requestModel.Request) {\n        switch (request.type) {\n            case types.RequestType.REQUEST:\n                switch (request.resourceType) {\n                    case types.RequestResourceType.USER:\n                        return this.renderRequestJoinRequest(request as requestModel.UserRequest)\n                    case types.RequestResourceType.WORKSPACE:\n                        return this.renderRequestNarrativeRequest(request as requestModel.WorkspaceRequest)\n                    case types.RequestResourceType.APP:\n                        return this.renderRequestAppRequest(request as requestModel.AppRequest)\n                    default:\n                        throw new Error('Unsupported resource type: ' + request.resourceType)\n                }\n            case types.RequestType.INVITATION:\n                switch (request.resourceType) {\n                    case types.RequestResourceType.USER:\n                        return this.renderRequestJoinInvitation(request as requestModel.UserInvitation)\n                    case types.RequestResourceType.WORKSPACE:\n                        throw new Error('Workspace invitations are not supported')\n                    // return this.renderRequestNarrativeInvitation(request as types.WorkspaceRequest)\n                    case types.RequestResourceType.APP:\n                        throw new Error('App invitations are not supported')\n                    // return this.renderRequestAppInvitation(request as types.AppRequest)\n                    default:\n                        throw new Error('Unsupported resource type: ' + request.resourceType)\n                }\n        }\n    }\n\n    renderRequests() {\n        const requests = this.props.viewModel.requests\n\n        if (requests.length === 0) {\n            return (\n                <Alert\n                    type=\"info\"\n                    showIcon\n                    style={{ minWidth: '5em', maxWidth: '20em', margin: '0 auto' }}\n                    message=\"No pending requests for this organization\" />\n            )\n        }\n        return requests\n            .map((request) => {\n                return this.renderRequest(request)\n            })\n    }\n\n    renderInvitations() {\n        const invitations = this.props.viewModel.invitations\n        if (invitations.length === 0) {\n            return (\n                <Alert\n                    type=\"info\"\n                    showIcon\n                    style={{ minWidth: '5em', maxWidth: '20em', margin: '0 auto' }}\n                    message=\"No pending invitations for this organization\" />\n            )\n        }\n        return invitations\n            .map((request) => {\n                return this.renderRequest(request)\n            })\n    }\n\n    render() {\n        if (this.state.cancelToBrowser) {\n            return <Redirect push to=\"/organizations\" />\n        }\n\n        if (this.state.cancelToViewer) {\n            return <Redirect push to={\"/viewOrganization/\" + this.props.viewModel.organization.id} />\n        }\n\n        const invitationCount = this.props.viewModel.invitations.length\n\n        const requestCount = this.props.viewModel.requests.length\n\n        return (\n            <div className=\"ManageGroupRequests\">\n                {this.renderHeader()}\n                <OrganizationHeader organizationId={this.props.viewModel.organization.id} />\n                <div className=\"row\">\n                    <div className=\"pendingCol\">\n                        <h2>Requests ({requestCount})</h2>\n                        <div className=\"pendingRequests\">\n                            {this.renderRequests()}\n                        </div>\n                    </div>\n                    <div className=\"historyCol\">\n                        <h2>Invitations ({invitationCount})</h2>\n                        {this.renderInvitations()}\n                    </div>\n                </div>\n            </div>\n        )\n    }\n}\n\nexport default ManageGroupRequests","import { Dispatch, Action } from 'redux'\nimport { connect } from 'react-redux'\n\nimport * as types from '../../../types'\nimport * as actions from '../../../redux/actions/manageOrganizationRequests'\n\nimport Component from './component'\n\nexport interface OwnProps {\n    // organizationId: string\n}\n\ninterface StateProps {\n    viewModel: types.ManageOrganizationRequestsViewModel\n}\n\ninterface DispatchProps {\n    // onStart: (organizationId: string) => void,\n    onAcceptJoinRequest: (requestId: string) => void\n    onDenyJoinRequest: (requestId: string) => void\n    onCancelJoinInvitation: (requestId: string) => void\n    onGetViewAccess: (requestId: string) => void\n}\n\nfunction mapStateToProps(state: types.StoreState, props: OwnProps): StateProps {\n    const {\n        views: {\n            manageOrganizationRequestsView\n        }\n    } = state\n    if (!manageOrganizationRequestsView.viewModel) {\n        throw new Error('view state not loaded!')\n    }\n    return {\n        viewModel: manageOrganizationRequestsView.viewModel\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<Action>): DispatchProps {\n    return {\n        // onStart: (organizationId: string) => {\n        //     dispatch(actions.manageOrganizationRequests(organizationId) as any)\n        // },\n        onAcceptJoinRequest: (requestId: string) => {\n            dispatch(actions.acceptJoinRequest(requestId) as any)\n        },\n        onDenyJoinRequest: (requestId: string) => {\n            dispatch(actions.denyJoinRequest(requestId) as any)\n        },\n        onCancelJoinInvitation: (requestId: string) => {\n            dispatch(actions.cancelJoinInvitation(requestId) as any)\n        },\n        onGetViewAccess: (requestId: string) => {\n            dispatch(actions.getViewAccess(requestId) as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, types.StoreState>(mapStateToProps, mapDispatchToProps)(Component)\n\n","import * as React from 'react'\n\nimport { ComponentLoadingState } from '../../../types'\nimport Container from './container'\n\nexport interface LoaderProps {\n    organizationId: string\n    loadingState: ComponentLoadingState\n    onLoad: (organizationId: string) => void\n    onUnload: () => void\n}\n\ninterface LoaderState {\n\n}\n\nclass Loader extends React.Component<LoaderProps, LoaderState> {\n    constructor(props: LoaderProps) {\n        super(props)\n    }\n\n    renderLoading() {\n        return (\n            <div>\n                Loading...\n            </div>\n        )\n    }\n\n    render() {\n        switch (this.props.loadingState) {\n            case ComponentLoadingState.NONE:\n                this.props.onLoad(this.props.organizationId)\n                return this.renderLoading()\n            case ComponentLoadingState.LOADING:\n                return this.renderLoading()\n            case ComponentLoadingState.SUCCESS:\n                return (\n                    <Container />\n                )\n        }\n    }\n\n    componentWillUnmount() {\n        this.props.onUnload()\n    }\n}\n\nimport { Dispatch, Action } from 'redux'\nimport { connect } from 'react-redux'\n\nimport * as types from '../../../types'\nimport * as actions from '../../../redux/actions/manageOrganizationRequests'\n\n// org id fed from the url\nexport interface OwnProps {\n    organizationId: string\n}\n\n// we unpack the view state?\ninterface StateProps {\n    loadingState: types.ComponentLoadingState\n}\n\n// the loader can just load this view\ninterface DispatchProps {\n    onLoad: (organizationId: string) => void\n    onUnload: () => void\n}\n\nfunction mapStateToProps(state: types.StoreState, props: OwnProps): StateProps {\n    return {\n        loadingState: state.views.manageOrganizationRequestsView.loadingState\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<Action>): DispatchProps {\n    return {\n        onLoad: (organizationId: string) => {\n            dispatch(actions.load(organizationId) as any)\n        },\n        onUnload: () => {\n            dispatch(actions.unload() as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, types.StoreState>(mapStateToProps, mapDispatchToProps)(Loader)","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\n\nimport { ActionFlag } from './index'\n\nimport { AppError, StoreState, MemberType } from '../../types'\nimport * as orgModel from '../../data/models/organization/model'\nimport * as uberModel from '../../data/models/uber'\n\n// LOADING\n\nexport interface Load extends Action {\n    type: ActionFlag.VIEW_MEMBERS_LOAD,\n    organizationId: string\n}\n\nexport interface LoadStart extends Action {\n    type: ActionFlag.VIEW_MEMBERS_LOAD_START\n}\n\nexport interface Unload extends Action {\n    type: ActionFlag.VIEW_MEMBERS_UNLOAD\n}\n\nexport interface LoadSuccess extends Action {\n    type: ActionFlag.VIEW_MEMBERS_LOAD_SUCCESS\n    organization: orgModel.Organization\n    relation: orgModel.Relation\n}\n\nexport interface LoadError extends Action {\n    type: ActionFlag.VIEW_MEMBERS_LOAD_ERROR\n    error: AppError\n}\n\n\nexport function loadStart(): LoadStart {\n    return {\n        type: ActionFlag.VIEW_MEMBERS_LOAD_START\n    }\n}\n\nexport function loadSuccess(organization: orgModel.Organization, relation: orgModel.Relation): LoadSuccess {\n    return {\n        type: ActionFlag.VIEW_MEMBERS_LOAD_SUCCESS,\n        organization: organization,\n        relation: relation\n    }\n}\n\nexport function loadError(error: AppError): LoadError {\n    return {\n        type: ActionFlag.VIEW_MEMBERS_LOAD_ERROR,\n        error: error\n    }\n}\n\nexport function unload(): Unload {\n    return {\n        type: ActionFlag.VIEW_MEMBERS_UNLOAD\n    }\n}\n\nexport function load(organizationId: string) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(loadStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config } } = getState()\n\n\n        const uberClient = new uberModel.UberModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url,\n            serviceWizardURL: config.services.ServiceWizard.url,\n            userProfileServiceURL: config.services.UserProfile.url,\n            workspaceServiceURL: config.services.Workspace.url\n        })\n\n        try {\n            const { organization, relation } = await uberClient.getOrganizationForUser(organizationId)\n            dispatch(loadSuccess(organization, relation))\n\n        } catch (ex) {\n            dispatch(loadError({\n                code: ex.name,\n                message: ex.message\n            }))\n        }\n    }\n}\n\n// Promoting member to admin\n\nexport interface PromoteToAdmin extends Action {\n    type: ActionFlag.VIEW_MEMBERS_PROMOTE_TO_ADMIN,\n    memberUsername: string\n}\n\nexport interface PromoteToAdminStart extends Action {\n    type: ActionFlag.VIEW_MEMBERS_PROMOTE_TO_ADMIN_START\n}\n\nexport interface PromoteToAdminSuccess extends Action {\n    type: ActionFlag.VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS,\n    memberUsername: string\n}\n\nexport interface PromoteToAdminError extends Action {\n    type: ActionFlag.VIEW_MEMBERS_PROMOTE_TO_ADMIN_ERROR,\n    error: AppError\n}\n\n\nexport function promoteToAdminStart(): PromoteToAdminStart {\n    return {\n        type: ActionFlag.VIEW_MEMBERS_PROMOTE_TO_ADMIN_START\n    }\n}\n\nexport function promoteToAdminSuccess(memberUsername: string): PromoteToAdminSuccess {\n    return {\n        type: ActionFlag.VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS,\n        memberUsername\n    }\n}\n\nexport function promoteToAdminError(error: AppError): PromoteToAdminError {\n    return {\n        type: ActionFlag.VIEW_MEMBERS_PROMOTE_TO_ADMIN_ERROR,\n        error: error\n    }\n}\n\nexport function promoteToAdmin(memberUsername: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(promoteToAdminStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config },\n            views: {\n                viewMembersView: { viewModel }\n            }\n        } = getState()\n        if (viewModel === null) {\n            throw new Error('view is not populated')\n        }\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        orgClient.memberToAdmin(viewModel.organization.id, memberUsername)\n            .then((org) => {\n                dispatch(promoteToAdminSuccess(memberUsername))\n\n                // Brute force, update the in-store organization\n                // const { viewMembersView: { view } } = getState()\n\n                // if (!view) {\n                //     dispatch(viewMembersPromoteToAdminError({\n                //         code: 'NoView',\n                //         message: 'No view for viewMembers'\n                //     }))\n                //     return\n                // }\n\n\n                // dispatch(viewMembersLoad(view.organization.id))\n            })\n            .catch((err: Error) => {\n                dispatch(promoteToAdminError({\n                    code: err.name,\n                    message: err.message\n                }))\n            })\n    }\n}\n\n// Demote admin to member\n\nexport interface DemoteToMember extends Action {\n    type: ActionFlag.VIEW_MEMBERS_DEMOTE_TO_MEMBER,\n    memberUsername: string\n}\n\nexport interface DemoteToMemberStart extends Action {\n    type: ActionFlag.VIEW_MEMBERS_DEMOTE_TO_MEMBER_START\n}\n\nexport interface DemoteToMemberSuccess extends Action {\n    type: ActionFlag.VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS,\n    memberUsername: string\n}\n\nexport interface DemoteToMemberError extends Action {\n    type: ActionFlag.VIEW_MEMBERS_DEMOTE_TO_MEMBER_ERROR,\n    error: AppError\n}\n\n\nexport function demoteToMemberStart(): DemoteToMemberStart {\n    return {\n        type: ActionFlag.VIEW_MEMBERS_DEMOTE_TO_MEMBER_START\n    }\n}\n\nexport function demoteToMemberSuccess(memberUsername: string): DemoteToMemberSuccess {\n    return {\n        type: ActionFlag.VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS,\n        memberUsername: memberUsername\n    }\n}\n\nexport function demoteToMemberError(error: AppError): DemoteToMemberError {\n    return {\n        type: ActionFlag.VIEW_MEMBERS_DEMOTE_TO_MEMBER_ERROR,\n        error: error\n    }\n}\n\nexport function demoteToMember(memberUsername: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(demoteToMemberStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config },\n            views: {\n                viewMembersView: { viewModel }\n            }\n        } = getState()\n\n        if (viewModel === null) {\n            throw new Error('view is not populated')\n        }\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        orgClient.adminToMember(viewModel.organization.id, memberUsername)\n            .then((org) => {\n                dispatch(demoteToMemberSuccess(memberUsername))\n                // dispatch(viewMembersLoad(view.organization.id))\n            })\n            .catch((err: Error) => {\n                dispatch(demoteToMemberError({\n                    code: err.name,\n                    message: err.message\n                }))\n            })\n    }\n}\n\n// Remove a member\n\nexport interface RemoveMember extends Action {\n    type: ActionFlag.VIEW_MEMBERS_REMOVE_MEMBER,\n    memberUsername: string\n}\n\ninterface RemoveMemberStart extends Action {\n    type: ActionFlag.VIEW_MEMBERS_REMOVE_MEMBER_START\n}\n\ninterface RemoveMemberSuccess extends Action {\n    type: ActionFlag.VIEW_MEMBERS_REMOVE_MEMBER_SUCCESS\n}\n\ninterface RemoveMemberError extends Action {\n    type: ActionFlag.VIEW_MEMBERS_REMOVE_MEMBER_ERROR,\n    error: AppError\n}\n\nfunction removeMemberStart(): RemoveMemberStart {\n    return {\n        type: ActionFlag.VIEW_MEMBERS_REMOVE_MEMBER_START\n    }\n}\n\nfunction removeMemberSuccess(): RemoveMemberSuccess {\n    return {\n        type: ActionFlag.VIEW_MEMBERS_REMOVE_MEMBER_SUCCESS\n    }\n}\n\nfunction removeMemberError(error: AppError): RemoveMemberError {\n    return {\n        type: ActionFlag.VIEW_MEMBERS_REMOVE_MEMBER_ERROR,\n        error: error\n    }\n}\n\nexport function removeMember(memberUsername: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(removeMemberStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config },\n            views: {\n                viewMembersView: { viewModel }\n            }\n        } = getState()\n        if (viewModel === null) {\n            throw new Error('view is not populated')\n        }\n\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        orgClient.removeMember(viewModel.organization.id, memberUsername)\n            .then(() => {\n                dispatch(removeMemberSuccess())\n                dispatch(load(viewModel.organization.id))\n            })\n            .catch((err: Error) => {\n                dispatch(removeMemberError({\n                    code: err.name,\n                    message: err.message\n                }))\n            })\n    }\n}","import * as React from 'react'\n\nimport './component.css'\n\nimport { Button, Icon, Menu, Dropdown } from 'antd';\nimport MemberComponent from '../../entities/MemberContainer';\nimport * as orgModel from '../../../data/models/organization/model'\n\ninterface MemberRowProps {\n    member: orgModel.Member,\n    organization: orgModel.Organization,\n    relation: orgModel.Relation,\n    onPromoteMemberToAdmin: (memberUsername: string) => void,\n    onDemoteAdminToMember: (adminUsername: string) => void,\n    onRemoveMember: (memberUsername: string) => void\n}\n\ninterface MemberRowState {\n    over: boolean\n}\n\nclass MemberRow extends React.Component<MemberRowProps, MemberRowState> {\n    constructor(props: MemberRowProps) {\n        super(props)\n        this.state = {\n            over: false\n        }\n    }\n\n    renderPromoteButton() {\n        switch (this.props.member.type) {\n            case orgModel.MemberType.MEMBER:\n                return (\n                    <Button\n                        style={{ width: '100%' }}\n                        disabled={!this.state.over}\n                        onClick={() => { this.props.onPromoteMemberToAdmin(this.props.member.username) }}>\n                        <Icon type=\"unlock\" />Promote to Admin\n                    </Button>\n                )\n            case orgModel.MemberType.ADMIN:\n                return (\n                    <Button\n                        style={{ width: '100%' }}\n                        disabled={!this.state.over}\n                        onClick={() => { this.props.onDemoteAdminToMember(this.props.member.username) }}>\n                        <Icon type=\"user\" />Demote to Member\n                </Button>\n                )\n            case orgModel.MemberType.OWNER:\n                return\n        }\n\n    }\n\n    renderMemberButtons(member: orgModel.Member) {\n        if (!(this.props.relation.type === orgModel.UserRelationToOrganization.OWNER ||\n            this.props.relation.type === orgModel.UserRelationToOrganization.ADMIN)) {\n            return\n        }\n        // if (!this.state.over) {\n        //     return\n        // }\n        return (\n            <div>\n                <div>\n                    <Button\n                        type=\"danger\"\n                        disabled={!this.state.over}\n                        style={{ width: '100%' }}\n                        onClick={() => { this.props.onRemoveMember(member.username) }}>\n                        <Icon type=\"delete\" />Remove from Org\n                    </Button>\n                </div>\n                <div>\n                    {this.renderPromoteButton()}\n                </div>\n            </div>\n        )\n    }\n\n    onMemberMenu(key: string, member: orgModel.Member) {\n        switch (key) {\n            case 'promoteToAdmin':\n                this.props.onPromoteMemberToAdmin(member.username)\n                break\n            case 'removeMember':\n                this.props.onRemoveMember(member.username)\n                break\n        }\n    }\n\n    onAdminMenu(key: string, member: orgModel.Member) {\n        switch (key) {\n            case 'demoteToMember':\n                this.props.onDemoteAdminToMember(member.username)\n                break\n        }\n    }\n\n    renderMemberMenu(member: orgModel.Member) {\n        const menu = (\n            <Menu onClick={({ key }) => { this.onMemberMenu.call(this, key, member) }}>\n                <Menu.Item key=\"promoteToAdmin\" >\n                    <Icon type=\"unlock\" />Promote to Admin\n                </Menu.Item>\n                <Menu.Item key=\"removeMember\" >\n                    <Icon type=\"delete\" />Remove Member\n                </Menu.Item>\n            </Menu>\n        )\n        return (\n            <div>\n                <Dropdown overlay={menu} trigger={['click']}>\n                    <Button icon=\"ellipsis\" />\n                </Dropdown>\n            </div>\n        )\n    }\n\n    renderAdminMenu(member: orgModel.Member) {\n        const menu = (\n            <Menu onClick={({ key }) => { this.onAdminMenu.call(this, key, member) }}>\n                <Menu.Item key=\"demoteToMember\">\n                    <Icon type=\"user\" />Demote to Member\n                    </Menu.Item>\n            </Menu>\n        )\n        return (\n            <div>\n                <Dropdown overlay={menu} trigger={['click']}>\n                    <Button icon=\"ellipsis\" />\n                </Dropdown>\n            </div>\n        )\n    }\n\n    renderOwnerMenu(member: orgModel.Member) {\n        return\n    }\n\n    renderMemberOptions(member: orgModel.Member) {\n        if (!(this.props.relation.type === orgModel.UserRelationToOrganization.OWNER ||\n            this.props.relation.type === orgModel.UserRelationToOrganization.ADMIN)) {\n            return\n        }\n\n        switch (this.props.member.type) {\n            case orgModel.MemberType.OWNER:\n                return this.renderOwnerMenu(member)\n            case orgModel.MemberType.ADMIN:\n                return this.renderAdminMenu(member)\n            case orgModel.MemberType.MEMBER:\n                return this.renderMemberMenu(member)\n        }\n    }\n\n    onMouseOver() {\n        this.setState({ over: true })\n    }\n\n    onMouseOut() {\n        this.setState({ over: false })\n    }\n\n    render() {\n        return (\n            <div key={this.props.member.username}\n                className=\"memberRow\"\n                onMouseEnter={this.onMouseOver.bind(this)}\n                onMouseLeave={this.onMouseOut.bind(this)}>\n                <div style={{ flex: '1 1 0px' }}>\n                    <MemberComponent member={this.props.member} avatarSize={50} key={this.props.member.username} />\n                </div>\n                <div style={{ flex: '0 0 10em', textAlign: 'right' }}>\n                    {/* {this.renderMemberButtons(this.props.member)} */}\n                    {this.renderMemberOptions(this.props.member)}\n                </div>\n            </div>\n        )\n    }\n}\n\nexport default MemberRow","import * as React from 'react'\n\nimport './component.css'\n\nimport { Member, MemberType, RequestResourceType } from '../../../types'\nimport Header from '../../Header'\nimport { Redirect } from 'react-router'\nimport { Button, Icon, Modal, Row, Col, Menu, Dropdown, Alert } from 'antd';\nimport MemberComponent from '../../entities/Member';\nimport MemberRowComponent from './MemberRow'\nimport { NavLink } from 'react-router-dom';\nimport OrganizationHeader from '../organizationHeader/loader';\nimport { Request } from '../../request/component'\nimport * as orgModel from '../../../data/models/organization/model'\n\nexport interface ViewMembersProps {\n    organization: orgModel.Organization\n    relation: orgModel.Relation\n    onViewMembersUnload: () => void\n    onPromoteMemberToAdmin: (memberUsername: string) => void\n    onDemoteAdminToMember: (adminUsername: string) => void\n    onRemoveMember: (memberUsername: string) => void\n}\n\ninterface ViewMembersState {\n    cancelToBrowser: boolean\n    cancelToViewer: boolean\n}\n\n\n\nclass ViewMembers extends React.Component<ViewMembersProps, ViewMembersState> {\n    constructor(props: ViewMembersProps) {\n        super(props)\n\n        this.state = {\n            cancelToBrowser: false,\n            cancelToViewer: false\n        }\n    }\n\n    onClickCancelToBrowser() {\n        this.setState({ cancelToBrowser: true })\n    }\n\n    onClickCancelToViewer() {\n        this.setState({ cancelToViewer: true })\n    }\n\n    onPromoteMemberToAdmin(memberUsername: string) {\n        this.props.onPromoteMemberToAdmin(memberUsername)\n    }\n\n    onDemoteAdminToMember(adminUsername: string) {\n        this.props.onDemoteAdminToMember(adminUsername)\n    }\n\n    onShowInfo() {\n        Modal.info({\n            title: 'View Members Help',\n            width: '50em',\n            content: (\n                <div>\n                    <p>This is the view members tool...</p>\n                </div>\n            )\n        })\n    }\n\n    isMember(): boolean {\n        if (!this.props.organization) {\n            return false\n        }\n        if (this.props.relation.type === orgModel.UserRelationToOrganization.OWNER ||\n            this.props.relation.type === orgModel.UserRelationToOrganization.ADMIN ||\n            this.props.relation.type === orgModel.UserRelationToOrganization.MEMBER) {\n            return true\n        }\n        return false\n    }\n\n    isAdmin(): boolean {\n        if (!this.props.organization) {\n            return false\n        }\n        if (this.props.relation.type === orgModel.UserRelationToOrganization.OWNER ||\n            this.props.relation.type === orgModel.UserRelationToOrganization.ADMIN) {\n            return true\n        }\n        return false\n    }\n\n    renderOrgName(name: string) {\n        const maxLength = 25\n        if (name.length < 25) {\n            return name\n        }\n        return (\n            <span>\n                {name.slice(0, 25)}\n                \n            </span>\n        )\n    }\n\n    renderHeader() {\n        const breadcrumbs = (\n            <React.Fragment>\n                <span>\n                    <NavLink to={`/viewOrganization/${this.props.organization.id}`}>\n                        <span style={{ fontWeight: 'bold' }}>\n                            {this.renderOrgName(this.props.organization.name)}\n                        </span>\n                    </NavLink>\n\n                    <Icon type=\"right\" style={{ verticalAlign: 'middle', marginLeft: '4px', marginRight: '4px' }} />\n\n                    <Icon type=\"team\" />\n                    {' '}\n                    <span style={{ fontSize: '120%' }}>Viewing Org Members</span>\n                </span>\n            </React.Fragment>\n        )\n        const buttons = (\n            <React.Fragment>\n                <Button icon=\"undo\"\n                    type=\"danger\"\n                    onClick={this.onClickCancelToViewer.bind(this)}>\n                    Return to this Org\n                </Button>\n                <Button\n                    shape=\"circle\"\n                    icon=\"info\"\n                    onClick={this.onShowInfo.bind(this)}>\n                </Button>\n            </React.Fragment>\n        )\n        return (\n            <Header breadcrumbs={breadcrumbs} buttons={buttons} />\n        )\n    }\n\n    renderMembersToolbar() {\n        switch (this.props.relation.type) {\n            case orgModel.UserRelationToOrganization.NONE:\n                return (\n                    <div className=\"toolbar\">\n                        <Button><Icon type=\"plus\" />Join</Button>\n                    </div>\n                )\n\n            case orgModel.UserRelationToOrganization.MEMBER:\n                return (\n                    <div className=\"toolbar\">\n                    </div>\n                )\n\n            case orgModel.UserRelationToOrganization.ADMIN:\n                return (\n                    <div className=\"toolbar\">\n                        <NavLink to={\"/inviteUser/\" + this.props.organization.id}><Button><Icon type=\"mail\" /> Invite a User</Button></NavLink>\n                    </div>\n                )\n\n            case orgModel.UserRelationToOrganization.OWNER:\n                return (\n                    <div className=\"toolbar\">\n                        <NavLink to={\"/inviteUser/\" + this.props.organization.id}><Button><Icon type=\"mail\" /> Invite a User</Button></NavLink>\n                    </div>\n                )\n\n        }\n    }\n\n    // renderMemberButtons(member: UserBase) {\n    //     if (!(this.props.organization.relation.type === UserRelationToOrganization.OWNER ||\n    //         this.props.organization.relation.type === UserRelationToOrganization.ADMIN)) {\n    //         return\n    //     }\n    //     return (\n    //         <div>\n    //             <div><Button type=\"danger\" style={{ width: '100%' }}><Icon type=\"delete\" />Remove from Org</Button></div>\n    //             <div><Button style={{ width: '100%' }} onClick={() => { this.onPromoteMemberToAdmin.call(this, member.username) }}><Icon type=\"unlock\" />Promote to Admin</Button></div>\n    //         </div>\n    //     )\n    // }\n\n    renderMembers() {\n        let members\n        // if (!this.isMember()) {\n        //     return (\n        //         <p className=\"message\">\n        //             Sorry, group membership restricted to members only\n        //         </p>\n        //     )\n        // }\n        if (this.props.organization.members.length === 0) {\n            members = (\n                <p className=\"message\">\n                    This organization has no members\n                </p>\n            )\n        } else {\n            members = this.props.organization.members.map((member) => (\n                <React.Fragment key={member.username}>\n                    <MemberRowComponent\n                        member={member}\n                        relation={this.props.relation}\n                        organization={this.props.organization}\n                        onPromoteMemberToAdmin={this.props.onPromoteMemberToAdmin}\n                        onDemoteAdminToMember={this.props.onDemoteAdminToMember}\n                        onRemoveMember={this.props.onRemoveMember}\n                    />\n                </React.Fragment>\n            ))\n        }\n        return (\n            <div className=\"table infoTable\">\n                <div className=\"row\">\n                    <div className=\"col0\" style={{ display: 'flex', flexDirection: 'column', overflowY: 'auto' }}>\n                        {members}\n                    </div>\n                </div>\n            </div>\n        )\n    }\n\n    // renderPendingMembers() {\n\n    //     if (!this.isAdmin()) {\n    //         return (\n    //             <Alert type=\"info\" showIcon message=\"Sorry, pending group membership restricted to admin members only\" />\n    //         )\n    //     }\n    //     const pendingRequests = this.props.organization.adminRequests.filter((request) => {\n    //         return (request.resourceType === RequestResourceType.USER)\n    //     })\n    //     if (pendingRequests.length === 0) {\n    //         return (\n    //             <Alert type=\"info\" message=\"No pending member requests or invitations\" />\n    //         )\n    //     }\n    //     return pendingRequests.map((request) => {\n    //         return (\n    //             <div key={request.id}>\n    //                 <Request request={request} />\n    //             </div>\n    //         )\n    //     })\n    // }\n\n    renderAdminsToolbar() {\n        return (\n            <div className=\"toolbar\">\n\n            </div>\n        )\n    }\n    // renderAdminButtons(admin: Member) {\n    //     if (!(this.props.relation.type === orgModel.UserRelationToOrganization.OWNER ||\n    //         this.props.relation.type === orgModel.UserRelationToOrganization.ADMIN)) {\n    //         return\n    //     }\n    //     return (\n    //         <div>\n    //             <div><Button type=\"danger\" style={{ width: '100%' }}><Icon type=\"delete\" />Remove from Org</Button></div>\n    //             <div><Button style={{ width: '100%' }} onClick={() => { this.onDemoteAdminToMember.call(this, admin.user.username) }}><Icon type=\"user\" />Demote to Member</Button></div>\n    //         </div>\n    //     )\n    // }\n    // renderAdmins() {\n    //     const admins = this.props.organization.members.filter((member) => (member.type === MemberType.ADMIN))\n    //     let adminList\n    //     if (admins.length === 0) {\n    //         adminList = (\n    //             <p style={{ fontStyle: 'italic', textAlign: 'center' }}>\n    //                 This organization has no admins\n    //             </p>\n    //         )\n    //     } else {\n    //         adminList = admins.map((member) => {\n    //             return (\n    //                 <div key={member.username} style={{ flex: '0 0 auto', display: 'flex', flexDirection: 'row' }}>\n    //                     <div style={{ flex: '1 1 0px' }}>\n    //                         <MemberComponent member={member} avatarSize={50} key={member.username} />\n    //                     </div>\n    //                     <div style={{ flex: '0 0 10em' }}>\n    //                         {this.renderAdminButtons(member)}\n    //                     </div>\n    //                 </div>\n\n    //             )\n    //         })\n    //     }\n    //     return (\n    //         <div className=\"table infoTable\">\n    //             <div className=\"row\">\n    //                 <div className=\"col0\" style={{ display: 'flex', flexDirection: 'column', overflowY: 'auto' }}>\n    //                     {adminList}\n    //                 </div>\n    //             </div>\n    //         </div>\n    //     )\n    // }\n\n    renderOrganizationHeader() {\n        return (\n            <OrganizationHeader organizationId={this.props.organization.id} />\n        )\n    }\n\n    componentWillUnmount() {\n        this.props.onViewMembersUnload()\n    }\n\n    render() {\n\n        if (this.state.cancelToBrowser) {\n            return <Redirect push to=\"/organizations\" />\n        }\n\n        if (this.state.cancelToViewer) {\n            return <Redirect push to={\"/viewOrganization/\" + this.props.organization.id} />\n        }\n\n        return (\n            <div className=\"ViewMembers\">\n                {this.renderHeader()}\n                {this.renderOrganizationHeader()}\n                <div className=\"body\">\n                    <div className=\"membersCol\">\n                        <h2>Members</h2>\n                        {this.renderMembersToolbar()}\n                        {this.renderMembers()}\n                    </div>\n                    <div className=\"otherCol\">\n                        <h2>Pending Members</h2>\n                        {this.renderAdminsToolbar()}\n\n                        <p>\n                            This space to provide a list of user requests and invitations. This will allow this view\n                            to provide all user management tools in one place.\n                        </p>\n                        <p>\n                            In progress... currently renders the requests but does not provide actions (buttons).\n                        </p>\n                        {/* {this.renderPendingMembers()} */}\n\n                    </div>\n                </div>\n\n            </div>\n        )\n    }\n}\n\nexport default ViewMembers","import { Dispatch, Action } from 'redux'\nimport { connect } from 'react-redux'\n\nimport { StoreState } from '../../../types'\nimport * as actions from '../../../redux/actions/viewMembers'\nimport ViewMembers from './component'\nimport * as orgModel from '../../../data/models/organization/model'\n\nexport interface OwnProps {\n\n}\n\ninterface StateProps {\n    organization: orgModel.Organization\n    relation: orgModel.Relation\n}\n\ninterface DispatchProps {\n    onViewMembersUnload: () => void,\n    onPromoteMemberToAdmin: (memberUsername: string) => void,\n    onDemoteAdminToMember: (adminUsername: string) => void,\n    onRemoveMember: (memberUsername: string) => void\n}\n\nfunction mapStateToProps(state: StoreState, props: OwnProps): StateProps {\n    if (!state.views.viewMembersView || (state.views.viewMembersView.viewModel === null)) {\n        throw new Error('Runtime Error - view members view is not defined!')\n    }\n    const {\n        views: {\n            viewMembersView: {\n                viewModel: { organization, relation }\n            }\n        }\n    } = state\n    return {\n        organization, relation\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<Action>): DispatchProps {\n    return {\n        onViewMembersUnload: () => {\n            dispatch(actions.unload() as any)\n        },\n        onPromoteMemberToAdmin: (memberUsername: string) => {\n            dispatch(actions.promoteToAdmin(memberUsername) as any)\n        },\n        onDemoteAdminToMember: (adminUsername: string) => {\n            dispatch(actions.demoteToMember(adminUsername) as any)\n        },\n        onRemoveMember: (memberUsername: string) => {\n            dispatch(actions.removeMember(memberUsername) as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(ViewMembers)","import * as React from 'react'\n\nimport { ComponentLoadingState, StoreState } from '../../../types'\nimport ViewMembersContainer from './container'\n\nexport interface ViewMemberLoaderProps {\n    organizationId: string,\n    state: ComponentLoadingState,\n    onViewMembersLoad: (organizationId: string) => void\n}\n\ninterface ViewMemberLoaderState {\n\n}\n\nclass ViewMembersLoader extends React.Component<ViewMemberLoaderProps, ViewMemberLoaderState> {\n    constructor(props: ViewMemberLoaderProps) {\n        super(props)\n    }\n\n    renderLoading() {\n        return (\n            <div>\n                Loading...\n            </div>\n        )\n    }\n\n    render() {\n        switch (this.props.state) {\n            case ComponentLoadingState.NONE:\n                this.props.onViewMembersLoad(this.props.organizationId)\n                return this.renderLoading()\n            case ComponentLoadingState.LOADING:\n                return this.renderLoading()\n            case ComponentLoadingState.SUCCESS:\n                return (\n                    <ViewMembersContainer />\n                )\n        }\n    }\n}\n\nimport { Dispatch } from 'redux'\nimport { connect } from 'react-redux'\n\nimport * as actions from '../../../redux/actions/viewMembers'\n// import ViewMembers from './component'\n\nexport interface OwnProps {\n    organizationId: string\n}\n\ninterface StateProps {\n    state: ComponentLoadingState\n}\n\ninterface DispatchProps {\n    onViewMembersLoad: (organizationId: string) => void\n}\n\nfunction mapStateToProps(state: StoreState, props: OwnProps): StateProps {\n    return {\n        state: state.views.viewMembersView.loadingState\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<actions.Load>): DispatchProps {\n    return {\n        onViewMembersLoad: (organizationId: string) => {\n            dispatch(actions.load(organizationId) as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(ViewMembersLoader)","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\n\nimport { ActionFlag } from './index'\n\nimport { AppError, StoreState, User, InviteUserViewModel, ComponentLoadingState, RequestType, RequestResourceType, MemberType, OrganizationUser } from '../../types'\nimport { Model, UserQuery } from '../../data/model'\nimport * as orgModel from '../../data/models/organization/model'\nimport * as userModel from '../../data/models/user'\nimport * as requestModel from '../../data/models/requests'\n\n// View Loading\n\nexport interface Load extends Action {\n    type: ActionFlag.INVITE_USER_LOAD\n}\n\nexport interface LoadStart extends Action {\n    type: ActionFlag.INVITE_USER_LOAD_START\n}\n\nexport interface LoadSuccess extends Action {\n    type: ActionFlag.INVITE_USER_LOAD_SUCCESS,\n    organization: orgModel.Organization,\n    users: Array<OrganizationUser> | null\n}\n\nexport interface LoadError extends Action {\n    type: ActionFlag.INVITE_USER_LOAD_ERROR,\n    error: AppError\n}\n\nexport interface Unload extends Action {\n    type: ActionFlag.INVITE_USER_UNLOAD\n}\n\n\nexport function loadStart(): LoadStart {\n    return {\n        type: ActionFlag.INVITE_USER_LOAD_START\n    }\n}\n\nexport function loadSuccess(organization: orgModel.Organization): LoadSuccess {\n    return {\n        type: ActionFlag.INVITE_USER_LOAD_SUCCESS,\n        organization: organization,\n        users: null\n    }\n}\n\nexport function loadError(error: AppError): LoadError {\n    return {\n        type: ActionFlag.INVITE_USER_LOAD_ERROR,\n        error: error\n    }\n}\n\nexport function unload(): Unload {\n    return {\n        type: ActionFlag.INVITE_USER_UNLOAD\n    }\n}\n\nexport function load(organizationId: string) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(loadStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config }\n        } = getState()\n\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        try {\n            const org = await orgClient.getOrg(organizationId)\n            dispatch(loadSuccess(org))\n        } catch (ex) {\n            dispatch(loadError({\n                code: ex.name,\n                message: ex.message\n            }))\n        }\n    }\n}\n\n// User Selection\n\n\n\nexport interface InviteUserSearchUsers extends Action {\n    type: ActionFlag.INVITE_USER_SEARCH_USERS,\n    query: UserQuery\n}\n\ninterface SearchUsersStart extends Action {\n    type: ActionFlag.INVITE_USER_SEARCH_USERS_START\n}\n\nexport interface SearchUsersSuccess extends Action {\n    type: ActionFlag.INVITE_USER_SEARCH_USERS_SUCCESS,\n    users: Array<OrganizationUser> | null\n}\n\ninterface SearchUsersError extends Action {\n    type: ActionFlag.INVITE_USER_SEARCH_USERS_ERROR,\n    error: AppError\n}\n\nfunction searchUsersStart(): SearchUsersStart {\n    return {\n        type: ActionFlag.INVITE_USER_SEARCH_USERS_START\n    }\n}\n\nfunction searchUsersSuccess(users: Array<OrganizationUser> | null): SearchUsersSuccess {\n    return {\n        type: ActionFlag.INVITE_USER_SEARCH_USERS_SUCCESS,\n        users: users\n    }\n}\n\nfunction searchUsersError(error: AppError): SearchUsersError {\n    return {\n        type: ActionFlag.INVITE_USER_SEARCH_USERS_ERROR,\n        error: error\n    }\n}\n\nexport function inviteUserSearchUsers(query: UserQuery) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(searchUsersStart())\n\n        if (query.query.length === 0) {\n            dispatch(searchUsersSuccess(null))\n            return\n        }\n\n        const {\n            views: {\n                inviteUserView: { viewModel }\n            },\n            auth: { authorization: { token, username } },\n            app: { config } } = getState()\n\n        // TODO: better form of type narrowing? \n        if (viewModel === null) {\n            return\n        }\n        const org = viewModel.organization\n\n        const userClient = new userModel.UserModel({\n            token,\n            userProfileServiceURL: config.services.UserProfile.url\n        })\n\n        let excludedUsers: Array<string> = []\n\n        // excludedUsers.push(org.owner.user.username)\n\n        let owner: string = org.owner.username\n        let adminUsers: Array<string> = []\n        let members: Array<string> = []\n        let invited: Array<string> = []\n        let requested: Array<string> = []\n\n        org.members.forEach((member) => {\n            switch (member.type) {\n                case MemberType.MEMBER:\n                    members.push(member.username)\n                case MemberType.ADMIN:\n                    adminUsers.push(member.username)\n            }\n        })\n\n        // excludedUsers = excludedUsers.concat(org.members.map((member) => {\n        //     return member.\n        // }))\n\n        // TODO revive\n        // org.adminRequests.forEach((request) => {\n        //     if (request.resourceType === RequestResourceType.USER) {\n        //         switch (request.type) {\n        //             case RequestType.INVITATION:\n        //                 invited.push((<UserInvitation>request).user.username)\n        //                 // excludedUsers.push((<UserInvitation>request).user.username)\n        //                 break\n        //             case RequestType.REQUEST:\n        //                 requested.push((<UserRequest>request).requester.username)\n        //             // excludedUsers.push((<UserRequest>request).requester.username)\n        //         }\n        //     }\n        // })\n\n        try {\n            const users = await userClient.searchUsers(query)\n\n\n            // const filteredUsers = users.filter((user) => {\n            //     return (excludedUsers.indexOf(user.username) === -1)\n            // })\n            const orgUsers: Array<OrganizationUser> = users.map(({ username, realname }) => {\n                let relation: orgModel.UserRelationToOrganization\n                if (username === owner) {\n                    relation = orgModel.UserRelationToOrganization.OWNER\n                } else if (adminUsers.indexOf(username) >= 0) {\n                    relation = orgModel.UserRelationToOrganization.ADMIN\n                } else if (invited.indexOf(username) >= 0) {\n                    relation = orgModel.UserRelationToOrganization.MEMBER_INVITATION_PENDING\n                } else if (requested.indexOf(username) >= 0) {\n                    relation = orgModel.UserRelationToOrganization.MEMBER_REQUEST_PENDING\n                } else if (members.indexOf(username) >= 0) {\n                    relation = orgModel.UserRelationToOrganization.MEMBER\n                } else {\n                    relation = orgModel.UserRelationToOrganization.NONE\n                }\n                return {\n                    username, realname,\n                    relation: relation\n                }\n            })\n            dispatch(searchUsersSuccess(orgUsers))\n        } catch (ex) {\n            dispatch(searchUsersError({\n                code: ex.name,\n                message: ex.message\n            }))\n        }\n\n    }\n}\n\n// Select a user\n\nexport interface SelectUser extends Action {\n    type: ActionFlag.INVITE_USER_SELECT_USER,\n    username: string\n}\n\nexport interface SelectUserStart extends Action {\n    type: ActionFlag.INVITE_USER_SELECT_USER_START\n}\n\nexport interface SelectUserSuccess extends Action {\n    type: ActionFlag.INVITE_USER_SELECT_USER_SUCCESS,\n    user: User,\n    relation: orgModel.UserRelationToOrganization\n}\n\nexport interface SelectUserError extends Action {\n    type: ActionFlag.INVITE_USER_SELECT_USER_ERROR,\n    error: AppError\n}\n\n\nfunction selectUserStart(): SelectUserStart {\n    return {\n        type: ActionFlag.INVITE_USER_SELECT_USER_START\n    }\n}\n\nfunction selectUserSuccess(user: User, relation: orgModel.UserRelationToOrganization): SelectUserSuccess {\n    return {\n        type: ActionFlag.INVITE_USER_SELECT_USER_SUCCESS,\n        user: user,\n        relation: relation\n    }\n}\n\nfunction selectUserError(error: AppError): SelectUserError {\n    return {\n        type: ActionFlag.INVITE_USER_SELECT_USER_ERROR,\n        error: error\n    }\n}\n\nfunction isUserRequest(request: requestModel.Request, username: string): request is requestModel.UserRequest {\n    const req: requestModel.UserRequest = <requestModel.UserRequest>request\n    if (req.resourceType === RequestResourceType.USER &&\n        req.type === RequestType.REQUEST &&\n        req.requester === username) {\n        return true\n    }\n    return false\n}\n\nfunction isUserInvitation(request: requestModel.Request, username: string): request is requestModel.UserRequest {\n    const req: requestModel.UserInvitation = <requestModel.UserInvitation>request\n    if (req.resourceType === RequestResourceType.USER &&\n        req.type === RequestType.INVITATION &&\n        req.user &&\n        req.user === username) {\n        return true\n    }\n    return false\n}\n\nfunction getUserRelation(user: User, organization: orgModel.Organization): orgModel.UserRelationToOrganization {\n    if (user.username === organization.owner.username) {\n        return orgModel.UserRelationToOrganization.OWNER\n    }\n    const member = organization.members.find((member) => {\n        return member.username === user.username\n    })\n    if (member) {\n        switch (member.type) {\n            case MemberType.ADMIN:\n                return orgModel.UserRelationToOrganization.ADMIN\n            case MemberType.OWNER:\n                return orgModel.UserRelationToOrganization.OWNER\n            case MemberType.MEMBER:\n                return orgModel.UserRelationToOrganization.MEMBER\n        }\n    }\n\n    // TODO revive\n    // for (const request of organization.adminRequests) {\n    //     if (isUserInvitation(request, user.username)) {\n    //         return UserRelationToOrganization.MEMBER_INVITATION_PENDING\n    //     } else if (isUserRequest(request, user.username)) {\n    //         return UserRelationToOrganization.MEMBER_REQUEST_PENDING\n    //     }\n    // }\n\n    return orgModel.UserRelationToOrganization.VIEW\n}\n\nexport function selectUser(selectedUsername: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(selectUserStart())\n\n        const {\n            views: {\n                inviteUserView: { viewModel }\n            },\n            auth: { authorization: { token, username } },\n            app: { config } } = getState()\n\n        if (!viewModel) {\n            dispatch(selectUserError({\n                code: 'invalid state',\n                message: 'select user invalid state -- no view value'\n            }))\n            return\n        }\n\n        const userClient = new userModel.UserModel({\n            token,\n            userProfileServiceURL: config.services.UserProfile.url\n        })\n\n        userClient.getUser(selectedUsername)\n            .then((user) => {\n                // TODO: use the new model getUserRelation, or even getUserWithRelation\n                const relation = getUserRelation(user, viewModel.organization)\n                dispatch(selectUserSuccess(user, relation))\n            })\n            .catch((err) => {\n                dispatch(selectUserError({\n                    code: err.name,\n                    message: err.message\n                }))\n            })\n    }\n}\n\n// Now send the invitation, whew!\n\nexport interface SendInvitation extends Action {\n    type: ActionFlag.INVITE_USER_SEND_INVITATION\n}\n\nexport interface SendInvitationStart extends Action {\n    type: ActionFlag.INVITE_USER_SEND_INVITATION_START\n}\n\nexport interface SendInvitationSuccess extends Action {\n    type: ActionFlag.INVITE_USER_SEND_INVITATION_SUCCESS\n}\n\nexport interface SendInvitationError extends Action {\n    type: ActionFlag.INVITE_USER_SEND_INVITATION_ERROR,\n    error: AppError\n}\n\n\nexport function sendInvitationStart(): SendInvitationStart {\n    return {\n        type: ActionFlag.INVITE_USER_SEND_INVITATION_START\n    }\n}\n\nexport function sendInvitationSuccess(): SendInvitationSuccess {\n    return {\n        type: ActionFlag.INVITE_USER_SEND_INVITATION_SUCCESS\n    }\n}\n\nexport function sendInvitationError(error: AppError): SendInvitationError {\n    return {\n        type: ActionFlag.INVITE_USER_SEND_INVITATION_ERROR,\n        error: error\n    }\n}\n\nexport function sendInvitation() {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(sendInvitationStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config },\n            views: {\n                inviteUserView: { loadingState, viewModel, error }\n            }\n        } = getState()\n\n        if (loadingState !== ComponentLoadingState.SUCCESS) {\n            return\n        }\n\n        if (viewModel === null) {\n            return\n        }\n\n        const { selectedUser, organization: { id } } = viewModel as InviteUserViewModel\n\n        if (!selectedUser) {\n            return\n        }\n\n        const requestClient = new requestModel.RequestsModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        requestClient.inviteUserToJoinOrg(id, selectedUser.user.username)\n            .then((request) => {\n                dispatch(sendInvitationSuccess())\n            })\n            .catch((err) => {\n                dispatch(sendInvitationError({\n                    code: err.name,\n                    message: err.message\n                }))\n            })\n    }\n}","import * as React from 'react'\nimport './User.css'\n\nimport Avatar from './entities/Avatar'\nimport * as types from '../types';\n\nexport interface UserProps {\n    user: types.User\n    avatarSize?: number\n}\n\ninterface UserState {\n\n}\n\nclass User extends React.Component<UserProps, UserState> {\n    constructor(props: UserProps) {\n        super(props)\n    }\n\n    render() {\n        return (\n            <div className=\"User\">\n                <div className=\"avatarCol\">\n                    <Avatar user={this.props.user} size={this.props.avatarSize || 30} />\n                </div>\n                <div className=\"infoCol\">\n                    <div className=\"name\">\n                        <a href={\"#people/\" + this.props.user.username} target=\"_blank\">{this.props.user.realname}</a>\n                        {' '}\n                        {this.props.user.username}\n                                </div>\n                    <div className=\"organization\">\n                        {this.props.user.organization || <i>no organization in user profile</i>}\n                    </div>\n                    <div className=\"location\">\n                        {[this.props.user.city, this.props.user.state, this.props.user.country].filter(x => x).join(', ') || <i>no location information in user profile</i>}\n                    </div>\n                </div>\n            </div>\n        )\n    }\n}\n\nexport default User","import * as React from 'react'\n\nimport './component.css'\nimport { User, InviteUserViewState, OrganizationUser } from '../../../types';\nimport { Button, Icon, Modal, Alert } from 'antd';\nimport Header from '../../Header';\nimport { Redirect, NavLink } from 'react-router-dom';\nimport OrganizationHeader from '../organizationHeader/loader';\nimport UserComponent from '../../User'\nimport * as orgModel from '../../../data/models/organization/model'\nimport * as userModel from '../../../data/models/user'\n\nexport interface InviteUserProps {\n    organization: orgModel.Organization,\n    selectedUser: {\n        user: User,\n        relation: orgModel.UserRelationToOrganization\n    } | null\n    editState: InviteUserViewState,\n    users: Array<OrganizationUser> | null\n    onSearchUsers: (query: userModel.UserQuery) => void,\n    onSelectUser: (username: string) => void,\n    onSendInvitation: () => void\n}\n\ninterface InviteUserState {\n    cancelToViewMembers: boolean\n    cancelToBrowser: boolean\n    cancelToViewer: boolean\n    autocompleteMessage: string\n}\n\nclass InviteUser extends React.Component<InviteUserProps, InviteUserState> {\n\n    lastSearchAt: Date | null\n\n    static searchDebounce: number = 200\n\n    searchInput: React.RefObject<HTMLInputElement>\n    searchButton: React.RefObject<Button>\n\n    constructor(props: InviteUserProps) {\n        super(props)\n\n        this.lastSearchAt = null\n        this.searchInput = React.createRef()\n        this.searchButton = React.createRef()\n\n        this.state = {\n            cancelToViewMembers: false,\n            cancelToBrowser: false,\n            cancelToViewer: false,\n            autocompleteMessage: ''\n        }\n    }\n\n    onClickCancelToViewMembers() {\n        this.setState({ cancelToViewMembers: true })\n    }\n\n    onClickCancelToBrowser() {\n        this.setState({ cancelToBrowser: true })\n    }\n\n    onClickCancelToViewer() {\n        this.setState({ cancelToViewer: true })\n    }\n\n    onSendInvitation() {\n        this.props.onSendInvitation()\n    }\n\n    canSave() {\n        if (this.props.selectedUser) {\n            return true\n        }\n        return false\n    }\n\n    onSubmit(e: React.FormEvent<HTMLFormElement>) {\n        e.preventDefault()\n        let currentSearchInputValue;\n        if (this.searchInput.current) {\n            currentSearchInputValue = this.searchInput.current.value\n        } else {\n            currentSearchInputValue = ''\n        }\n        this.doSearchUsers(currentSearchInputValue)\n    }\n\n    onSearchInputChange() {\n        let currentSearchInputValue;\n        if (this.searchInput.current) {\n            currentSearchInputValue = this.searchInput.current.value\n        } else {\n            currentSearchInputValue = ''\n        }\n        // this.doSearchUsers(currentSearchInputValue)\n    }\n\n    doSearchUsers(value: string) {\n        // if (value.length < 3) {\n        //     this.setState({ autocompleteMessage: 'Search begins after 3 or more characters' })\n        //     return\n        // }\n        // this.setState({ autocompleteMessage: '' })\n        // build up list of users already owning, members of, or with membership pending.\n        const excludedUsers: Array<string> = []\n\n        if (this.lastSearchAt === null ||\n            (new Date().getTime() - this.lastSearchAt.getTime() > InviteUser.searchDebounce)) {\n            this.lastSearchAt = new Date()\n            this.props.onSearchUsers({\n                query: value,\n                excludedUsers: []\n            })\n        }\n    }\n\n    onSelectUser(user: OrganizationUser) {\n        this.props.onSelectUser(user.username);\n    }\n\n    onShowInfo() {\n        Modal.info({\n            title: 'Invite User Help',\n            width: '50em',\n            content: (\n                <div>\n                    <p>This is the invite user tool...</p>\n                </div>\n            )\n        })\n    }\n\n    // foundUsers() {\n    //     const users = this.props.users.map(({ username, realname }) => {\n    //         return {\n    //             value: username,\n    //             text: realname + ' (' + username + ')'\n    //         }\n    //     })\n    //     return users\n    // }\n\n    renderOrgName(name: string) {\n        const maxLength = 25\n        if (name.length < 25) {\n            return name\n        }\n        return (\n            <span>\n                {name.slice(0, 25)}\n                \n            </span>\n        )\n    }\n\n    renderHeader() {\n        let orgName: string\n        // if (this.props.manageGroupRequestsView && this.props.manageGroupRequestsView.view) {\n        //     orgName = this.props.manageGroupRequestsView.view.organization.name\n        // } else {\n        //     orgName = 'loading...'\n        // }\n        const breadcrumbs = (\n            <React.Fragment>\n                <span>\n                    <NavLink to={`/viewOrganization/${this.props.organization.id}`}>\n                        <span style={{ fontWeight: 'bold' }}>\n                            {this.renderOrgName(this.props.organization.name)}\n                        </span>\n                    </NavLink>\n\n                    <Icon type=\"right\" style={{ verticalAlign: 'middle', marginLeft: '4px', marginRight: '4px' }} />\n\n                    <Icon type=\"tool\" />\n                    {' '}\n                    <span style={{ fontSize: '120%' }}>Invite a User to Join Org</span>\n                </span>\n            </React.Fragment>\n        )\n        const buttons = (\n            <React.Fragment>\n                <Button icon=\"undo\"\n                    type=\"danger\"\n                    onClick={this.onClickCancelToViewMembers.bind(this)}>\n                    Return to Org Members\n            </Button>\n                <Button icon=\"undo\"\n                    type=\"danger\"\n                    onClick={this.onClickCancelToViewer.bind(this)}>\n                    Return to this Org\n            </Button>\n\n\n                <Button\n                    shape=\"circle\"\n                    icon=\"info\"\n                    onClick={this.onShowInfo.bind(this)}>\n                </Button>\n            </React.Fragment>\n\n        )\n        return (\n            <Header breadcrumbs={breadcrumbs} buttons={buttons} />\n        )\n    }\n\n    renderUsers() {\n        if (!this.props.users) {\n            const message = 'Search for users by name or username to display a list of available users in this space.'\n            return (\n                <Alert type=\"info\" message={message} showIcon />\n            )\n        }\n        if (this.props.users.length === 0) {\n            return (\n                <Alert type=\"warning\" message=\"No users found\" showIcon />\n            )\n        }\n        return this.props.users.map((user) => {\n            if (user.relation === orgModel.UserRelationToOrganization.NONE) {\n                return (\n                    <div\n                        className=\"user notInOrganization \"\n                        key={user.username}\n                        onClick={() => { this.onSelectUser.call(this, user) }}>\n                        <div className=\"name \"\n                        >\n                            {user.realname} ({user.username})\n                        </div>\n                    </div>\n                )\n            } else {\n                return (\n                    <div\n                        className=\"user inOrganization\"\n                        key={user.username}\n                        onClick={() => { this.onSelectUser.call(this, user) }}>\n                        <div className=\"name \"\n                        >\n                            {user.realname} ({user.username})\n                        </div>\n                    </div>\n                )\n            }\n        })\n    }\n\n    renderOrgInfo() {\n        return (\n            <div className=\"orgInfo\">\n                <div className=\"name\">\n                    <span className=\"field-label\">name</span>\n                    <span>{this.props.organization.name}</span>\n                </div>\n                <div className=\"description\">\n                    <span className=\"field-label\">description</span>\n                    <span>{this.props.organization.description}</span>\n                </div>\n            </div>\n        )\n    }\n\n\n\n    renderInvitationForm() {\n        let button\n        let message\n        if (this.props.selectedUser) {\n            if (this.props.selectedUser.relation === orgModel.UserRelationToOrganization.VIEW) {\n                button = (\n                    <Button\n                        type=\"primary\"\n                        onClick={this.onSendInvitation.bind(this)}>Send Invitation</Button>\n                )\n            } else {\n                button = (\n                    <Button\n                        disabled\n                        type=\"primary\"\n                    >Send Invitation</Button>\n                )\n                // message = 'User is a member of this organization'\n                message = (\n                    <div>\n                        User may not be invited because:<br />\n                        {this.renderRelation(this.props.selectedUser.relation)}\n                    </div>\n                )\n                message = (\n                    <Alert\n                        type=\"warning\"\n                        message={message}\n                        showIcon\n                    />\n                )\n            }\n        } else {\n            button = (\n                <Button\n                    disabled\n                    type=\"primary\"\n                >Send Invitation</Button>\n            )\n            message = 'Please select a user'\n        }\n        return (\n            <div className=\"invitationForm\">\n                <div style={{ textAlign: 'center', marginTop: '10px' }}>\n                    {button}\n                </div>\n                <div style={{ textAlign: 'center', marginTop: '10px' }}>\n                    {message}\n                </div>\n            </div>\n        )\n    }\n\n    renderInvitationStatus() {\n        switch (this.props.editState) {\n            case InviteUserViewState.NONE:\n                return (\n                    <div>NONE</div>\n                )\n            case InviteUserViewState.EDITING:\n                return (\n                    <div>EDITING</div>\n                )\n            case InviteUserViewState.SENDABLE:\n                return (\n                    <div>SENDABLE</div>\n                )\n            case InviteUserViewState.SENDING:\n                return (\n                    <div>SENDING</div>\n                )\n            case InviteUserViewState.SUCCESS:\n                return (\n                    <div>SENT SUCCESSFULLY</div>\n                )\n            case InviteUserViewState.ERROR:\n                return (\n                    <div>ERROR SENDING</div>\n                )\n            default:\n                return (\n                    <div>Bad State</div>\n                )\n        }\n\n    }\n\n    renderOrgHeader() {\n        // apparently TS is not smart enough to know this from the conditional branch in render()!\n        if (!this.props.organization) {\n            return\n        }\n        return (\n            <OrganizationHeader organizationId={this.props.organization.id} />\n        )\n    }\n\n    renderRelation(relation: orgModel.UserRelationToOrganization) {\n        switch (relation) {\n            case (orgModel.UserRelationToOrganization.NONE):\n                return (\n                    <span><Icon type=\"stop\" />None</span>\n                )\n            case (orgModel.UserRelationToOrganization.VIEW):\n                return (\n                    <span><Icon type=\"stop\" /> Not a member</span>\n                )\n            case (orgModel.UserRelationToOrganization.MEMBER_REQUEST_PENDING):\n                return (<span><Icon type=\"user\" style={{ color: 'orange' }} /> User's membership <b>request</b> is pending</span>)\n            case (orgModel.UserRelationToOrganization.MEMBER_INVITATION_PENDING):\n                return (<span><Icon type=\"user\" style={{ color: 'blue' }} /> User has been <b>invited</b> to join</span>)\n            case (orgModel.UserRelationToOrganization.MEMBER):\n                return (<span><Icon type=\"user\" /> User is a <b>member</b> of this organization</span>)\n            case (orgModel.UserRelationToOrganization.ADMIN):\n                return (<span><Icon type=\"unlock\" />User is an <b>admin</b> of this organization</span>)\n            case (orgModel.UserRelationToOrganization.OWNER):\n                return (\n\n                    <span><Icon type=\"crown\" /> User is the <b>owner</b> of this Organization</span>\n                )\n        }\n    }\n\n    // renderRelationText(relation: UserRelationToOrganization) {\n    //     switch (relation) {\n    //         case (UserRelationToOrganization.NONE):\n    //             return (\n    //                 <span><Icon type=\"stop\" />None</span>\n    //             )\n    //         case (UserRelationToOrganization.VIEW):\n    //             return (\n    //                 <span><Icon type=\"stop\" /> Not a member</span>\n    //             )\n    //         case (UserRelationToOrganization.MEMBER_REQUEST_PENDING):\n    //             return (<span><Icon type=\"user\" style={{ color: 'orange' }} /> User's membership <b>request</b> is pending</span>)\n    //         case (UserRelationToOrganization.MEMBER_INVITATION_PENDING):\n    //             return (<span><Icon type=\"user\" style={{ color: 'blue' }} /> User has been <b>invited</b> to join</span>)\n    //         case (UserRelationToOrganization.MEMBER):\n    //             return (<span><Icon type=\"user\" /> User is a <b>member</b> of this organization</span>)\n    //         case (UserRelationToOrganization.ADMIN):\n    //             return (<span><Icon type=\"unlock\" />User is an <b>admin</b> of this organization</span>)\n    //         case (UserRelationToOrganization.OWNER):\n    //             return (\n    //                 <span><Icon type=\"crown\" /> User is the <b>owner</b> of this Organization</span>\n    //             )\n    //     }\n    // }\n\n    renderSelectedUser() {\n\n        if (this.props.selectedUser === null) {\n            return (\n                <div className=\"selectedUser\">\n                    <p className=\"noSelection\">\n                        No user yet selected\n                    </p>\n                </div>\n            )\n        } else {\n            return (\n                <div className=\"selectedUser\">\n                    <UserComponent user={this.props.selectedUser.user} />\n                    {this.renderRelation(this.props.selectedUser.relation)}\n                </div>\n            )\n        }\n    }\n\n    renderFooter() {\n        return (\n            <div className=\"footer\">\n            </div>\n        )\n    }\n\n    renderSearchButton() {\n        return (<Icon type=\"search\" />)\n    }\n\n    render() {\n\n        if (this.state.cancelToViewMembers) {\n            return <Redirect push to={\"/viewMembers/\" + this.props.organization.id} />\n        }\n\n        if (this.state.cancelToBrowser) {\n            return <Redirect push to=\"/organizations\" />\n        }\n\n        if (this.state.cancelToViewer) {\n            return <Redirect push to={\"/viewOrganization/\" + this.props.organization.id} />\n        }\n\n        return (\n            <div className=\"InviteUser scrollable-flex-column\">\n                {this.renderHeader()}\n                {this.renderOrgHeader()}\n                <div className=\"row scrollable-flex-column\">\n                    <div className=\"col1 firstCol users scrollable-flex-column\">\n                        <h3>Select User to Invite</h3>\n                        <form id=\"searchForm\" className=\"searchBar\"\n                            onSubmit={this.onSubmit.bind(this)}>\n                            <input\n                                ref={this.searchInput}\n                                autoFocus\n                                onChange={this.onSearchInputChange.bind(this)}\n                                placeholder=\"Search for a user\"\n                            />\n                            <Button\n                                className=\"searchButton\"\n                                form=\"searchForm\"\n                                key=\"submit\"\n                                htmlType=\"submit\"\n                            >\n                                {this.renderSearchButton()}\n                            </Button>\n                        </form>\n                        <div className=\"usersTable\">\n                            {this.renderUsers()}\n                        </div>\n                        {/* <SelectUserComponent\n                            users={this.props.users}\n                            selectedUser={this.props.selectedUser}\n                            onSearchUsers={this.onSearchUsers.bind(this)}\n                            onSelectUser={this.onSelectUser.bind(this)}\n                        />\n                        {this.renderInvitationForm()}\n                        {this.renderInvitationStatus()} */}\n                    </div>\n                    <div className=\"col1 lastCol\">\n                        <h3>Selected User</h3>\n                        {this.renderSelectedUser()}\n                        {this.renderInvitationForm()}\n                    </div>\n                </div>\n                {/* <div className=\"row\">\n                    <div className=\"col1\">\n                        <h3>Send Invitation</h3>\n                        {this.renderInvitationForm()}\n                    </div>\n                </div>\n                <div className=\"row\">\n                    <div className=\"col1\">\n                        <h3>Status</h3>\n                        {this.renderInvitationStatus()}\n                    </div>\n                </div> */}\n                {/* {this.renderUsers()} */}\n                {this.renderFooter()}\n            </div>\n        )\n\n        // return (\n        //     <div className=\"InviteUser\">\n        //         {this.renderHeader()}\n        //         {this.renderOrgHeader()}\n        //         <div className=\"row\">\n        //             <div className=\"col1\">\n        //                 <h3>Select User to Invite</h3>\n        //                 <SelectUserComponent\n        //                     users={this.props.users}\n        //                     selectedUser={this.props.selectedUser}\n        //                     onSearchUsers={this.onSearchUsers.bind(this)}\n        //                     onSelectUser={this.onSelectUser.bind(this)}\n        //                 />\n        //                 {this.renderInvitationForm()}\n        //                 {this.renderInvitationStatus()}\n        //             </div>\n        //         </div>\n        //         {/* <div className=\"row\">\n        //             <div className=\"col1\">\n        //                 <h3>Send Invitation</h3>\n        //                 {this.renderInvitationForm()}\n        //             </div>\n        //         </div>\n        //         <div className=\"row\">\n        //             <div className=\"col1\">\n        //                 <h3>Status</h3>\n        //                 {this.renderInvitationStatus()}\n        //             </div>\n        //         </div> */}\n        //         {/* {this.renderUsers()} */}\n        //     </div>\n        // )\n    }\n}\n\nexport default InviteUser","import { Dispatch } from 'redux'\nimport { connect } from 'react-redux'\n\nimport * as types from '../../../types'\nimport * as actions from '../../../redux/actions/inviteUser'\nimport InviteUser from './component'\nimport * as orgModel from '../../../data/models/organization/model'\nimport * as userModel from '../../../data/models/user'\n\nexport interface OwnProps {\n\n}\n\ninterface StateProps {\n    organization: orgModel.Organization\n    users: Array<types.OrganizationUser> | null\n    selectedUser: {\n        user: types.User,\n        relation: orgModel.UserRelationToOrganization\n    } | null\n    editState: types.InviteUserViewState\n}\n\ninterface DispatchProps {\n    onSearchUsers: (query: userModel.UserQuery) => void\n    onSelectUser: (username: string) => void\n    onSendInvitation: () => void\n}\n\nfunction mapStateToProps(state: types.StoreState, props: OwnProps): StateProps {\n    if (!state.views.inviteUserView || (state.views.inviteUserView.viewModel === null)) {\n        throw new Error('Runtime Error - invite members view is not defined!')\n    }\n\n\n    const {\n        views: {\n            inviteUserView: {\n                viewModel: { organization, users, selectedUser, editState }\n            }\n        }\n    } = state\n\n    return { organization, users, selectedUser, editState }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<actions.Load>): DispatchProps {\n    return {\n        onSearchUsers: ({ query, excludedUsers }) => {\n            dispatch(actions.inviteUserSearchUsers({ query, excludedUsers }) as any)\n        },\n        onSelectUser: (username: string) => {\n            dispatch(actions.selectUser(username) as any)\n        },\n        onSendInvitation: () => {\n            dispatch(actions.sendInvitation() as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, types.StoreState>(mapStateToProps, mapDispatchToProps)(InviteUser)","import * as React from 'react'\n\nimport Container from './container'\nimport { ComponentLoadingState, StoreState } from '../../../types';\n\nexport interface InviteUserLoaderProps {\n    loadingState: ComponentLoadingState\n    organizationId: string\n    onInviteUserLoad: (organizationId: string) => void\n    onUnload: () => void\n}\n\ninterface InviteUserLoaderState {\n}\n\nclass InviteUserLoader extends React.Component<InviteUserLoaderProps, InviteUserLoaderState> {\n    constructor(props: InviteUserLoaderProps) {\n        super(props)\n    }\n\n    renderLoading() {\n        return (\n            <div>\n                Loading Users...\n            </div>\n        )\n    }\n\n    renderError() {\n        return (\n            <div>\n                Error!\n            </div>\n        )\n    }\n\n    render() {\n        switch (this.props.loadingState) {\n            case ComponentLoadingState.NONE:\n                this.props.onInviteUserLoad(this.props.organizationId)\n                return this.renderLoading()\n            case ComponentLoadingState.LOADING:\n                return this.renderLoading()\n            case ComponentLoadingState.ERROR:\n                return this.renderError()\n            case ComponentLoadingState.SUCCESS:\n                return (\n                    <Container />\n                )\n        }\n    }\n\n    componentWillUnmount() {\n        this.props.onUnload()\n    }\n}\n\nimport { Dispatch } from 'redux'\nimport { connect } from 'react-redux'\nimport * as actions from '../../../redux/actions/inviteUser'\n\nexport interface OwnProps {\n    organizationId: string\n}\n\ninterface StateProps {\n    loadingState: ComponentLoadingState\n}\n\ninterface DispatchProps {\n    onInviteUserLoad: (organizationId: string) => void\n    onUnload: () => void\n}\n\nfunction mapStateToProps(state: StoreState, props: OwnProps): StateProps {\n    return {\n        loadingState: state.views.inviteUserView.loadingState\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<actions.Load>): DispatchProps {\n    return {\n        onInviteUserLoad: (organizationId: string) => {\n            dispatch(actions.load(organizationId) as any)\n        },\n        onUnload: () => {\n            dispatch(actions.unload() as any)\n        }\n    }\n}\n\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(InviteUserLoader)","import * as React from 'react'\nimport Header from '../../Header';\nimport { Icon, Button, Modal, Input } from 'antd';\nimport { Redirect, NavLink } from 'react-router-dom';\nimport './component.css'\nimport OrganizationHeader from '../organizationHeader/loader';\nimport * as orgModel from '../../../data/models/organization/model'\nimport * as userModel from '../../../data/models/user'\n\nexport interface ManageMembershipProps {\n    username: userModel.Username\n    organization: orgModel.Organization\n}\n\ninterface MangeMembershipState {\n    cancelToBrowser: boolean\n    cancelToViewer: boolean\n}\n\nclass ManageMembership extends React.Component<ManageMembershipProps, MangeMembershipState> {\n    constructor(props: ManageMembershipProps) {\n        super(props)\n\n        this.state = {\n            cancelToBrowser: false,\n            cancelToViewer: false\n        }\n    }\n\n    doCancelToViewer() {\n        this.setState({ cancelToViewer: true })\n    }\n\n    doCancelToBrowser() {\n        this.setState({ cancelToBrowser: true })\n    }\n\n    doShowInfo() {\n        // this.setState({ showInfo: true })\n        Modal.info({\n            title: 'Manage My Membership Help',\n            width: '50em',\n            content: (\n                <div>\n                    <p>This is the view to help you manage your membership...</p>\n                </div>\n            )\n        })\n    }\n\n    renderOrgName(name: string) {\n        const maxLength = 25\n        if (name.length < 25) {\n            return name\n        }\n        return (\n            <span>\n                {name.slice(0, 25)}\n                \n            </span>\n        )\n    }\n\n    renderHeader() {\n        const breadcrumbs = (\n            <React.Fragment>\n                <span>\n                    <NavLink to={`/viewOrganization/${this.props.organization.id}`}>\n                        <span style={{ fontWeight: 'bold' }}>\n                            {this.renderOrgName(this.props.organization.name)}\n                        </span>\n                    </NavLink>\n\n                    <Icon type=\"right\" style={{ verticalAlign: 'middle', marginLeft: '4px', marginRight: '4px' }} />\n\n                    <Icon type=\"user\" />\n                    {' '}\n                    <span style={{ fontSize: '120%' }}>Manage your membership</span>\n                </span>\n            </React.Fragment>\n        )\n        const buttons = (\n            <React.Fragment>\n                <Button icon=\"undo\"\n                    type=\"danger\"\n                    onClick={this.doCancelToViewer.bind(this)}>\n                    Return to this Org\n                </Button>\n                <Button\n                    shape=\"circle\"\n                    icon=\"info\"\n                    onClick={this.doShowInfo.bind(this)}>\n                </Button>\n            </React.Fragment>\n        )\n        return (\n            <Header breadcrumbs={breadcrumbs} buttons={buttons} />\n        )\n    }\n\n    renderOrgHeader() {\n        // apparently TS is not smart enough to know this from the conditional branch in render()!\n        if (!this.props.organization) {\n            return\n        }\n        return (\n            <OrganizationHeader organizationId={this.props.organization.id} />\n        )\n    }\n\n    render() {\n\n        if (this.state.cancelToBrowser) {\n            return <Redirect push to=\"/organizations\" />\n        }\n\n        if (this.state.cancelToViewer) {\n            return <Redirect push to={\"/viewOrganization/\" + this.props.organization.id} />\n        }\n\n        return (\n            <div className=\"ManageMembership\">\n                {this.renderHeader()}\n                {this.renderOrgHeader()}\n                <h3>\n                    Edit Organization Profile\n                </h3>\n                <div className=\"body\">\n                    <div className=\"col1\">\n                        <div className=\"editorTable\">\n                            <div className=\"editorTable-row\">\n                                <div className=\"editorTable-labelCol\">\n                                    <span className=\"field-label\">\n                                        title\n                                    </span>\n                                </div>\n                                <div className=\"editorTable-controlCol\">\n                                    <Input />\n                                </div>\n                            </div>\n\n                        </div>\n                    </div>\n                    <div className=\"col2\">\n                        <div>\n                            org user profile here\n                        </div>\n                    </div>\n                </div>\n                <h3>\n                    User Profile\n                </h3>\n                <p>\n                    Your user profile is ...\n                </p>\n                <h3>\n                    Leave Org\n                </h3>\n                <Button>\n                    Leave This Org\n                </Button>\n            </div>\n        )\n    }\n}\n\nexport default ManageMembership","import { Dispatch } from 'redux'\nimport { connect } from 'react-redux'\nimport * as actions from '../../../redux/actions/manageMembership'\n\nimport { StoreState } from '../../../types';\nimport * as orgModel from '../../../data/models/organization/model'\nimport * as userModel from '../../../data/models/user'\n\nimport Component from './component'\n\nexport interface OwnProps {\n}\n\ninterface StateProps {\n    username: userModel.Username\n    organization: orgModel.Organization\n}\n\ninterface DispatchProps {\n}\n\nfunction mapStateToProps(state: StoreState, props: OwnProps): StateProps {\n    if (!state.views.manageMembershipView.viewModel) {\n        throw new Error('View model missing')\n    }\n    const {\n        auth: { authorization: { username } },\n        views: {\n            manageMembershipView: {\n                viewModel: { organization }\n            }\n        }\n    } = state\n    return {\n        username, organization\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<actions.Load>): DispatchProps {\n    return {\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(Component)","import * as React from 'react'\n\nimport { ManageMembershipView, AppError, ComponentLoadingState, StoreState } from '../../../types'\n\nimport Container from './container'\n\nexport interface Props {\n    organizationId: string\n    view: ManageMembershipView\n    onLoad: (organizationId: string) => void\n    onUnload: () => void\n}\n\ninterface State {\n}\n\nclass Loader extends React.Component<Props, State> {\n    constructor(props: Props) {\n        super(props)\n    }\n\n    renderLoading() {\n        return (\n            <div>\n                Loading view...\n            </div>\n        )\n    }\n\n    renderError(error: AppError) {\n        return (\n            <div>\n                Error!\n                <div>\n                    {error.message}\n                </div>\n            </div>\n        )\n    }\n\n    render() {\n        switch (this.props.view.loadingState) {\n            case ComponentLoadingState.NONE:\n                this.props.onLoad(this.props.organizationId)\n                return this.renderLoading()\n            case ComponentLoadingState.LOADING:\n                return this.renderLoading()\n            case ComponentLoadingState.ERROR:\n                if (this.props.view.error) {\n                    return this.renderError(this.props.view.error)\n                } else {\n                    return this.renderError({\n                        code: 'Missing Error',\n                        message: 'The error appears to be missing'\n                    })\n                }\n            default:\n                return (\n                    <Container />\n                )\n        }\n    }\n\n    componentWillUnmount() {\n        this.props.onUnload()\n    }\n}\n\n//\n\nimport { Dispatch } from 'redux'\nimport { connect } from 'react-redux'\n\n\nimport * as actions from '../../../redux/actions/manageMembership'\nimport { types } from 'util';\n\nexport interface OwnProps {\n    organizationId: string\n}\n\ninterface StateProps {\n    view: ManageMembershipView\n}\n\ninterface DispatchProps {\n    onLoad: (organizationId: string) => void\n    onUnload: () => void\n}\n\nfunction mapStateToProps(state: StoreState, props: OwnProps): StateProps {\n    return {\n        view: state.views.manageMembershipView\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<actions.Load>): DispatchProps {\n    return {\n        onLoad: (organizationId: string) => {\n            dispatch(actions.load(organizationId) as any)\n        },\n        onUnload: () => {\n            dispatch(actions.unload() as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(Loader)","import * as React from 'react'\n\nimport OrganizationHeader from '../organizationHeader/loader';\nimport { Redirect, NavLink } from 'react-router-dom';\nimport { Narrative, NarrativeState, SortDirection } from '../../../types';\nimport Header from '../../Header';\nimport { Icon, Button, Modal, Alert, Select } from 'antd';\nimport './component.css'\nimport * as orgModel from '../../../data/models/organization/model'\n\n\nexport interface Props {\n    organization: orgModel.Organization\n    narratives: Array<Narrative>\n    relation: orgModel.Relation\n    selectedNarrative: Narrative | null\n    searching: boolean\n    sortBy: string\n    sortDirection: string\n    filter: string\n    doSendRequest: (groupId: string, narrative: Narrative) => void\n    doSelectNarrative: (narrative: Narrative) => void\n}\n\nenum NavigateTo {\n    NONE = 0,\n    BROWSER,\n    VIEWER\n}\n\ninterface State {\n    navigateTo: NavigateTo,\n    // selectedNarrative: Narrative | null\n}\n\nexport class RequestAddNarrative extends React.Component<Props, State> {\n    constructor(props: Props) {\n        super(props)\n\n        this.state = {\n            navigateTo: NavigateTo.NONE,\n            // selectedNarrative: null\n        }\n    }\n\n    doCancelToBrowser() {\n        this.setState({ navigateTo: NavigateTo.BROWSER })\n    }\n\n    doCancelToViewer() {\n        this.setState({ navigateTo: NavigateTo.VIEWER })\n    }\n\n    doSelectNarrative(narrative: Narrative) {\n        this.props.doSelectNarrative(narrative)\n    }\n\n    doShowInfo() {\n        // this.setState({ showInfo: true })\n        Modal.info({\n            title: 'Request to Add Narrative Help',\n            width: '50em',\n            content: (\n                <div>\n                    <p>This is the view to help you request the addition of a narrative to this org...</p>\n                </div>\n            )\n        })\n    }\n\n    doSendRequest() {\n        if (this.props.selectedNarrative === null) {\n            console.warn('attempt to send request without selected narrative')\n            return\n        }\n        this.props.doSendRequest(this.props.organization.id, this.props.selectedNarrative)\n    }\n\n    canSendRequest() {\n        if (this.props.selectedNarrative) {\n            return true\n        }\n        return false\n    }\n\n    renderOrgHeader() {\n        // apparently TS is not smart enough to know this from the conditional branch in render()!\n        if (!this.props.organization) {\n            return\n        }\n        return (\n            <OrganizationHeader organizationId={this.props.organization.id} />\n        )\n    }\n\n    renderOrgName(name: string) {\n        const maxLength = 25\n        if (name.length < 25) {\n            return name\n        }\n        return (\n            <span>\n                {name.slice(0, 25)}\n                \n            </span>\n        )\n    }\n\n    renderHeader() {\n        let orgName: string\n        const breadcrumbs = (\n            <React.Fragment>\n                <span>\n                    <NavLink to={`/viewOrganization/${this.props.organization.id}`}>\n                        <span style={{ fontWeight: 'bold' }}>\n                            {this.renderOrgName(this.props.organization.name)}\n                        </span>\n                    </NavLink>\n\n                    <Icon type=\"right\" style={{ verticalAlign: 'middle', marginLeft: '4px', marginRight: '4px' }} />\n\n                    <Icon type=\"plus\" />\n                    {' '}\n                    <span style={{ fontSize: '120%' }}>Add Narrative to Org</span>\n                </span>\n            </React.Fragment>\n        )\n        const buttons = (\n            <React.Fragment>\n                <Button icon=\"undo\"\n                    type=\"danger\"\n                    onClick={this.doCancelToViewer.bind(this)}>\n                    Return to this Org\n                </Button>\n                <Button\n                    shape=\"circle\"\n                    icon=\"info\"\n                    onClick={this.doShowInfo.bind(this)}>\n                </Button>\n            </React.Fragment>\n        )\n        return (\n            <Header breadcrumbs={breadcrumbs} buttons={buttons} />\n        )\n    }\n\n    renderNarratives() {\n        return this.props.narratives.map((narrative, index) => {\n            let isSelected\n            if (this.props.selectedNarrative &&\n                narrative.workspaceId === this.props.selectedNarrative.workspaceId) {\n                isSelected = true\n            } else {\n                isSelected = false\n            }\n            let classNames = ['narrative']\n            if (isSelected) {\n                classNames.push('selected')\n            }\n            if (narrative.status === NarrativeState.ASSOCIATED) {\n                classNames.push('narrativeInOrg')\n                return (\n                    <div\n                        className={classNames.join(' ')}\n                        onClick={() => { this.doSelectNarrative.call(this, narrative) }}\n                        key={String(index)}>\n                        <div className=\"title\">\n                            {narrative.title || 'n/a'} (associated)\n                        </div>\n                    </div>\n                )\n            } else if (narrative.status === NarrativeState.REQUESTED) {\n                classNames.push('narrativeInOrg')\n                return (\n                    <div\n                        className={classNames.join(' ')}\n                        onClick={() => { this.doSelectNarrative.call(this, narrative) }}\n                        key={String(index)}>\n                        <div className=\"title\">\n                            {narrative.title || 'n/a'} (request pending)\n                        </div>\n                    </div>\n                )\n            } else {\n                classNames.push('narrativeNotInOrg')\n                return (\n                    <div\n                        className={classNames.join(' ')}\n                        onClick={() => { this.doSelectNarrative.call(this, narrative) }}\n                        key={String(index)}>\n                        <div className=\"title\">\n                            {narrative.title || 'n/a'}\n                        </div>\n                    </div>\n                )\n            }\n\n        })\n    }\n\n    onSearchSubmit() {\n        console.log('searching...')\n        return\n    }\n\n    renderSearchIcon() {\n        if (this.props.searching) {\n            return (<Icon type=\"loading\" />)\n        }\n        return (<Icon type=\"search\" />)\n    }\n\n    renderSearchBar() {\n        return (\n            <form id=\"searchForm\"\n                className=\"searchBar\"\n                onSubmit={this.onSearchSubmit.bind(this)}>\n                <input\n                    placeholder=\"Search Organizations\"\n                    // onChange={this.onSearchInputChange.bind(this)}\n                    autoFocus\n                // ref={this.searchInput}\n                />\n                {/* <Tooltip\n                    title=\"Enter one or more words to search organizations by name or owner\">\n                    <Icon type=\"info-circle\" theme=\"twoTone\" style={{ alignSelf: 'end' }} />\n                </Tooltip> */}\n                <Button\n                    // disabled={!this.haveSearchInput()}\n                    // ref={this.searchButton}\n                    className=\"button\"\n                    form=\"searchForm\"\n                    key=\"submit\"\n                    htmlType=\"submit\">\n                    {this.renderSearchIcon()}\n                    {/* Search */}\n                </Button>\n\n                {/* <div className=\"message\">\n                    {this.renderSearchFeedback()}\n                </div> */}\n            </form>\n        )\n    }\n\n    onSortByChange() {\n\n    }\n\n    onSortDirectionChange() {\n\n    }\n\n    onFilterChange() {\n\n    }\n\n    renderFilterSortBar() {\n        return (\n            <div className=\"filterSortBar\">\n                <span className=\"field-label\">sort by</span>\n                <Select onChange={this.onSortByChange.bind(this)}\n                    defaultValue={this.props.sortBy}\n                    style={{ width: '8em' }}\n                    dropdownMatchSelectWidth={true}>\n                    <Select.Option value=\"title\" key=\"title\">Title</Select.Option>\n                    <Select.Option value=\"savedAt\" key=\"savedAt\">Last saved</Select.Option>\n                </Select>\n                <Select onChange={this.onSortDirectionChange.bind(this)}\n                    style={{ width: '4em' }}\n                    dropdownMatchSelectWidth={true}\n                    defaultValue={this.props.sortDirection}>\n                    <Select.Option value={SortDirection.ASCENDING} key=\"name\"><Icon type=\"sort-ascending\" /></Select.Option>\n                    <Select.Option value={SortDirection.DESCENDING} key=\"owner\"><Icon type=\"sort-descending\" /></Select.Option>\n                </Select>\n                {/* <span className=\"field-label\" style={{ marginLeft: '10px' }}>filter</span>\n                <Select onChange={this.onFilterChange.bind(this)}\n                    defaultValue={this.props.filter}\n                    style={{ width: '10em' }}\n                    dropdownMatchSelectWidth={true}>\n                    <Select.Option value=\"all\" key=\"all\">All</Select.Option>\n                    <Select.Option value=\"notAssociatedPending\" key=\"notAssociatedPending\">Not Associated/Pending</Select.Option>\n                    <Select.Option value=\"associatedPending\" key=\"associatedPending\">Only Associated/Pending</Select.Option>\n                </Select> */}\n            </div>\n        )\n    }\n\n    renderNarrativeSelector() {\n        return (\n            <div className=\"narrativeSelector scrollable-flex-column\">\n                <div style={{ display: 'flex', flexDirection: 'row' }}>\n                    <div style={{ flex: '0 0 10em' }}>\n                        {this.renderSearchBar()}\n                    </div>\n                    <div style={{ flex: '1 1 0px' }}>\n                        {this.renderFilterSortBar()}\n                    </div>\n                </div>\n                <div className=\"narratives scrollable-flex-column\">\n                    <div className=\"narrativesTable\">\n                        {this.renderNarratives()}\n                    </div>\n\n                </div>\n            </div >\n        )\n    }\n\n    renderSelectedNarrativeButton() {\n        if (!this.props.selectedNarrative) {\n            return\n        }\n        if (this.props.selectedNarrative.status === NarrativeState.ASSOCIATED) {\n            return (\n                <Alert type=\"info\" message=\"This Narrative is associated with this Organization\" />\n            )\n        } else if (this.props.selectedNarrative.status === NarrativeState.REQUESTED) {\n            return (\n                <Alert type=\"warning\" message=\"You have requested to associate this Narrative with this Organization\" />\n            )\n        }\n        let buttonLabel\n        if (this.props.relation.type === orgModel.UserRelationToOrganization.ADMIN ||\n            this.props.relation.type === orgModel.UserRelationToOrganization.OWNER) {\n            buttonLabel = 'Add Selected Narrative to Organization'\n        } else {\n            buttonLabel = 'Request Association of Selected Narrative to Organization'\n        }\n        return (\n            <Button\n                type=\"primary\"\n                onClick={this.doSendRequest.bind(this)}\n                disabled={!this.canSendRequest.call(this)}\n            >{buttonLabel}</Button>\n        )\n\n    }\n\n    renderSelectedNarrative() {\n        if (this.props.selectedNarrative) {\n            return (\n                <div className=\"selectedNarrative\">\n                    <div className=\"title\">\n                        {this.props.selectedNarrative.title}\n                    </div>\n                    <div>\n                        <i>last modified</i>\n                        {' '}\n                        {Intl.DateTimeFormat('en-US', {\n                            month: 'long',\n                            day: 'numeric',\n                            year: 'numeric'\n                        }).format(this.props.selectedNarrative.modifiedAt)}\n                    </div>\n                </div>\n            )\n        } else {\n            return (\n                <Alert type=\"info\" message=\"Select a narrative on the left to show it here and be able to add it to this organization.\" />\n            )\n        }\n    }\n\n    render() {\n        switch (this.state.navigateTo) {\n            case NavigateTo.BROWSER:\n                return <Redirect push to=\"/organizations\" />\n            case NavigateTo.VIEWER:\n                return <Redirect push to={\"/viewOrganization/\" + this.props.organization.id} />\n            case NavigateTo.NONE:\n            default:\n            // do nothing.\n        }\n\n        // let buttonLabel\n        // if (this.props.organization.relation.type === UserRelationToOrganization.ADMIN ||\n        //     this.props.organization.relation.type === UserRelationToOrganization.OWNER) {\n        //     buttonLabel = 'Add Selected Narrative to Organization'\n        // } else {\n        //     buttonLabel = 'Request Addition of Selected Narrative to Organization'\n        // }\n\n        return (\n            <div className=\"RequestNarrative scrollable-flex-column\">\n                {this.renderHeader()}\n                {this.renderOrgHeader()}\n                <div className=\"body scrollable-flex-column\">\n                    <div className=\"selectNarrativeCol scrollable-flex-column\">\n                        <h3>Select a Narrative</h3>\n                        {this.renderNarrativeSelector()}\n                    </div>\n                    <div className=\"selectedNarrativeCol\">\n                        <h3>Selected Narrative</h3>\n                        {this.renderSelectedNarrative()}\n                        <div className=\"selectedNarrativeButtonBar\">\n                            {this.renderSelectedNarrativeButton()}\n                        </div>\n                    </div>\n                </div>\n                <div className=\"footer\">\n                    {/* <Button\n                        type=\"primary\"\n                        onClick={this.doSendRequest.bind(this)}\n                        disabled={!this.canSendRequest.call(this)}\n                    >{buttonLabel}</Button> */}\n                </div>\n            </div>\n        )\n    }\n}\n\nexport default RequestAddNarrative","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\nimport { ActionFlag } from './index'\n\nimport * as orgModel from '../../data/models/organization/model'\nimport * as userModel from '../../data/models/user'\nimport { AppError, StoreState } from '../../types'\n\n// Loading\n\nexport interface Load extends Action {\n    type: ActionFlag.MANAGE_MEMBERSHIP_LOAD\n}\n\nexport interface LoadStart extends Action {\n    type: ActionFlag.MANAGE_MEMBERSHIP_LOAD_START\n}\n\nexport interface LoadSuccess extends Action {\n    type: ActionFlag.MANAGE_MEMBERSHIP_LOAD_SUCCESS,\n    organization: orgModel.Organization\n}\n\nexport interface LoadError extends Action {\n    type: ActionFlag.MANAGE_MEMBERSHIP_LOAD_ERROR,\n    error: AppError\n}\n\nexport interface Unload extends Action {\n    type: ActionFlag.MANAGE_MEMBERSHIP_UNLOAD\n}\n\nexport function loadStart(): LoadStart {\n    return {\n        type: ActionFlag.MANAGE_MEMBERSHIP_LOAD_START\n    }\n}\n\nexport function loadSuccess(organization: orgModel.Organization): LoadSuccess {\n    return {\n        type: ActionFlag.MANAGE_MEMBERSHIP_LOAD_SUCCESS,\n        organization: organization\n    }\n}\n\nexport function loadError(error: AppError): LoadError {\n    return {\n        type: ActionFlag.MANAGE_MEMBERSHIP_LOAD_ERROR,\n        error: error\n    }\n}\n\nexport function unload() {\n    return {\n        type: ActionFlag.MANAGE_MEMBERSHIP_UNLOAD\n    }\n}\n\nexport function load(organizationId: string) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(loadStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config }\n        } = getState()\n\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        // TODO: here is where we would hook into the store state entities for groups\n        try {\n            const org = await orgClient.getOrg(organizationId)\n            dispatch(loadSuccess(org))\n        } catch (ex) {\n            dispatch(loadError({\n                code: ex.name,\n                message: ex.message\n            }))\n        }\n    }\n\n}\n","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\nimport { ActionFlag } from './index'\nimport { Model } from '../../data/model'\nimport { AppError, StoreState, Narrative } from '../../types'\n\nimport * as orgModel from '../../data/models/organization/model'\nimport * as narrativeModel from '../../data/models/narrative'\nimport * as requestModel from '../../data/models/requests'\n\nexport interface Load extends Action {\n    type: ActionFlag.REQUEST_ADD_NARRATIVE_LOAD\n}\n\nexport interface LoadStart extends Action {\n    type: ActionFlag.REQUEST_ADD_NARRATIVE_LOAD_START\n}\n\nexport interface LoadSuccess extends Action {\n    type: ActionFlag.REQUEST_ADD_NARRATIVE_LOAD_SUCCESS\n    organization: orgModel.Organization\n    narratives: Array<Narrative>\n    relation: orgModel.Relation\n}\n\nexport interface LoadError extends Action {\n    type: ActionFlag.REQUEST_ADD_NARRATIVE_LOAD_ERROR\n    error: AppError\n}\n\nexport function loadStart(): LoadStart {\n    return {\n        type: ActionFlag.REQUEST_ADD_NARRATIVE_LOAD_START\n    }\n}\n\nexport function loadSuccess(organization: orgModel.Organization, narratives: Array<Narrative>, relation: orgModel.Relation): LoadSuccess {\n    return {\n        type: ActionFlag.REQUEST_ADD_NARRATIVE_LOAD_SUCCESS,\n        organization, narratives, relation\n    }\n}\n\nexport function loadError(error: AppError): LoadError {\n    return {\n        type: ActionFlag.REQUEST_ADD_NARRATIVE_LOAD_ERROR,\n        error: error\n    }\n}\n\nexport function load(organizationId: string) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(loadStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config } } = getState()\n\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n        const narrativeClient = new narrativeModel.NarrativeModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url,\n            serviceWizardURL: config.services.ServiceWizard.url,\n            workspaceServiceURL: config.services.Workspace.url\n        })\n        const requestClient = new requestModel.RequestsModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        try {\n            const [org, narratives, request, invitation] = await Promise.all([\n                orgClient.getOrg(organizationId),\n                narrativeClient.getOwnNarratives(organizationId),\n                requestClient.getUserRequestForOrg(organizationId),\n                requestClient.getUserInvitationForOrg(organizationId)\n            ])\n\n            const relation = orgModel.determineRelation(org, username, request, invitation)\n            dispatch(loadSuccess(org, narratives, relation))\n        } catch (ex) {\n            console.error('loading error', ex)\n            dispatch(loadError({\n                code: ex.name,\n                message: ex.message\n            }))\n        }\n    }\n}\n\n// Selecting narrative\nexport interface SelectNarrative {\n    type: ActionFlag.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE,\n    narrative: Narrative\n}\n\nexport interface SelectNarrativeStart {\n    type: ActionFlag.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_START\n}\n\nexport interface SelectNarrativeSuccess {\n    type: ActionFlag.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_SUCCESS\n    narrative: Narrative\n}\n\nexport interface SelectNarrativeError {\n    type: ActionFlag.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_ERROR\n    error: AppError\n}\n\nexport function selectNarrativeStart(): SelectNarrativeStart {\n    return {\n        type: ActionFlag.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_START\n    }\n}\n\nexport function selectNarrativeSuccess(narrative: Narrative): SelectNarrativeSuccess {\n    return {\n        type: ActionFlag.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_SUCCESS,\n        narrative: narrative\n    }\n}\n\nexport function selectNarrativeError(error: AppError): SelectNarrativeError {\n    return {\n        type: ActionFlag.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_ERROR,\n        error: error\n    }\n}\n\nexport function selectNarrative(narrative: Narrative) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(selectNarrativeStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config } } = getState()\n\n        // TODO: fetch narrative and populate the selected narrative accordingly...\n\n\n        dispatch(selectNarrativeSuccess(narrative))\n    }\n}\n\n// Sending Request\nexport interface SendRequest {\n    type: ActionFlag.REQUEST_ADD_NARRATIVE_SEND\n}\n\nexport interface SendRequestStart {\n    type: ActionFlag.REQUEST_ADD_NARRATIVE_SEND_START\n}\n\nexport interface SendRequestSuccess {\n    type: ActionFlag.REQUEST_ADD_NARRATIVE_SEND_SUCCESS,\n    request: requestModel.Request | boolean\n}\n\nexport interface SendRequestError {\n    type: ActionFlag.REQUEST_ADD_NARRATIVE_SEND_ERROR,\n    error: AppError\n}\n\n\nexport function sendRequestStart(): SendRequestStart {\n    return {\n        type: ActionFlag.REQUEST_ADD_NARRATIVE_SEND_START\n    }\n}\n\nexport function sendRequestSuccess(request: requestModel.Request | boolean): SendRequestSuccess {\n    return {\n        type: ActionFlag.REQUEST_ADD_NARRATIVE_SEND_SUCCESS,\n        request: request\n    }\n}\n\nexport function sendRequestError(error: AppError): SendRequestError {\n    return {\n        type: ActionFlag.REQUEST_ADD_NARRATIVE_SEND_ERROR,\n        error: error\n    }\n}\n\nexport function sendRequest(groupId: string, narrative: Narrative) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(sendRequestStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config } } = getState()\n\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        try {\n            const request = await orgClient.addOrRequestNarrativeToGroup(groupId, narrative.workspaceId)\n            dispatch(sendRequestSuccess(request))\n        } catch (ex) {\n            dispatch(sendRequestError({\n                code: ex.name,\n                message: ex.message\n            }))\n        }\n    }\n}\n\n// Unloading\n\nexport interface Unload extends Action {\n    type: ActionFlag.REQUEST_ADD_NARRATIVE_UNLOAD\n}\n\nexport function unload(): Unload {\n    return {\n        type: ActionFlag.REQUEST_ADD_NARRATIVE_UNLOAD\n    }\n}","import { Dispatch, Action } from 'redux'\n\nimport { connect } from 'react-redux'\n\nimport * as types from '../../../types'\n\nimport Component from './component'\nimport * as actions from '../../../redux/actions/requestAddNarrative'\nimport * as orgModel from '../../../data/models/organization/model'\n\nexport interface OwnProps {\n}\n\ninterface StateProps {\n    organization: orgModel.Organization\n    relation: orgModel.Relation\n    narratives: Array<types.Narrative>\n    selectedNarrative: types.Narrative | null\n    searching: boolean\n    sortBy: string\n    sortDirection: types.SortDirection\n    filter: string\n}\n\ninterface DispatchProps {\n    doSendRequest: (groupId: string, narrative: types.Narrative) => void\n    doSelectNarrative: (narrative: types.Narrative) => void\n}\n\nfunction mapStateToProps(state: types.StoreState, props: OwnProps): StateProps {\n    if (state.views.requestNarrativeView.viewModel === null) {\n        throw new Error('view value is not defined!')\n    }\n    const {\n        views: {\n            requestNarrativeView: {\n                viewModel: {\n                    organization, relation, narratives, selectedNarrative\n                }\n            }\n        }\n    } = state\n\n\n    return {\n        organization: organization,\n        relation: relation,\n        narratives: narratives,\n        selectedNarrative: selectedNarrative,\n        searching: false,\n        sortBy: 'title',\n        sortDirection: types.SortDirection.ASCENDING,\n        filter: ''\n    }\n}\n\nfunction mapDispatchToProps(dispatch: Dispatch<Action>): DispatchProps {\n    return {\n        doSendRequest: (groupId: string, narrative: types.Narrative) => {\n            dispatch(actions.sendRequest(groupId, narrative) as any)\n        },\n        doSelectNarrative: (narrative: types.Narrative) => {\n            dispatch(actions.selectNarrative(narrative) as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, types.StoreState>(mapStateToProps, mapDispatchToProps)(Component)","import * as React from 'react'\n\nimport Container from './container'\n\nexport interface Props {\n    organizationId: string\n    view: types.RequestNarrativeView\n    onLoad: (organizationId: string) => void\n    onUnload: () => void\n}\n\ninterface State {\n}\n\nclass Loader extends React.Component<Props, State> {\n    constructor(props: Props) {\n        super(props)\n    }\n\n    renderLoading() {\n        return (\n            <div>\n                Loading Your Narratives...\n            </div>\n        )\n    }\n\n    renderError(error: types.AppError) {\n        return (\n            <div>\n                Error!\n                <div>\n                    {error.message}\n                </div>\n            </div>\n        )\n    }\n\n    render() {\n        switch (this.props.view.loadingState) {\n            case types.ComponentLoadingState.NONE:\n                this.props.onLoad(this.props.organizationId)\n                return this.renderLoading()\n            case types.ComponentLoadingState.LOADING:\n                return this.renderLoading()\n            case types.ComponentLoadingState.ERROR:\n                if (this.props.view.error) {\n                    return this.renderError(this.props.view.error)\n                } else {\n                    return this.renderError({\n                        code: 'Missing Error',\n                        message: 'The error appears to be missing'\n                    })\n                }\n            default:\n                return (\n                    <Container />\n                )\n        }\n    }\n\n    componentWillUnmount() {\n        this.props.onUnload()\n    }\n}\n\n//\n\nimport { Dispatch } from 'redux'\nimport { connect } from 'react-redux'\n\nimport * as types from '../../../types'\nimport * as actions from '../../../redux/actions/requestAddNarrative'\n\nexport interface OwnProps {\n    organizationId: string\n}\n\ninterface StateProps {\n    view: types.RequestNarrativeView\n}\n\ninterface DispatchProps {\n    onLoad: (organizationId: string) => void\n    onUnload: () => void\n}\n\nfunction mapStateToProps(state: types.StoreState, props: OwnProps): StateProps {\n    return {\n        view: state.views.requestNarrativeView\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<actions.Load>): DispatchProps {\n    return {\n        onLoad: (organizationId: string) => {\n            dispatch(actions.load(organizationId) as any)\n        },\n        onUnload: () => {\n            dispatch(actions.unload() as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, types.StoreState>(mapStateToProps, mapDispatchToProps)(Loader)","import * as React from 'react'\n\nimport * as organizationModel from '../../../data/models/organization/model'\nimport * as userModel from '../../../data/models/user'\nimport { NavLink } from 'react-router-dom';\n\nimport './OrganizationCompact.css'\nimport { Icon } from 'antd';\n\nexport interface OrganizationProps {\n    organization: organizationModel.Organization\n}\n\nenum View {\n    COMPACT = 0,\n    NORMAL\n}\ninterface OrganizationState {\n    view: View\n}\n\nfunction reverseView(v: View) {\n    switch (v) {\n        case View.COMPACT:\n            return View.NORMAL\n        case View.NORMAL:\n            return View.COMPACT\n    }\n}\n\nexport default class OrganizationCompact extends React.Component<OrganizationProps, OrganizationState> {\n    constructor(props: OrganizationProps) {\n        super(props)\n\n        this.state = {\n            view: View.COMPACT\n        }\n    }\n\n    onToggleView() {\n        this.setState({\n            view: reverseView(this.state.view)\n        })\n    }\n\n    getAvatarUrl(org: organizationModel.Organization) {\n        // const defaultImages = [\n        //     'orgs-64.png',\n        //     'unicorn-64.png'\n        // ]\n        // if (!org.gravatarHash) {\n        //     return defaultImages[Math.floor(Math.random() * 2)]\n        // }\n        if (!org.gravatarHash) {\n            return 'unicorn-64.png'\n        }\n        const gravatarDefault = 'identicon';\n\n        return 'https://www.gravatar.com/avatar/' + org.gravatarHash + '?s=64&amp;r=pg&d=' + gravatarDefault;\n    }\n\n    renderAvatar(org: organizationModel.Organization) {\n        return (\n            <img style={{ width: 30, height: 30 }}\n                src={this.getAvatarUrl(org)} />\n        )\n    }\n\n\n    pluralize(count: number, singular: string, plural: string) {\n        if (count === 0 || count > 1) {\n            return plural\n        }\n        return singular\n    }\n\n    renderMemberCount(org: organizationModel.Organization) {\n        return (\n            <div className=\"memberCount\">\n                {org.members.length > 0 ? org.members.length : 'no'} {this.pluralize(org.members.length, 'member', 'members')}\n            </div>\n        )\n    }\n\n    renderNormal() {\n        const org = this.props.organization\n        return (\n            <div className=\"OrganizationCompact\" key={org.id}>\n                <div className=\"avatarCol\">\n                    <NavLink to={`/viewOrganization/${org.id}`}>\n                        {this.renderAvatar(org)}\n                    </NavLink>\n                </div>\n                <div className=\"bodyCol\">\n                    <div className=\"orgName\">\n                        <NavLink to={`/viewOrganization/${org.id}`}>\n                            {org.name}\n                        </NavLink>\n                    </div>\n                    <div className=\"orgOwner\">\n                        <span className=\"field-label\">owner</span>\n                        <span className=\"field-value\"><a href={\"/#people/\" + org.owner.username} target=\"_blank\">{org.owner.username} {org.owner.username}</a></span>\n\n                    </div>\n                    <div className=\"orgCreated\">\n                        <span className=\"field-label\">established</span>\n                        <span className=\"field-value\">{Intl.DateTimeFormat('en-US', {\n                            month: 'short',\n                            day: 'numeric',\n                            year: 'numeric'\n                        }).format(org.createdAt)}</span>\n                    </div>\n                </div>\n                <div className=\"controlCol\">\n                    <a onClick={this.onToggleView.bind(this)}\n                        className={`linkButton ${this.state.view === View.NORMAL ? \"pressed\" : \"\"}`}\n                    >\n                        <Icon type={`${this.state.view === View.NORMAL ? \"up\" : \"down\"}`} />\n                    </a>\n                </div>\n            </div>\n        )\n    }\n\n    renderCompact() {\n        const org = this.props.organization\n        return (\n            <div className=\"OrganizationCompact\" key={org.id}>\n                <div className=\"avatarCol\">\n                    <NavLink to={`/viewOrganization/${org.id}`}>\n                        {this.renderAvatar(org)}\n                    </NavLink>\n                </div>\n                <div className=\"bodyCol\">\n                    <div className=\"orgName\">\n                        <NavLink to={`/viewOrganization/${org.id}`}>\n                            {org.name}\n                        </NavLink>\n                    </div>\n\n                </div>\n                <div className=\"controlCol\">\n                    <a onClick={this.onToggleView.bind(this)}\n                        className={`linkButton ${this.state.view === View.NORMAL ? \"pressed\" : \"\"}`}\n                    >\n                        <Icon type={`${this.state.view === View.NORMAL ? \"up\" : \"down\"}`} />\n                    </a>\n                </div>\n            </div>\n        )\n    }\n\n    render() {\n        switch (this.state.view) {\n            case View.COMPACT:\n                return (\n                    <div className=\"User View-COMPACT\">\n                        {this.renderCompact()}\n                    </div>\n                )\n            case View.NORMAL:\n                return (\n                    <div className=\"User View-NORMAL\">\n                        {this.renderNormal()}\n                    </div>\n                )\n        }\n    }\n}\n","import * as React from 'react'\n\nimport * as organizationModel from '../../../data/models/organization/model'\nimport * as uberModel from '../../../data/models/uber'\nimport { NavLink } from 'react-router-dom';\nimport { Tooltip, Icon } from 'antd';\nimport UserComponent from '../../entities/UserContainer'\n\nimport './Organization.css'\n\nexport interface OrganizationProps {\n    organization: uberModel.UberOrganization\n    // users: Map<userModel.Username, userModel.User>\n}\n\ninterface OrganizationState {\n}\n\nexport default class OrganizationBlock extends React.Component<OrganizationProps, OrganizationState> {\n    constructor(props: OrganizationProps) {\n        super(props)\n    }\n\n    getAvatarUrl(org: organizationModel.Organization) {\n        // const defaultImages = [\n        //     'orgs-64.png',\n        //     'unicorn-64.png'\n        // ]\n        // if (!org.gravatarHash) {\n        //     return defaultImages[Math.floor(Math.random() * 2)]\n        // }\n        if (!org.gravatarHash) {\n            return 'unicorn-64.png'\n        }\n        const gravatarDefault = 'identicon';\n\n        return 'https://www.gravatar.com/avatar/' + org.gravatarHash + '?s=64&amp;r=pg&d=' + gravatarDefault;\n    }\n\n    renderAvatar(org: organizationModel.Organization) {\n        return (\n            <img style={{ width: 64, height: 64 }}\n                src={this.getAvatarUrl(org)} />\n        )\n    }\n\n    renderRelation() {\n        switch (this.props.organization.relation.type) {\n            case (organizationModel.UserRelationToOrganization.NONE):\n                return (\n                    <span><Icon type=\"stop\" />None</span>\n                )\n            case (organizationModel.UserRelationToOrganization.VIEW):\n                return (\n                    <Tooltip\n                        placement=\"bottomRight\"\n                        mouseEnterDelay={0.5}\n                        title=\"You are not a member of this org, but you may access it; you may request membership\"\n                    >\n                        <span><Icon type=\"stop\" /> You are not a member - view group to join</span>\n                    </Tooltip>\n                )\n            case (organizationModel.UserRelationToOrganization.MEMBER_REQUEST_PENDING):\n                return (<span><Icon type=\"user\" style={{ color: 'orange' }} /> Your membership <b>request</b> is pending</span>)\n            case (organizationModel.UserRelationToOrganization.MEMBER_INVITATION_PENDING):\n                return (<span><Icon type=\"user\" style={{ color: 'blue' }} /> You have been <b>invited</b> to join</span>)\n            case (organizationModel.UserRelationToOrganization.MEMBER):\n                return (<span><Icon type=\"user\" /> You are a <b>member</b> of this organization</span>)\n            case (organizationModel.UserRelationToOrganization.ADMIN):\n                return (<span><Icon type=\"unlock\" />Admin</span>)\n            case (organizationModel.UserRelationToOrganization.OWNER):\n                return (\n                    <Tooltip\n                        placement=\"bottomRight\"\n                        mouseEnterDelay={0.5}\n                        title=\"You own this org\"\n                    >\n                        <span><Icon type=\"crown\" /> You are the <b>owner</b> of this Organization</span>\n                    </Tooltip>\n                )\n        }\n    }\n\n    pluralize(count: number, singular: string, plural: string) {\n        if (count === 0 || count > 1) {\n            return plural\n        }\n        return singular\n    }\n\n    renderMemberCount() {\n        const org = this.props.organization.organization\n        return (\n            <div className=\"memberCount\">\n                {org.members.length > 0 ? org.members.length : 'no'} {this.pluralize(org.members.length, 'member', 'members')}\n            </div>\n        )\n    }\n\n    renderRelationInfo() {\n        switch (this.props.organization.relation.type) {\n            case organizationModel.UserRelationToOrganization.NONE:\n                return (\n                    <div>\n                        Only members may view membership information\n                    </div>\n                )\n                break\n            case organizationModel.UserRelationToOrganization.VIEW:\n                return (\n                    <div>Only members may view membership information</div>\n                )\n                break\n            case organizationModel.UserRelationToOrganization.MEMBER:\n                return (\n                    <div>\n                        {this.renderMemberCount()}\n                    </div>\n                )\n                break\n            case organizationModel.UserRelationToOrganization.MEMBER_REQUEST_PENDING:\n                return (\n                    <div>Only members may view membership information</div>\n                )\n                break\n            case organizationModel.UserRelationToOrganization.MEMBER_INVITATION_PENDING:\n                return (\n                    <div>\n                        Only members may view membership information\n                    </div>\n                )\n                break\n            case organizationModel.UserRelationToOrganization.ADMIN:\n                return (\n                    <div>\n                        {this.renderMemberCount()}\n                    </div>\n                )\n                break\n            case organizationModel.UserRelationToOrganization.OWNER:\n                return (\n                    <div>\n                        {this.renderMemberCount()}\n                    </div>\n                )\n                break\n        }\n    }\n\n    renderAdminInfo() {\n        if (!(this.props.organization.relation.type === organizationModel.UserRelationToOrganization.OWNER ||\n            this.props.organization.relation.type === organizationModel.UserRelationToOrganization.ADMIN)) {\n            return\n        }\n        const requests = this.props.organization.groupRequests\n        let requestsPending\n        if (requests && requests.length > 0) {\n            requestsPending = (\n                <div>\n                    <Icon type=\"exclamation-circle\" theme=\"twoTone\" twoToneColor=\"orange\" />\n                    {' '}\n                    there\n                    {' '}\n                    {requests.length > 1 ? 'are' : 'is'}\n                    {' '}\n                    <b>{requests.length} pending request{requests.length > 1 ? 's' : ''}</b>\n                </div>\n            )\n        }\n\n        return (\n            <div className=\"admin\">\n                {requestsPending}\n            </div>\n        )\n    }\n\n    render() {\n        const org = this.props.organization.organization\n        return (\n            <div className=\"OrganizationBlock\" key={org.id}>\n                <div className=\"avatarCol\">\n                    <NavLink to={`/viewOrganization/${org.id}`}>\n                        {this.renderAvatar(org)}\n                    </NavLink>\n                </div>\n                <div className=\"bodyCol\">\n                    <div className=\"orgName\">\n                        <NavLink to={`/viewOrganization/${org.id}`}>\n                            {org.name}\n                        </NavLink>\n                    </div>\n                    <div>\n                        {this.renderRelation()}\n                    </div>\n                    <div>\n                        {this.renderRelationInfo()}\n                    </div>\n                    <div>\n                        {this.renderAdminInfo()}\n                    </div>\n                    <div className=\"orgOwner\">\n                        <span className=\"field-label\">owner</span>\n                        <span className=\"field-value\"><a href={\"/#people/\" + org.owner.username} target=\"_blank\">{org.owner.username} {org.owner.username}</a></span>\n                    </div>\n                    <div className=\"orgCreated\">\n                        <span className=\"field-label\">established</span>\n                        <span className=\"field-value\">{Intl.DateTimeFormat('en-US', {\n                            month: 'short',\n                            day: 'numeric',\n                            year: 'numeric'\n                        }).format(org.createdAt)}</span>\n                    </div>\n                    {/* {this.renderAdminInfo(org)} */}\n                </div>\n            </div>\n        )\n    }\n}\n","import * as React from 'react'\nimport * as orgModel from '../../../data/models/organization/model'\nimport OrganizationCompact from './OrganizationCompact'\n\ninterface LoaderProps {\n    organizationId: orgModel.OrganizationID\n    organization: orgModel.Organization | undefined\n    onLoad: (organizationId: orgModel.OrganizationID) => void\n}\n\ninterface LoaderState {\n\n}\n\nclass Loader extends React.Component<LoaderProps, LoaderState> {\n    constructor(props: LoaderProps) {\n        super(props)\n    }\n\n    render() {\n        if (this.props.organization) {\n            return (\n                <OrganizationCompact organization={this.props.organization} />\n            )\n        } else {\n            this.props.onLoad(this.props.organizationId)\n            return (\n                <div>\n                    Loading org...\n                </div>\n            )\n        }\n    }\n}\n\nimport { Dispatch } from 'redux'\nimport { connect } from 'react-redux'\nimport { StoreState } from '../../../types';\nimport * as actions from '../../../redux/actions/entities'\n\n\nexport interface OwnProps {\n    organizationId: orgModel.OrganizationID\n}\n\ninterface StateProps {\n    organization: orgModel.Organization | undefined\n}\n\ninterface DispatchProps {\n    onLoad: (organizationId: orgModel.OrganizationID) => void\n}\n\nfunction mapStateToProps(state: StoreState, props: OwnProps): StateProps {\n    return {\n        organization: state.entities.orgs.byId.get(props.organizationId)\n    }\n}\n\nfunction mapDispatchToProps(dispatch: Dispatch<actions.EntityAction>): DispatchProps {\n    return {\n        onLoad: (organizationId: orgModel.OrganizationID) => {\n            dispatch(actions.organizationLoader(organizationId) as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(Loader)","export function niceElapsed(someDate: Date) {\n    const nowDate = new Date()\n\n    const elapsed = Math.round((nowDate.getTime() - someDate.getTime()) / 1000);\n    const elapsedAbs = Math.abs(elapsed);\n\n    let measure, measureAbs, unit;\n    const maxDays = 90\n    if (elapsedAbs < 60 * 60 * 24 * maxDays) {\n        if (elapsedAbs === 0) {\n            return 'now';\n        } else if (elapsedAbs < 60) {\n            measure = elapsed;\n            measureAbs = elapsedAbs;\n            unit = 'second';\n        } else if (elapsedAbs < 60 * 60) {\n            measure = Math.round(elapsed / 60);\n            measureAbs = Math.round(elapsedAbs / 60);\n            unit = 'minute';\n        } else if (elapsedAbs < 60 * 60 * 24) {\n            measure = Math.round(elapsed / 3600);\n            measureAbs = Math.round(elapsedAbs / 3600);\n            unit = 'hour';\n        } else {\n            measure = Math.round(elapsed / (3600 * 24));\n            measureAbs = Math.round(elapsedAbs / (3600 * 24));\n            unit = 'day';\n        }\n\n        if (measureAbs > 1) {\n            unit += 's';\n        }\n\n        let prefix = null;\n        let suffix = null;\n        if (measure < 0) {\n            prefix = 'in';\n        } else if (measure > 0) {\n            suffix = 'ago';\n        }\n\n        return (prefix ? prefix + ' ' : '') + measureAbs + ' ' + unit + (suffix ? ' ' + suffix : '');\n    } else {\n        // otherwise show the actual date, with or without the year.\n        if (nowDate.getFullYear() === nowDate.getFullYear()) {\n            return Intl.DateTimeFormat('en-US', {\n                month: 'short',\n                day: 'numeric'\n            }).format(someDate)\n            // return shortMonths[date.getMonth()] + ' ' + date.getDate();\n        } else {\n            return Intl.DateTimeFormat('en-US', {\n                month: 'short',\n                day: 'numeric',\n                year: 'numeric'\n            }).format(someDate)\n            // return shortMonths[date.getMonth()] + ' ' + date.getDate() + ', ' + date.getFullYear();\n        }\n    }\n}\n","import * as React from 'react'\nimport * as feedsModel from '../../data/models/feeds'\n\nexport interface NotificationsProps {\n    notifications: Array<feedsModel.Notification>\n}\n\ninterface NotificationsState {\n\n}\n\nexport class Notifications extends React.Component<NotificationsProps, NotificationsState> {\n    constructor(props: NotificationsProps) {\n        super(props)\n    }\n\n    renderNotification(notification: feedsModel.Notification) {\n        return (\n            <div className=\"notification\">\n                <div>\n                    {notification.actor}\n                </div>\n                <div>\n                    {notification.verb}\n                </div>\n                <div>\n                    {notification.source}\n                </div>\n            </div>\n        )\n    }\n\n    renderNotifications() {\n        if (this.props.notifications.length === 0) {\n            return (\n                <div className=\"message\">\n                    No unread notifications\n                </div>\n            )\n        }\n        return this.props.notifications.map((notification) => {\n            return this.renderNotification(notification)\n        })\n    }\n\n    render() {\n        return (\n            <div className=\"Notifications\">\n                {this.renderNotifications()}\n            </div>\n        )\n    }\n}\n\nexport default Notifications","import * as React from 'react'\nimport { StoreState } from '../../types';\nimport { Dispatch, Action } from 'redux';\nimport { connect } from 'react-redux';\nimport Component from './component'\nimport * as feedsModel from '../../data/models/feeds'\n\nexport interface OwnProps {\n\n}\n\nexport interface StateProps {\n    notifications: Array<feedsModel.Notification>\n}\n\nexport interface DispatchProps {\n\n}\n\nexport function mapStateToProps(state: StoreState): StateProps {\n    const { db: { notifications: { byId } } } = state\n\n    const values = byId.values()\n\n    // todo .. some processing\n\n    const notifications = Array.from(values)\n    return {\n        notifications\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<Action>): DispatchProps {\n    return {}\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(Component)\n","import * as React from 'react'\nimport Header from '../../Header';\nimport { Icon, Card, Button, Alert, Modal } from 'antd';\nimport './component.css'\nimport { Redirect } from 'react-router-dom';\nimport { DashboardViewModel } from '../../../types';\nimport * as orgModel from '../../../data/models/organization/model'\nimport * as requestModel from '../../../data/models/requests'\nimport Organization from './Organization';\nimport OrganizationCompact from './OrganizationCompactContainer'\nimport * as formatters from '../../../data/formatters'\nimport Narrative from '../../entities/NarrativeContainer';\nimport User from '../../entities/UserContainer';\nimport Notifications from '../../notifications/storeAdapter'\n\nenum NavigateTo {\n    NONE = 0,\n    BROWSER,\n    NEW_ORG\n}\n\nexport interface DashboardProps {\n    viewModel: DashboardViewModel\n}\n\ninterface DashboardState {\n    navigateTo: NavigateTo\n}\n\nexport class Dashboard extends React.Component<DashboardProps, DashboardState> {\n    constructor(props: DashboardProps) {\n        super(props)\n\n        this.state = {\n            navigateTo: NavigateTo.NONE\n        }\n    }\n\n    onNavigateToBrowser() {\n        this.setState({ navigateTo: NavigateTo.BROWSER })\n    }\n\n    onNavigateToNewOrg() {\n        this.setState({ navigateTo: NavigateTo.NEW_ORG })\n    }\n\n    onShowInfo() {\n        Modal.info({\n            title: 'Dashboard',\n            width: '50em',\n            content: (\n                <div>\n                    <p>This is the dashboard...</p>\n                </div>\n            )\n        })\n    }\n\n    renderHeader() {\n        const breadcrumbs = (\n            <React.Fragment>\n                <span>\n                    Your Orgs Dashboard\n                </span>\n            </React.Fragment>\n        )\n        const buttons = (\n            <React.Fragment>\n                <Button\n                    shape=\"circle\"\n                    icon=\"info\"\n                    onClick={this.onShowInfo.bind(this)}>\n                </Button>\n            </React.Fragment>\n        )\n        return (\n            <Header breadcrumbs={breadcrumbs} buttons={buttons} />\n        )\n    }\n\n    renderOrganizations() {\n        const orgs = this.props.viewModel.organizations\n        if (orgs.length === 0) {\n            const message = (\n                <div>\n                    <p>\n                        You are not associated with any Organizations\n                    </p>\n                    <p>\n                        To get started, you can create a\n                        {' '}\n                        <Button onClick={this.onNavigateToNewOrg.bind(this)}><Icon type=\"plus\" />{' '}New</Button>\n                        {' '}\n                        Organization,\n                        or\n                        {' '}\n                        <Button onClick={this.onNavigateToBrowser.bind(this)}>Browse All</Button>\n                        {' '}\n                        organizations to find one to join.\n                    </p>\n                </div>\n            )\n            return (\n                <Alert type=\"info\"\n                    message={message} />\n            )\n        }\n        return this.props.viewModel.organizations.map((org) => {\n            return (\n                <div key={org.organization.id}>\n                    <Organization organization={org} />\n                </div>\n            )\n        })\n    }\n\n    renderOrganizationsCard() {\n        const extra = (\n            <div>\n                <Button key=\"newOrgButton\" onClick={this.onNavigateToNewOrg.bind(this)}><Icon type=\"plus\" />{' '}New</Button>\n                {' '}\n                <Button key=\"browseButton\" onClick={this.onNavigateToBrowser.bind(this)}>Browse All</Button>\n            </div>\n        )\n        return (\n            <Card title=\"Your Organizations\"\n                headStyle={{ backgroundColor: 'gray', color: 'white' }}\n                className=\"slimCard yourOrgsCard\"\n                extra={extra}>\n                {this.renderOrganizations()}\n            </Card>\n        )\n    }\n\n    renderNotificationsCard() {\n        return (\n            <Card title=\"Notifications\"\n                headStyle={{ backgroundColor: 'gray', color: 'white' }}\n                className=\"slimCard notificationsCard\">\n                {this.renderPendingNotifications()}\n            </Card>\n        )\n    }\n\n    renderRequestSentType(request: requestModel.Request) {\n        switch (request.type) {\n            case requestModel.RequestType.REQUEST:\n                switch (request.resourceType) {\n                    case requestModel.RequestResourceType.APP:\n                        return 'REQUEST to associate App'\n                    case requestModel.RequestResourceType.USER:\n                        return 'REQUEST to join Organization'\n                    case requestModel.RequestResourceType.WORKSPACE:\n                        return 'REQUEST to associate Narrative'\n                }\n            case requestModel.RequestType.INVITATION:\n                switch (request.resourceType) {\n                    case requestModel.RequestResourceType.USER:\n                        return 'INVITATION to join Organization'\n                }\n        }\n        return 'unknown request'\n    }\n\n    renderRequestSentSubject(request: requestModel.Request) {\n        switch (request.type) {\n            case requestModel.RequestType.REQUEST:\n                switch (request.resourceType) {\n                    case requestModel.RequestResourceType.APP:\n                        return 'SHOW APP'\n                    case requestModel.RequestResourceType.USER:\n                        return ''\n                    case requestModel.RequestResourceType.WORKSPACE:\n                        return (\n                            <div>\n                                <div className=\"miniDetail\">\n                                    <Narrative workspaceId={parseInt(request.narrativeId, 10)} />\n                                </div>\n\n                            </div>\n                        )\n                }\n            case requestModel.RequestType.INVITATION:\n                switch (request.resourceType) {\n                    case requestModel.RequestResourceType.USER:\n                        return (\n                            <div>\n\n                                <div className=\"miniDetail\">\n                                    <User userId={request.user} avatarSize={30} />\n                                </div>\n\n                            </div>\n                        )\n                }\n        }\n        return 'unknown request'\n    }\n\n    renderRequestRequester(request: requestModel.Request) {\n        return (\n            <User userId={request.requester} avatarSize={30} />\n        )\n    }\n\n    renderRequestReceivedType(request: requestModel.Request) {\n        switch (request.type) {\n            case requestModel.RequestType.REQUEST:\n                switch (request.resourceType) {\n                    case requestModel.RequestResourceType.APP:\n                        return 'REQUEST to associate App'\n                    case requestModel.RequestResourceType.USER:\n                        return 'REQUEST to join Organization'\n                    case requestModel.RequestResourceType.WORKSPACE:\n                        return 'REQUEST to associate Narrative'\n                }\n            case requestModel.RequestType.INVITATION:\n                switch (request.resourceType) {\n                    case requestModel.RequestResourceType.USER:\n                        return 'INVITATION to join Organization'\n                }\n        }\n        return 'unknown request'\n    }\n\n    renderRequestReceivedSubject(request: requestModel.Request) {\n        switch (request.type) {\n            case requestModel.RequestType.REQUEST:\n                switch (request.resourceType) {\n                    case requestModel.RequestResourceType.APP:\n                        return 'SHOW APP'\n                    case requestModel.RequestResourceType.USER:\n                        return ''\n                    case requestModel.RequestResourceType.WORKSPACE:\n                        return (\n                            <div>\n                                <div className=\"miniDetail\">\n                                    <Narrative workspaceId={parseInt(request.narrativeId, 10)} />\n                                </div>\n                                <div className=\"cardSectionHeader\">with organization</div>\n                            </div>\n                        )\n                }\n            case requestModel.RequestType.INVITATION:\n                switch (request.resourceType) {\n                    case requestModel.RequestResourceType.USER:\n                        return ''\n                }\n        }\n        return 'unknown request'\n    }\n\n    renderPendingRequestsSentCard() {\n        return (\n            <Card title=\"Requests From You\"\n                headStyle={{ backgroundColor: 'gray', color: 'white' }}\n                className=\"slimCard pendingRequestsCard\">\n                {this.renderPendingRequestsSent()}\n            </Card>\n        )\n    }\n\n    renderPendingRequestsReceivedCard() {\n        return (\n            <Card title=\"Invitations To You\"\n                headStyle={{ backgroundColor: 'gray', color: 'white' }}\n                className=\"slimCard pendingInvitationsCard\">\n                {this.renderPendingRequestsReceived()}\n            </Card>\n        )\n    }\n\n    isAdmin() {\n        return (this.props.viewModel.organizations.some(({ relation }) => {\n            return (relation.type === orgModel.UserRelationToOrganization.OWNER ||\n                relation.type === orgModel.UserRelationToOrganization.ADMIN)\n        }))\n    }\n\n    renderPendingAdminTasksCard() {\n        if (!this.isAdmin()) {\n            return\n        }\n        return (\n            <Card title=\"Organization Requests\"\n                headStyle={{ backgroundColor: 'gray', color: 'white' }}\n                className=\"slimCard pendingAdminTasksCard\">\n                {this.renderPendingAdminRequests()}\n            </Card>\n        )\n    }\n\n    renderPendingNotifications() {\n        return (\n            <Notifications />\n        )\n    }\n\n    renderPendingRequestsSent() {\n        const requests = this.props.viewModel.pendingRequests\n        if (requests.length === 0) {\n            return (\n                <div className=\"message\">\n                    No pending requests\n                </div>\n            )\n        }\n        return this.props.viewModel.pendingRequests.map((request) => {\n            return (\n                <div key={request.id} className=\"aRequest request\">\n                    <div className=\"requestHeader\">\n                        <div className=\"requestHeaderRow\">\n                            <div className=\"requestHeaderCreatedAt\">\n                                {/* <span className=\"field-label\">created</span>\n                                {' '} */}\n                                {Intl.DateTimeFormat('en-US', {\n                                    month: 'short',\n                                    day: 'numeric',\n                                    year: 'numeric'\n                                }).format(request.createdAt)}\n                            </div>\n                            <div className=\"requestHeaderExpireAt\">\n                                <span className=\"field-label\">expires</span>\n                                {' '}\n                                {formatters.niceElapsed(request.expireAt)}\n                            </div>\n                        </div>\n                    </div>\n                    <div className=\"requestBody\">\n                        <div className=\"requestType\">{this.renderRequestSentType(request)}</div>\n\n                        <div className=\"requestSubject\">{this.renderRequestSentSubject(request)}</div>\n\n                        <div className=\"cardSectionHeader\">with organization</div>\n                        <div className=\"miniDetail\">\n                            <OrganizationCompact organizationId={request.organizationId} />\n                        </div>\n                    </div>\n                </div>\n            )\n        })\n    }\n\n    renderPendingAdminRequests() {\n        const requests = this.props.viewModel.pendingAdminRequests\n        if (requests.length === 0) {\n            return (\n                <div className=\"message\">\n                    No pending organization requests\n                </div>\n            )\n        }\n\n        return requests.map((request) => {\n            return (\n                <div key={request.id} className=\"aRequest invitation\">\n                    <div className=\"requestHeader\">\n                        <div className=\"requestHeaderRow\">\n                            <div className=\"requestHeaderCreatedAt\">\n                                {/* <span className=\"field-label\">created</span>\n                            {' '} */}\n                                {Intl.DateTimeFormat('en-US', {\n                                    month: 'short',\n                                    day: 'numeric',\n                                    year: 'numeric'\n                                }).format(request.createdAt)}\n                            </div>\n                            <div className=\"requestHeaderExpireAt\">\n                                <span className=\"field-label\">expires</span>\n                                {' '}\n                                {formatters.niceElapsed(request.expireAt)}\n\n                            </div>\n                        </div>\n                    </div>\n                    <div className=\"requestBody\">\n                        <div className=\"requestType\">{this.renderRequestReceivedType(request)}</div>\n                        <div className=\"requestSubject\">{this.renderRequestReceivedSubject(request)}</div>\n                        <div className=\"miniDetail\">\n                            <OrganizationCompact organizationId={request.organizationId} />\n                        </div>\n                        <div className=\"cardSectionHeader\">from</div>\n                        <div className=\"requester miniDetail\">{this.renderRequestRequester(request)}</div>\n                    </div>\n                </div>\n            )\n        })\n    }\n\n    renderPendingRequestsReceived() {\n        const requests = this.props.viewModel.pendingInvitations\n        if (requests.length === 0) {\n            return (\n                <div className=\"message\">\n                    No pending invitations\n                </div>\n            )\n        }\n        return this.props.viewModel.pendingInvitations.map((request) => {\n            return (\n                <div key={request.id} className=\"aRequest invitation\">\n                    <div className=\"requestHeader\">\n                        <div className=\"requestHeaderRow\">\n                            <div className=\"requestHeaderCreatedAt\">\n                                {/* <span className=\"field-label\">created</span>\n                            {' '} */}\n                                {Intl.DateTimeFormat('en-US', {\n                                    month: 'short',\n                                    day: 'numeric',\n                                    year: 'numeric'\n                                }).format(request.createdAt)}\n                            </div>\n                            <div className=\"requestHeaderExpireAt\">\n                                <span className=\"field-label\">expires</span>\n                                {' '}\n                                {formatters.niceElapsed(request.expireAt)}\n\n                            </div>\n                        </div>\n                    </div>\n                    <div className=\"requestBody\">\n                        <div className=\"requestType\">{this.renderRequestReceivedType(request)}</div>\n                        <div className=\"requestSubject\">{this.renderRequestReceivedSubject(request)}</div>\n                        <div className=\"miniDetail\">\n                            <OrganizationCompact organizationId={request.organizationId} />\n                        </div>\n                        <div className=\"cardSectionHeader\">\n                            sent by\n                        </div>\n                        <User userId={request.requester} avatarSize={30} />\n                    </div>\n                </div>\n            )\n        })\n    }\n\n    render() {\n\n        switch (this.state.navigateTo) {\n            case NavigateTo.BROWSER:\n                return (\n                    <Redirect to=\"/organizations\" />\n                )\n            case NavigateTo.NEW_ORG:\n                return (\n                    <Redirect to=\"/newOrganization\" />\n                )\n        }\n\n        return (\n            <div className=\"Dashboard scrollable-flex-column\">\n                {this.renderHeader()}\n                <div className=\"body scrollable-flex-column\">\n                    <div className=\"col1\">\n                        {this.renderOrganizationsCard()}\n                    </div>\n                    <div className=\"col2\">\n\n                        {this.renderNotificationsCard()}\n\n                        {this.renderPendingRequestsSentCard()}\n\n                        {this.renderPendingRequestsReceivedCard()}\n\n                        {this.renderPendingAdminTasksCard()}\n\n                    </div>\n                </div>\n\n            </div>\n        )\n    }\n}\n\nexport default Dashboard","import { Dispatch } from 'redux'\nimport { connect } from 'react-redux'\n\nimport Dashboard from './component'\nimport { StoreState, DashboardViewModel } from '../../../types';\nimport * as actions from '../../../redux/actions/dashboard';\n\nexport interface OwnProps {\n\n}\n\ninterface StateProps {\n    viewModel: DashboardViewModel\n}\n\ninterface DispatchProps {\n\n}\n\nfunction mapStateToProps(state: StoreState, props: OwnProps): StateProps {\n    const view = state.views.dashboardView\n    if (view.viewModel === null) {\n        throw new Error('view model is null!')\n    }\n    return {\n        viewModel: view.viewModel\n    }\n}\n\nfunction mapDispatchToProps(dispatch: Dispatch<actions.DashboardAction>): DispatchProps {\n    return {\n\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(Dashboard)","import * as feedsApi from '../apis/feeds'\nimport { string } from 'prop-types';\n\nexport type NotificationID = string\n\nexport enum Level {\n    ALERT = 0,\n    ERROR,\n    WARNING,\n    REQUEST\n}\n\nexport interface Context { }\n\nexport interface Notification {\n    id: NotificationID\n    actor: string\n    verb: string\n    object: string\n    target: Array<string>\n    source: string\n    level: Level\n    seen: boolean\n    createdAt: Date\n    expiresAt: Date\n    externalKey?: string\n    context?: Context\n}\n\nfunction convertLevel(level: string) {\n    switch (level) {\n        case 'alert':\n            return Level.ALERT\n        case 'error':\n            return Level.ERROR\n        case 'warning':\n            return Level.WARNING\n        case 'request':\n            return Level.REQUEST\n        default:\n            throw new Error('Invalid level value: ' + level)\n    }\n}\n\nexport interface FeedsClientParams {\n    token: string\n    feedsServiceURL: string\n}\n\nexport class FeedsClient {\n    params: FeedsClientParams\n    feedsClient: feedsApi.FeedsClient\n    constructor(params: FeedsClientParams) {\n        this.params = params\n        this.feedsClient = new feedsApi.FeedsClient({\n            token: this.params.token,\n            url: this.params.feedsServiceURL\n        })\n    }\n\n    async getNotifications(): Promise<Array<Notification>> {\n        const notifications = await this.feedsClient.getNotifications()\n\n        return notifications.user.feed.map((notification) => {\n            const { id, actor, verb, object, target, source, level, seen,\n                created, expires, external_key, context } = notification\n            return {\n                id, actor, verb, object, target, source,\n                level: convertLevel(level),\n                seen,\n                createdAt: new Date(created), expiresAt: new Date(expires),\n                externalKey: external_key, context\n            }\n        })\n    }\n}","\n/*\n{\n    \"id\": string - a unique id for the notification,\n    \"actor\": string - the actor who triggered the notification,\n    \"verb\": string - the action represented by this notification (see list of verbs below),\n    \"object\": string - the object of the notification,\n    \"target\": list - the target(s) of the notification,\n    \"source\": string - the source service that created the notification,\n    \"level\": string, one of alert, error, warning, request,\n    \"seen\": boolean, if true, then this has been seen before,\n    \"created\": int - number of milliseconds since the epoch, when the notification was created,\n    \"expires\": int - number of milliseconds since the epoch, when the notification will expire, and will no longer be seen.\n    \"external_key\": string - (optional) a external key that has meaning for the service that created the notification. Meant for use by other services.\n    \"context\": structure - (optional) a (mostly) freely open structure with meaning for the service that created it. The special keys `text` and `link` are intended to be used by the front end viewers. A `link` becomes a hyperlink that would link to some relevant place. `text` gets interpreted as the intended text of the notification, instead of automatically generating it.\n}\n*/\n\nexport interface Notification {\n    id: string\n    actor: string\n    verb: string\n    object: string\n    target: Array<string>\n    source: string\n    level: string\n    seen: boolean\n    created: number\n    expires: number\n    external_key?: string\n    context?: {}\n}\n\nexport interface GetNotificationsResult {\n    group: {\n        feed: Array<Notification>\n        unseen: number\n    }\n    user: {\n        feed: Array<Notification>\n        unseen: number\n    }\n}\n\nexport interface FeedsClientParams {\n    token: string\n    url: string\n}\n\ninterface APIResponse { }\n\nexport class FeedsClient {\n    params: FeedsClientParams\n\n\n    constructor(params: FeedsClientParams) {\n        this.params = params\n    }\n\n    async get(path: Array<string>): Promise<APIResponse> {\n        const url = [this.params.url, 'api', 'V1'].concat(path).join('/')\n        const response = await fetch(url, {\n            headers: {\n                Authorization: this.params.token,\n                Accept: 'application/json'\n            },\n            mode: 'cors'\n        })\n\n        if (response.headers.get('Content-Type') === 'application/json') {\n            if (response.status === 200) {\n                const result = await response.json()\n                return result\n            }\n            throw new Error('Non-success response: ' + response.status + ': ' + response.statusText)\n        } else {\n            const textResult = await response.text()\n            throw new Error('Non-JSON response' + textResult)\n        }\n    }\n\n    async getNotifications(): Promise<GetNotificationsResult> {\n        const notifications = await this.get(['notifications'])\n        return notifications as GetNotificationsResult\n    }\n}\n\nexport default FeedsClient","import * as React from 'react'\nimport { ComponentLoadingState, AppError, DashboardViewModel, DashboardView, StoreState } from '../../../types';\nimport Container from './container'\n\n// First the loader component, which takes care of a loading view, error view, and the \n// container.\n\nexport interface LoaderProps {\n    view: DashboardView\n    onLoad: () => void\n    onUnload: () => void\n}\n\ninterface LoaderState {\n\n}\n\nclass Loader extends React.Component<LoaderProps, LoaderState> {\n    constructor(props: LoaderProps) {\n        super(props)\n    }\n\n    renderLoading() {\n        return (\n            <div>\n                Fetching your orgs and other stuff...\n            </div>\n        )\n    }\n\n    renderError() {\n        if (!this.props.view.error) {\n            return\n        }\n        return (\n            <div>\n                Error! {this.props.view.error.message}\n            </div>\n        )\n    }\n\n    render() {\n        switch (this.props.view.loadingState) {\n            case ComponentLoadingState.NONE:\n                // should only appear briefly as the LOAD event is processed.\n                this.props.onLoad()\n                return this.renderLoading()\n            case ComponentLoadingState.LOADING:\n                return this.renderLoading()\n            case ComponentLoadingState.ERROR:\n                return this.renderError()\n            case ComponentLoadingState.SUCCESS:\n                return (\n                    <Container />\n                )\n        }\n    }\n\n    componentWillUnmount() {\n        this.props.onUnload()\n    }\n}\n\n// THe redux connection\n\nimport { Dispatch } from 'redux'\nimport { connect } from 'react-redux'\n\nimport * as actions from '../../../redux/actions/dashboard'\n\nexport interface OwnProps {\n\n}\n\ninterface StateProps {\n    view: DashboardView\n}\n\ninterface DispatchProps {\n    onLoad: () => void\n    onUnload: () => void\n}\n\nfunction mapStateToProps(state: StoreState, props: OwnProps): StateProps {\n    return {\n        view: state.views.dashboardView\n    }\n}\n\nfunction mapDispatchToProps(dispatch: Dispatch<actions.DashboardAction>): DispatchProps {\n    return {\n        onLoad: () => {\n            dispatch(actions.load() as any)\n        },\n        onUnload: () => {\n            dispatch(actions.unload() as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(Loader)","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\n\nimport { ActionFlag } from './index'\nimport { AppError, StoreState, MemberType } from '../../types'\nimport * as orgsModel from '../../data/models/organization/model'\nimport * as userModel from '../../data/models/user'\nimport * as requestModel from '../../data/models/requests'\nimport * as uberModel from '../../data/models/uber'\n// temp\nimport { FeedsClient } from '../../data/models/feeds'\n\nexport interface DashboardAction extends Action {\n\n}\n\nexport interface Load extends DashboardAction {\n    type: ActionFlag.DASHBOARD_LOAD\n}\n\nexport interface LoadStart extends DashboardAction {\n    type: ActionFlag.DASHBOARD_LOAD_START\n}\n\nexport interface LoadSuccess extends DashboardAction {\n    type: ActionFlag.DASHBOARD_LOAD_SUCCESS\n    organizations: Array<uberModel.UberOrganization>\n    // users: Map<userModel.Username, userModel.User>\n    requests: Array<requestModel.Request>\n    invitations: Array<requestModel.Request>\n    pendingGroupRequests: Array<requestModel.Request>\n}\n\nexport interface LoadError extends DashboardAction {\n    type: ActionFlag.DASHBOARD_LOAD_ERROR\n    error: AppError\n}\n\nexport interface Unload extends DashboardAction {\n    type: ActionFlag.DASHBOARD_UNLOAD\n}\n\n// Generators\n\nexport function loadStart(): LoadStart {\n    return {\n        type: ActionFlag.DASHBOARD_LOAD_START\n    }\n}\n\nexport function loadSuccess(\n    organizations: Array<uberModel.UberOrganization>,\n    // users: Map<userModel.Username, userModel.User>,\n    requests: Array<requestModel.Request>,\n    invitations: Array<requestModel.Request>,\n    pendingGroupRequests: Array<requestModel.Request>): LoadSuccess {\n    return {\n        type: ActionFlag.DASHBOARD_LOAD_SUCCESS,\n        organizations: organizations,\n        // users: users,\n        requests: requests,\n        invitations: invitations,\n        pendingGroupRequests: pendingGroupRequests\n    }\n}\n\nexport function loadError(error: AppError): LoadError {\n    return {\n        type: ActionFlag.DASHBOARD_LOAD_ERROR,\n        error: error\n    }\n}\n\nexport function unload(): Unload {\n    return {\n        type: ActionFlag.DASHBOARD_UNLOAD\n    }\n}\n\n// Thunks\n\nexport function load() {\n    return async (dispatch: ThunkDispatch<StoreState, void, DashboardAction>, getState: () => StoreState) => {\n        dispatch(loadStart())\n\n        const {\n            views: {\n                dashboardView\n            },\n            entities,\n            auth: { authorization: { token, username } },\n            app: { config } } = getState()\n\n        // if (dashboardView === null) {\n        //     dispatch(searchOrgsError({\n        //         code: 'invalid-state',\n        //         message: 'Search orgs may not be called without a defined view'\n        //     }))\n        //     return\n        // }\n\n        const uberClient = new uberModel.UberModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url,\n            userProfileServiceURL: config.services.UserProfile.url,\n            workspaceServiceURL: config.services.Workspace.url,\n            serviceWizardURL: config.services.ServiceWizard.url\n        })\n\n        // const orgModel = new organizationsModel.OrganizationModel({\n        //     token, username,\n        //     groupsServiceURL: config.services.Groups.url\n        // })\n\n        // const userModelClient = new userModel.UserModel({\n        //     token,\n        //     userProfileServiceURL: config.services.UserProfile.url\n        // })\n\n        const requestModelClient = new requestModel.RequestsModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        // TODO:\n\n        // get the projection, or view:\n        // - orgs of current user\n        // - requests created by or targeting current user\n        try {\n            const orgs = await uberClient.getOrganizationsForUser()\n            // const orgs = await orgModel.getOwnOrgs()\n\n            const allUsers: Map<userModel.Username, boolean> = new Map()\n\n            // orgs.forEach((org) => {\n            //     allUsers.set(org.owner.username, true)\n            //     org.members.forEach((member) => {\n            //         allUsers.set(member.username, true)\n            //     })\n            // })\n\n            // const users = await userModelClient.getUsers(Array.from(allUsers.keys()))\n\n            const requests = await requestModelClient.getUserRequests()\n\n            const invitations = await requestModelClient.getUserInvitations()\n\n            const adminOrgIds = orgs\n                .filter(({ organization }) => {\n                    // TODO: why not have relation on org, again?   \n                    if (organization.owner.username === username) {\n                        return true\n                    }\n                    if (organization.members.find((member) => {\n                        return (member.username === username && member.type === MemberType.ADMIN)\n                    })) {\n                        return true\n                    }\n                    return false\n                })\n                .map(({ organization }) => {\n                    return organization.id\n                })\n\n            const pendingGroupRequests = await requestModelClient.getPendingOrganizationRequests(adminOrgIds)\n\n            // now notifications???\n            const feedsClient = new FeedsClient({\n                token,\n                feedsServiceURL: config.services.Feeds.url\n            })\n            const notifications = await feedsClient.getNotifications()\n\n            dispatch(loadSuccess(orgs, requests, invitations, pendingGroupRequests))\n        } catch (ex) {\n            dispatch(loadError({\n                code: 'error',\n                message: ex.message\n            }))\n        }\n\n\n        // resolve all data!\n        // - orgs\n        // - requests\n        // - users (org members, owner, request requester, resource)\n\n        // fetch current orgs for this user\n\n        // const groupsInStore: Array<groups.Group> = []\n        // const groupsNeeded: Array<string> = []\n        // orgs.organizations forEach((groupId) => {\n        //     const org = entities.orgs.byId.get(groupId)\n        //     if (org) {\n        //         groupsInStore.push(org.group)\n        //     } else {\n        //         groupsNeeded.push(groupId)\n        //     }\n        // })\n\n        // for each org\n        // look for org entity in store.\n        // if don't have fetch\n        // look for sub-entities\n        // - users (members, admins, owner)\n        //   - look for user entities\n        //   - if don't find, fetch \n        // \n        // fetch all requests for user\n        // do the lookup, fetch cycle\n        // subentities:\n        // - users\n        // - orgs (should be covered by above... but some requests may \n        //         reference orgs this user does not have access to ... sigh ...)\n\n        // try {\n        //     const [orgs, requests, invitations] = await Promise.all([\n        //         model.ownOrgs(username),\n        //         model.getUserRequests(),\n        //         model.getUserInvitations()\n        //     ])\n\n        //     // const orgs = await model.ownOrgs(username)\n        //     dispatch(loadSuccess(orgs.organizations, requests, invitations))\n        // } catch (ex) {\n        //     dispatch(loadError({\n        //         code: 'error',\n        //         message: ex.message\n        //     }))\n        // }\n    }\n}\n\n","import {\n    StoreState, SortDirection, AuthState, AppState,\n    EditState, SaveState, ValidationState, BrowseOrgsState, ComponentLoadingState\n} from \"../types\";\n\n// rawOrganizations: [],\n//                         organizations: [],\n//                         totalCount: 0,\n//                         filteredCount: 0,\n//                         sortBy: 'name',\n//                         sortDirection: SortDirection.ASCENDING,\n//                         filter: 'all',\n//                         searchTerms: [],\n//                         selectedOrganizationId: null,\n//                         searching: false\nexport class StateInstances {\n    static makeInitialState(): StoreState {\n        return {\n            entities: {\n                users: {\n                    byId: new Map(),\n                    all: []\n                },\n                orgs: {\n                    byId: new Map(),\n                    all: []\n                },\n                requests: {\n                    byId: new Map(),\n                    all: []\n                },\n                narratives: {\n                    byId: new Map()\n                }\n            },\n            db: {\n                notifications: {\n                    byId: new Map(),\n                    collections: {\n                        byGroup: new Map()\n                    }\n                }\n            },\n            views: {\n                browseOrgsView: {\n                    loadingState: ComponentLoadingState.NONE,\n                    error: null,\n                    viewModel: null\n                },\n                organizationCentricView: {\n                    loadingState: ComponentLoadingState.NONE,\n                    error: null,\n                    viewModel: null\n                },\n                addOrgView: {\n                    loadingState: ComponentLoadingState.NONE,\n                    error: null,\n                    viewModel: null\n                },\n                editOrgView: {\n                    loadingState: ComponentLoadingState.NONE,\n                    error: null,\n                    viewModel: null\n                    // organizationId: '',\n                    // editState: EditState.NONE,\n                    // saveState: SaveState.NONE,\n                    // validationState: ValidationState.NONE,\n                    // editedOrganization: StaticData.makeEmptyEditableOrganization(),\n                    // organization: null\n                },\n                manageOrganizationRequestsView: {\n                    loadingState: ComponentLoadingState.NONE,\n                    error: null,\n                    viewModel: null\n                },\n                viewMembersView: {\n                    loadingState: ComponentLoadingState.NONE,\n                    error: null,\n                    viewModel: null\n                },\n                inviteUserView: {\n                    loadingState: ComponentLoadingState.NONE,\n                    error: null,\n                    viewModel: null\n                },\n                manageMembershipView: {\n                    loadingState: ComponentLoadingState.NONE,\n                    error: null,\n                    viewModel: null\n                },\n                requestNarrativeView: {\n                    loadingState: ComponentLoadingState.NONE,\n                    error: null,\n                    viewModel: null\n                },\n                dashboardView: {\n                    loadingState: ComponentLoadingState.NONE,\n                    error: null,\n                    viewModel: null\n                },\n                viewOrgView: {\n                    loadingState: ComponentLoadingState.NONE,\n                    error: null,\n                    viewModel: null\n                },\n            },\n\n\n            auth: {\n                status: AuthState.NONE,\n                message: '',\n                authorization: {\n                    token: '',\n                    username: '',\n                    realname: '',\n                    roles: []\n                }\n            },\n            error: null,\n\n            app: {\n                status: AppState.NONE,\n                config: {\n                    baseUrl: '',\n                    services: {\n                        Groups: {\n                            url: ''\n                        },\n                        UserProfile: {\n                            url: ''\n                        },\n                        Workspace: {\n                            url: ''\n                        },\n                        ServiceWizard: {\n                            url: ''\n                        },\n                        Feeds: {\n                            url: ''\n                        }\n                    }\n                }\n            },\n\n            updateOrg: {\n                pending: false\n            },\n\n\n        }\n    }\n}","import React, { Component } from 'react'\nimport { Route, Switch } from 'react-router'\nimport { Redirect, HashRouter } from 'react-router-dom'\n\n// redux\nimport { Provider } from 'react-redux';\nimport { createStore, applyMiddleware, compose } from 'redux'\nimport thunk from 'redux-thunk'\n\nimport theReducer from './redux/reducers'\n\n// the app and subcomponents\nimport './App.css';\n\n// fontawesome setup\nimport { library } from '@fortawesome/fontawesome-svg-core'\nimport { faSpinner, faSearch, faGlobe, faUserLock } from '@fortawesome/free-solid-svg-icons'\nlibrary.add(faSpinner, faSearch, faGlobe, faUserLock)\n\nimport OrganizationsBrowser from './components/views/browseOrgs/loader'\nimport NewOrganization from './components/views/newOrganization/loader'\nimport ViewOrganization from './components/views/viewOrganization/loader'\nimport EditOrganization from './components/views/editOrganization/loader'\nimport Auth from './containers/Auth'\nimport KBaseIntegration from './containers/KBaseIntegration'\nimport ManageOrganizationRequests from './components/views/manageOrganizationRequests/loader'\nimport ViewMembers from './components/views/viewMembers/loader'\nimport InviteUser from './components/views/inviteUser/loader'\nimport ManageMembership from './components/views/manageMembership/loader'\nimport RequestAddNarrative from './components/views/requestAddNarrative/loader'\nimport DashboardView from './components/views/dashboard/loader'\nimport { StateInstances } from './redux/state';\n\n// Put the redux store together\n// Just for prototyping --- This is super naive and will change!\n// import {organizations} from './data/temp';\n\n// TODO: determine the environment\n\nconst hosted = window.frameElement ? true : false\n\n// Set up initial state \n// TODO: move to own file\nconst initialState = StateInstances.makeInitialState()\n\n\n// TODO: remove the cast of reducer to any...\n// const middleware = [thunk]\n// const store = createStore<StoreState, SortOrgs, null, null>(theReducer as any, initialState, applyMiddleware(thunk));\nconst store = createStore(theReducer as any, initialState as any, compose(applyMiddleware(thunk)))\n\nclass App extends Component {\n  constructor(props: any) {\n    super(props)\n  }\n\n  render() {\n    return (\n      <Provider store={store}>\n        <Auth hosted={hosted}>\n          <KBaseIntegration>\n            <HashRouter basename=\"/orgs/\">\n              <div className=\"App scrollable-flex-column\">\n                <div className=\"App-body scrollable-flex-column\">\n                  <Switch>\n                    <Route path=\"/\" exact={true} component={DashboardView} />\n                    <Route path=\"/organizations\" component={OrganizationsBrowser} />\n                    <Route path=\"/newOrganization\" component={NewOrganization} />\n                    {/* The destructuring below is ugly, but effective */}\n                    <Route path=\"/viewOrganization/:id\" component={({ match: { params: { id } } }: { match: { params: { id: string } } }) => <ViewOrganization organizationId={id} />} />\n                    <Route path=\"/editOrganization/:id\" component={({ match: { params: { id } } }: { match: { params: { id: string } } }) => <EditOrganization organizationId={id} />} />\n                    <Route path=\"/manageOrganizationRequests/:id\" component={({ match: { params: { id } } }: { match: { params: { id: string } } }) => <ManageOrganizationRequests organizationId={id} />} />\n                    <Route path=\"/viewMembers/:id\" component={({ match: { params: { id } } }: { match: { params: { id: string } } }) => <ViewMembers organizationId={id} />} />\n                    <Route path=\"/inviteUser/:id\" component={({ match: { params: { id } } }: { match: { params: { id: string } } }) => (<InviteUser organizationId={id} />)} />\n                    <Route path=\"/membership/:id\" component={({ match: { params: { id } } }: { match: { params: { id: string } } }) => (<ManageMembership organizationId={id} />)} />\n                    <Route path=\"/requestAddNarrative/:id\" component={({ match: { params: { id } } }: { match: { params: { id: string } } }) => (<RequestAddNarrative organizationId={id} />)} />\n\n                    {/* <Redirect from=\"/\" to=\"/organizations\" exact={true} /> */}\n                  </Switch>\n                </div>\n              </div>\n            </HashRouter>\n          </KBaseIntegration>\n        </Auth>\n      </Provider>\n    )\n  }\n}\n\nexport default App\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n// import * as serviceWorker from './serviceWorker';\nimport 'typeface-oxygen';\nimport 'normalize.css';\nimport 'antd/dist/antd.css'\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: http://bit.ly/CRA-PWA\n// serviceWorker.unregister();\n"],"sourceRoot":""}